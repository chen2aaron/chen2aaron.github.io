<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>xixijun&#39;s blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://morningchen.com/"/>
  <updated>2018-11-30T09:25:49.000Z</updated>
  <id>https://morningchen.com/</id>
  
  <author>
    <name>xixijun</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Use ZeroNet With Tor</title>
    <link href="https://morningchen.com/2018/11/30/use-zeronet-with-tor/"/>
    <id>https://morningchen.com/2018/11/30/use-zeronet-with-tor/</id>
    <published>2018-11-30T09:31:00.000Z</published>
    <updated>2018-11-30T09:25:49.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Use-ZeroNet-With-Tor"><a href="#Use-ZeroNet-With-Tor" class="headerlink" title="Use ZeroNet With Tor"></a>Use ZeroNet With Tor</h1><blockquote><p><code>ZeroNet</code> æœ¬èº«å¹¶ä¸æ˜¯åŒ¿åç½‘ç»œã€‚ä½†ä»–å¯ä»¥ä¸ <code>Tor Browser</code> ç»“åˆï¼Œå®ç°åŒ¿åç½‘ç»œçš„åŠŸèƒ½ã€‚</p></blockquote><ol><li><p>å®‰è£… <code>ZeroNet</code> å’Œ <code>Tor Browser</code>ï¼Œè¯¦ç»†æ•™ç¨‹å¯ä»¥å‚è§å®˜ç½‘ã€‚</p></li><li><p>æ‰“å¼€æ´‹è‘±æµè§ˆå™¨ï¼ˆTor borwserï¼‰</p><ul><li>æ‰“å¼€ç½‘å€ about:preferences</li><li>ç‚¹å‡» ç½‘ç»œä»£ç† - è®¾ç½®</li><li>è¾“å…¥ 127.0.0.1 å¹¶æŠŠè¿™ä¸ªåœ°å€åŠ å…¥åˆ° ä¸é€šè¿‡ä»£ç†è®¿é—®</li></ul></li></ol><a id="more"></a><p><img src="torsettings.png" alt=""></p><ol start="3"><li><p>ç¼–è¾‘ <code>Tor</code> çš„é…ç½®æ–‡ä»¶ <code>torrc</code>ï¼Œæ·»åŠ ä¸€è¡Œï¼Œç„¶åé‡å¯ <code>Tor</code> æœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ControlPort 9051</span><br></pre></td></tr></table></figure></li><li><p>è¿è¡Œ <code>ZeroNet</code> å¹¶æ‰“å¼€ <code>http://127.0.0.1:43110/Config</code>ï¼Œè®¾ç½® Network - Tor - Always<br><img src="zeronetconfig.png" alt=""></p></li><li><p>æ‰¾åˆ° <code>ZeroNet</code> çš„é…ç½®æ–‡ä»¶ <code>zeronet.conf</code>ï¼Œå¢åŠ  2 è¡Œ Tor ä»£ç†é…ç½®ï¼Œä¿å­˜å¹¶é‡å¯ <code>ZeroNet</code> æœåŠ¡</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">tor = always</span><br><span class="line">fileserver_port = 15441</span><br><span class="line">tor_controller = 127.0.0.1:9151</span><br><span class="line">tor_proxy = 127.0.0.1:9150</span><br></pre></td></tr></table></figure><ol start="6"><li>ç”¨ <code>Tor Browser</code> è®¿é—® <code>http://127.0.0.1:43110</code> å°±å¯ä»¥å•¦ã€‚</li></ol><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><code>ZeroNetä¸­æ–‡å®‰è£…æŒ‡å—</code> <a href="https://stgapr.github.io/zeronet-Documentation-ZH_CN/faq/" target="_blank" rel="noopener">https://stgapr.github.io/zeronet-Documentation-ZH_CN/faq/</a></li><li><code>Tor</code> é…ç½®æ–‡ä»¶è·¯å¾„ <a href="https://www.torproject.org/docs/faq.html.en#AdvancedTorUsage" target="_blank" rel="noopener">https://www.torproject.org/docs/faq.html.en#AdvancedTorUsage</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Use-ZeroNet-With-Tor&quot;&gt;&lt;a href=&quot;#Use-ZeroNet-With-Tor&quot; class=&quot;headerlink&quot; title=&quot;Use ZeroNet With Tor&quot;&gt;&lt;/a&gt;Use ZeroNet With Tor&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;ZeroNet&lt;/code&gt; æœ¬èº«å¹¶ä¸æ˜¯åŒ¿åç½‘ç»œã€‚ä½†ä»–å¯ä»¥ä¸ &lt;code&gt;Tor Browser&lt;/code&gt; ç»“åˆï¼Œå®ç°åŒ¿åç½‘ç»œçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;å®‰è£… &lt;code&gt;ZeroNet&lt;/code&gt; å’Œ &lt;code&gt;Tor Browser&lt;/code&gt;ï¼Œè¯¦ç»†æ•™ç¨‹å¯ä»¥å‚è§å®˜ç½‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ‰“å¼€æ´‹è‘±æµè§ˆå™¨ï¼ˆTor borwserï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰“å¼€ç½‘å€ about:preferences&lt;/li&gt;
&lt;li&gt;ç‚¹å‡» ç½‘ç»œä»£ç† - è®¾ç½®&lt;/li&gt;
&lt;li&gt;è¾“å…¥ 127.0.0.1 å¹¶æŠŠè¿™ä¸ªåœ°å€åŠ å…¥åˆ° ä¸é€šè¿‡ä»£ç†è®¿é—®&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Research" scheme="https://morningchen.com/categories/Research/"/>
    
    
      <category term="ZeroNet" scheme="https://morningchen.com/tags/ZeroNet/"/>
    
      <category term="Tor" scheme="https://morningchen.com/tags/Tor/"/>
    
  </entry>
  
  <entry>
    <title>Use Gitlab CI</title>
    <link href="https://morningchen.com/2018/10/16/use-gitlab-ci/"/>
    <id>https://morningchen.com/2018/10/16/use-gitlab-ci/</id>
    <published>2018-10-16T06:31:22.000Z</published>
    <updated>2018-11-30T09:24:31.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸ºä½•ä½¿ç”¨-CI-CD"><a href="#ä¸ºä½•ä½¿ç”¨-CI-CD" class="headerlink" title="ä¸ºä½•ä½¿ç”¨ CI/CD"></a>ä¸ºä½•ä½¿ç”¨ CI/CD</h2><blockquote><p>å†™äº†ä¸€ä¸ªè·¨å¹³å°æ¡Œé¢åº”ç”¨é¡¹ç›®ï¼Œå…¶ä½¿ç”¨ Elecron ä½œä¸ºæ¡†æ¶ï¼Œéœ€è¦åœ¨ä¸åŒçš„æ¡Œé¢ç«¯ï¼ˆmacï¼Œwinï¼Œlinuxï¼‰è¿›è¡Œæµ‹è¯•+æ‰“åŒ…å·¥ä½œï¼Œæ‰‹åŠ¨æ–¹å¼å¾ˆç¹çï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€å¥— CI/CD èƒ½å¤Ÿå®Œæˆ  è‡ªåŠ¨åŒ–æµ‹è¯•æ‰“åŒ…åŠéƒ¨ç½²ã€‚</p></blockquote><ul><li>å¦‚æœä½¿ç”¨çš„æ˜¯ Gitlab ä½œä¸ºç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå¯¹åº”çš„ä½¿ç”¨<code>Gitlab CI</code>ä½œä¸ºè§£å†³æ–¹æ¡ˆã€‚</li><li>å¦‚æœä½¿ç”¨ Github ä½œä¸ºç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>Travis CI</code>(æ”¯æŒ Linux + OSX å¹³å°ï¼ŒWindows æ”¯æŒä¹Ÿå°†ä¼šé©¬ä¸Šå‘å¸ƒ)å’Œ<code>AppVeyor</code>(æ”¯æŒ Windows + Linux å¹³å°)</li></ul><p>æˆ‘ä»¬è¿™è¾¹ä»¥<code>Gitlab CI</code>ä¸ºä¾‹ã€‚</p><a id="more"></a><h2 id="1-é…ç½®-Gitlab-Runner"><a href="#1-é…ç½®-Gitlab-Runner" class="headerlink" title="1. é…ç½® Gitlab Runner"></a>1. é…ç½® <code>Gitlab Runner</code></h2><p><code>Gitlab Runner</code>æ˜¯<code>.gitlab-ci.yml</code>è„šæœ¬çš„è¿è¡Œå™¨ï¼Œ<code>Gitlab Runner</code>æ˜¯åŸºäº Gitlab-CI çš„ API è¿›è¡Œæ„å»ºçš„ç›¸äº’éš”ç¦»çš„æœºå™¨ï¼ˆæˆ–è™šæ‹Ÿæœºï¼‰ã€‚<code>GitLab Runner</code> ä¸éœ€è¦å’Œ Gitlab å®‰è£…åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œä½†æ˜¯è€ƒè™‘åˆ° GitLab Runner çš„èµ„æºæ¶ˆè€—é—®é¢˜å’Œå®‰å…¨é—®é¢˜ï¼Œä¹Ÿä¸å»ºè®®è¿™ä¸¤è€…å®‰è£…åœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚</p><p><code>Gitlab Runner</code>åˆ†ä¸ºä¸¤ç§ï¼Œ<code>Shared runners</code>å’Œ<code>Specific runners</code>ã€‚<br><code>Specific runners</code>åªèƒ½è¢«æŒ‡å®šçš„é¡¹ç›®ä½¿ç”¨ï¼Œ<code>Shared runners</code>åˆ™å¯ä»¥è¿è¡Œæ‰€æœ‰å¼€å¯ <code>Allow shared runners</code>é€‰é¡¹çš„é¡¹ç›®ã€‚</p><p>å…³äºå¦‚ä½•å®‰è£…<code>Gitlab Runner</code>ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œ<a href="https://docs.gitlab.com/runner/install/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a> è‚¯å®šæ˜¯æœ€ä½³é€‰æ‹©ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬é…ç½®äº† 2 å°<code>Specific Runner</code>ï¼Œä¸€å° Windows å¹³å°ä¸‹ï¼Œä¸€å° Linux å¹³å°ä¸‹ï¼Œå¦‚å›¾æ‰€ç¤º</p><p><img src="gitlab-runner.jpeg" alt=""></p><p>é¡ºä¾¿è¯´è¯´é…ç½®æ—¶è¸©åˆ°çš„å‘ï¼š</p><blockquote><p>åœ¨é…ç½®ç© Runner åï¼Œgitlab ui ä¸€ç›´æ˜¾ç¤ºè¿™ä¸ª Runner çš„è­¦å‘Šï¼Œä¸æ˜¯ç»¿è‰²çš„ è€Œæ˜¯æ„Ÿå¹å· âš ï¸</p></blockquote><p><strong>åæ¥å‘ç°åœ¨æ‰§è¡Œå®Œ<code>gitlab-runner start</code>åï¼Œè¿˜è¦æ‰§è¡Œ<code>gitlab-runner run</code>æ‰ç®—æ˜¯çœŸæ­£çš„è·‘èµ·æ¥ã€‚ã€‚ã€‚</strong></p><p>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹<code>Linux Runner</code>çš„é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/gitlab-runner/config.toml</span><br><span class="line"></span><br><span class="line">concurrent = 1</span><br><span class="line">check_interval = 0</span><br><span class="line"></span><br><span class="line">[session_server]</span><br><span class="line">  session_timeout = 1800</span><br><span class="line"></span><br><span class="line">[[runners]]</span><br><span class="line">  name = <span class="string">"WH46-Linux-Runner"</span></span><br><span class="line">  url = <span class="string">"https://xxxxxxxx.com/"</span></span><br><span class="line">  token = <span class="string">"xxxxxxxx"</span></span><br><span class="line">  executor = <span class="string">"docker"</span></span><br><span class="line">  [runners.docker]</span><br><span class="line">    tls_verify = <span class="literal">false</span></span><br><span class="line">    image = <span class="string">"python:3.6.6-slim"</span></span><br><span class="line">    privileged = <span class="literal">false</span></span><br><span class="line">    disable_cache = <span class="literal">false</span></span><br><span class="line">    volumes = [<span class="string">"/root/build_cache:/cache:rw"</span>]</span><br><span class="line">    shm_size = 0</span><br><span class="line">    pull_policy = <span class="string">"if-not-present"</span></span><br><span class="line">  [runners.cache]</span><br><span class="line">    [runners.cache.s3]</span><br><span class="line">    [runners.cache.gcs]</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©<code>docker</code>ä½œä¸º <code>Runner</code>çš„<code>executor</code>ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©<code>shell</code>ã€‚</li><li>å¦‚æœæƒ³åœ¨ docker çš„å®¿ä¸»æœºä¸Šä¿å­˜ cacheï¼Œå¯ä»¥é…ç½®<code>volumes = [&quot;/root/build_cache:/cache:rw&quot;]</code>ï¼Œå°†å®¿ä¸»æœºçš„<code>/root/build_cache</code>ç›®å½•æ˜ å°„åˆ° docker çš„<code>/cache</code>ç›®å½•ï¼Œå¹¶ä¸”å¯è¯»å¯å†™ã€‚</li><li>è¿™é‡Œæ‹‰å– docker é•œåƒçš„ç­–ç•¥æ˜¯<code>pull_policy = &quot;if-not-present&quot;</code>ï¼Œå½“æœ¬åœ°é•œåƒä¸å­˜åœ¨æ—¶ï¼Œæ‰æ‹‰å–è¿œç¨‹çš„é•œåƒï¼ˆé»˜è®¤é…ç½®æ˜¯ç›´æ¥ä»è¿œç¨‹æ‹‰å–ï¼‰</li></ul><p>ä¸‹é¢æ˜¯<code>Windows Runner</code>çš„é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">concurrent = 1</span><br><span class="line">check_interval = 0</span><br><span class="line"></span><br><span class="line">[session_server]</span><br><span class="line">  session_timeout = 1800</span><br><span class="line"></span><br><span class="line">[[runners]]</span><br><span class="line">  name = <span class="string">"WH44-WIN-Runner"</span></span><br><span class="line">  url = <span class="string">"https://xxxxxxx.com/"</span></span><br><span class="line">  token = <span class="string">"xxxxxxxx"</span></span><br><span class="line">  executor = <span class="string">"shell"</span></span><br><span class="line">  [runners.cache]</span><br><span class="line">    [runners.cache.s3]</span><br><span class="line">    [runners.cache.gcs]</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©<code>shell</code>ä½œä¸º <code>Runner</code>çš„<code>executor</code>ã€‚ï¼ˆå› ä¸º docker æ²¡æœ‰ windows çš„é•œåƒï¼Œè€Œæˆ‘ä»¬éœ€è¦åœ¨ windows ç¯å¢ƒä¸‹æ‰“åŒ…ï¼‰</li></ul><h2 id="2-é…ç½®-gitlab-ci-yml"><a href="#2-é…ç½®-gitlab-ci-yml" class="headerlink" title="2. é…ç½® .gitlab-ci.yml"></a>2. é…ç½® <code>.gitlab-ci.yml</code></h2><p>åªè¦åœ¨é¡¹ç›®ä»“åº“çš„æ ¹ç›®å½•æ·»åŠ <code>.gitlab-ci.yml</code>æ–‡ä»¶ï¼Œå¹¶ä¸”é…ç½®äº†Runnerï¼ˆè¿è¡Œå™¨ï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡åˆå¹¶è¯·æ±‚ï¼ˆMRï¼‰æˆ–è€…push æˆ–è€…æ‰“tag éƒ½ä¼šè§¦å‘CI pipelineã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæ›´å¤šçš„é…ç½®å¯ä»¥å‚è€ƒ <code>gitlab ci</code> çš„å®˜æ–¹æ–‡æ¡£<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">image: python:3.6.6-custom</span><br><span class="line">stages:</span><br><span class="line">  - test</span><br><span class="line">  - report</span><br><span class="line">  - deploy</span><br><span class="line"></span><br><span class="line">variables:</span><br><span class="line">  PIP_CACHE_DIR: "$CI_PROJECT_DIR/pip-cache"</span><br><span class="line"></span><br><span class="line">cache:</span><br><span class="line">  key: "$CI_PROJECT_ID"</span><br><span class="line">  paths:</span><br><span class="line">  - $CI_PROJECT_DIR/pip-cache</span><br><span class="line">  - $CI_PROJECT_DIR/node_modules</span><br><span class="line"></span><br><span class="line">before_script:</span><br><span class="line"><span class="comment">#  - apt-get update &amp;&amp; apt-get install -y --no-install-recommends gcc python3-dev libssl-dev</span></span><br><span class="line"><span class="comment">#  - apt-get install --reinstall -y build-essential</span></span><br><span class="line">  - python --version</span><br><span class="line">  - pip install -r zipoc/requirements.txt -i https://mirrors.aliyun.com/pypi/simple</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">  stage: test</span><br><span class="line">  tags:</span><br><span class="line">    - linux</span><br><span class="line">  script:</span><br><span class="line">    - pip list</span><br><span class="line"><span class="comment">#    - python -m unittest</span></span><br><span class="line"></span><br><span class="line">coverage:</span><br><span class="line">  stage: report</span><br><span class="line">  tags:</span><br><span class="line">    - linux</span><br><span class="line">  coverage: '/TOTAL\s+\d+\s+\d+\s+(\d+%)/'</span><br><span class="line">  script:</span><br><span class="line">    - pip install coverage</span><br><span class="line"><span class="comment">#    - coverage run -m unittest</span></span><br><span class="line">    - coverage report</span><br><span class="line"></span><br><span class="line">windows package:</span><br><span class="line">  stage: deploy</span><br><span class="line">  tags:</span><br><span class="line">    - win</span><br><span class="line">  before_script:</span><br><span class="line">    - pwd</span><br><span class="line">    - virtualenv.exe --python "C:\\Users\\app\\AppData\\Local\\Programs\\Python\\Python36\\python.exe" env</span><br><span class="line">    - call env\Scripts\activate</span><br><span class="line">    - call pip install -r zipoc/requirements.txt</span><br><span class="line">  script:</span><br><span class="line">    - pyinstaller</span><br><span class="line">    - npm run build:win32</span><br><span class="line">  artifacts:</span><br><span class="line">    paths:</span><br><span class="line">      - build/zipoc-win32-x64/</span><br><span class="line">    expire_in: 7d</span><br><span class="line">  only:</span><br><span class="line">    - tags</span><br><span class="line">  except:</span><br><span class="line">    - branches</span><br></pre></td></tr></table></figure></p><h2 id="é—®é¢˜-windows-runner-ä¸è¿è¡Œ"><a href="#é—®é¢˜-windows-runner-ä¸è¿è¡Œ" class="headerlink" title="é—®é¢˜: windows runner ä¸è¿è¡Œ"></a>é—®é¢˜: windows runner ä¸è¿è¡Œ</h2><p>è¿è¡Œå®Œ<code>before_script</code>åé¢çš„<code>script</code>å°±è·³è¿‡ä¸è¿è¡Œäº†ï¼Œåæ¥å‘ç°æ˜¯<code>CMD</code>çš„å‘ã€‚</p><p>åœ¨ windows ä¸Šä½¿ç”¨ Runner æ—¶ï¼Œé»˜è®¤ shell æ˜¯<code>CMD</code>ï¼Œæœ‰å¤ªå¤š 80 å¹´ä»£çš„<code>MS-DOS</code>é—ç•™é—®é¢˜éœ€è¦è¸©ï¼Œ<br>è§£å†³åŠæ³•æ˜¯åœ¨å‘½ä»¤å‰åŠ ä¸Š<code>call</code>ï¼Œ<br>æˆ–è€…ä½¿ç”¨<code>powershell</code>ä½œä¸º Runner çš„<code>shell</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">before_script:</span><br><span class="line">  - call npm install --silent</span><br><span class="line"></span><br><span class="line">stages:</span><br><span class="line">  - test</span><br><span class="line"></span><br><span class="line">lint:</span><br><span class="line">  stage: test</span><br><span class="line">  tags:</span><br><span class="line">    - javascript</span><br><span class="line">  script:</span><br><span class="line">    - call eslint */**</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸ºä½•ä½¿ç”¨-CI-CD&quot;&gt;&lt;a href=&quot;#ä¸ºä½•ä½¿ç”¨-CI-CD&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä½•ä½¿ç”¨ CI/CD&quot;&gt;&lt;/a&gt;ä¸ºä½•ä½¿ç”¨ CI/CD&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;å†™äº†ä¸€ä¸ªè·¨å¹³å°æ¡Œé¢åº”ç”¨é¡¹ç›®ï¼Œå…¶ä½¿ç”¨ Elecron ä½œä¸ºæ¡†æ¶ï¼Œéœ€è¦åœ¨ä¸åŒçš„æ¡Œé¢ç«¯ï¼ˆmacï¼Œwinï¼Œlinuxï¼‰è¿›è¡Œæµ‹è¯•+æ‰“åŒ…å·¥ä½œï¼Œæ‰‹åŠ¨æ–¹å¼å¾ˆç¹çï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€å¥— CI/CD èƒ½å¤Ÿå®Œæˆ  è‡ªåŠ¨åŒ–æµ‹è¯•æ‰“åŒ…åŠéƒ¨ç½²ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨çš„æ˜¯ Gitlab ä½œä¸ºç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå¯¹åº”çš„ä½¿ç”¨&lt;code&gt;Gitlab CI&lt;/code&gt;ä½œä¸ºè§£å†³æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨ Github ä½œä¸ºç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œåˆ™å¯ä»¥ä½¿ç”¨&lt;code&gt;Travis CI&lt;/code&gt;(æ”¯æŒ Linux + OSX å¹³å°ï¼ŒWindows æ”¯æŒä¹Ÿå°†ä¼šé©¬ä¸Šå‘å¸ƒ)å’Œ&lt;code&gt;AppVeyor&lt;/code&gt;(æ”¯æŒ Windows + Linux å¹³å°)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬è¿™è¾¹ä»¥&lt;code&gt;Gitlab CI&lt;/code&gt;ä¸ºä¾‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="DevOps" scheme="https://morningchen.com/categories/DevOps/"/>
    
    
      <category term="GitLab" scheme="https://morningchen.com/tags/GitLab/"/>
    
      <category term="CI/CD" scheme="https://morningchen.com/tags/CI-CD/"/>
    
  </entry>
  
  <entry>
    <title>CEYE.IO</title>
    <link href="https://morningchen.com/2017/11/04/ceye-architechure/"/>
    <id>https://morningchen.com/2017/11/04/ceye-architechure/</id>
    <published>2017-11-04T03:46:48.000Z</published>
    <updated>2018-09-27T14:35:46.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-CEYEæ˜¯ä»€ä¹ˆ"><a href="#1-CEYEæ˜¯ä»€ä¹ˆ" class="headerlink" title="1. CEYEæ˜¯ä»€ä¹ˆ"></a>1. CEYEæ˜¯ä»€ä¹ˆ</h2><p>CEYEæ˜¯ä¸€ä¸ªç”¨æ¥æ£€æµ‹ <code>å¸¦å¤–ï¼ˆOut-of-Bandï¼‰</code>æµé‡çš„ç›‘æ§å¹³å°ï¼Œå¦‚DNSæŸ¥è¯¢å’ŒHTTPè¯·æ±‚ã€‚å®ƒå¯ä»¥å¸®åŠ©å®‰å…¨ç ”ç©¶äººå‘˜åœ¨æµ‹è¯•æ¼æ´æ—¶æ”¶é›†ä¿¡æ¯ï¼ˆä¾‹å¦‚SSRF / XXE / RFI / RCEï¼‰ã€‚</p><h2 id="2-ä¸ºä»€ä¹ˆä¼šæœ‰CEYE"><a href="#2-ä¸ºä»€ä¹ˆä¼šæœ‰CEYE" class="headerlink" title="2. ä¸ºä»€ä¹ˆä¼šæœ‰CEYE"></a>2. ä¸ºä»€ä¹ˆä¼šæœ‰CEYE</h2><p>æåˆ°ä¸ºä»€ä¹ˆä¼šæœ‰CEYEå°±å¿…é¡»æåˆ°å®ƒçš„ä½¿ç”¨åœºæ™¯äº†ã€‚</p><p>æœ‰ä¸¤ç§å¸¸è§çš„æƒ…å†µä¼šå¯¼è‡´è®¸å¤šæ¼æ´æ‰«æå·¥å…·æ¼æ‰«ï¼š</p><ul><li>æ¼æ´æ£€æµ‹æˆ–æ¼æ´åˆ©ç”¨éœ€è¦è¿›ä¸€æ­¥çš„ç”¨æˆ·æˆ–ç³»ç»Ÿäº¤äº’</li><li>ä¸€äº›æ¼æ´ç±»å‹æ²¡æœ‰ç›´æ¥è¡¨æ˜æ”»å‡»æ˜¯æˆåŠŸçš„ã€‚å¦‚Payloadè§¦å‘äº†å´ä¸åœ¨å‰ç«¯é¡µé¢æ˜¾ç¤ºã€‚</li></ul><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼€å‘äº†CEYEå¹³å°ã€‚é€šè¿‡ä½¿ç”¨è¯¸å¦‚DNSå’ŒHTTPä¹‹ç±»çš„å¸¦å¤–ä¿¡é“ï¼Œä¾¿å¯ä»¥å¾—åˆ°å›æ˜¾ä¿¡æ¯ã€‚</p><a id="more"></a><h2 id="3-å¦‚ä½•ä½¿ç”¨"><a href="#3-å¦‚ä½•ä½¿ç”¨" class="headerlink" title="3. å¦‚ä½•ä½¿ç”¨"></a>3. å¦‚ä½•ä½¿ç”¨</h2><p>ç™»å½• <code>ceye.io</code>ï¼Œåœ¨<a href="http://ceye.io/profile" target="_blank" rel="noopener">ç”¨æˆ·è¯¦æƒ…é¡µ</a>å¯ä»¥çœ‹åˆ°è‡ªå·±çš„åŸŸåæ ‡è¯†ç¬¦ <code>identifier</code>ï¼Œå¯¹äºæ¯ä¸ªç”¨æˆ·ï¼Œéƒ½æœ‰å”¯ä¸€çš„åŸŸåæ ‡è¯†ç¬¦å¦‚<code>abcdef.ceye.io</code>ã€‚æ‰€æœ‰æ¥è‡ªäº<code>abcdef.ceye.io</code>æˆ–<code>*.abcdef.ceye.io</code>çš„ <code>DNSæŸ¥è¯¢</code>å’Œ<code>HTTPè¯·æ±‚</code>éƒ½ä¼šè¢«è®°å½•ã€‚é€šè¿‡æŸ¥çœ‹è¿™äº›è®°å½•ä¿¡æ¯ï¼Œå®‰å…¨ç ”ç©¶äººå‘˜å¯ä»¥ç¡®è®¤å¹¶æ”¹è¿›è‡ªå·±çš„æ¼æ´ç ”ç©¶æ–¹æ¡ˆã€‚</p><h3 id="3-1-é€šè¿‡DNSå¸¦å¤–ä¿¡é“æ£€æµ‹-Blind-Payload-çš„æ‰§è¡Œæƒ…å†µ"><a href="#3-1-é€šè¿‡DNSå¸¦å¤–ä¿¡é“æ£€æµ‹-Blind-Payload-çš„æ‰§è¡Œæƒ…å†µ" class="headerlink" title="3.1 é€šè¿‡DNSå¸¦å¤–ä¿¡é“æ£€æµ‹ Blind Payload çš„æ‰§è¡Œæƒ…å†µ"></a>3.1 é€šè¿‡DNSå¸¦å¤–ä¿¡é“æ£€æµ‹ Blind Payload çš„æ‰§è¡Œæƒ…å†µ</h3><p><img src="ceye-dns.jpeg" alt=""></p><p>DNSæŸ¥è¯¢å¯ä»¥ä»¥å¤šç§ä¸åŒçš„æ–¹å¼è¿›è¡Œè§£æã€‚<code>CEYE.IO</code>å¹³å°æä¾›äº†ä¸€å°DNS Serveræ¥è§£æåŸŸåã€‚å®ƒçš„<code>nameserver address</code>è¢«è®¾ç½®ä¸ºè‡ªå·±çš„æœåŠ¡å™¨IPï¼Œå› æ­¤æ‰€æœ‰å…³äº<code>ceye.io</code>çš„åŸŸåçš„DNSæŸ¥è¯¢æœ€ç»ˆéƒ½ä¼šè¢«å‘é€åˆ°CEYEçš„DNSæœåŠ¡å™¨ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ç»ˆç«¯ä¸­ä½¿ç”¨<code>nslookup</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">âœ nslookup `whoami`.abcdef.ceye.io</span><br><span class="line">Server:127.1.1.1</span><br><span class="line">Address:127.1.1.1<span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:chan.abcdef.ceye.io</span><br><span class="line">Address: 118.192.48.48</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æœ‰è®°å½•äº§ç”Ÿ<br><img src="ceye-dns01.jpeg" alt=""></p><p>æˆ‘ä»¬ä¿å­˜äº†æœ€è¿‘çš„100æ¡è®°å½•ï¼Œä½ å¯ä»¥é€šè¿‡æœç´¢æ¡†ï¼Œæœç´¢å¹¶å¯¼å‡ºä½ éœ€è¦çš„ç»“æœï¼Œå¯¼å‡ºæ ¼å¼ä¸º<code>JSON</code>ã€‚æ›´å¤šçš„Playloadä¿¡æ¯å¯ä»¥ç™»å½•<code>CEYE.IO</code>å¹³å°è·å–ã€‚</p><h3 id="3-2-é€šè¿‡HTTPå¸¦å¤–ä¿¡é“æ£€æµ‹-Blind-Payload-çš„æ‰§è¡Œæƒ…å†µ"><a href="#3-2-é€šè¿‡HTTPå¸¦å¤–ä¿¡é“æ£€æµ‹-Blind-Payload-çš„æ‰§è¡Œæƒ…å†µ" class="headerlink" title="3.2 é€šè¿‡HTTPå¸¦å¤–ä¿¡é“æ£€æµ‹ Blind Payload çš„æ‰§è¡Œæƒ…å†µ"></a>3.2 é€šè¿‡HTTPå¸¦å¤–ä¿¡é“æ£€æµ‹ Blind Payload çš„æ‰§è¡Œæƒ…å†µ</h3><p>CEYE.IOå¹³å°æ‹¥æœ‰è‡ªå·±çš„HTTPæœåŠ¡å™¨ï¼Œè®°å½•ç”¨æˆ·åŸŸåçš„æ‰€æœ‰è¯·æ±‚ã€‚è¿™å¯ä»¥ç”¨æ¥åšä¸€äº›æœ‰è¶£çš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">âœ curl -X POST http://ip.port.abcdef.ceye.io/`whoami`?p=http -d data=http</span><br><span class="line">&#123;<span class="string">"meta"</span>: &#123;<span class="string">"code"</span>: 201, <span class="string">"message"</span>: <span class="string">"HTTP Record Insert Success"</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="ceye-http01.jpeg" alt=""></p><p>åœ¨åå°ï¼ŒCEYE.IOå¹³å°å°†è®°å½•å®¢æˆ·ç«¯è¯·æ±‚çš„URLï¼Œè¿œç¨‹IPåœ°å€ï¼ŒHttp Methodï¼ŒDataï¼ŒUser Agentï¼ŒContent Typeç­‰ä¿¡æ¯ã€‚ä½ å¯ä»¥åœ¨HTTP Recordsé¡µé¢æ‰¾åˆ°è¿™äº›è¯¦ç»†ä¿¡æ¯ã€‚</p><h2 id="4-å…³äºCEYEæ¶æ„"><a href="#4-å…³äºCEYEæ¶æ„" class="headerlink" title="4. å…³äºCEYEæ¶æ„"></a>4. å…³äºCEYEæ¶æ„</h2><p>åŸceyeçš„æ¶æ„ï¼š</p><ul><li>å¼€å‘è¯­è¨€ï¼špython2.7</li><li>Nginxåå‘ä»£ç†</li><li>åç«¯WEBå¼•æ“ï¼šFlask</li><li>ORMï¼šSQLAlchemy</li><li>æ•°æ®åº“ï¼šMySQL</li></ul><p>æ–°çš„CEYEé‡‡ç”¨äº†å‰åç«¯åˆ†ç¦»æ¶æ„ï¼š</p><p>å‰ç«¯ <code>ceye.io</code>ï¼š</p><ul><li>å¼€å‘è¯­è¨€ï¼šES6</li><li>Reactå…¨å®¶æ¡¶ï¼šreact react-router react-redux</li><li>å¼‚æ­¥è¯·æ±‚åº“ï¼šAxios</li><li>ES6è½¬ç ç¼–è¯‘å™¨ï¼šBabel</li><li>æ‰“åŒ…å·¥å…·ï¼šWebpack</li><li>UIè®¾è®¡ï¼šAntDesion</li><li>UIåŠ¨æ•ˆï¼šAntMotion</li></ul><p>åç«¯ <code>api.ceye.io</code>ï¼š</p><ul><li>å¼€å‘è¯­è¨€ï¼špython3.6</li><li>WEBæ¡†æ¶ï¼š<a href="https://github.com/falconry/falcon" target="_blank" rel="noopener">Falcon</a></li><li>ORMï¼šredisco</li><li>æ•°æ®åº“ NOSQLï¼šRedis</li><li>æ•°æ®æ ¡éªŒï¼šcerberus</li><li>éƒ¨ç½²ï¼šFabric</li><li>DNS Serverï¼štwisted</li><li>WSGI Serverï¼šgunicorn</li><li>è´Ÿè½½å‡è¡¡ï¼šNginx</li></ul><h3 id="4-1-æŠ€æœ¯é€‰å‹"><a href="#4-1-æŠ€æœ¯é€‰å‹" class="headerlink" title="4.1 æŠ€æœ¯é€‰å‹"></a>4.1 æŠ€æœ¯é€‰å‹</h3><h4 id="æ•°æ®åº“-MySQL-or-Redisï¼Ÿ"><a href="#æ•°æ®åº“-MySQL-or-Redisï¼Ÿ" class="headerlink" title="æ•°æ®åº“ MySQL or Redisï¼Ÿ"></a>æ•°æ®åº“ MySQL or Redisï¼Ÿ</h4><p>æˆ‘ä»¬å®Œå…¨å¼ƒç”¨äº†ä»¥å‰çš„MySQLæ•°æ®åº“ï¼Œé‡‡ç”¨äº†Redisä½œä¸ºåç«¯æ•°æ®åº“ã€‚åŸå› æ˜¯å½“æ•°ä¸ªè¡¨çš„æ•°æ®çªç ´äº†äº¿è¡Œï¼Œé¡µé¢ä¸ŠåŒæ—¶éœ€è¦è¯»å–çš„åŠ¨æ€æ•°æ®å¢å¤šæ—¶ï¼Œä¸ºäº†ä¼˜åŒ–MySQLçš„æ“ä½œå°±æ˜¾å¾—å¾—ä¸å¿å¤±ã€‚è€Œ Redis å¯ä»¥åœ¨å•å°æœåŠ¡å™¨ä¸Šå®ç°æ¯ç§’æ•°ä¸‡æ¬¡çš„è¯»å–å’Œå†™å…¥ã€‚</p><p>æ—¢ç„¶é€‰æ‹©äº†Redisä½œä¸ºåç«¯æ•°æ®åº“ï¼Œé‚£ä¹ˆç›¸åº”çš„åº”è¯¥é€‰æ‹©ä¸€ä¸ªRedis ORMã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©äº†Rediscoä½œä¸ºORMï¼Œè™½ç„¶åŸä½œè€…å·²ç»å¼ƒå‘ä¸æ›´æ–°äº†ï¼Œå®ƒçš„ç»§æ‰¿è€…ä¹Ÿå·²ç»å¿«ä¸€å¹´å¤šæ²¡æœ‰å›å¤issueäº†ï¼Œä¹Ÿæ²¡æœ‰åšpython3çš„é€‚é…ã€‚ä½†æ˜¯è°å«å®ƒçš„æ¥å£æ›´ç¬¦åˆdjango ormçš„æ“ä½œæ–¹å¼å‘¢ã€‚äºæ˜¯æäº¤äº†ä¸€ä¸ªPRé€‚é…äº†python3ã€‚</p><h4 id="WEB-Frameworkï¼Ÿ"><a href="#WEB-Frameworkï¼Ÿ" class="headerlink" title="WEB Frameworkï¼Ÿ"></a>WEB Frameworkï¼Ÿ</h4><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©falconè€Œæ²¡æœ‰ä½¿ç”¨flaskï¼Œdjangoæˆ–å…¶ä»–python webæ¡†æ¶çš„åŸå› æ˜¯å®ƒæ›´å¿«è€Œä¸”RESTfulï¼Œè¿™é‡Œæ¨èä¸€ä¸ªæ‰©å±•é˜…è¯»ï¼š<a href="http://klen.github.io/py-frameworks-bench/" target="_blank" rel="noopener">å…³äºPython Webæ¡†æ¶çš„æ€§èƒ½æµ‹è¯•ç»“æœ</a>ã€‚<br>å½“æˆ‘å†™å®Œè¿™ä¸ªé¡¹ç›®æ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªæ›´å¿«çš„æ¡†æ¶ <a href="https://github.com/squeaky-pl/japronto" target="_blank" rel="noopener">Japronto</a></p><h4 id="å‰ç«¯æ¡†æ¶ï¼Ÿ"><a href="#å‰ç«¯æ¡†æ¶ï¼Ÿ" class="headerlink" title="å‰ç«¯æ¡†æ¶ï¼Ÿ"></a>å‰ç«¯æ¡†æ¶ï¼Ÿ</h4><p>è¿™é‡Œé¢ä¸´äº†2ä¸ªé€‰æ‹©ï¼ŒVue or Reactï¼Ÿ</p><ul><li>é€‰æ‹©ç†Ÿæ‚‰çš„ï¼ŸVue ï¼ˆ<a href="https://www.iviewui.com/" target="_blank" rel="noopener">iView</a> ï¼Œ <a href="http://element.eleme.io/#/zh-CN" target="_blank" rel="noopener">Element</a>ï¼‰</li><li>é€‰æ‹©é€‚é…å…¬å¸æŠ€æœ¯æ ˆçš„ï¼ŸReact ï¼ˆ<a href="https://ant.design" target="_blank" rel="noopener">AntDesign</a>ï¼‰</li><li>å­¦ä¹ æ–°æŠ€æœ¯ï¼Reactï¼</li></ul><p>ä½œä¸ºä¸€ä¸ªäºŒæ‰‹å‰ç«¯ï¼Œäºæ˜¯å¼€å§‹äº†è¸©å‘Reactä¹‹æ—…ï¼Œå„ç§æ·±å‘æµ…å‘ä¸æ–­ï¼Œè¿˜å¥½éƒ½ä¸€ä¸€è§£å†³äº†ã€‚<br>ä½œä¸ºæ›¾ç»çš„Vueç²‰ç®€å•å¯¹æ¯”ä¸‹Reactå’ŒVueï¼š</p><ul><li><p>ç”Ÿæ€åœˆ</p><p>æ˜æ˜¾æ„Ÿè§‰åˆ°äº†Reactç”Ÿæ€åœˆçš„å¼ºå¤§ï¼Œèš‚èšé‡‘æœå‰ç«¯å›¢é˜Ÿçš„AntDesioné¡¹ç›®ï¼ŒçœŸçš„æŠŠæˆ‘æƒŠè‰³åˆ°äº†ã€‚å®ƒçš„è®¾è®¡åŸåˆ™è®©æˆ‘æ·±åˆ»çš„ä½“ä¼šåˆ°äº†ä»€ä¹ˆæ˜¯<code>è®©ç”¨æˆ·è§‰å¾—è‡ªå·±æ˜¯çˆ¹</code>ã€‚</p></li><li><p>ä¸Šæ‰‹éš¾åº¦</p><p>ä¸¤è€…ç›¸æ¯”ï¼Œä»ä¸Šæ‰‹éš¾åº¦æ¥è¯´Reactçš„å„ç§æ¦‚å¿µçœŸçš„æ˜¯è®©æ–°æ‰‹è„‘å£³ç–¼ï¼Œè€Œä¸”reactçš„starter kitéƒ½æ„å»ºå¾—æ— æ¯”æ¶å¿ƒã€‚å†ä»ä»£ç é‡æ–¹é¢æ¥è¯´ï¼šåœ¨å†™redux actionå’Œreducerçš„æ—¶å€™ï¼Œå„ç§å‘½åéƒ½ä¼šæ˜¾å¾—å¾ˆç¹çï¼Œä½†åˆæ°å¥½æ˜¯reduxè¿™ä¸€å¥—ï¼Œè®©åæœŸç»´æŠ¤å˜å¾—æ›´åŠ å®¹æ˜“ã€‚å¯¹äºå†™æƒ¯äº†django templateç­‰ç­‰åç«¯æ¸²æŸ“æ¨¡ç‰ˆçš„æ–¹å¼åå†å­¦Vue templateå°±ä¼šå¾ˆå®¹æ˜“ä¸Šæ‰‹ï¼Œè€Œåˆšå¼€å§‹ç”¨Reactçš„JSXè¯­æ³•ä¼šè§‰å¾—æœ‰ç‚¹åˆ«æ‰­ï¼Œä½†æ˜¯ä¹ æƒ¯äº†åˆä¼šå†™å¾—å¾ˆçˆ½ã€‚</p></li></ul><p>è¿™é‡Œä¸å±•å¼€è®¨è®ºReactå’ŒVueåˆ°åº•å“ªä¸ªå¥½ï¼Œå°±å’ŒPHPæ˜¯ä¸–ç•Œä¸Šæœ€ç¾çš„è¯­è¨€ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ª<code>å“²å­¦é—®é¢˜</code></p><p>æœ€åå¸Œæœ›å¤§å®¶ç”¨å¾—å¼€å¿ƒï¼Œæˆ‘ä»¬ä¼šæŒç»­è·Ÿè¿›ä½ ä»¬çš„å»ºè®®å“’~ ^.^</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-CEYEæ˜¯ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#1-CEYEæ˜¯ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;1. CEYEæ˜¯ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;1. CEYEæ˜¯ä»€ä¹ˆ&lt;/h2&gt;&lt;p&gt;CEYEæ˜¯ä¸€ä¸ªç”¨æ¥æ£€æµ‹ &lt;code&gt;å¸¦å¤–ï¼ˆOut-of-Bandï¼‰&lt;/code&gt;æµé‡çš„ç›‘æ§å¹³å°ï¼Œå¦‚DNSæŸ¥è¯¢å’ŒHTTPè¯·æ±‚ã€‚å®ƒå¯ä»¥å¸®åŠ©å®‰å…¨ç ”ç©¶äººå‘˜åœ¨æµ‹è¯•æ¼æ´æ—¶æ”¶é›†ä¿¡æ¯ï¼ˆä¾‹å¦‚SSRF / XXE / RFI / RCEï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2-ä¸ºä»€ä¹ˆä¼šæœ‰CEYE&quot;&gt;&lt;a href=&quot;#2-ä¸ºä»€ä¹ˆä¼šæœ‰CEYE&quot; class=&quot;headerlink&quot; title=&quot;2. ä¸ºä»€ä¹ˆä¼šæœ‰CEYE&quot;&gt;&lt;/a&gt;2. ä¸ºä»€ä¹ˆä¼šæœ‰CEYE&lt;/h2&gt;&lt;p&gt;æåˆ°ä¸ºä»€ä¹ˆä¼šæœ‰CEYEå°±å¿…é¡»æåˆ°å®ƒçš„ä½¿ç”¨åœºæ™¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä¸¤ç§å¸¸è§çš„æƒ…å†µä¼šå¯¼è‡´è®¸å¤šæ¼æ´æ‰«æå·¥å…·æ¼æ‰«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¼æ´æ£€æµ‹æˆ–æ¼æ´åˆ©ç”¨éœ€è¦è¿›ä¸€æ­¥çš„ç”¨æˆ·æˆ–ç³»ç»Ÿäº¤äº’&lt;/li&gt;
&lt;li&gt;ä¸€äº›æ¼æ´ç±»å‹æ²¡æœ‰ç›´æ¥è¡¨æ˜æ”»å‡»æ˜¯æˆåŠŸçš„ã€‚å¦‚Payloadè§¦å‘äº†å´ä¸åœ¨å‰ç«¯é¡µé¢æ˜¾ç¤ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼€å‘äº†CEYEå¹³å°ã€‚é€šè¿‡ä½¿ç”¨è¯¸å¦‚DNSå’ŒHTTPä¹‹ç±»çš„å¸¦å¤–ä¿¡é“ï¼Œä¾¿å¯ä»¥å¾—åˆ°å›æ˜¾ä¿¡æ¯ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Product" scheme="https://morningchen.com/categories/Product/"/>
    
      <category term="CEYE" scheme="https://morningchen.com/categories/Product/CEYE/"/>
    
    
      <category term="React" scheme="https://morningchen.com/tags/React/"/>
    
      <category term="Python" scheme="https://morningchen.com/tags/Python/"/>
    
      <category term="Architechure" scheme="https://morningchen.com/tags/Architechure/"/>
    
      <category term="CEYE" scheme="https://morningchen.com/tags/CEYE/"/>
    
  </entry>
  
  <entry>
    <title>Cross site scripting vulnerability in django-epiceditor</title>
    <link href="https://morningchen.com/2017/03/09/Cross-site-scripting-vulnerability-in-django-epiceditor/"/>
    <id>https://morningchen.com/2017/03/09/Cross-site-scripting-vulnerability-in-django-epiceditor/</id>
    <published>2017-03-09T04:43:38.000Z</published>
    <updated>2018-09-27T03:49:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>django-epiceditor</p><p>A django app that allows the easy addition of EpicEditor markdown editor to a django form field, whether in a custom app or the Django Admin.</p><p>The project url: <a href="https://pypi.python.org/pypi/django-epiceditor" target="_blank" rel="noopener">https://pypi.python.org/pypi/django-epiceditor</a></p><a id="more"></a><h2 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h2><ul><li>django==1.10.6</li><li>django-epiceditor==0.2.3</li></ul><h2 id="Vulnerability-reproduction"><a href="#Vulnerability-reproduction" class="headerlink" title="Vulnerability reproduction"></a>Vulnerability reproduction</h2><p>Your apps, in the form.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> epiceditor.widgets <span class="keyword">import</span> AdminEpicEditorWidget</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> FooModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    title = forms.CharField(widget=AdminEpicEditorWidget())</span><br><span class="line">    info = forms.CharField(widget=AdminEpicEditorWidget())</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = FooModel</span><br><span class="line">        fields = <span class="string">"__all__"</span></span><br></pre></td></tr></table></figure></p><p>Then enter django background page, if the field use widget AdminEpicEditorWidget</p><p>in editor:</p><p><img src="http://7xi9tp.com1.z0.glb.clouddn.com/v2476.png" alt=""></p><p>click preview<br><img src="http://7xi9tp.com1.z0.glb.clouddn.com/v1123.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h2&gt;&lt;p&gt;django-epiceditor&lt;/p&gt;
&lt;p&gt;A django app that allows the easy addition of EpicEditor markdown editor to a django form field, whether in a custom app or the Django Admin.&lt;/p&gt;
&lt;p&gt;The project url: &lt;a href=&quot;https://pypi.python.org/pypi/django-epiceditor&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://pypi.python.org/pypi/django-epiceditor&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Security" scheme="https://morningchen.com/categories/Security/"/>
    
      <category term="XSS" scheme="https://morningchen.com/categories/Security/XSS/"/>
    
    
      <category term="xss" scheme="https://morningchen.com/tags/xss/"/>
    
      <category term="vulnerability" scheme="https://morningchen.com/tags/vulnerability/"/>
    
  </entry>
  
  <entry>
    <title>Ethereum Ecosphere</title>
    <link href="https://morningchen.com/2016/12/19/ethereum-ecosphere/"/>
    <id>https://morningchen.com/2016/12/19/ethereum-ecosphere/</id>
    <published>2016-12-19T01:01:45.000Z</published>
    <updated>2018-09-27T17:04:05.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»¥å¤ªåŠé¡¹ç›®ç”Ÿæ€åœˆ"><a href="#ä»¥å¤ªåŠé¡¹ç›®ç”Ÿæ€åœˆ" class="headerlink" title="ä»¥å¤ªåŠé¡¹ç›®ç”Ÿæ€åœˆ"></a>ä»¥å¤ªåŠé¡¹ç›®ç”Ÿæ€åœˆ</h1><h3 id="ç»„ç»‡ç»“æ„"><a href="#ç»„ç»‡ç»“æ„" class="headerlink" title="ç»„ç»‡ç»“æ„"></a>ç»„ç»‡ç»“æ„</h3><p>ä»¥å¤ªåŠé¡¹ç›®å°†ç”±ä»¥ä¸‹3ä¸ªç»„ç»‡ç»„æˆ<br><img src="/2016/12/19/ethereum-ecosphere/eth.png"><br><a id="more"></a><br><img src="https://camo.githubusercontent.com/68b6d4dd156e85d22114ef1fa8a028f4f717e6f5/687474703a2f2f626974636f696e386274632e71696e6975646e2e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f31312f66696c65303030322e6a7067" alt="ethereum"></p><h5 id="ä»¥å¤ªåŠåŸºé‡‘ä¼šï¼š"><a href="#ä»¥å¤ªåŠåŸºé‡‘ä¼šï¼š" class="headerlink" title="ä»¥å¤ªåŠåŸºé‡‘ä¼šï¼š"></a>ä»¥å¤ªåŠåŸºé‡‘ä¼šï¼š</h5><p>æ€»éƒ¨è®¾åœ¨ç‘å£«æ¥šæ ¼å·çš„éè¥åˆ©åŸºé‡‘ä¼šï¼Œè¿™ä¸ªåŸºé‡‘æ˜¯è´Ÿè´£ä¸ºæœªæ¥åŠ å¯†è´§å¸ç ”å‘å’Œæ¨è¿›å¼€å‘çš„å…¶ä»–æœºæ„åˆ†é…èµ„æºçš„ä¼å½¢å…¬å¸ã€‚è¯¥åŸºé‡‘ä¼šçš„è‘£äº‹ä¼šç”±Vitalik Buterinï¼ˆä¸»å¸­ï¼‰ï¼ŒMihai Alisieï¼ˆå‰¯ä¸»å¸­ï¼‰ï¼ŒTaylor Gerring, Stephan Tual, Joseph Lubin, Jeffrey Wilcke è¿˜æœ‰ Gavin Woodç»„æˆã€‚è¯¥åŸºé‡‘ä¼šå°†é‡ç‚¹æ”¾åœ¨é¦–è¦çš„â€œä½¿å‘½â€ä¸Šï¼Œå³ï¼Œä½¿è¿è¥æœºæ„æ¥å®Œæˆæ¯å¤©çš„æ—¥å¸¸å·¥ä½œã€‚</p><p>ä½¿å‘½å’Œæ„¿æ™¯:<br>ä»¥å¤ªåŠåŸºé‡‘ä¼šçš„ä½¿å‘½æ˜¯ä¿ƒè¿›å’Œæ”¯æŒç ”ç©¶ï¼Œå¼€å‘å’Œæ•™è‚²ï¼Œä¸ºä¸–ç•Œæä¾›åˆ†æ•£çš„åè®®å’Œå·¥å…·ï¼Œä½¿å¼€å‘å•†èƒ½å¤Ÿç”Ÿäº§ä¸‹ä¸€ä»£åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºï¼ˆdappsï¼‰ï¼Œå¹¶å…±åŒæ„å»ºæ›´å…¨çƒå¯è®¿é—®ï¼Œæ›´è‡ªç”±å’Œæ›´å¯ä¿¡çš„äº’è”ç½‘ ã€‚</p><p>ä¸»è¦èŒè´£ï¼šä¸¾åŠå¼€å‘è€…å¤§ä¼š ç›®å‰å·²ä¸¾åŠ3å±Š</p><ul><li>DEVCON0 æŸæ— 2014å¹´11æœˆ</li><li>DEVCON1 ä¼¦æ•¦ 2015å¹´11æœˆ</li><li>DEVCON2 ä¸Šæµ· 2016å¹´9æœˆ</li></ul><h5 id="ä»¥å¤ªåŠç‘å£«æœ‰é™å…¬å¸-å·²åœæ­¢è¿ä½œ-ï¼š"><a href="#ä»¥å¤ªåŠç‘å£«æœ‰é™å…¬å¸-å·²åœæ­¢è¿ä½œ-ï¼š" class="headerlink" title="ä»¥å¤ªåŠç‘å£«æœ‰é™å…¬å¸(å·²åœæ­¢è¿ä½œ)ï¼š"></a>ä»¥å¤ªåŠç‘å£«æœ‰é™å…¬å¸(å·²åœæ­¢è¿ä½œ)ï¼š</h5><p>æ€»éƒ¨è®¾åœ¨ç‘å£«çš„ä¸€å®¶å…¬å¸ï¼Œä¸ºäº†é¢†å¯¼åˆ›ä¸–å—é“¾çš„å‘è¡Œï¼Œå°†è´Ÿè´£è¿è¥2014å¹´åº¦çš„ä¸€éƒ¨åˆ†å·¥ä½œã€‚è¯¥å…¬å¸ç”±ä»¥å¤ªåŠåŸºé‡‘ä¼š100ï¼…æ§åˆ¶ï¼Œè®¡åˆ’åœ¨åˆ›ä¸–å—é“¾å‘è¡Œååœæ­¢è¿ä½œã€‚</p><h5 id="DÎVï¼š"><a href="#DÎVï¼š" class="headerlink" title="ÄÎVï¼š"></a>ÄÎVï¼š</h5><p>å°†å¾—åˆ°ä¸¤æ¡£åŸºé‡‘æ¥ä¸“é—¨å»ºç«‹çš„ä¸€ä¸ªéè¥åˆ©æ€§ç»„ç»‡ï¼Œä¼˜åŒ–å’Œæ¨å¹¿ä»¥å¤ªåŠ1.0ç‰ˆæœ¬ã€‚ä¸»å¯¼å¼€å‘è€…Vitalik Buterinï¼ŒGavin Wood å’Œ Jeffrey Wilckeä¸ºè‘£äº‹ã€‚</p><h5 id="å…¶ä»–ç»„ç»‡ï¼š"><a href="#å…¶ä»–ç»„ç»‡ï¼š" class="headerlink" title="å…¶ä»–ç»„ç»‡ï¼š"></a>å…¶ä»–ç»„ç»‡ï¼š</h5><p>åŒ…æ‹¬è‡ªå¾‹ç»„ç»‡ï¼ˆSROï¼‰å’Œéè¥åˆ©æ€§ç ”ç©¶æœºæ„ï¼Œè¿™äº›ç»„ç»‡å¯èƒ½ä¼šåŒæ—¶å¾—åˆ°èµ„åŠ©ã€‚æ ¹æ®é¢„è®¡ï¼Œä»¥å¤ªåŠç‘å£«æœ‰é™å…¬å¸å°†ä¼šååŠ©è¿™äº›ç ”ç©¶æœºæ„çš„èµ·æ­¥ï¼Œä»¥å¤ªåŠåŸºé‡‘ä¼šå¯èƒ½å°†ä¼šç›‘ç£SROçš„æ´»åŠ¨ã€‚æœ€ç»ˆï¼Œä»¥å¤ªåŠåŸºé‡‘ä¼šè¿˜å°†ç›‘ç£ç ”ç©¶æœºæ„æœ¬èº«ã€‚</p><h3 id="ä»¥å¤ªåŠå†å²ä¸è§„åˆ’"><a href="#ä»¥å¤ªåŠå†å²ä¸è§„åˆ’" class="headerlink" title="ä»¥å¤ªåŠå†å²ä¸è§„åˆ’"></a>ä»¥å¤ªåŠå†å²ä¸è§„åˆ’</h3><h4 id="ä¼—ç­¹è®¡åˆ’"><a href="#ä¼—ç­¹è®¡åˆ’" class="headerlink" title="ä¼—ç­¹è®¡åˆ’"></a>ä¼—ç­¹è®¡åˆ’</h4><h5 id="ä»¥å¤ªåŠ1-0ç‰ˆæœ¬-å·²å®Œæˆ"><a href="#ä»¥å¤ªåŠ1-0ç‰ˆæœ¬-å·²å®Œæˆ" class="headerlink" title="ä»¥å¤ªåŠ1.0ç‰ˆæœ¬(å·²å®Œæˆ)"></a>ä»¥å¤ªåŠ1.0ç‰ˆæœ¬(å·²å®Œæˆ)</h5><p>ä»¥å¤ªåŠ1.0ä»£è¡¨äº†ÄÎVå’Œä»¥å¤ªåŠç‘å£«æœ‰é™å…¬å¸å’Œçš„é¦–è¦ç›®æ ‡ã€‚ä»¥å¤ªåŠåŸºé‡‘ä¼šåˆ™å°†ä¼šæŠŠå…´è¶£æ”¾åœ¨ä¿ƒè¿›æ•´ä¸ªåŠ å¯†ç©ºé—´çš„å‘å±•ä¸Šã€‚</p><p>è‡ª2014å¹´1æœˆä»½é¡¹ç›®æˆç«‹ä»¥æ¥ï¼Œè‡ªæ„¿è´¡çŒ®ä»£ç çš„å¼€å‘äººå‘˜å·²ç»å®Œæˆäº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p><p>å®Œæˆ4ä¸ªè¿‘ä¹å…¼å®¹çš„ä»¥å¤ªåŠå®¢æˆ·ç«¯</p><ul><li><a href="https://github.com/ethereum/go-ethereum" target="_blank" rel="noopener">go-ethereum</a> å®˜æ–¹ä»¥å¤ªåŠåè®®çš„Goè¯­è¨€å®ç°</li><li><a href="https://github.com/ethereum/cpp-ethereum" target="_blank" rel="noopener">cpp-ethereum</a> ä»¥å¤ªåŠåè®®çš„c++å®ç°</li><li><a href="https://github.com/ethereum/pyethapp" target="_blank" rel="noopener">pyethapp</a> ä»¥å¤ªåŠåè®®çš„pythonå®ç°</li><li><a href="https://github.com/ethereum/ethereumj" target="_blank" rel="noopener">ethereumj</a> ä»¥å¤ªåŠåè®®çš„çº¯Javaå®ç°</li></ul><p>Serpent, LLL å’Œ Mutançš„3ç§åˆçº¦ç¼–ç¨‹è¯­è¨€</p><ul><li><a href="https://github.com/ethereum/serpent" target="_blank" rel="noopener">serpent</a></li><li>LLL ï¼ˆå·²æ­»äº¡ æ— è¿›å±•ï¼‰</li><li><a href="https://github.com/obscuren/mutan" target="_blank" rel="noopener">Mutan</a></li></ul><p>ä»¥å¤ªåŠçš„JavaScript API</p><ul><li><a href="https://github.com/ethereum/web3.js" target="_blank" rel="noopener">web3.js</a></li></ul><h4 id="å‘å¸ƒè®¡åˆ’"><a href="#å‘å¸ƒè®¡åˆ’" class="headerlink" title="å‘å¸ƒè®¡åˆ’"></a>å‘å¸ƒè®¡åˆ’</h4><h5 id="ç¬¬ä¸€é˜¶æ®µ-Frontier-å·²å®Œæˆ"><a href="#ç¬¬ä¸€é˜¶æ®µ-Frontier-å·²å®Œæˆ" class="headerlink" title="ç¬¬ä¸€é˜¶æ®µ Frontier (å·²å®Œæˆ)"></a>ç¬¬ä¸€é˜¶æ®µ Frontier (å·²å®Œæˆ)</h5><p>Frontieré˜¶æ®µæ˜¯ä»¥å¤ªåŠçš„æœ€åˆç‰ˆæœ¬ï¼Œä¸æ˜¯ä¸€ä¸ªå®Œå…¨å¯é å’Œå®‰å…¨çš„ç½‘ç»œã€‚Frontieræ˜¯ç©ºç™½ç‰ˆçš„ä»¥å¤ªåŠç½‘ç»œï¼šä¸€ä¸ªç”¨äºæŒ–çŸ¿çš„ç•Œé¢å’Œä¸€ç§ä¸Šä¼ å’Œæ‰§è¡Œåˆçº¦çš„æ–¹æ³•ã€‚Frontierçš„ä¸»è¦ç”¨é€”æ˜¯ï¼šå°†æŒ–çŸ¿å’Œäº¤æ˜“æ‰€äº¤æ˜“è¿è¡Œèµ·æ¥ï¼Œä»è€Œç¤¾åŒºå¯ä»¥è¿è¡ŒæŒ–çŸ¿è®¾å¤‡ï¼Œå’Œå¼€å§‹å»ºç«‹ä¸€ä¸ªç¯å¢ƒï¼Œäººä»¬å¯ä»¥åœ¨é‡Œé¢æµ‹è¯•åˆ†å¸ƒå¼åº”ç”¨ï¼ˆDAppsï¼‰ã€‚ç”±äºFrontieré˜¶æ®µçš„ä»¥å¤ªåŠå®¢æˆ·ç«¯åªæœ‰å‘½ä»¤è¡Œç•Œé¢ï¼Œæ²¡æœ‰å›¾å½¢ç•Œé¢ï¼Œæ‰€ä»¥è¯¥é˜¶æ®µä¸»è¦ä¸ºå¼€å‘è€…ã€‚</p><h5 id="ç¬¬äºŒé˜¶æ®µ-Homesteadï¼ˆç›®å‰é˜¶æ®µï¼‰"><a href="#ç¬¬äºŒé˜¶æ®µ-Homesteadï¼ˆç›®å‰é˜¶æ®µï¼‰" class="headerlink" title="ç¬¬äºŒé˜¶æ®µ Homesteadï¼ˆç›®å‰é˜¶æ®µï¼‰"></a>ç¬¬äºŒé˜¶æ®µ Homesteadï¼ˆç›®å‰é˜¶æ®µï¼‰</h5><p>Homesteadé˜¶æ®µä¸Frontieré˜¶æ®µç›¸æ¯”ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æŠ€æœ¯æ€§é‡Œç¨‹ç¢‘ï¼Œä¸»è¦æ”¹å–„äº†å®‰å…¨æ€§ï¼Œè¡¨æ˜ä»¥å¤ªåŠç½‘ç»œå·²ç»å¹³ç¨³è¿è¡Œï¼Œä¸å†æ˜¯ä¸å®‰å…¨å’Œä¸å¯é çš„ç½‘ç»œäº†ã€‚åœ¨æ­¤é˜¶æ®µï¼Œä»¥å¤ªåŠæä¾›äº†å›¾å½¢ç•Œé¢çš„é’±åŒ…ï¼ˆMistï¼‰ï¼Œæ˜“ç”¨æ€§å¾—åˆ°æå¤§æ”¹å–„ï¼Œä»¥å¤ªåŠä¸å†æ˜¯å¼€å‘è€…çš„ä¸“å±ï¼Œæ™®é€šç”¨æˆ·ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°ä½“éªŒå’Œä½¿ç”¨ä»¥å¤ªåŠã€‚</p><p>è¯¦ç»†å‘å±•è®¡åˆ’è§<br> <a href="https://github.com/ethereum/homestead-guide" target="_blank" rel="noopener">homestead-guide</a></p><h5 id="ç¬¬ä¸‰é˜¶æ®µ-Metropolisï¼ˆå¾…å®šï¼‰"><a href="#ç¬¬ä¸‰é˜¶æ®µ-Metropolisï¼ˆå¾…å®šï¼‰" class="headerlink" title="ç¬¬ä¸‰é˜¶æ®µ Metropolisï¼ˆå¾…å®šï¼‰"></a>ç¬¬ä¸‰é˜¶æ®µ Metropolisï¼ˆå¾…å®šï¼‰</h5><p>åœ¨Metropolisé˜¶æ®µï¼Œå›¢é˜Ÿå°†æœ€ç»ˆæ­£å¼å‘å¸ƒä¸€ä¸ªä¸ºéæŠ€æœ¯ç”¨æˆ·è®¾è®¡çš„ã€åŠŸèƒ½ç›¸å¯¹å®Œå–„çš„ç”¨æˆ·ç•Œé¢ï¼Œä¹Ÿå°±æ˜¯å‘å¸ƒ<a href="https://github.com/ethereum/mist" target="_blank" rel="noopener">Mistæµè§ˆå™¨</a>ã€‚</p><h5 id="ç¬¬å››é˜¶æ®µ-Serenityï¼ˆå¾…å®šï¼‰"><a href="#ç¬¬å››é˜¶æ®µ-Serenityï¼ˆå¾…å®šï¼‰" class="headerlink" title="ç¬¬å››é˜¶æ®µ Serenityï¼ˆå¾…å®šï¼‰"></a>ç¬¬å››é˜¶æ®µ Serenityï¼ˆå¾…å®šï¼‰</h5><p>åŒæ—¶ä¹Ÿæ˜¯ä»¥å¤ªåŠ2.0é˜¶æ®µï¼Œå®ƒæœ‰4ä¸ªä¸»è¦ç ”ç©¶ç›®æ ‡ï¼š</p><ul><li>å‘å¸ƒåŒºå—é“¾çš„ PoS è‚¡æƒè¯æ˜(Casper)ç‰ˆæœ¬</li><li>å¯æ‰©å±•æ€§</li><li>zkSNARKï¼ˆzero-knowledge Succinct Non-interactive Argument of Knowledgeï¼‰ï¼Œä¹Ÿå°±æ˜¯é›¶çŸ¥è¯†ç®€æ´éäº¤äº’å¼å‚æ•°ã€‚è§£å†³éšç§é—®é¢˜ã€‚</li><li>å‡çº§evmï¼ˆä»¥å¤ªåŠè™šæ‹Ÿæœºï¼‰</li></ul><h3 id="ç›®å‰ä¸»è¦ç»´æŠ¤çš„å¼€æºä»£ç "><a href="#ç›®å‰ä¸»è¦ç»´æŠ¤çš„å¼€æºä»£ç " class="headerlink" title="ç›®å‰ä¸»è¦ç»´æŠ¤çš„å¼€æºä»£ç "></a>ç›®å‰ä¸»è¦ç»´æŠ¤çš„å¼€æºä»£ç </h3><h5 id="ä»¥å¤ªåŠå®¢æˆ·ç«¯"><a href="#ä»¥å¤ªåŠå®¢æˆ·ç«¯" class="headerlink" title="ä»¥å¤ªåŠå®¢æˆ·ç«¯"></a>ä»¥å¤ªåŠå®¢æˆ·ç«¯</h5><p>æŒ‰ç…§æµè¡Œç¨‹åº¦ç”±é«˜åˆ°ä½æ’åˆ—</p><ul><li><a href="https://github.com/ethereum/go-ethereum" target="_blank" rel="noopener">go-ethereum</a> å®˜æ–¹ä»¥å¤ªåŠåè®®çš„Goè¯­è¨€å®ç°</li><li><a href="https://github.com/ethcore/parity" target="_blank" rel="noopener">parity</a> ä»¥å¤ªåŠåè®®çš„Rustå®ç°</li><li><a href="https://github.com/ethereum/cpp-ethereum" target="_blank" rel="noopener">cpp-ethereum</a> ä»¥å¤ªåŠåè®®çš„c++å®ç°</li><li><a href="https://github.com/ethereum/pyethapp" target="_blank" rel="noopener">pyethapp</a> ä»¥å¤ªåŠåè®®çš„pythonå®ç°</li><li><a href="https://github.com/ethereum/ethereumj" target="_blank" rel="noopener">ethereumj</a> ä»¥å¤ªåŠåè®®çš„çº¯Javaå®ç°</li></ul><h5 id="åˆçº¦ç¼–ç¨‹è¯­è¨€"><a href="#åˆçº¦ç¼–ç¨‹è¯­è¨€" class="headerlink" title="åˆçº¦ç¼–ç¨‹è¯­è¨€"></a>åˆçº¦ç¼–ç¨‹è¯­è¨€</h5><ul><li><a href="https://github.com/ethereum/solidity" target="_blank" rel="noopener">solidity</a> åšå®çš„é¢å‘åˆçº¦çš„ç¼–ç¨‹è¯­è¨€ (ä¸»æµåˆçº¦ç¼–ç¨‹è¯­è¨€)</li><li><a href="https://github.com/ethereum/viper" target="_blank" rel="noopener">viper</a> æ–°çš„æ­£åœ¨å®éªŒä¸­çš„ç¼–ç¨‹è¯­è¨€</li><li><a href="https://github.com/ethereum/serpent" target="_blank" rel="noopener">serpent</a> ç”¨äºå†™åˆçº¦çš„ç¼–ç¨‹è¯­è¨€</li></ul><h5 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h5><ul><li><a href="https://github.com/ethereum/web3.js" target="_blank" rel="noopener">web3.js</a> ä»¥å¤ªåŠçš„JavaScript API</li><li><a href="https://github.com/ethereum/evmjit" target="_blank" rel="noopener">evmjit</a> EVM JITæ˜¯ä¸€ä¸ªç”¨äºåŠæ—¶ç¼–è¯‘Ethereum EVMä»£ç çš„åº“ã€‚ å®ƒå¯ä»¥ç”¨äºæ›¿æ¢ä»¥å¤ªåŠå®¢æˆ·ç«¯ä¸­ç»å…¸çš„è§£é‡Šå™¨å¼EVMè™šæ‹Ÿæœºã€‚</li><li><a href="https://github.com/ethereum/pyethereum" target="_blank" rel="noopener">pyethereum</a> ä»¥å¤ªåŠé¡¹ç›®çš„Pythonæ ¸å¿ƒåº“</li><li><a href="https://github.com/ethereum/browser-solidity" target="_blank" rel="noopener">browser-solidity</a> ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„Solidityç¼–è¯‘å™¨å’ŒIDE</li><li><a href="https://github.com/ethereum/mist" target="_blank" rel="noopener">mist</a> mistæµè§ˆå™¨ æµè§ˆå’Œä½¿ç”¨Ãappsçš„é¦–é€‰å·¥å…·</li><li><a href="https://github.com/ethereum/homebrew-ethereum" target="_blank" rel="noopener">homebrew-ethereum</a> homebrewçš„æ‰©å±• ç”¨æ¥åœ¨macä¸Šå®‰è£…å’Œç®¡ç† ethereum</li><li><a href="https://github.com/ethereum/solc-js" target="_blank" rel="noopener">solc-js</a> Javascriptç»‘å®šçš„solidityç¼–è¯‘å™¨</li><li><a href="https://github.com/ethereum/ens" target="_blank" rel="noopener">ens</a> ä»¥å¤ªåŠçš„åŸŸåæœåŠ¡(Ethereum Name Service)</li><li><a href="https://github.com/ethereum/remix" target="_blank" rel="noopener">remix</a> Ethereum IDE å’Œwebå·¥å…·</li><li><a href="https://github.com/ethereum/meteor-dapp-wallet" target="_blank" rel="noopener">meteor-dapp-wallet</a> ç”¨meteorå†™çš„ä»¥å¤ªåŠé’±åŒ…åº”ç”¨</li><li><a href="https://github.com/ethereum/meteor-package-elements" target="_blank" rel="noopener">meteor-package-elements</a> åŸºæœ¬çš„Meteoræ¨¡æ¿/ç»„ä»¶çš„é›†åˆï¼Œä½¿å¾—dappsæ›´å¿«åœ°æ„å»ºã€‚</li></ul><h5 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h5><ul><li><a href="https://github.com/ethereum/ethereum-org" target="_blank" rel="noopener">ethereum-org</a> ä»¥å¤ªåŠç½‘ç«™æºç </li><li><a href="https://github.com/ethereum/yellowpaper" target="_blank" rel="noopener">yellowpaper</a> ä»¥å¤ªåŠé»„çš®ä¹¦</li><li><a href="https://github.com/ethereum/EIPs" target="_blank" rel="noopener">EIPs</a> ä»¥å¤ªåŠæ”¹è¿›å»ºè®®(Ethereum Improvement Proposal), æè®®å’Œæè¿°å¯¹ä»¥å¤ªåŠåè®®çš„æ›´æ”¹ã€‚</li><li><a href="https://github.com/ethereum/wiki" target="_blank" rel="noopener">wiki</a> ä»¥å¤ªåŠwiki</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä»¥å¤ªåŠé¡¹ç›®ç”Ÿæ€åœˆ&quot;&gt;&lt;a href=&quot;#ä»¥å¤ªåŠé¡¹ç›®ç”Ÿæ€åœˆ&quot; class=&quot;headerlink&quot; title=&quot;ä»¥å¤ªåŠé¡¹ç›®ç”Ÿæ€åœˆ&quot;&gt;&lt;/a&gt;ä»¥å¤ªåŠé¡¹ç›®ç”Ÿæ€åœˆ&lt;/h1&gt;&lt;h3 id=&quot;ç»„ç»‡ç»“æ„&quot;&gt;&lt;a href=&quot;#ç»„ç»‡ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;ç»„ç»‡ç»“æ„&quot;&gt;&lt;/a&gt;ç»„ç»‡ç»“æ„&lt;/h3&gt;&lt;p&gt;ä»¥å¤ªåŠé¡¹ç›®å°†ç”±ä»¥ä¸‹3ä¸ªç»„ç»‡ç»„æˆ&lt;br&gt;&lt;img src=&quot;/2016/12/19/ethereum-ecosphere/eth.png&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Research" scheme="https://morningchen.com/categories/Research/"/>
    
      <category term="Ethereum" scheme="https://morningchen.com/categories/Research/Ethereum/"/>
    
    
      <category term="ethereum" scheme="https://morningchen.com/tags/ethereum/"/>
    
      <category term="block-chain" scheme="https://morningchen.com/tags/block-chain/"/>
    
  </entry>
  
  <entry>
    <title>Run docker-compose in Jenkins</title>
    <link href="https://morningchen.com/2016/11/22/Run-docker-compose-in-Jenkins/"/>
    <id>https://morningchen.com/2016/11/22/Run-docker-compose-in-Jenkins/</id>
    <published>2016-11-22T09:09:06.000Z</published>
    <updated>2018-09-27T03:52:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²Jenkins åœ¨Jenkinsä¸­è‡ªåŠ¨è¿è¡Œdocker-compose<br>è¿™ç¯‡æ–‡ç« ä¸»è¦è®°å½•ä¸€ä¸‹éƒ¨ç½²æ—¶å€™é‡åˆ°çš„é—®é¢˜ã€‚</p><p>Server: Ubuntu 14.04.2 LTS</p><p>Requirement:</p><ul><li>Jenkins version 2.19.3</li><li>Docker version 1.12.3</li><li>docker-compose version 1.8.1</li></ul><a id="more"></a><h2 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h2><h3 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h3><p>Jenkins å®‰è£…å®Œæˆåä¼šåˆ›å»ºä¸€ä¸ªåä¸ºjenkinsçš„ç”¨æˆ·ï¼Œé»˜è®¤å¯åŠ¨8080ç«¯å£ å¼€å¯jenkinsæœåŠ¡<br>ç™»é™†webï¼Œåˆå§‹å¼•å¯¼æ“ä½œä¼šè®©ä½ åˆ›å»ºç”¨æˆ·å’Œå®‰è£…ä¸€äº›æ’ä»¶ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹å¿…é¡»é¢å¤–å®‰è£…çš„æ’ä»¶</p><p>ç³»ç»Ÿç®¡ç†-ç®¡ç†æ’ä»¶-å¯é€‰æ’ä»¶</p><ul><li>Git client plugin</li><li>Git plugin</li><li>Bitbucket Plugin</li><li>Build Pipeline Plugin</li><li>Pipeline</li></ul><p>ä¸‹æ’ä»¶æ—¶å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œé—®é¢˜ éœ€è¦å¤šé‡è¯•å‡ æ¬¡</p><h3 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h3><p>è¯¥é¡¹ç›®æœ‰4ä¸ªjob åˆ†åˆ«æ˜¯</p><ul><li>mom ç”¨äºæŠ“bitbucket momçš„ä»£ç </li><li>momflask ç”¨äºæŠ“bitbucket momflaskçš„ä»£ç </li><li>rmom ç”¨äºæŠ“bitbucket rmomçš„ä»£ç </li><li>run_docker_compose è¿è¡Œdocker-compose</li></ul><h4 id="1-æ–°å»ºmom-job"><a href="#1-æ–°å»ºmom-job" class="headerlink" title="1. æ–°å»ºmom job"></a>1. æ–°å»ºmom job</h4><p>æºç ç®¡ç† <a href="mailto:git@bitbucket.org" target="_blank" rel="noopener">git@bitbucket.org</a>:Aaron_Liu/mom.git</p><p>æŒ‡å®šåˆ†æ”¯ master</p><p>æ„å»º-execute shell<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br><span class="line">ls -a</span><br></pre></td></tr></table></figure></p><p>æ„å»ºåæ“ä½œ-Trigger parameterized build on other projectsï¼ˆè¿™ä¸€æ­¥æ˜¯ä¸ºäº†è‡ªåŠ¨è§¦å‘momflaskçš„æ„å»ºå·¥ä½œï¼‰</p><pre><code>Projects to build momflaskTrigger when build is StableTrigger build without parameters ä¸€å®šè¦æ‰“å‹¾ï¼ï¼ï¼</code></pre><h4 id="2-æ–°å»ºmomflask-job"><a href="#2-æ–°å»ºmomflask-job" class="headerlink" title="2. æ–°å»ºmomflask job"></a>2. æ–°å»ºmomflask job</h4><p>General é«˜çº§</p><pre><code>ä½¿ç”¨è‡ªå®šä¹‰çš„å·¥ä½œç©ºé—´ ç›®å½• `$JENKINS_HOME/workspace/mom/momflask`ç›®çš„æ˜¯ä¸ºäº†æŠŠmomflaskçš„æ–‡ä»¶å¤¹æ”¾åœ¨momä¸‹</code></pre><p>æºç ç®¡ç† <a href="mailto:git@bitbucket.org" target="_blank" rel="noopener">git@bitbucket.org</a>:xixijun/momflask.git</p><p>æŒ‡å®šåˆ†æ”¯ develop</p><p>æ„å»º-execute shell<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br><span class="line">ls -a</span><br></pre></td></tr></table></figure></p><p>æ„å»ºåæ“ä½œ-Trigger parameterized build on other projectsï¼ˆè¿™ä¸€æ­¥æ˜¯ä¸ºäº†è‡ªåŠ¨è§¦å‘rmomçš„æ„å»ºå·¥ä½œï¼‰</p><pre><code>Projects to build rmomTrigger when build is StableTrigger build without parameters ä¸€å®šè¦æ‰“å‹¾ï¼ï¼ï¼</code></pre><h4 id="3-æ–°å»ºrmom-job"><a href="#3-æ–°å»ºrmom-job" class="headerlink" title="3. æ–°å»ºrmom job"></a>3. æ–°å»ºrmom job</h4><p>General é«˜çº§</p><pre><code>ä½¿ç”¨è‡ªå®šä¹‰çš„å·¥ä½œç©ºé—´ ç›®å½• `$JENKINS_HOME/workspace/mom/rmom`</code></pre><p>æºç ç®¡ç† <a href="mailto:git@bitbucket.org" target="_blank" rel="noopener">git@bitbucket.org</a>:xixijun/rmom.git</p><p>æŒ‡å®šåˆ†æ”¯ dev</p><p>æ„å»º-execute shell<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br><span class="line">ls -a</span><br></pre></td></tr></table></figure></p><p>æ„å»ºåæ“ä½œ-Trigger parameterized build on other projectsï¼ˆè¿™ä¸€æ­¥æ˜¯ä¸ºäº†è‡ªåŠ¨è§¦å‘run_docker_composeçš„æ„å»ºå·¥ä½œï¼‰</p><pre><code>Projects to build run_docker_composeTrigger when build is StableTrigger build without parameters ä¸€å®šè¦æ‰“å‹¾ï¼ï¼ï¼</code></pre><h4 id="4-æ–°å»ºrun-docker-compose-job"><a href="#4-æ–°å»ºrun-docker-compose-job" class="headerlink" title="4. æ–°å»ºrun_docker_compose job"></a>4. æ–°å»ºrun_docker_compose job</h4><p>General é«˜çº§</p><pre><code>ä½¿ç”¨è‡ªå®šä¹‰çš„å·¥ä½œç©ºé—´ ç›®å½• `$JENKINS_HOME/workspace/mom`</code></pre><p>æ„å»º-execute shell<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose ps</span><br><span class="line">docker-compose up -d --build</span><br></pre></td></tr></table></figure></p><h4 id="5-æ–°å»ºpipline-view"><a href="#5-æ–°å»ºpipline-view" class="headerlink" title="5. æ–°å»ºpipline view"></a>5. æ–°å»ºpipline view</h4><p>è¿™ä¸€æ­¥éœ€è¦ <code>Build Pipeline Plugin</code> æ’ä»¶æ”¯æŒ<br>æ–°å»ºæŒ‰é’®åœ¨Allæ ‡ç­¾æ å³è¾¹çš„+å·<br>ç‚¹å‡» Build Pipeline View</p><p>é…ç½® Select Initial Job é€‰æ‹©mom<br>ä¿å­˜åä¼šçœ‹åˆ°æµç¨‹å›¾ï¼Œæµç¨‹å›¾çš„å…³è”æ˜¯ä¾æ®ä¹‹å‰è®¾ç½® <code>æ„å»ºåæ“ä½œ-Trigger parameterized build on other projects</code></p><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>å¦‚æœæƒ³è¦å®ç°gitæ¨é€ä»£ç åè‡ªåŠ¨æ›´æ–° éœ€è¦åœ¨jobçš„æ„å»ºè§¦å‘å™¨ä¸­è®¾ç½®Build when a change is pushed to BitBucket<br>è¿˜è¦åœ¨è¯¥é¡¹ç›®çš„BitBucketä¸­è®¾ç½®webhooksä¸º <a href="http://url/bitbucket-hook/" target="_blank" rel="noopener">http://url/bitbucket-hook/</a></p><p>å®‰è£…Jenkinsä¹‹åä¼šåˆ›å»ºä¸€ä¸ªåä¸ºjenkinsçš„ç”¨æˆ· éœ€è¦èµ‹äºˆè¯¥ç”¨æˆ·æƒé™æ‰èƒ½æ‰§è¡Œdockerå‘½ä»¤<br>sudo usermod -aG docker Jenkins</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;éœ€æ±‚&quot;&gt;&lt;a href=&quot;#éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;éœ€æ±‚&quot;&gt;&lt;/a&gt;éœ€æ±‚&lt;/h2&gt;&lt;p&gt;åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²Jenkins åœ¨Jenkinsä¸­è‡ªåŠ¨è¿è¡Œdocker-compose&lt;br&gt;è¿™ç¯‡æ–‡ç« ä¸»è¦è®°å½•ä¸€ä¸‹éƒ¨ç½²æ—¶å€™é‡åˆ°çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;Server: Ubuntu 14.04.2 LTS&lt;/p&gt;
&lt;p&gt;Requirement:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Jenkins version 2.19.3&lt;/li&gt;
&lt;li&gt;Docker version 1.12.3&lt;/li&gt;
&lt;li&gt;docker-compose version 1.8.1&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="DevOps" scheme="https://morningchen.com/categories/DevOps/"/>
    
    
      <category term="Docker" scheme="https://morningchen.com/tags/Docker/"/>
    
      <category term="Jenkins" scheme="https://morningchen.com/tags/Jenkins/"/>
    
  </entry>
  
  <entry>
    <title>è°ˆè°ˆäº’è”ç½‘å®‰å…¨</title>
    <link href="https://morningchen.com/2016/02/16/Talk-about-Internet-Security/"/>
    <id>https://morningchen.com/2016/02/16/Talk-about-Internet-Security/</id>
    <published>2016-02-16T12:09:30.000Z</published>
    <updated>2018-09-27T03:55:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ— è®ºæ˜¯ITä»ä¸šäººå‘˜è¿˜æ˜¯æ™®é€šç”¨æˆ·éƒ½åº”è¯¥äº†è§£ä¸€ä¸‹äº’è”ç½‘å®‰å…¨ï¼Œæ¯•ç«Ÿè¿™å…³ç³»åˆ°ç§äººéšç§ã€‚ä»¥ä¸‹ä»9ä¸ªæ–¹é¢è°ˆè°ˆäº’è”ç½‘å®‰å…¨</p><h3 id="1-æ’åº“"><a href="#1-æ’åº“" class="headerlink" title="1.æ’åº“"></a>1.æ’åº“</h3><p>å…¶å®å¾ˆå¤šç½‘ç«™éƒ½æ³„éœ²è¿‡æ•°æ®åº“ï¼ŒåŒ…æ‹¬ä¸€äº›å¤§çš„æ¯”å¦‚csdnã€ç½‘æ˜“é‚®ç®±ã€æºç¨‹ã€ç”šè‡³åŒ…æ‹¬å¾ˆä¹…ä¹‹å‰çš„QQéƒ½æ³„éœ²è¿‡ã€‚<br>æ’åº“å°±æ˜¯æ‹¿è¿™äº›å·²ç»æ³„éœ²è¿‡çš„ç”¨æˆ·å+å¯†ç ï¼Œå»å°è¯•åœ¨ä¸€ç³»åˆ—åˆ«çš„ç½‘ç«™ç™»é™†</p><p>åº”å¯¹ç­–ç•¥ï¼šå¯¹äºå¼€å‘äººå‘˜ï¼Œæ¢saltï¼Œæ¢åŠ å¯†æ–¹å¼ï¼›å¯¹äºæ™®é€šç”¨æˆ·ï¼Œæ”¹å¯†ç ã€‚</p><h3 id="2-æ¨¡æ‹Ÿç™»é™†"><a href="#2-æ¨¡æ‹Ÿç™»é™†" class="headerlink" title="2.æ¨¡æ‹Ÿç™»é™†"></a>2.æ¨¡æ‹Ÿç™»é™†</h3><p>å½“ä½ ç™»é™†ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œå…¶å®æ˜¯å»ºç«‹äº†ä¸€ä¸ªsessionï¼Œä¹Ÿå°±æ˜¯ä¼šè¯ï¼Œä¼šè¯æ•°æ®æ˜¯åœ¨æœåŠ¡å™¨ç«¯ä¿å­˜ã€‚ä½†æ˜¯å¦‚ä½•çŸ¥é“ä½ æ˜¯å“ªä¸ªç”¨æˆ·å‘¢ï¼Œå®ƒä¼šå›ä¼ ä¸€ä¸ªsession_idä¿å­˜åœ¨cookieé‡Œï¼Œç”¨æˆ·æ¯æ¬¡ç™»é™†çš„æ—¶å€™éƒ½ä¼šéšæœºç”Ÿæˆçš„ä¸€ä¸ªå¾ˆé•¿çš„éšæœºsession_idï¼Œé»‘å®¢ä¼šé€šè¿‡ä¸€äº›å·¥å…·ï¼ˆæ¯”å¦‚æŠ“åŒ…å·¥å…·ï¼‰æ¥è·å–ä½ æµè§ˆå™¨çš„session_idæ¥æ¨¡æ‹Ÿç™»é™†ä½ çš„è´¦å·ï¼Œè¾¾åˆ°çªƒå–éšç§çš„ç›®çš„ã€‚</p><a id="more"></a><h3 id="3-æŠ“åŒ…"><a href="#3-æŠ“åŒ…" class="headerlink" title="3.æŠ“åŒ…"></a>3.æŠ“åŒ…</h3><p>ç°åœ¨ç»å¤§å¤šæ•°ç½‘ç«™è¿˜æ˜¯ä½¿ç”¨çš„httpåè®®ï¼Œè€Œhttpåè®®æœ¬èº«åˆæ˜¯ä¸åŠ å¯†çš„ï¼Œæ‰€ä»¥åœ¨ä½ è®¿é—®ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œå®ƒçš„requestå’Œresponseéƒ½æ˜¯æ˜æ–‡çš„ï¼Œè¿™æ ·é»‘å®¢å°±èƒ½æŠ“åˆ°ä½ requestå’Œresponseçš„å†…å®¹ï¼Œç„¶åè¿›è¡Œå„ä¸ªå­—æ®µçš„åˆ†æï¼Œå°±èƒ½æ‹¿åˆ°å®ƒæœ‰ç”¨çš„ä¸œè¥¿ï¼Œç„¶åå»ç ´è§£ä½ ï¼Œæ¨¡æ‹Ÿä½ çš„ç™»é™†ã€‚<br>è§£å†³åŠæ³•å°±æ˜¯ç”¨httpsåè®®ï¼Œè¿™ä¸ªså°±æ˜¯secureçš„æ„æ€ï¼Œå®ƒé€šè¿‡SSL/TLSåè®®æŠŠrequestå’Œresponseçš„å†…å®¹åšäº†ä¸€äº›åŠ å¯†ï¼Œå¹¶ä¸”å…·æœ‰æ ¡éªŒæœºåˆ¶å’Œè¯ä¹¦ï¼Œé˜²æ­¢è¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹æˆ–è€…å†’å……ã€‚å½“ç„¶æœ‰ä¸€äº›httpsåŠ å¯†æ–¹å¼å·²ç»è¢«ç ´è§£äº†ï¼Œéœ€è¦æ›´æ–°æœ€æ–°çš„åŠ å¯†åŒ…ã€‚ä¹‹å‰çš„SSLä½ç‰ˆæœ¬æ¼æ´å’Œå¿ƒè„æ»´è¡€æ¼æ´éƒ½æ˜¯httpsåè®®è¢«ç ´è§£çš„æƒ…å†µã€‚</p><p>åº”å¯¹ç­–ç•¥ï¼šç½‘ç«™æ¢httpsåè®®ã€åŠæ—¶æ›´æ–°ä¾èµ–çš„åŒ…</p><h3 id="4-è·¨ç«™è„šæœ¬æ”»å‡»-XSS"><a href="#4-è·¨ç«™è„šæœ¬æ”»å‡»-XSS" class="headerlink" title="4.è·¨ç«™è„šæœ¬æ”»å‡» - XSS"></a>4.è·¨ç«™è„šæœ¬æ”»å‡» - XSS</h3><p>æ¯”å¦‚æœ‰çš„ç½‘ç«™çš„ç•™è¨€æ¿æ²¡æœ‰ç¦ç”¨æ‰htmlæ ¼å¼çš„ä»£ç ï¼Œé»‘å®¢ç”¨ä¸€æ®µurlçš„è„šæœ¬ç•™è¨€ï¼Œè¿™ä¸ªurlçš„?åé¢è·Ÿä¸Šç”¨æˆ·çš„cookieä¿¡æ¯ã€‚ä»»ä½•ä¸€ä¸ªäººåªè¦æ‰“å¼€äº†è¿™ä¸ªé¡µé¢å°±ä¼šæŠŠè‡ªå·±çš„cookieä¿¡æ¯ä¸Šä¼ åˆ°é»‘å®¢çš„æœåŠ¡å™¨ä¸Šï¼Œé»‘å®¢å°±æ‹¿åˆ°ä½ çš„cookieè¿›è¡Œåˆ†æï¼Œè¦çŸ¥é“session_idæ˜¯å­˜åœ¨cookieé‡Œçš„ï¼Œäºæ˜¯é»‘å®¢å°±èƒ½åˆ©ç”¨ä½ çš„session_idè¿›è¡Œæ¨¡æ‹Ÿç™»é™†ï¼Œæ¥çªƒå–ä¸€äº›ä¿¡æ¯äº†</p><p>åº”å¯¹ç­–ç•¥ï¼šæ‰€ä»¥è¿™äº›ç•™è¨€æ¿å’Œç”¨æˆ·å¯è¾“å…¥çš„åœ°æ–¹éƒ½è¦å¯¹htmlè¯­æ³•è¿›è¡Œè¿‡æ»¤</p><h3 id="5-DDoSæ”»å‡»"><a href="#5-DDoSæ”»å‡»" class="headerlink" title="5.DDoSæ”»å‡»"></a>5.DDoSæ”»å‡»</h3><p>é»‘å®¢ä¼šé€šè¿‡å„ç§æ‰‹æ®µæŒæ¡å¤§é‡ç©ºé—²çš„è®¡ç®—æœºï¼Œä¿—ç§°è‚‰é¸¡ï¼Œå»å¯¹æŸä¸€ä¸ªç½‘ç«™å‘èµ·è¯·æ±‚ã€‚æŠŠä½ çš„ç½‘ç«™æ¯”ä½œé“¶è¡ŒæŸœå°çš„è¯ï¼Œé»‘å®¢ç”¨ä¸€ä¸‡å°è‚‰é¸¡å¯¹ä½ çš„ç½‘ç«™å‘èµ·è¯·æ±‚ï¼Œå°±æ„å‘³ç€ä¸€ä¸‡ä¸ªäººæ¥åˆ°ä½ çš„é“¶è¡ŒæŸœå°æ‰¾æŸœå‘˜Balaä¸€äº›æœ‰çš„æ²¡çš„ï¼Œä½†æ˜¯åé¢æƒ³å–é’±çš„äººå°±æŒ¤ä¸è¿›æ¥ï¼Œè¿™æ ·å­é“¶è¡ŒæŸœå°è¢«å¡æ»¡äº†ï¼Œä¹Ÿå°±æ„å‘³ç€ä½ çš„ç½‘ç«™ç˜«ç—ªäº†ã€‚<br>è¿‡å»éƒ½æ˜¯é’ˆå¯¹ä¸€äº›å®‰å…¨é˜²èŒƒåšå¾—ä¸å¤ªå¥½çš„ç½‘å§æ¤å…¥æœ¨é©¬ç¨‹åºï¼Œæœ€è¿‘å‡ºç°ä¸ªæ–°çš„æƒ…å†µï¼Œç”¨æ‰‹æœºå½“ä½œè‚‰é¸¡ï¼Œç‰¹åˆ«æ˜¯rootåçš„æ‰‹æœºï¼Œä¸€æ—¦rootåï¼Œä¼šå¾ˆå®¹æ˜“ç»™ç¬¬ä¸‰æ–¹è½¯ä»¶æŒæ¡æ‰‹æœºçš„ç³»ç»Ÿæƒé™ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºæ‰‹æœºä¹Ÿè¢«è£…äº†æœ¨é©¬ã€‚<br>DDosç›®å‰æ²¡æœ‰ä»€ä¹ˆå¾ˆå¥½çš„æªæ–½è¿›è¡Œé˜²èŒƒï¼Œå› ä¸ºéƒ½æ˜¯æ¨¡æ‹Ÿçš„çœŸå®ç”¨æˆ·ï¼Œè€Œä¸”æ¥æºåœ°ç†ä½ç½®IPä¹Ÿæ˜¯å¾ˆåˆ†æ•£çš„ï¼Œå¾ˆéš¾å»è¿‡æ»¤æ‰è¿™ç§éæ³•è¯·æ±‚ï¼Œæ‰€ä»¥è¿™ç§å¯èƒ½éœ€è¦æ‰¾ç¬¬ä¸‰æ–¹å®‰å…¨å…¬å¸è¿›è¡Œç­–ç•¥ä¸Šçš„æ¸…æ´—ï¼Œä¹Ÿå°±æ˜¯æµé‡çš„æ¸…æ´—ï¼Œä»–ä»¬ä¼šè¯†åˆ«è¿™äº›è¯·æ±‚æœ‰ä»€ä¹ˆéæ³•çš„åœ°æ–¹ï¼Œç„¶åå§è¿™äº›è¯·æ±‚è¿‡æ»¤æ‰ã€‚å…·ä½“çš„åšæ³•å°±æ˜¯æŠŠä½ ç½‘ç«™çš„åŸŸåè§£æåˆ°å®‰å…¨å…¬å¸çš„IPä¸Šï¼Œä»–çš„æœåŠ¡å™¨æŠŠè¿‡æ»¤åçš„åˆæ³•è¯·æ±‚å†è½¬å‘ç»™ä½ è‡ªå·±çš„ç½‘ç«™æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å¤§é‡çš„DDosè¯·æ±‚å°±è¢«ä»–ä»¬ç»™è¿‡æ»¤æ‰äº†ã€‚</p><h3 id="6-SQLæ³¨å…¥"><a href="#6-SQLæ³¨å…¥" class="headerlink" title="6.SQLæ³¨å…¥"></a>6.SQLæ³¨å…¥</h3><p>é€ æˆSQLæ³¨å…¥çš„åŸå› æ˜¯å› ä¸ºç¨‹åºæ²¡æœ‰æœ‰æ•ˆè¿‡æ»¤ç”¨æˆ·çš„è¾“å…¥ï¼Œä½¿æ”»å‡»è€…æˆåŠŸçš„å‘æœåŠ¡å™¨æäº¤æ¶æ„çš„SQLæŸ¥è¯¢ä»£ç ï¼Œç¨‹åºåœ¨æ¥æ”¶åé”™è¯¯çš„å°†æ”»å‡»è€…çš„è¾“å…¥ä½œä¸ºæŸ¥è¯¢è¯­å¥çš„ä¸€éƒ¨åˆ†æ‰§è¡Œï¼Œå¯¼è‡´åŸå§‹çš„æŸ¥è¯¢é€»è¾‘è¢«æ”¹å˜ï¼Œé¢å¤–çš„æ‰§è¡Œäº†æ”»å‡»è€…ç²¾å¿ƒæ„é€ çš„æ¶æ„ä»£ç ã€‚</p><p>åº”å¯¹ç­–ç•¥ï¼šDAOå±‚åŒ…è£…ï¼Œåœ¨åå°ä½œä¸ºå‚æ•°ä¼ è¿‡å»ï¼Œå¤„ç†ç‰¹æ®Šå­—ç¬¦æ‰</p><h3 id="7-å¼±å¯†ç "><a href="#7-å¼±å¯†ç " class="headerlink" title="7.å¼±å¯†ç "></a>7.å¼±å¯†ç </h3><p>æœåŠ¡å™¨å¯†ç ã€æ•°æ®åº“å¯†ç ç­‰ä¸€äº›é…ç½®æ–‡ä»¶åº”è¯¥ä½¿ç”¨å­—æ¯æ•°å­—å¤§å°å†™æ··åˆçš„å¤æ‚é•¿å¯†ç ã€‚è¿˜æœ‰ï¼Œä¸è¦æŠŠè¿™äº›é…ç½®æ–‡ä»¶ä¸Šä¼ åˆ°å¼€æºçš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­å»äº†ã€‚å»githubä¸Šæœç´¢å…³é”®å­—passwordï¼Œç®€ç›´ä¸è¦å¤ªå¤šã€‚<br>å†è¯´è¯´ç”¨æˆ·å¯†ç çš„åŠ å¯†æ–¹å¼ï¼Œè™½ç„¶å¾ˆå¤šç½‘ç«™é‡‡ç”¨çš„MD5çš„åŠ å¯†æ–¹å¼åŠ å¯†äº†ç”¨æˆ·çš„å¯†ç ï¼Œä½†æ˜¯å¾ˆå¤šé»‘å®¢æ‰‹é‡Œéƒ½æœ‰å½©è™¹è¡¨ï¼Œå·¦è¾¹æ˜¯åŸæ–‡å¯†ç ï¼Œå³è¾¹æ˜¯MD5åçš„å¯†ç ã€‚å¦‚æœç”¨æˆ·çš„å¯†ç å¼‚å¸¸ç®€å•æˆ–å¾ˆå¸¸è§çš„è¯ï¼Œå°±ç®—æ˜¯MD5åŠ å¯†åçš„å¯†ç ï¼Œä¹Ÿèƒ½å¾ˆå®¹æ˜“åæŸ¥å‡ºåŸæ–‡å¯†ç ã€‚</p><p>åº”å¯¹ç­–ç•¥ï¼šæ¢è¾ƒéš¾ç ´è§£çš„åŠ å¯†æ–¹å¼ï¼Œ</p><p>ä¸€äº›å¸¸è§çš„å¯†ç åŠ å¯†ç®—æ³•ï¼Œç”±ç ´è§£éš¾åº¦ä»ä½åˆ°é«˜æ’åˆ—ï¼š</p><ul><li>æ˜æ–‡å‚¨å­˜</li><li>hash md5</li><li>md5 + salt</li><li>bcrypt</li><li>PBKDF2</li></ul><h3 id="8-æœåŠ¡å™¨æ¼æ´"><a href="#8-æœåŠ¡å™¨æ¼æ´" class="headerlink" title="8.æœåŠ¡å™¨æ¼æ´"></a>8.æœåŠ¡å™¨æ¼æ´</h3><p>ä¸€èˆ¬éƒ½æ˜¯å¼€å‘äººå‘˜ç–å¿½é€ æˆçš„ï¼Œæ¯”å¦‚è¯´æƒé™æ§åˆ¶æ²¡åšå¥½ï¼Œæ²¡è€ƒè™‘å‘¨å…¨ç­‰åŸå› éƒ½ä¼šé€ æˆæœåŠ¡å™¨æ¼æ´ï¼Œç»™é»‘å®¢å¯ä¹˜ä¹‹æœºã€‚</p><p>åº”å¯¹ç­–ç•¥ï¼šcode review</p><h3 id="9-æœåŠ¡å™¨å®‰å…¨"><a href="#9-æœåŠ¡å™¨å®‰å…¨" class="headerlink" title="9.æœåŠ¡å™¨å®‰å…¨"></a>9.æœåŠ¡å™¨å®‰å…¨</h3><p>ä¹‹å‰å†™è¿‡ä¸€ç¯‡å…³äºæœåŠ¡å™¨å®‰å…¨çš„æ–‡ç« <a href="http://morningchen.com/2015/07/16/settings-for-VPS-safety/">ã€ŠæœåŠ¡å™¨å®‰å…¨ä¹‹SSHè®¾ç½®ã€‹</a></p><ul><li>ç”¨linux iptablesè½¯ä»¶é˜²ç«å¢™æœåŠ¡</li><li>å°½é‡æŠŠä¸ç”¨çš„ä¸€äº›ç«¯å£ç»™å…³æ‰ï¼Œæ•°æ®åº“çš„é»˜è®¤ç«¯å£ä¹Ÿè¦ç»™æ”¹æ‰ï¼ˆæƒ³æƒ³ä¹‹å‰çš„redisæ¼æ´ï¼‰</li><li>è½¯ä»¶åŠæ—¶æ›´æ–°ï¼Œæ‰“å®‰å…¨è¡¥ä¸</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä»å®‰å…¨è§’åº¦æ¥è®²ï¼Œæ°¸è¿œæ˜¯é“é«˜ä¸€å°ºé­”é«˜ä¸€ä¸ˆï¼Œé»‘å®¢æ°¸è¿œä¼šæ‰¾åˆ°æ›´å…ˆè¿›çš„æ”»å‡»æ–¹æ³•ã€‚æ¯”å¦‚è¯´å»å¹´æœ‰äººä¹Ÿè¯´è¿‡äº¬ä¸œï¼Œä»–è™½ç„¶ç”¨çš„httpsåè®®ï¼Œä½†æ˜¯æ˜¯SSL 2.0çš„åŠ å¯†ç‰ˆæœ¬ï¼Œæ—©å°±è¢«ç ´è§£äº†ï¼Œä½†æ˜¯è¿˜æœ‰æ— æ•°çš„ç½‘ç«™è¿httpséƒ½æ²¡ç”¨åšã€‚æ¯•ç«Ÿäº¬ä¸œæ˜¯ä¸€å®¶ä¸Šå¸‚å…¬å¸ï¼Œå¤§å®¶éš¾å…å¯¹ä»–çš„è¦æ±‚éƒ½æ¯”è¾ƒé«˜ã€‚å¯¹äºä¸€èˆ¬çš„äº’è”ç½‘å…¬å¸è€Œè¨€ï¼Œå¯èƒ½æ˜¯ä¸ªå¾ªåºæ¸è¿›çš„è¿‡ç¨‹ï¼Œä¸€å¼€å§‹æŠŠä¸€äº›è¾ƒå¤§çš„æ¼æ´ç»™è¡¥ä¸Šï¼Œéšç€å…¬å¸çš„æ‰©å¤§ï¼Œé¢„ç®—çš„å¢åŠ ï¼Œä¸æ–­æé«˜è‡ªå·±çš„å®‰å…¨æ°´å‡†ï¼Œæˆ–è€…è¯·ä¸€äº›å®‰å…¨ä¸“å®¶ã€‚</p><p>å¯¹äºä¸€èˆ¬ç”¨æˆ·è€Œè¨€å°±æ˜¯å°½é‡ä¿è¯è‡ªå·±æ¯ä¸ªç½‘ç«™çš„å¯†ç éƒ½ä¸ç›¸åŒï¼Œä¸€äº›æ¶‰åŠåˆ°éšç§çš„é‡è¦ç½‘ç«™ï¼Œæ¯”å¦‚è¯´ä¸€äº›è´­ç‰©ç½‘ç«™ã€ç½‘é“¶ä¸€å®šè¦ä½¿ç”¨å¤æ‚çš„å¯†ç ï¼Œç„¶åæ¯éš”ä¸€æ®µæ—¶é—´å°±æ¢ä¸€æ¬¡å¯†ç ã€‚æ°¸è¿œè®°ä½ä¸€å¥è¯ï¼Œä¸æ˜¯ä½ çš„è´¦å·æ²¡æ³„éœ²ï¼Œè€Œæ˜¯ä½ çš„è´¦å·æ²¡æœ‰ä»·å€¼ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ— è®ºæ˜¯ITä»ä¸šäººå‘˜è¿˜æ˜¯æ™®é€šç”¨æˆ·éƒ½åº”è¯¥äº†è§£ä¸€ä¸‹äº’è”ç½‘å®‰å…¨ï¼Œæ¯•ç«Ÿè¿™å…³ç³»åˆ°ç§äººéšç§ã€‚ä»¥ä¸‹ä»9ä¸ªæ–¹é¢è°ˆè°ˆäº’è”ç½‘å®‰å…¨&lt;/p&gt;
&lt;h3 id=&quot;1-æ’åº“&quot;&gt;&lt;a href=&quot;#1-æ’åº“&quot; class=&quot;headerlink&quot; title=&quot;1.æ’åº“&quot;&gt;&lt;/a&gt;1.æ’åº“&lt;/h3&gt;&lt;p&gt;å…¶å®å¾ˆå¤šç½‘ç«™éƒ½æ³„éœ²è¿‡æ•°æ®åº“ï¼ŒåŒ…æ‹¬ä¸€äº›å¤§çš„æ¯”å¦‚csdnã€ç½‘æ˜“é‚®ç®±ã€æºç¨‹ã€ç”šè‡³åŒ…æ‹¬å¾ˆä¹…ä¹‹å‰çš„QQéƒ½æ³„éœ²è¿‡ã€‚&lt;br&gt;æ’åº“å°±æ˜¯æ‹¿è¿™äº›å·²ç»æ³„éœ²è¿‡çš„ç”¨æˆ·å+å¯†ç ï¼Œå»å°è¯•åœ¨ä¸€ç³»åˆ—åˆ«çš„ç½‘ç«™ç™»é™†&lt;/p&gt;
&lt;p&gt;åº”å¯¹ç­–ç•¥ï¼šå¯¹äºå¼€å‘äººå‘˜ï¼Œæ¢saltï¼Œæ¢åŠ å¯†æ–¹å¼ï¼›å¯¹äºæ™®é€šç”¨æˆ·ï¼Œæ”¹å¯†ç ã€‚&lt;/p&gt;
&lt;h3 id=&quot;2-æ¨¡æ‹Ÿç™»é™†&quot;&gt;&lt;a href=&quot;#2-æ¨¡æ‹Ÿç™»é™†&quot; class=&quot;headerlink&quot; title=&quot;2.æ¨¡æ‹Ÿç™»é™†&quot;&gt;&lt;/a&gt;2.æ¨¡æ‹Ÿç™»é™†&lt;/h3&gt;&lt;p&gt;å½“ä½ ç™»é™†ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œå…¶å®æ˜¯å»ºç«‹äº†ä¸€ä¸ªsessionï¼Œä¹Ÿå°±æ˜¯ä¼šè¯ï¼Œä¼šè¯æ•°æ®æ˜¯åœ¨æœåŠ¡å™¨ç«¯ä¿å­˜ã€‚ä½†æ˜¯å¦‚ä½•çŸ¥é“ä½ æ˜¯å“ªä¸ªç”¨æˆ·å‘¢ï¼Œå®ƒä¼šå›ä¼ ä¸€ä¸ªsession_idä¿å­˜åœ¨cookieé‡Œï¼Œç”¨æˆ·æ¯æ¬¡ç™»é™†çš„æ—¶å€™éƒ½ä¼šéšæœºç”Ÿæˆçš„ä¸€ä¸ªå¾ˆé•¿çš„éšæœºsession_idï¼Œé»‘å®¢ä¼šé€šè¿‡ä¸€äº›å·¥å…·ï¼ˆæ¯”å¦‚æŠ“åŒ…å·¥å…·ï¼‰æ¥è·å–ä½ æµè§ˆå™¨çš„session_idæ¥æ¨¡æ‹Ÿç™»é™†ä½ çš„è´¦å·ï¼Œè¾¾åˆ°çªƒå–éšç§çš„ç›®çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Security" scheme="https://morningchen.com/categories/Security/"/>
    
    
      <category term="éšç¬”" scheme="https://morningchen.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
      <category term="Security" scheme="https://morningchen.com/tags/Security/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠGrowth Hackerã€‹è¯»åæ„Ÿ</title>
    <link href="https://morningchen.com/2015/12/18/growth-hacker-book-review/"/>
    <id>https://morningchen.com/2015/12/18/growth-hacker-book-review/</id>
    <published>2015-12-18T14:58:11.000Z</published>
    <updated>2018-09-27T03:51:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‹œè¯»äº†ä¸€ä¸‹ã€ŠGrowth Hackerã€‹ã€‚è‰¾ç›ï¼Œç®€ç›´å°±æ˜¯äº§å“ç»ç†çš„è£…é€¼åˆ©å™¨å•Šï½æœ¬ä¹¦å¹²è´§æ»¡æ»¡ï¼Œå„ç§æ²¡å¬è¿‡çš„è¯è¿é¢æ‰‘æ¥ï¼Œç®€ç›´å¤§å¼€çœ¼ç•Œã€‚æ­¤ä¹¦ä¸€å‡ºï¼Œä¼°è®¡å›½å†…ä¸ä¹…åå°±ä¼šå‡ºç°CGO(Chief Growth Officer)é¦–å¸­å¢é•¿å®˜äº†:)ï¼Œå˜¿å˜¿å˜¿ã€‚</p><p>è®²çœŸï¼Œä¸€å£æ°”çœ‹å®Œè¿™æœ¬ä¹¦åï¼Œç»™æˆ‘å°è±¡æœ€æ·±çš„è¿˜æ˜¯è¿™å¥è¯ï¼š</p><blockquote><p>æ€»çš„è¯´æ¥ï¼Œä¸€è·¯é‡è›®æˆé•¿ï¼Œè·Œè·Œæ’æ’ï¼Œä½“å†…å¸æ”¶äº†ä¸å°‘â€œæ··ä¹±â€çš„èƒ½é‡ï¼Œç„¶è€Œé‚£äº›åœ¨å½“åˆçœ‹æ¥ä»»æ€§å¦„ä¸ºã€æ— è¶³è½»é‡çš„ç»å†ï¼Œç»ˆå°†åœ¨æŸä¸€æ—¥è¿ç‚¹æˆçº¿ï¼Œå¼€èŠ±ç»“æœ</p></blockquote><p>ç®€ç›´æ·±æœ‰ä½“ä¼šå•Šï¼ï¼ï¼æ›¾ç»ä¸ç»æ„åšçš„ä¸€äº›å°äº‹ï¼Œçœ‹è¿‡çš„ä¸€ç¯‡æ–‡ç« ï¼Œå†™è¿‡çš„ä¸€æ®µä»£ç ï¼Œå‘è¡¨çš„ä¸€ç¯‡æ„Ÿå¹ï¼Œæ°å¥½å°±åœ¨é‚£æ—¶ç¢°æ’åœ¨äº†ä¸€èµ·ï¼Œä¸ç”±æ„Ÿå¹å†¥å†¥ä¹‹ä¸­ã€‚ã€‚ã€‚&gt;.&lt; ç®€ç›´äº†ã€‚ã€‚</p><p>æˆ–è®¸æˆ‘çš„BLOGä¹Ÿå¯èƒ½ä¼šåœ¨æœªæ¥ä¸æŸä»¶äº‹è¿æˆä¸€çº¿å§ã€‚ç®€å•æ¢³ç†ä¸‹ä¸»è¦å†…å®¹ï¼Œä½œä¸ºä¸€ä¸ªæ¡†æ¶æ¤å…¥åˆ°æˆ‘çš„è„‘æµ·ä¸­ï¼Œç­‰ä»€ä¹ˆæ—¶å€™ç”¨å¾—ç€äº†è‡ªç„¶å°±ä¼šæƒ³èµ·å…¶ä¸­ä¸€äºŒã€‚</p><a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯å¢é•¿é»‘å®¢"><a href="#ä»€ä¹ˆæ˜¯å¢é•¿é»‘å®¢" class="headerlink" title="ä»€ä¹ˆæ˜¯å¢é•¿é»‘å®¢"></a>ä»€ä¹ˆæ˜¯å¢é•¿é»‘å®¢</h3><p>é¡¾åæ€ä¹‰ Growth æŒ‡çš„äº§å“å¢é•¿è¿™ä¸ªæ ¸å¿ƒç›®æ ‡ï¼ŒHacker å°±æ˜¯ä»¥ Hackerçš„æ€ç»´æ–¹å¼æ€è€ƒã€‚<br>äº§å“å¢é•¿è¿™ä¸ªç›®æ ‡å¯ä»¥åˆ†ä¸º5ä¸ªé˜¶æ®µAARRR</p><ul><li>Acquisition è·å–ç”¨æˆ·</li><li>Activation æ¿€å‘æ´»è·ƒ</li><li>Retention æé«˜ç•™å­˜</li><li>Revenue å¢åŠ æ”¶å…¥</li><li>Referral ä¼ æ’­æ¨è</li></ul><p>æœ¬ä¹¦ä»¥å¤§é‡çš„æ¡ˆä¾‹é˜è¿°äº†å¦‚ä½•åšåˆ°AARRRè¿™äº”ä¸ªé˜¶æ®µï¼Œä½†å‰ææ˜¯åˆ›é€ æ­£ç¡®çš„äº§å“</p><h3 id="åˆ›é€ æ­£ç¡®çš„äº§å“"><a href="#åˆ›é€ æ­£ç¡®çš„äº§å“" class="headerlink" title="åˆ›é€ æ­£ç¡®çš„äº§å“"></a>åˆ›é€ æ­£ç¡®çš„äº§å“</h3><ul><li>äº§å“æœ¬èº«çš„å®šä½</li><li><p>PMF</p><p>  ProductMarketFit æ¢å¯»äº§å“ä¸å¸‚åœºçš„å®Œç¾å¥‘åˆ<br>  å¦‚æœäº§å“åˆæœŸä¸æ˜¯é‚£ä¹ˆå®Œå¤‡ï¼Œé‚£ä¹ˆæ— æ­¢å¢ƒçš„å¸‚åœºæ‰©å¼ åªä¼šæ¯äº†è¿™ä¸ªäº§å“</p></li><li><p>MVP</p><p>  éœ€æ±‚æ‰æ˜¯å‚¬ç”Ÿäº§å“çš„åŸåŠ¨åŠ› ç”¨æœ€å°åŒ–å¯è¡Œäº§å“(MVP, Minimum Viable Product)éªŒè¯éœ€æ±‚</p><p>  å…¸å‹ä¾‹å­ ç”¨å¾®ä¿¡å¹³å°å¼€å‘MVP</p><p>  å¿…å¤‡æ¨¡å—ï¼šåé¦ˆæ¸ é“ã€å®˜æ–¹å…¬å‘Šã€è‡ªåŠ¨å‡çº§</p></li></ul><h3 id="Growth-Hackerçš„ç‰¹å¾"><a href="#Growth-Hackerçš„ç‰¹å¾" class="headerlink" title="Growth Hackerçš„ç‰¹å¾"></a>Growth Hackerçš„ç‰¹å¾</h3><ul><li>æ•°æ®ä¸ºç‹</li><li>ä¸“æ³¨ç›®æ ‡</li><li>å…³æ³¨ç»†èŠ‚</li><li>å¯Œäºåˆ›æ„</li><li>ä¿¡æ¯é€šé€</li></ul><h3 id="ä»¥åå¯èƒ½ä¼šç”¨ä¸Šçš„Growth-Hackerå·¥å…·ç®±"><a href="#ä»¥åå¯èƒ½ä¼šç”¨ä¸Šçš„Growth-Hackerå·¥å…·ç®±" class="headerlink" title="ä»¥åå¯èƒ½ä¼šç”¨ä¸Šçš„Growth Hackerå·¥å…·ç®±"></a>ä»¥åå¯èƒ½ä¼šç”¨ä¸Šçš„Growth Hackerå·¥å…·ç®±</h3><ul><li><p>Google Analytics</p><p>è°·æ­Œå¼ºå¤§å…è´¹çš„ç»Ÿè®¡å·¥å…·</p></li><li><p>Mixpanel/KissMetrics</p><p>ç”¨æˆ·è¡Œä¸ºå¯¼å‘åˆ†æå·¥å…·</p></li><li><p>UserCycle</p><p>ç»Ÿè®¡åˆ†æ+ç”Ÿå‘½å‘¨æœŸç»´æŠ¤+åˆ†ç»„å®éªŒæµ‹è¯•</p></li><li><p>Customer.io/Vero</p><p>åˆ†æé‚®ä»¶</p></li><li><p>Optimize.ly/Unbouce</p><p>A/Bæµ‹è¯•åˆ©å™¨</p></li><li><p>Basecamp/é£è½¦/æ˜é“/Tower/Teambition</p><p>å›¢é˜Ÿåä½œå¹³å°</p></li><li><p>å‹ç›Ÿ/TalkingData</p><p>ç§»åŠ¨åº”ç”¨ç»Ÿè®¡å¹³å°</p></li></ul><h3 id="æˆ‘çš„æ„Ÿå—"><a href="#æˆ‘çš„æ„Ÿå—" class="headerlink" title="æˆ‘çš„æ„Ÿå—"></a>æˆ‘çš„æ„Ÿå—</h3><p>å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œä¹Ÿè®¸æœ€å¥½çš„é¢è¯•æ–¹å¼æ˜¯show me the codeï¼›<br>å¯¹äºå¢é•¿é»‘å®¢è€Œè¨€ï¼Œä¹Ÿè®¸å°±æ˜¯show me the dataã€‚</p><p>æ— è®ºæ˜¯ä¼ ç»Ÿè¡Œä¸šè¿˜æ˜¯æ–°å…´è¡Œä¸šï¼Œéƒ½è¶Šæ¥è¶Šéœ€è¦å¤šé¢æ‰‹äº†ã€‚æ¯”å¦‚å»ºç­‘ç”µæ°”å·¥ç¨‹å¸ˆã€æŠ€æœ¯å‹é”€å”®ã€å…¨æ ˆå·¥ç¨‹å¸ˆä»¥åŠè¿™é‡Œè¯´åˆ°çš„å¢é•¿é»‘å®¢ï¼Œä»–ä»¬éƒ½ä¸æ­¢ç²¾é€šäºä¸€ç‚¹ï¼Œå¤šä¸ªéƒ¨é—¨ä¹‹é—´çš„åè°ƒåˆä½œæ­£æ˜¯éœ€è¦è¿™äº›å¤šé¢æ‰‹æ¥æŠŠæŒã€‚å®ç°äº§å“çš„å¢é•¿æ­£æ˜¯éœ€è¦å¢é•¿é»‘å®¢ï¼Œä»–ä»¬æ˜¯æ¸¸èµ°åœ¨äº§å“ã€è¿è¥ã€ç ”å‘ã€è®¾è®¡ã€ç”¨ç ”ç­‰ç¯èŠ‚ä¹‹é—´çš„å¤šé¢æ‰‹ã€‚</p><p>æ¶Œç°å‡ºå¦‚æ­¤å¤šçš„æœªçŸ¥äº‹ç‰©æƒ³æƒ³éƒ½æœ‰äº›å°å…´å¥‹å‘¢ï¼ŒæœŸå¾…æœªæ¥ï½</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‹œè¯»äº†ä¸€ä¸‹ã€ŠGrowth Hackerã€‹ã€‚è‰¾ç›ï¼Œç®€ç›´å°±æ˜¯äº§å“ç»ç†çš„è£…é€¼åˆ©å™¨å•Šï½æœ¬ä¹¦å¹²è´§æ»¡æ»¡ï¼Œå„ç§æ²¡å¬è¿‡çš„è¯è¿é¢æ‰‘æ¥ï¼Œç®€ç›´å¤§å¼€çœ¼ç•Œã€‚æ­¤ä¹¦ä¸€å‡ºï¼Œä¼°è®¡å›½å†…ä¸ä¹…åå°±ä¼šå‡ºç°CGO(Chief Growth Officer)é¦–å¸­å¢é•¿å®˜äº†:)ï¼Œå˜¿å˜¿å˜¿ã€‚&lt;/p&gt;
&lt;p&gt;è®²çœŸï¼Œä¸€å£æ°”çœ‹å®Œè¿™æœ¬ä¹¦åï¼Œç»™æˆ‘å°è±¡æœ€æ·±çš„è¿˜æ˜¯è¿™å¥è¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ€»çš„è¯´æ¥ï¼Œä¸€è·¯é‡è›®æˆé•¿ï¼Œè·Œè·Œæ’æ’ï¼Œä½“å†…å¸æ”¶äº†ä¸å°‘â€œæ··ä¹±â€çš„èƒ½é‡ï¼Œç„¶è€Œé‚£äº›åœ¨å½“åˆçœ‹æ¥ä»»æ€§å¦„ä¸ºã€æ— è¶³è½»é‡çš„ç»å†ï¼Œç»ˆå°†åœ¨æŸä¸€æ—¥è¿ç‚¹æˆçº¿ï¼Œå¼€èŠ±ç»“æœ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç®€ç›´æ·±æœ‰ä½“ä¼šå•Šï¼ï¼ï¼æ›¾ç»ä¸ç»æ„åšçš„ä¸€äº›å°äº‹ï¼Œçœ‹è¿‡çš„ä¸€ç¯‡æ–‡ç« ï¼Œå†™è¿‡çš„ä¸€æ®µä»£ç ï¼Œå‘è¡¨çš„ä¸€ç¯‡æ„Ÿå¹ï¼Œæ°å¥½å°±åœ¨é‚£æ—¶ç¢°æ’åœ¨äº†ä¸€èµ·ï¼Œä¸ç”±æ„Ÿå¹å†¥å†¥ä¹‹ä¸­ã€‚ã€‚ã€‚&amp;gt;.&amp;lt; ç®€ç›´äº†ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ–è®¸æˆ‘çš„BLOGä¹Ÿå¯èƒ½ä¼šåœ¨æœªæ¥ä¸æŸä»¶äº‹è¿æˆä¸€çº¿å§ã€‚ç®€å•æ¢³ç†ä¸‹ä¸»è¦å†…å®¹ï¼Œä½œä¸ºä¸€ä¸ªæ¡†æ¶æ¤å…¥åˆ°æˆ‘çš„è„‘æµ·ä¸­ï¼Œç­‰ä»€ä¹ˆæ—¶å€™ç”¨å¾—ç€äº†è‡ªç„¶å°±ä¼šæƒ³èµ·å…¶ä¸­ä¸€äºŒã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Reading" scheme="https://morningchen.com/categories/Reading/"/>
    
    
      <category term="éšç¬”" scheme="https://morningchen.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>Vue.js åˆä½“éªŒ</title>
    <link href="https://morningchen.com/2015/12/05/vue-js-notes/"/>
    <id>https://morningchen.com/2015/12/05/vue-js-notes/</id>
    <published>2015-12-05T13:53:09.000Z</published>
    <updated>2018-09-27T17:39:55.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ€è¿‘å·¥ä½œä¸­çš„ä¸€ä¸ªå°é¡¹ç›®éœ€è¦åšä¸€ä¸ªè½¦è¾†ä¿¡æ¯é€‰æ‹©æ¡†çš„ä¸‰çº§è”åŠ¨ï¼Œæœ‰ç‚¹ç±»ä¼¼çœå¸‚å¿çš„ä¸‰çº§è”åŠ¨ï¼Œä¸‹ä¸€çº§ä¾èµ–ä¸Šä¸€çº§çš„æ•°æ®ã€‚æœ€åçš„æ•ˆæœæ˜¯è¿™æ ·</p><p>å› ä¸ºè¿™ä¸€å—çš„ä»£ç ä¸šåŠ¡é€»è¾‘ç›¸å½“å¤æ‚ï¼Œé‡‡ç”¨jQueryå†™çš„è¯ä»£ç é‡æœ‰ç‚¹å¤§ï¼Œè€Œä¸”ä¼šæŠŠhtmlçš„ä»£ç å†™åœ¨jsæ–‡ä»¶é‡Œï¼Œä¸æ˜“äºé˜…è¯»å’ŒåæœŸç»´æŠ¤ï¼Œæ‰€ä»¥CTOå¤§å¤§å»ºè®®ç”¨Vue.jsæ¥é‡å†™ã€‚</p><h3 id="æ€è€ƒè¿‡ç¨‹"><a href="#æ€è€ƒè¿‡ç¨‹" class="headerlink" title="æ€è€ƒè¿‡ç¨‹"></a>æ€è€ƒè¿‡ç¨‹</h3><ol><li>é¦–å…ˆæ˜¯çˆ¬å–è½¦è¾†ä¿¡æ¯çš„æ•°æ®ï¼Œæ‰¾äº†ä¸€å®¶ä¿¡æ¯æ¯”è¾ƒå…¨çš„ç›¸å…³å¹³å°ï¼Œå¼€å§‹äº†çˆ¬è™«ä¹‹æ—…ï¼Œå¾…æœ‰ç©ºå†™ä¸‹çˆ¬è™«çš„æ€è€ƒï¼Œè¿™é‡Œç•¥è¿‡</li><li>æ‹¿åˆ°å¤§æ¦‚2ä¸‡å¤šæ¡æ•°æ®åï¼Œå†™ä¸€ä¸ªpipelineæ•´ç†å¥½æ•°æ®å¹¶å†™å…¥è‡ªå·±çš„æ•°æ®åº“ï¼Œæ•°æ®åˆ†ä¸º3ç±»ï¼šå“ç‰Œã€ç³»åˆ—ã€è½¦å‹ï¼Œå­˜å…¥3å¼ è¡¨é‡Œï¼Œåˆ†åˆ«å‘½åä¸ºcar_brands, car_series, car_modelsï¼Œå“¦äº†ï½æœ‰äº†æ•°æ®å°±å¯ä»¥åŠ¨æ‰‹äº†</li><li>åç«¯å†™å¥½ä¸‰ä¸ªhandleré€»è¾‘ï¼Œå°†æ•°æ®ä»¥jsonçš„æ–¹å¼ä¼ ç»™å‰ç«¯</li></ol><a id="more"></a><h3 id="ç”¨-jQueryå†™"><a href="#ç”¨-jQueryå†™" class="headerlink" title="ç”¨ jQueryå†™"></a>ç”¨ jQueryå†™</h3><p>å‰ç«¯å‰ç«¯æ¥æ¥å—æˆ‘å¤§åç«¯çš„æ•°æ®å§ï½ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä¹‹å‰å†™çš„jQueryç‰ˆæœ¬çš„ä»£ç </p><ol><li>ç¬¬ä¸€ä¸ªfocusäº‹ä»¶ ç‚¹å‡»inputæ¡†æ¡†å¼¹å‡ºmodalé€‰æ‹©æ¡†ï¼Œå¹¶å‘åå°è¯·æ±‚car_brandsæ•°æ®ï¼ŒæˆåŠŸårenderåˆ°modalé‡Œ</li><li>ç¬¬äºŒä¸ªclickäº‹ä»¶ é€‰æ‹©ç¬¬ä¸€åˆ—å“ç‰Œåï¼Œå‘åå°è¯·æ±‚car_seriesæ•°æ®ï¼ŒæˆåŠŸårenderå‡ºè¯¥å“ç‰Œä¸‹æ‰€æœ‰çš„è½¦ç³»</li><li>ç¬¬ä¸‰ä¸ªclickäº‹ä»¶ é€‰æ‹©ç¬¬äºŒåˆ—è½¦ç³»åï¼Œå‘åå°è¯·æ±‚car_modelsæ•°æ®ï¼ŒæˆåŠŸårenderå‡ºè¯¥è½¦ç³»ä¸‹æ‰€æœ‰çš„å‹å·</li><li>ç¬¬å››ä¸ªclickäº‹ä»¶ é€‰æ‹©ç¬¬ä¸‰åˆ—è½¦å‹åï¼Œå°†<code>ç¡®å®š</code>buttonæ¿€æ´»</li><li>ç¬¬äº”ä¸ªclickäº‹ä»¶ ç‚¹å‡»ä¿å­˜æŒ‰é’®å éšè—modalæ¡†ï¼Œå°†é€‰å¥½çš„ä¿¡æ¯å†™å…¥inputæ¡†æ¡†ï¼Œç”¨bluræ–¹æ³•æ¿€æ´»formvalidationè¡¨å•æ ¡éªŒ</li></ol><pre><code>$(&quot;#select-car&quot;).on(&quot;focus&quot;, &apos;input&apos;, (function () {    $(&apos;#carModal&apos;).modal(&apos;show&apos;);    $(&quot;#choose-brand &gt; .choose-box&quot;).html(&apos;&apos;);    $(&quot;#choose-series &gt; .choose-box&quot;).html(&apos;&lt;div class=&quot;cont-default&quot; data-code=&quot;&quot; data-name=&quot;&quot;&gt;è¯·å…ˆé€‰æ‹©å“ç‰Œ&lt;/div&gt;&apos;);    $(&quot;#choose-model &gt; .choose-box&quot;).html(&apos;&lt;div class=&quot;cont-default&quot; data-code=&quot;&quot; data-name=&quot;&quot;&gt;è¯·å…ˆé€‰æ‹©è½¦ç³»&lt;/div&gt;&apos;);    $(&apos;#save-car&apos;).prop(&apos;disabled&apos;, true);    $.ajax({        url: &quot;/borrow/release/car_brands&quot;,        dataType: &quot;json&quot;,        success: function (data) {            $(&quot;.brand-cata&quot;).html(&quot;&quot;);            $.each(data, function(k, v){                $(&quot;.brand-cata&quot;).append(&quot;&lt;li&gt;&quot; + v.cata + &quot;&lt;/li&gt;&quot;);                $(&quot;#choose-brand &gt; .choose-box&quot;).append(&quot;&lt;div class=cont-tit data-name=&apos;&quot; + v.cata + &quot;&apos;&gt;&quot; + v.cata + &quot;&lt;/div&gt;&quot;);                $.each(v.brands, function(k, v){                    var b = $(&quot;&lt;div class=&apos;choose-cont&apos; data-code=&apos;&quot; + v.brand_code + &quot;&apos; data-name=&apos;&quot; + v.en_name + &quot;&apos;&gt;&quot; + v.en_name + &quot;&lt;/div&gt;&quot;);                    $(&quot;#choose-brand &gt; .choose-box&quot;).append(b);                })            });            $(&quot;.brand-cata li&quot;).on(&quot;click&quot;, function () {                var e = $(this).html(),                    t = $(&quot;#choose-brand .choose-box .cont-tit[data-name=&quot; + e.toUpperCase() + &quot;]&quot;);                t.length &amp;&amp; t.parent().animate({scrollTop: t.parent().scrollTop() + (t.offset().top - t.parent().offset().top)})            });        },        error: function (data) {},        fail: function (data) {}    });}));var loading_flag = false;$(&quot;#choose-brand&quot;).on(&quot;click&quot;, &quot;.choose-box &gt; .choose-cont&quot;, function () {    if (loading_flag == true) {        return false    }    $(&quot;#choose-series &gt; .choose-box&quot;).html(&apos;&lt;div class=&quot;cont-default&quot; data-code=&quot;&quot; data-name=&quot;&quot;&gt;è¯·å…ˆé€‰æ‹©å“ç‰Œ&lt;/div&gt;&apos;);    $(&quot;#choose-model &gt; .choose-box&quot;).html(&apos;&lt;div class=&quot;cont-default&quot; data-code=&quot;&quot; data-name=&quot;&quot;&gt;è¯·å…ˆé€‰æ‹©è½¦ç³»&lt;/div&gt;&apos;);    $(&apos;#save-car&apos;).prop(&apos;disabled&apos;, true);    $(&quot;.choose-cont&quot;).removeClass(&quot;active&quot;);    $(this).addClass(&quot;active&quot;);    $.ajax({        url: &quot;/borrow/release/car_series&quot;,        data: {&apos;brand_code&apos;: $(this).attr(&apos;data-code&apos;)},        dataType: &quot;json&quot;,        beforeSend: function () {            loading_flag = true;        },        success: function (data) {            loading_flag = false;            $(&quot;#choose-series &gt; .choose-box&quot;).html(&quot;&quot;);            $.each(data, function (k, v) {                $(&quot;#choose-series &gt; .choose-box&quot;).append(&quot;&lt;div class=cont-tit&gt;&quot; + v.factory + &quot;&lt;/div&gt;&quot;);                $.each(v.series, function(k, v) {                    var s = $(&apos;&lt;div class=&quot;choose-cont&quot; data-code=&quot;&apos; + v.series_code + &apos;&quot; data-name=&quot;&apos; + v.en_name + &apos;&quot;&gt;&apos; + v.en_name + &quot;&lt;/div&gt;&quot;);                    $(&quot;#choose-series &gt; .choose-box&quot;).append(s);                })            });        },        error: function (data) {        },        fail: function (data) {        }    })});$(&quot;#choose-series&quot;).on(&quot;click&quot;, &quot;.choose-box &gt; .choose-cont&quot;, function () {    if (loading_flag == true) {        return false    }    $(&quot;#choose-model &gt; .choose-box&quot;).html(&apos;&lt;div class=&quot;cont-default&quot; data-code=&quot;&quot; data-name=&quot;&quot;&gt;è¯·å…ˆé€‰æ‹©è½¦ç³»&lt;/div&gt;&apos;);    $(&quot;#choose-series &gt; .choose-box &gt; .choose-cont&quot;).removeClass(&quot;active&quot;);    $(&apos;#save-car&apos;).prop(&apos;disabled&apos;, true);    $(this).addClass(&quot;active&quot;);    $.ajax({        url: &quot;/borrow/release/car_models&quot;,        data: {&apos;series_code&apos;: $(this).attr(&apos;data-code&apos;)},        dataType: &quot;json&quot;,        beforeSend: function () {            loading_flag = true;        },        success: function (data) {            loading_flag = false;            $(&quot;#choose-model &gt; .choose-box&quot;).html(&quot;&quot;);            $.each(data, function (k, v) {                $(&quot;#choose-model &gt; .choose-box&quot;).append(&quot;&lt;div class=cont-tit&gt;&quot; + v.year + &apos;æ¬¾&apos; + &quot;&lt;/div&gt;&quot;);                $.each(v.models, function(k, v) {                    var m = $(&apos;&lt;div class=&quot;choose-cont&quot; data-code=&quot;&apos; + v.code + &apos;&quot; data-name=&quot;&apos; + v.en_name + &apos;&quot;&gt;&apos; + v.en_name + &quot;&lt;/div&gt;&quot;);                    $(&quot;#choose-model &gt; .choose-box&quot;).append(m);                })            });        },        error: function (data) {        },        fail: function (data) {        }    })});$(&quot;#choose-model&quot;).on(&quot;click&quot;, &quot;.choose-box &gt; .choose-cont&quot;, function () {    $(&quot;#choose-model &gt; .choose-box &gt; .choose-cont&quot;).removeClass(&quot;active&quot;);    $(this).addClass(&quot;active&quot;);    if ($(&quot;#choose-model &gt; .choose-box &gt; .choose-cont.active&quot;).length === 1) {        $(&quot;#save-car&quot;).prop(&quot;disabled&quot;, false)    }});$(&quot;#save-car&quot;).on(&quot;click&quot;, function () {    var car_brand = $(&apos;#choose-brand &gt; .choose-box &gt; .choose-cont.active&apos;).text(),        car_series = $(&quot;#choose-series &gt; .choose-box &gt; .choose-cont.active&quot;).text(),        car_model = $(&quot;#choose-model &gt; .choose-box &gt; .choose-cont.active&quot;).text();    $(&quot;#carModal&quot;).modal(&quot;hide&quot;);    $(&quot;#brand&quot;).val(car_brand).blur();    $(&quot;#brand-model&quot;).val(car_series).blur();    $(&quot;#car-model&quot;).val(car_model).blur();    $(&quot;#select-car&quot;).off(&quot;focus&quot;, &quot;input&quot;);    $(&quot;#select-car&quot;).on(&quot;focus&quot;, &apos;input&apos;, function(){        $(&apos;#carModal&apos;).modal(&apos;show&apos;)    })});</code></pre><p>å¦‚æœæˆ‘æ˜¯åˆšæ¥æ‰‹è¿™ä¸ªé¡¹ç›®çš„ç å†œè¯ï¼Œçœ‹åˆ°è¿™ä¸ªä»£ç ç®€ç›´è¦æ€æ¡Œ(ãƒ=Ğ”=)ãƒâ”»â”â”»ï¼ï¼ï¼ä¼°è®¡å°±ç®—è‡ªå·±å†™çš„è¿‡å‡ ä¸ªæœˆä¹Ÿçœ‹ä¸æ‡‚äº†ã€‚<br>æ˜¯æ—¶å€™ç¥­å‡ºvueäº†ï¼ï¼ï¼</p><h3 id="ç”¨-Vue-jsé‡å†™"><a href="#ç”¨-Vue-jsé‡å†™" class="headerlink" title="ç”¨ Vue.jsé‡å†™"></a>ç”¨ Vue.jsé‡å†™</h3><p>è¿‡äº†ä¸€évueçš„å®˜æ–¹æ–‡æ¡£ï¼Œå‘ç°æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼š</p><ol><li><p>è§£å†³tornado å’Œ vue expression çš„å†²çª</p><p> å› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯tornadoï¼Œå‰ç«¯ä¸ä»…æœ‰tornado renderæ¥çš„æ•°æ®ï¼Œè¿˜æœ‰vueçš„æ•°æ®ï¼Œå¦‚æœéƒ½ç”¨<code>{{ }}</code>ä¼šé€ æˆå†²çªçš„ã€‚google+stackoverflowäº†ä¸€æ³¢ï¼Œå‘ç°å¯ä»¥æ”¹å†™vue expressionçš„å…¨å±€é…ç½®ã€‚</p><pre><code>Vue.config.delimiters = [&apos;${&apos;, &apos;}&apos;]</code></pre><p> å°†vue expression æ”¹å†™æˆ<code>${ }</code>ã€‚</p><p> <a href="http://vuejs.org/api/#delimitersã€‚" target="_blank" rel="noopener">http://vuejs.org/api/#delimitersã€‚</a></p></li><li><p>ç¬¬äºŒä¸ªé—®é¢˜å°±æ˜¯vue å†…éƒ¨å¦‚ä½•ä¼ å€¼</p><p> å®˜æ–¹ä¾‹å­ä¸­ç»™äº†æˆ‘ä»¬ç­”æ¡ˆï¼Œç›´æ¥ <code>this.foo = bar</code>å°±å¯ä»¥æ”¹å˜dataé‡Œçš„æ•°æ®äº†ï¼Œç®€ç›´æ–¹ä¾¿çš„ä¸è¦ä¸è¦çš„</p><p> <a href="http://vuejs.org/examples/commits.html" target="_blank" rel="noopener">http://vuejs.org/examples/commits.html</a></p></li></ol><p>çœ‹çœ‹vue.js çš„ä»£ç ï¼Œ</p><ol><li>æ”¹å†™å…¨å±€é…ç½®ï¼Œç”¨<code>${ }</code>ä»£æ›¿é»˜è®¤çš„<code>{{ }}</code>expression</li><li>è®¾ç½®loading_flagé˜²æ­¢å¤šæ¬¡ajaxè¯·æ±‚</li><li><p>æ–°å»ºä¸€ä¸ªvueçš„å®ä¾‹ï¼Œé‡Œé¢åŒ…å«6æ¡æ•°æ®å’Œ5ä¸ªæ–¹æ³•ï¼Œä»–ä»¬å¿…é¡»åœ¨<code>#select-car</code>é‚£ä¸ªdivé‡Œé¢ï¼Œå¦åˆ™ä¸èƒ½è§£æ</p><ul><li>brand_items, series_items, model_items ç”¨æ¥ä¿å­˜åç«¯ä¼ æ¥çš„jsonæ•°æ®</li><li>chosen_brand, chosen_series, chosen_model ç”¨æ¥ä¿å­˜ç”¨æˆ·å½“å‰é€‰æ‹©çš„æ•°æ®</li><li>show_modal æ–¹æ³•å°±æ˜¯jQueryç‰ˆæœ¬ä¸­çš„select-caräº‹ä»¶ï¼Œè¯·æ±‚car_brandsæ•°æ®ï¼Œä¼ ç»™brand_itemsï¼Œå…¶ä»–çš„æ–¹æ³•ä¹Ÿç±»ä¼¼</li></ul></li></ol><pre><code>Vue.config.delimiters = [&apos;${&apos;, &apos;}&apos;];var loading_flag = false;var vue_show = new Vue({    el: &apos;#select-car&apos;,    data: {        brand_items: &apos;&apos;,        series_items: &apos;&apos;,        model_items: &apos;&apos;,        chosen_brand: &apos;&apos;,        chosen_series: &apos;&apos;,        chosen_model: &apos;&apos;    },    methods: {        show_modal: function () {            $(&apos;#carModal&apos;).modal(&apos;show&apos;);            var self = this;            $.ajax({                url: &quot;/common/car_brands&quot;,                dataType: &quot;json&quot;,                success: function(data){                    self.brand_items = sort_brands(data);                }            })        },        select_brand: function (e) {            var self = this;            if (loading_flag == true) {                return false            }            var $target = $(e.target);            self.chosen_brand = $target.attr(&apos;data-name&apos;);            loading_flag = true;            $.ajax({                url: &quot;/common/car_series&quot;,                data: {&apos;brand_code&apos;: $target.attr(&apos;data-code&apos;)},                dataType: &quot;json&quot;            }).done( function (data) {                self.model_items=[];                self.series_items = sort_series(data);                self.chosen_series = &apos;&apos;;                self.chosen_model = &apos;&apos;;            }).always(function (data) {                loading_flag = false            });        },        select_series: function (e) {            var self = this;            if (loading_flag == true) {                return false            }            var $target = $(e.target);            self.chosen_series = $target.attr(&apos;data-name&apos;);            loading_flag = true;            $.ajax({                url: &quot;/common/car_models&quot;,                data: {&apos;series_code&apos;: $target.attr(&apos;data-code&apos;)},                dataType: &quot;json&quot;            }).done( function (data) {                self.model_items = sort_models(data);                self.chosen_model = &apos;&apos;;            }).always(function (data) {                loading_flag = false            });        },        select_model: function (e) {            var self = this;            self.chosen_model = $(e.target).attr(&apos;data-name&apos;);        },        scroll_brands: function (e) {            var s = $(e.target).html(),                t = $(&quot;#choose-brand .choose-box .cont-tit[data-name=&quot; + s.toUpperCase() + &quot;]&quot;);            t.length &amp;&amp; t.parent().animate({scrollTop: t.parent().scrollTop() + (t.offset().top - t.parent().offset().top)})        }    }});</code></pre><p>ä»vue js ä¸­å¯ä»¥çœ‹å‡ºé€»è¾‘æ¸…æ™°ï¼Œæ•°æ®å’Œæ–¹æ³•æ˜¾ç¤ºç›´è§‚ï¼Œå‡ ä¹æ²¡ä»€ä¹ˆhtmlä»£ç ï¼Œå› ä¸ºéƒ½å†™åœ¨htmlé¡µé¢ä¸­äº†ï¼Œå†æ¥çœ‹çœ‹htmlä¸­çš„vueå¦‚ä½•å†™</p><ol><li>vue æ ¹æ®<code>el: &#39;#select-car&#39;</code>æ¥åˆ¤æ–­è¿™ä¸ªdivæ˜¯ä¸æ˜¯vue</li><li>input æ¡†ç»‘å®šäº†<code>show_modal</code>çš„clickäº‹ä»¶ï¼Œ<code>{{ form.car_model }}</code>æ˜¯tornado ä¼ æ¥çš„åˆ«çš„æ•°æ® å’Œvueæ— å…³ï¼Œä¸è¦åœ¨æ„</li><li><code>å­—æ¯åˆ—è¡¨</code>ç”¨<code>v-for</code>æ–¹æ³•å¾ªç¯äº†<code>brand_items</code>ï¼Œå°†å·¦ä¾§çš„å­—æ¯renderå‡ºæ¥ï¼Œå¹¶ç»‘å®šäº†<code>scroll_brands</code> clickäº‹ä»¶</li><li><code>å“ç‰Œåˆ—è¡¨</code>ç”¨<code>template v-for</code>æ–¹æ³•å¾ªç¯äº†<code>brand_items</code>ï¼Œç”¨<code>v-bind:class</code>å†™ä¸ªä¸‰å…ƒè¡¨è¾¾å¼æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯è¢«é€‰ä¸­ã€‚<code>template v-for</code>ä¸‹è¿˜æœ‰ç¬¬äºŒå±‚å¾ªç¯<code>v-for</code>ï¼Œä»–ç»‘å®šäº†<code>select_brand</code>çš„clickäº‹ä»¶</li><li><code>è½¦ç³»åˆ—è¡¨</code>ã€<code>è½¦å‹åˆ—è¡¨</code>ä¸<code>å“ç‰Œåˆ—è¡¨</code>ç±»ä¼¼</li><li><code>ç¡®å®š</code>button ç”¨<code>:disabled</code>å†™ä¸ªä¸‰å…ƒè¡¨è¾¾å¼æ¥åˆ¤æ–­æ˜¯å¦é€‰äº†modelï¼Œä»¥æ¿€æ´»<code>ç¡®å®š</code>button</li></ol><p>è¿™é‡Œè¯´ä¸‹<code>template v-for</code>å’Œ<code>v-for</code> çš„åŒºåˆ«ï¼š</p><ul><li><code>v-for</code>åªå¾ªç¯è‡ªèº«ï¼Œä¸å¾ªç¯åˆ«çš„å…ƒç´ </li><li><code>template v-for</code>å¾ªç¯åŒ…è£¹ç€çš„æ‰€æœ‰å…ƒç´ </li></ul><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;select-car&quot; class=&quot;select&quot;&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;car_model&quot; id=&quot;car-model&quot; placeholder=&quot;ç‚¹å‡»é€‰æ‹©è½¦å‹&quot;</span><br><span class="line">           autocomplete=&quot;off&quot; readonly value=`&#123;&#123; form.car_model &#125;&#125;` style=&quot;cursor: pointer&quot; @click=&quot;show_modal&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Modal --&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;div class=&quot;open-tit&quot;&gt;è¯·é€‰æ‹©å“ç‰Œ&lt;/div&gt;</span><br><span class="line">    &lt;ul class=&quot;col-xs-1 brand-cata&quot;&gt;</span><br><span class="line">        &lt;!--å­—æ¯åˆ—è¡¨--&gt;</span><br><span class="line">        &lt;li v-for=&quot;item in brand_items&quot; @click=&quot;scroll_brands&quot;&gt;</span><br><span class="line">            $&#123; item.cata &#125;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;div class=&quot;col-xs-10 choose-box&quot;&gt;</span><br><span class="line">        &lt;!--å“ç‰Œåˆ—è¡¨--&gt;</span><br><span class="line">        &lt;template v-for=&quot;item in brand_items&quot;&gt;</span><br><span class="line">            &lt;div class=cont-tit data-name=&quot;$&#123; item.cata &#125;&quot;&gt;</span><br><span class="line">                $&#123; item.cata &#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;choose-cont&quot; v-bind:class=&quot;[chosen_brand==b.en_name ? &apos;active&apos; : &apos;&apos;]&quot; data-code=&quot;$&#123; b.brand_code &#125;&quot; data-name=&quot;$&#123; b.en_name &#125;&quot;</span><br><span class="line">                 v-for=&quot;b in item.brands&quot; @click=&quot;select_brand&quot;&gt;</span><br><span class="line">                $&#123; b.en_name &#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;div class=&quot;open-tit&quot;&gt;è¯·é€‰æ‹©è½¦ç³»&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;choose-box&quot;&gt;</span><br><span class="line">        &lt;!--è½¦ç³»åˆ—è¡¨--&gt;</span><br><span class="line">        &lt;div class=&quot;cont-default&quot; data-code=&quot;&quot; data-name=&quot;&quot; v-bind:class=&quot;[chosen_brand ? &apos;none&apos; : &apos;&apos;]&quot;&gt;è¯·å…ˆé€‰æ‹©å“ç‰Œ&lt;/div&gt;</span><br><span class="line">        &lt;template v-for=&quot;item in series_items&quot;&gt;</span><br><span class="line">            &lt;div class=cont-tit&gt;$&#123; item.factory &#125;&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;choose-cont&quot; v-bind:class=&quot;[chosen_series==s.en_name ? &apos;active&apos; : &apos;&apos;]&quot; data-code=&quot;$&#123; s.series_code &#125;&quot; data-name=&quot;$&#123; s.en_name &#125;&quot;</span><br><span class="line">                 v-for=&quot;s in item.series&quot; @click=&quot;select_series&quot;&gt;</span><br><span class="line">                $&#123; s.en_name &#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;div class=&quot;open-tit&quot;&gt;è¯·é€‰æ‹©è½¦å‹&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;choose-box&quot;&gt;</span><br><span class="line">        &lt;!--è½¦å‹åˆ—è¡¨--&gt;</span><br><span class="line">        &lt;div class=&quot;cont-default&quot; data-code=&quot;&quot; data-name=&quot;&quot; v-bind:class=&quot;[chosen_series ? &apos;none&apos; : &apos;&apos;]&quot;&gt;è¯·å…ˆé€‰æ‹©è½¦ç³»&lt;/div&gt;</span><br><span class="line">        &lt;template v-for=&quot;item in model_items&quot;&gt;</span><br><span class="line">            &lt;div class=cont-tit&gt;$&#123; item.year + &apos;æ¬¾&apos; &#125;&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;choose-cont&quot; v-bind:class=&quot;[chosen_model==m.en_name ? &apos;active&apos; : &apos;&apos;]&quot; data-code=&quot;$&#123; m.code &#125;&quot; data-name=&quot;$&#123; m.en_name &#125;&quot;</span><br><span class="line">                    v-for=&quot;m in item.models&quot; @click=&quot;select_model&quot;&gt;</span><br><span class="line">                $&#123; m.en_name &#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot; id=&quot;save-car&quot; :disabled=&quot;chosen_model ? false : true&quot;&gt;ç¡®å®š&lt;/button&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>Vue.js ä»…ä»…æ˜¯MVVMä¸­çš„Vå±‚ï¼Œä»–è®¾è®¡ç®€å•ï¼Œå­¦ä¹ å‘¨æœŸçŸ­ï¼Œå¯ä»¥å¿«é€ŸæŠ•å…¥åˆ°å•é¡µé¢ä¸­</li><li>æŒ‡ä»¤å’Œç»„ä»¶åˆ†å¾ˆæ¸…æ™°ï¼Œæœ‰è‡ªå·±çš„è§†å›¾å’Œæ•°æ®é€»è¾‘</li><li>æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œæ²¡æœ‰è„æ£€æŸ¥ï¼Œå¹¶ä¸”éå¸¸éå¸¸å®¹æ˜“ä¼˜åŒ–</li></ul><h3 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h3><ul><li>Vue.jså®˜æ–¹ <a href="http://vuejs.org/" target="_blank" rel="noopener">http://vuejs.org/</a></li><li>CTOå¤§å¤§çš„å¼ºåŠ›åŠ©æ”»ï¼Œå’Œè¿™ä¹ˆå¤šä¼˜ç§€çš„å°ä¼™ä¼´ä¸€èµ·å…±äº‹ç®€ç›´å¤ªæ£’äº†~</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;æœ€è¿‘å·¥ä½œä¸­çš„ä¸€ä¸ªå°é¡¹ç›®éœ€è¦åšä¸€ä¸ªè½¦è¾†ä¿¡æ¯é€‰æ‹©æ¡†çš„ä¸‰çº§è”åŠ¨ï¼Œæœ‰ç‚¹ç±»ä¼¼çœå¸‚å¿çš„ä¸‰çº§è”åŠ¨ï¼Œä¸‹ä¸€çº§ä¾èµ–ä¸Šä¸€çº§çš„æ•°æ®ã€‚æœ€åçš„æ•ˆæœæ˜¯è¿™æ ·&lt;/p&gt;
&lt;p&gt;å› ä¸ºè¿™ä¸€å—çš„ä»£ç ä¸šåŠ¡é€»è¾‘ç›¸å½“å¤æ‚ï¼Œé‡‡ç”¨jQueryå†™çš„è¯ä»£ç é‡æœ‰ç‚¹å¤§ï¼Œè€Œä¸”ä¼šæŠŠhtmlçš„ä»£ç å†™åœ¨jsæ–‡ä»¶é‡Œï¼Œä¸æ˜“äºé˜…è¯»å’ŒåæœŸç»´æŠ¤ï¼Œæ‰€ä»¥CTOå¤§å¤§å»ºè®®ç”¨Vue.jsæ¥é‡å†™ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ€è€ƒè¿‡ç¨‹&quot;&gt;&lt;a href=&quot;#æ€è€ƒè¿‡ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;æ€è€ƒè¿‡ç¨‹&quot;&gt;&lt;/a&gt;æ€è€ƒè¿‡ç¨‹&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;é¦–å…ˆæ˜¯çˆ¬å–è½¦è¾†ä¿¡æ¯çš„æ•°æ®ï¼Œæ‰¾äº†ä¸€å®¶ä¿¡æ¯æ¯”è¾ƒå…¨çš„ç›¸å…³å¹³å°ï¼Œå¼€å§‹äº†çˆ¬è™«ä¹‹æ—…ï¼Œå¾…æœ‰ç©ºå†™ä¸‹çˆ¬è™«çš„æ€è€ƒï¼Œè¿™é‡Œç•¥è¿‡&lt;/li&gt;
&lt;li&gt;æ‹¿åˆ°å¤§æ¦‚2ä¸‡å¤šæ¡æ•°æ®åï¼Œå†™ä¸€ä¸ªpipelineæ•´ç†å¥½æ•°æ®å¹¶å†™å…¥è‡ªå·±çš„æ•°æ®åº“ï¼Œæ•°æ®åˆ†ä¸º3ç±»ï¼šå“ç‰Œã€ç³»åˆ—ã€è½¦å‹ï¼Œå­˜å…¥3å¼ è¡¨é‡Œï¼Œåˆ†åˆ«å‘½åä¸ºcar_brands, car_series, car_modelsï¼Œå“¦äº†ï½æœ‰äº†æ•°æ®å°±å¯ä»¥åŠ¨æ‰‹äº†&lt;/li&gt;
&lt;li&gt;åç«¯å†™å¥½ä¸‰ä¸ªhandleré€»è¾‘ï¼Œå°†æ•°æ®ä»¥jsonçš„æ–¹å¼ä¼ ç»™å‰ç«¯&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Frontend" scheme="https://morningchen.com/categories/Frontend/"/>
    
      <category term="Vue" scheme="https://morningchen.com/categories/Frontend/Vue/"/>
    
    
      <category term="JavaScript" scheme="https://morningchen.com/tags/JavaScript/"/>
    
      <category term="Tornado" scheme="https://morningchen.com/tags/Tornado/"/>
    
      <category term="Vue" scheme="https://morningchen.com/tags/Vue/"/>
    
      <category term="jQuery" scheme="https://morningchen.com/tags/jQuery/"/>
    
  </entry>
  
  <entry>
    <title>å†™cssé‡åˆ°çš„é—®é¢˜</title>
    <link href="https://morningchen.com/2015/11/03/css-notes/"/>
    <id>https://morningchen.com/2015/11/03/css-notes/</id>
    <published>2015-11-03T11:12:41.000Z</published>
    <updated>2018-09-27T03:49:49.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ ‡ç­¾çš„ä¼ªç±»æ ·å¼"><a href="#æ ‡ç­¾çš„ä¼ªç±»æ ·å¼" class="headerlink" title="æ ‡ç­¾çš„ä¼ªç±»æ ·å¼"></a>æ ‡ç­¾çš„ä¼ªç±»æ ·å¼</h3><ul><li>a:linkï¼š æœªè®¿é—®é“¾æ¥</li><li>a:visitedï¼š å·²è®¿é—®é“¾æ¥</li><li>a:focusï¼š æ­£åœ¨è®¿é—®çš„é“¾æ¥</li><li>a:activeï¼š æ¿€æ´»æ—¶ï¼ˆé“¾æ¥è·å¾—ç„¦ç‚¹æ—¶ï¼‰é“¾æ¥çš„é¢œè‰²</li><li>a:hoverï¼š é¼ æ ‡ç§»åˆ°é“¾æ¥ä¸Šæ—¶</li></ul><h3 id="æ–‡å­—æº¢å‡ºçœç•¥"><a href="#æ–‡å­—æº¢å‡ºçœç•¥" class="headerlink" title="æ–‡å­—æº¢å‡ºçœç•¥"></a>æ–‡å­—æº¢å‡ºçœç•¥</h3><pre><code>.flatpages-articles-col-left &gt; ul &gt; li &gt; a {    color: #3492e9;    line-height: 50px;    font-size: 16px;    width: 300px;    height: 40px;    overflow: hidden;    text-overflow: ellipsis;    white-space: nowrap;    display: inline-block;}</code></pre><a id="more"></a><h3 id="æ–‡ç« å†…æ»šåŠ¨"><a href="#æ–‡ç« å†…æ»šåŠ¨" class="headerlink" title="æ–‡ç« å†…æ»šåŠ¨"></a>æ–‡ç« å†…æ»šåŠ¨</h3><pre><code>.flatpages-articles-col-right {    border-left: 1px solid #d2d2d2;    height: 500px;    overflow: scroll;}</code></pre><h3 id="é˜´å½±"><a href="#é˜´å½±" class="headerlink" title="é˜´å½±"></a>é˜´å½±</h3><pre><code>.flatpages-articles-title {    width: 1004px;    height: 60px;    background: #0197f3;    position: relative;    margin-left: -28px;    margin-top: 26px;    -moz-box-shadow: 0 2px 5px rgba(0, 0, 0, .25);    -webkit-box-shadow: 0 2px 5px rgba(0, 0, 0, .25);    box-shadow: 0 2px 5px rgba(0, 0, 0, .25);}</code></pre><h3 id="ä¸‰è§’"><a href="#ä¸‰è§’" class="headerlink" title="ä¸‰è§’"></a>ä¸‰è§’</h3><pre><code>.flatpages-articles-title:before {    width: 0;    height: 0;    border-top: 12px solid #3492e9;    border-left: 12px solid transparent;    content: &apos;&apos;;    top: 60px;    position: absolute;}</code></pre><h3 id="é€æ˜è’™æ¿"><a href="#é€æ˜è’™æ¿" class="headerlink" title="é€æ˜è’™æ¿"></a>é€æ˜è’™æ¿</h3><pre><code>.flatpages-join-mask {    height: 710px;    width: 980px;    background-color: rgba(255, 255, 255, 0.6);    border-radius: 20px;    padding-top: 42px;}</code></pre><p>é€‚é…IE8ï¼ŒIE8ä¸­å†…å®¹ä¸é€æ˜ï¼Œè’™æ¿é€æ˜ï¼Œè®°å¾—åœ¨å†…å®¹ä¸­åŠ ä¸Šposition: relative</p><pre><code>.flatpages-about-mask {    background: #fff;    background-color: rgba(255, 255, 255, 0.6);    filter: progid:DXImageTransform.Microsoft.Alpha(opacity=60);    -ms-filter: &quot;progid:DXImageTransform.Microsoft.Alpha(opacity=60)&quot;;    color: #fff;    border-radius: 20px;    -moz-border-radius: 20px;    -webkit-border-radius: 20px;    padding: 40px 60px;    height: 600px;    margin-top: 20px;}</code></pre><h3 id="ä¼ªå…ƒç´ ä¸‹åˆ’çº¿"><a href="#ä¼ªå…ƒç´ ä¸‹åˆ’çº¿" class="headerlink" title="ä¼ªå…ƒç´ ä¸‹åˆ’çº¿"></a>ä¼ªå…ƒç´ ä¸‹åˆ’çº¿</h3><pre><code>.flatpages-join-info &gt; span:before {    content: &quot; &quot;;    position: absolute;    width: 360px;    height: 1px;    background-color: #d2d2d2;    bottom: 0;    left: 10px;}.flatpages-join-info &gt; span:after {    content: &quot; &quot;;    position: absolute;    bottom: 0;    left: 10px;    width: 100px;    height: 1px;    background-color: #00a1ea;}</code></pre><h3 id="å„ç§å›¾å½¢"><a href="#å„ç§å›¾å½¢" class="headerlink" title="å„ç§å›¾å½¢"></a>å„ç§å›¾å½¢</h3><ul><li><a href="https://css-tricks.com/examples/ShapesOfCSS/" target="_blank" rel="noopener">The Shapes of CSS</a></li></ul><h3 id="å›¾ç‰‡ç°åº¦åˆ‡æ¢"><a href="#å›¾ç‰‡ç°åº¦åˆ‡æ¢" class="headerlink" title="å›¾ç‰‡ç°åº¦åˆ‡æ¢"></a>å›¾ç‰‡ç°åº¦åˆ‡æ¢</h3><p>ä¾‹å­ <a href="http://insights.thoughtworkers.org/frontend-backend/" target="_blank" rel="noopener">http://insights.thoughtworkers.org/frontend-backend/</a></p><pre><code>img.gray {    -webkit-filter: grayscale(100%);    -o-filter: grayscale(100%);    filter: gray;    filter: grayscale(100%);    -webkit-transition: all 0.6s;    -moz-transition: all 0.6s;    -ms-transition: all 0.6s;    -o-transition: all 0.6s;    transition: all 0.6s;}</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;æ ‡ç­¾çš„ä¼ªç±»æ ·å¼&quot;&gt;&lt;a href=&quot;#æ ‡ç­¾çš„ä¼ªç±»æ ·å¼&quot; class=&quot;headerlink&quot; title=&quot;æ ‡ç­¾çš„ä¼ªç±»æ ·å¼&quot;&gt;&lt;/a&gt;æ ‡ç­¾çš„ä¼ªç±»æ ·å¼&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;a:linkï¼š æœªè®¿é—®é“¾æ¥&lt;/li&gt;
&lt;li&gt;a:visitedï¼š å·²è®¿é—®é“¾æ¥&lt;/li&gt;
&lt;li&gt;a:focusï¼š æ­£åœ¨è®¿é—®çš„é“¾æ¥&lt;/li&gt;
&lt;li&gt;a:activeï¼š æ¿€æ´»æ—¶ï¼ˆé“¾æ¥è·å¾—ç„¦ç‚¹æ—¶ï¼‰é“¾æ¥çš„é¢œè‰²&lt;/li&gt;
&lt;li&gt;a:hoverï¼š é¼ æ ‡ç§»åˆ°é“¾æ¥ä¸Šæ—¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;æ–‡å­—æº¢å‡ºçœç•¥&quot;&gt;&lt;a href=&quot;#æ–‡å­—æº¢å‡ºçœç•¥&quot; class=&quot;headerlink&quot; title=&quot;æ–‡å­—æº¢å‡ºçœç•¥&quot;&gt;&lt;/a&gt;æ–‡å­—æº¢å‡ºçœç•¥&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;.flatpages-articles-col-left &amp;gt; ul &amp;gt; li &amp;gt; a {
    color: #3492e9;
    line-height: 50px;
    font-size: 16px;
    width: 300px;
    height: 40px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline-block;
}
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="Frontend" scheme="https://morningchen.com/categories/Frontend/"/>
    
      <category term="CSS" scheme="https://morningchen.com/categories/Frontend/CSS/"/>
    
    
      <category term="CSS" scheme="https://morningchen.com/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>Two Scoops of Django 1.8 å­¦ä¹ ç¬”è®°ä¸ƒ</title>
    <link href="https://morningchen.com/2015/09/26/Two-Scoops-of-Django-1-8-notes-7/"/>
    <id>https://morningchen.com/2015/09/26/Two-Scoops-of-Django-1-8-notes-7/</id>
    <published>2015-09-26T08:45:28.000Z</published>
    <updated>2018-09-27T03:56:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="12-è¡¨å•é€šç”¨æ¨¡å¼"><a href="#12-è¡¨å•é€šç”¨æ¨¡å¼" class="headerlink" title="12. è¡¨å•é€šç”¨æ¨¡å¼"></a>12. è¡¨å•é€šç”¨æ¨¡å¼</h2><p>Djangoçš„è¡¨å•å¼ºå¤§ã€çµæ´»ã€æ‰©å±•æ€§å¼ºã€å¥å…¨ã€‚å› æ­¤ï¼ŒDjango admin å’Œ CBVså¹¿æ³›çš„ä½¿ç”¨äº†è¡¨å•ã€‚<br>äº‹å®ä¸Šï¼Œæ‰€æœ‰é‡å¤§çš„Django API æ¡†æ¶ç”¨ModelForms æˆ–è€…ç±»ä¼¼çš„å®ç°æ¥ä½œä¸ºå®ƒä»¬æ ¡éªŒçš„ä¸€éƒ¨åˆ†ã€‚</p><p>ç»“åˆè¡¨å•ã€æ¨¡å‹ã€è§†å›¾è®©æˆ‘ä»¬ç”¨è¾ƒå°‘çš„åŠªåŠ›åšäº†è¾ƒå¤šçš„äº‹ã€‚å­¦ä¹ æ›²çº¿æ˜¯å€¼å¾—çš„ï¼š<br>ä¸€æ—¦ä½ å­¦ä¼šäº†ä½¿ç”¨è¿™äº›ç»„ä»¶æµç•…çš„è¿›è¡Œå·¥ä½œï¼Œä½ ä¼šå‘ç°ï¼ŒDjangoæä¾›äº†ä»¥æƒŠäººçš„é€Ÿåº¦åˆ›é€ æ•°é‡æƒŠäººçš„æœ‰ç”¨ä¸”ç¨³å®šåŠŸèƒ½çš„èƒ½åŠ›</p><p>è¿™ä¸€ç« æ˜ç¡®è®²è§£äº†Djangoæœ€å¥½çš„éƒ¨åˆ†ä¹‹ä¸€ï¼šforms, models, CBVsä¹‹é—´çš„ååŒå·¥ä½œã€‚<br>å®ƒè¦†ç›–äº†äº”ä¸ªé€šç”¨è¡¨å•æ¨¡å¼ã€‚æ¯ä¸ªDjangoå¼€å‘è€…éƒ½åº”è¯¥æŒæ¡<br><a id="more"></a></p><h3 id="12-1-æ¨¡å¼ä¸€ï¼šç®€æ˜“çš„ModelFormä½¿ç”¨é»˜è®¤æ ¡éªŒ"><a href="#12-1-æ¨¡å¼ä¸€ï¼šç®€æ˜“çš„ModelFormä½¿ç”¨é»˜è®¤æ ¡éªŒ" class="headerlink" title="12.1 æ¨¡å¼ä¸€ï¼šç®€æ˜“çš„ModelFormä½¿ç”¨é»˜è®¤æ ¡éªŒ"></a>12.1 æ¨¡å¼ä¸€ï¼šç®€æ˜“çš„ModelFormä½¿ç”¨é»˜è®¤æ ¡éªŒ</h3><p>å¦‚æœä½ è¿˜è®°å¾—ï¼Œç”¨CBVså°±èƒ½å®ç°è¡¨å•çš„å¢åŠ å’Œä¿®æ”¹ï¼Œè€Œä¸”åªéœ€è¦å‡ è¡Œä»£ç ï¼š</p><pre><code># flavors/views.pyfrom django.views.generic import CreateView, UpdateViewfrom braces.views import LoginRequiredMixinfrom .models import Flavorclass FlavorCreateView(LoginRequiredMixin, CreateView):    model = Flavor    fields = (&apos;title&apos;, &apos;slug&apos;, &apos;scoops_remaining&apos;)class FlavorUpdateView(LoginRequiredMixin, UpdateView):    model = Flavor    fields = (&apos;title&apos;, &apos;slug&apos;, &apos;scoops_remaining&apos;)</code></pre><p>æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬åœ¨è¿™å„¿æ˜¯å¦‚ä½•ä½¿ç”¨é»˜è®¤æ ¡éªŒçš„ï¼š</p><ul><li>å°†Flavorä½œä¸ºæ¨¡å‹åˆ†é…åˆ°FlavorCreateViewå’ŒFlavorUpdateView</li><li>è¿™ä¸¤ä¸ªè§†å›¾æ ¹æ®Falvoræ¨¡å‹è‡ªåŠ¨ç”Ÿæˆäº†ä¸€ä¸ªModelForm</li><li>è¿™äº›ModelFormä¾èµ–Falvoræ¨¡å‹ä¸­é»˜è®¤çš„å­—æ®µæ ¡éªŒè§„åˆ™</li></ul><p>Djangoæä¾›äº†å¾ˆå¤šä¸é”™çš„æ•°æ®æ ¡éªŒï¼Œä½†åœ¨å®è·µä¸­è¿˜è¿œè¿œä¸å¤Ÿã€‚<br>æˆ‘ä»¬è®¤è¯†åˆ°äº†è¿™ä¸€ç‚¹ï¼Œå› æ­¤å°†å®ƒä½œä¸ºç¬¬ä¸€æ­¥ï¼Œä¸‹ä¸€æ¨¡å¼ä¸­å°†ä¼šæ¼”ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å­—æ®µæ ¡éªŒå™¨</p><h3 id="12-2-æ¨¡å¼äºŒï¼šModelFormä¸­è‡ªå®šä¹‰è¡¨å•å­—æ®µæ ¡éªŒ"><a href="#12-2-æ¨¡å¼äºŒï¼šModelFormä¸­è‡ªå®šä¹‰è¡¨å•å­—æ®µæ ¡éªŒ" class="headerlink" title="12.2 æ¨¡å¼äºŒï¼šModelFormä¸­è‡ªå®šä¹‰è¡¨å•å­—æ®µæ ¡éªŒ"></a>12.2 æ¨¡å¼äºŒï¼šModelFormä¸­è‡ªå®šä¹‰è¡¨å•å­—æ®µæ ¡éªŒ</h3><p>å¦‚æœæˆ‘ä»¬æƒ³è¦ç¡®å®šdessertåº”ç”¨ä¸­çš„titleå­—æ®µæ˜¯å¦æ˜¯ä»¥<code>Tasty</code>å¼€å¤´è¯¥æ€ä¹ˆåŠã€‚å¯ä»¥ç”¨ç®€å•çš„è‡ªå®šä¹‰å­—æ®µæ ¡éªŒå™¨è§£å†³ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªä¾‹å­ï¼šæˆ‘ä»¬çš„é¡¹ç›®ä¸­æœ‰ä¸¤ä¸ªä¸åŒçš„dessertç›¸å…³çš„æ¨¡å‹ï¼šä¸€ä¸ªæè¿°å†°æ·‡æ·‹å£å‘³çš„Flavoræ¨¡å‹å’Œä¸€ä¸ªæè¿°ä¸åŒç§ç±»å¥¶æ˜”çš„Milkshakeæ¨¡å‹ã€‚å‡è®¾å®ƒä»¬éƒ½æœ‰titleå­—æ®µã€‚</p><p>ä¸ºäº†æ ¡éªŒæ‰€æœ‰å¯ç¼–è¾‘æ¨¡å‹çš„titleå­—æ®µï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªvalidators.pyæ¨¡å—</p><pre><code># core/validators.pyfrom django.core.exceptions import ValidationErrordef validate_tasty(value):    &quot;&quot;&quot;Raise a ValidationError if the value doesn&apos;t start with the        word &apos;Tasty&apos;.    &quot;&quot;&quot;    if not value.startswith(u&quot;Tasty&quot;):        msg = u&quot;Must start with Tasty&quot;        raise ValidationError(msg)</code></pre><p>è¿™æ˜¯ä¸€ä¸ªå‡½æ•°æ ¡éªŒå™¨ï¼Œå¦‚æœä¸èƒ½é€šè¿‡æµ‹è¯•åˆ™æŠ›å‡ºé”™è¯¯ã€‚æˆ‘ä»¬çš„validate_tasty()å‡½æ•°æ ¡éªŒå™¨çœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²æ£€æŸ¥ï¼Œè€Œåœ¨å®è·µä¸­ï¼Œè¡¨å•å­—æ®µæ ¡éªŒå™¨ç›¸å½“å¤æ‚ã€‚</p><p>ä¸ºäº†åœ¨ä¸¤ä¸ªä¸åŒçš„dessertæ¨¡å‹ä¸­éƒ½èƒ½ä½¿ç”¨åˆ°validate_tasty()ï¼Œæˆ‘ä»¬ä¼šæŠŠè¿™ä¸ªæ ¡éªŒå™¨æ”¾åœ¨ä¸€ä¸ªå«åšTastyTitleAbstractModelçš„æŠ½è±¡æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨æ•´ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨äº†ã€‚</p><p>å‡è®¾æˆ‘ä»¬çš„Flavoræ¨¡å‹å’ŒMilkshakeæ¨¡å‹åœ¨å„è‡ªç‹¬ç«‹çš„åº”ç”¨ä¸­ï¼ŒæŠŠæ ¡éªŒå™¨æ”¾åœ¨ä»»ä¸€ä¸ªåº”ç”¨ä¸­éƒ½ä¸åˆç†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æŠŠTastyTitleAbstractModelæ”¾åœ¨<code>core/models.py</code>æ ¸å¿ƒæ¨¡å—ä¸­ã€‚</p><pre><code># core/models.pyfrom django.db import modelsfrom .validators import validate_tastyclass TastyTitleAbstractModel(models.Model):    title = models.CharField(max_length=255, validators=[validate_tasty])    class Meta:        abstract = True</code></pre><p>å¦‚æˆ‘ä»¬æ‰€æ„¿ï¼Œä»£ç æœ€åä¸¤è¡Œè®©TastyTitleAbstractModelæˆä¸ºäº†æŠ½è±¡æ¨¡å‹ã€‚</p><p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ flavor/models.py çš„åŸå§‹ä»£ç ï¼ŒæŠŠTastyTitleAbstractModelä½œä¸ºçˆ¶ç±»ï¼š</p><pre><code># flavors/models.pyfrom django.core.urlresolvers import reversefrom django.db import modelsfrom core.models import TastyTitleAbstractModelclass Flavor(TastyTitleAbstractModel):    slug = models.SlugField()    scoops_remaining = models.IntegerField(default=0)    def get_absolute_url(self):        return reverse(&quot;flavors:detail&quot;, kwargs={&quot;slug&quot;: self.slug})</code></pre><p>å®ƒå¯ä»¥ç”¨åˆ°Falvoræ¨¡å‹ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨åˆ°ä»»ä½•ä¸€ä¸ªä¸tastyç›¸å…³çš„æ¨¡å‹ä¸­ï¼Œ<br>æ¯”å¦‚ä¸€ä¸ªæè¿°åå¤«é¥¼çš„WaffleConeæ¨¡å‹æˆ–è€…ä¸€ä¸ªæè¿°è›‹ç³•çš„Cakeæ¨¡å‹ã€‚<br>å¦‚æœä»–ä»¬çš„titleå­—æ®µä¸æ˜¯ä»¥<code>Tasty</code>å¼€å¤´çš„ï¼Œéƒ½ä¼šæŠ›å‡ºä¸€ä¸ªæ ¡éªŒé”™è¯¯ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ¢è®¨ä¸€ä¸‹å¯èƒ½å­˜åœ¨ä½ è„‘æµ·ä¸­çš„ä¸¤ä¸ªç–‘é—®ï¼š</p><ul><li>å¦‚æœæˆ‘ä»¬åªæƒ³åœ¨è¡¨å•ä¸­ä½¿ç”¨validate_tasty()æ€ä¹ˆåŠï¼Ÿ</li><li>é™¤äº†titleå­—æ®µï¼Œæˆ‘ä»¬è¿˜æƒ³åœ¨åˆ«çš„å­—æ®µä¸­ä½¿ç”¨æ€ä¹ˆåŠï¼Ÿ</li></ul><p>é‚£å°±éœ€è¦åˆ©ç”¨è¿™ä¸ªæ ¡éªŒå™¨æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„FalvorFormï¼š</p><pre><code># flavors/forms.pyfrom django import formsfrom core.validators import validate_tastyfrom .models import Flavorclass FlavorForm(forms.ModelForm):    def __init__(self, *args, **kwargs):        super(FlavorForm, self).__init__(*args, **kwargs)        self.fields[&quot;title&quot;].validators.append(validate_tasty)        self.fields[&quot;slug&quot;].validators.append(validate_tasty)    class Meta:        model = Flavor</code></pre><p>è¿™ä¸ªæ¨¡å¼æœ€èµçš„åœ°æ–¹æ˜¯æˆ‘ä»¬æ²¡æœ‰æ”¹å˜æ ¡éªŒå™¨çš„åŸå§‹ä»£ç ï¼Œä»…ä»…åªæ˜¯å°†å®ƒå¯¼å…¥ï¼Œå¹¶ä¸”åœ¨æ–°çš„ä½ç½®ä½¿ç”¨äº†å®ƒ<br>ç»™è¿™ä¸ªè§†å›¾é™„ä¸Šè‡ªå®šä¹‰è¡¨å•æ˜¯æˆ‘ä»¬çš„ä¸‹ä¸€æ­¥ï¼ŒGCBVsä¸­çš„editè§†å›¾ä¼šåŸºäºè§†å›¾çš„æ¨¡å‹å±æ€§è‡ªåŠ¨ç”ŸæˆModelFormï¼Œæˆ‘ä»¬å°†é€šè¿‡å®šåˆ¶çš„FlavorFormæ¥è¦†ç›–é»˜è®¤çš„ã€‚</p><pre><code># flavors/views.pyfrom django.contrib import messagesfrom django.views.generic import CreateView, UpdateView, DetailViewfrom braces.views import LoginRequiredMixinfrom .models import Flavorfrom .forms import FlavorFormclass FlavorActionMixin(object):    model = Flavor    fields = (&apos;title&apos;, &apos;slug&apos;, &apos;scoops_remaining&apos;)    @property    def success_msg(self):        return NotImplemented    def form_valid(self, form):        messages.info(self.request, self.success_msg)        return super(FlavorActionMixin, self).form_valid(form)class FlavorCreateView(LoginRequiredMixin, FlavorActionMixin,                            CreateView):    success_msg = &quot;created&quot;    # Explicitly attach the FlavorForm class    form_class = FlavorFormclass FlavorUpdateView(LoginRequiredMixin, FlavorActionMixin,                            UpdateView):    success_msg = &quot;updated&quot;    # Explicitly attach the FlavorForm class    form_class = FlavorFormclass FlavorDetailView(DetailView):    model = Flavor</code></pre><p>ç°åœ¨FlavorCreateViewå’ŒFlavorUpdateViewè¿™ä¸¤ä¸ªè§†å›¾ä½¿ç”¨æ–°çš„FlavorFormæ¥æ ¡éªŒä¼ å…¥æ•°æ®ã€‚</p><h3 id="12-3-æ¨¡å¼ä¸‰ï¼šè¦†å†™æ ¡éªŒçš„cleané˜¶æ®µ"><a href="#12-3-æ¨¡å¼ä¸‰ï¼šè¦†å†™æ ¡éªŒçš„cleané˜¶æ®µ" class="headerlink" title="12.3 æ¨¡å¼ä¸‰ï¼šè¦†å†™æ ¡éªŒçš„cleané˜¶æ®µ"></a>12.3 æ¨¡å¼ä¸‰ï¼šè¦†å†™æ ¡éªŒçš„cleané˜¶æ®µ</h3><p>æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹æœ‰è¶£çš„æ ¡éªŒä½¿ç”¨æƒ…å†µï¼š</p><ul><li>å¤šå­—æ®µæ ¡éªŒ</li><li>æ ¡éªŒæ¶‰åŠå·²éªŒè¯çš„æ•°æ®åº“ä¸­çš„ç°æœ‰æ•°æ®</li></ul><p>è¿™ä¸¤ç§åœºæ™¯éƒ½éœ€è¦æ ¹æ®è‡ªå®šä¹‰çš„æ ¡éªŒé€»è¾‘è¦†å†™clean()å’Œclean_field_name()æ–¹æ³•</p><p>åœ¨é»˜è®¤çš„æ ¡éªŒå™¨å’Œè‡ªå®šä¹‰çš„å­—æ®µæ ¡éªŒå™¨è¿è¡Œä¹‹åï¼ŒDjangoæä¾›äº†ç¬¬äºŒé˜¶æ®µçš„æ ¡éªŒï¼Œé‚£å°±æ˜¯clean()å’Œclean_field_name()æ–¹æ³•ã€‚ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆDjangoæä¾›äº†æ›´å¤šçš„é’©å­è¿›è¡Œæ ¡éªŒï¼Œä¸‹æ˜¯æˆ‘ä»¬æœ€å–œæ¬¢çš„åŸå› ï¼š</p><ol><li>ç”±äºclean()ä¸æ˜¯é’ˆå¯¹ä»»ä½•ä¸€ä¸ªç‰¹å®šçš„å­—æ®µï¼Œclean()æ–¹æ³•æ˜¯ç”¨æ¥éªŒè¯ä¸¤ä¸ªæˆ–æ›´å¤šçš„å­—æ®µäº’ç›¸å†²çªçš„åœºæ‰€ï¼Œ</li><li>clean é˜¶æ®µæ˜¯ä¸€ä¸ªé’ˆå¯¹æŒä¹…ç±»æ•°æ®æ ¡éªŒçš„æ›´å¥½çš„åœºæ‰€ï¼Œç”±äºæ•°æ®å·²ç»æœ‰äº†ä¸€äº›éªŒè¯ï¼Œä½ å°±ä¸ä¼šå°†æ•°æ®åº“çš„å¾ªç¯æµªè´¹åœ¨ä¸å¿…è¦çš„æŸ¥è¯¢ä¸­ã€‚</li></ol><p>æˆ‘ä»¬é€šè¿‡å¦ä¸€ä¸ªä¾‹å­æ¥æ¢è®¨ä¸€ä¸‹ï¼Œä¹Ÿè®¸ä½ æƒ³å®ç°ä¸€ä¸ªå†°æ·‡æ·‹çš„è®¢è´­è¡¨å•ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šæƒ³è¦çš„å£å‘³ï¼Œé…æ–™ã€‚ç„¶åæ¥æˆ‘ä»¬çš„åº—é‡Œå–èµ°ã€‚ç”±äºæˆ‘ä»¬éœ€è¦ç»™é¡¾å®¢å±•ç¤ºåº“å­˜ä¸å¤Ÿçš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°clean_slug()æ–¹æ³•ï¼š</p><pre><code># flavors/forms.pyfrom django import formsfrom flavors.models import Flavorclass IceCreamOrderForm(forms.Form):    &quot;&quot;&quot;Normally done with forms.ModelForm. But we use forms.Form here        to demonstrate that these sorts of techniques work on every        type of form.    &quot;&quot;&quot;    slug = forms.ChoiceField(&quot;Flavor&quot;)    toppings = forms.CharField()    def __init__(self, *args, **kwargs):        super(IceCreamOrderForm, self).__init__(*args,                    **kwargs)        # We dynamically set the choices here rather than        # in the flavor field definition. Setting them in        # the field definition means status updates won&apos;t        # be reflected in the form without server restarts.        self.fields[&quot;slug&quot;].choices = [            (x.slug, x.title) for x in Flavor.objects.all()        ]        # NOTE: We could filter by whether or not a flavor        #       has any scoops, but this is an example of        #       how to use clean_slug, not filter().    def clean_slug(self):        slug = self.cleaned_data[&quot;slug&quot;]        if Flavor.objects.get(slug=slug).scoops_remaining &lt;= 0:            msg = u&quot;Sorry, we are out of that flavor.&quot;            raise forms.ValidationError(msg)        return slug</code></pre><p>å¯¹äºç”±HTMLé©±åŠ¨çš„è§†å›¾ï¼Œå¦‚æœåº“å­˜ä¸å¤Ÿäº†å°±ä¼šæŠ›å‡ºSorry, we are out of that flavorçš„é”™è¯¯ã€‚ç®€ç›´æ–¹ä¾¿çš„ä¸è¦ä¸è¦çš„ã€‚</p><p>ç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æ¥åˆ°äº†å®¢æˆ·æŠ•è¯‰è¯´å·§å…‹åŠ›å¤ªå¤šã€‚æ˜¯çš„ï¼Œè¿™æ˜¯æ„šè ¢çš„ä¹Ÿä¸å¯èƒ½å‘ç”Ÿçš„ï¼Œæˆ‘ä»¬åªæ˜¯ç”¨è¿™ä¸ªè™šæ„çš„ä¾‹å­æ¥ä¸ºæˆ‘ä»¬çš„çŸ¥è¯†ç‚¹ä¸¾ä¾‹ã€‚</p><pre><code># attach this code to the previous exampledef clean(self):    cleaned_data = super(IceCreamOrderForm, self).clean()    slug = cleaned_data.get(&quot;slug&quot;, &quot;&quot;)    toppings = cleaned_data.get(&quot;toppings&quot;, &quot;&quot;)    # Silly &quot;too much chocolate&quot; validation example    if u&quot;chocolate&quot; in slug.lower() and \           u&quot;chocolate&quot; in toppings.lower():        msg = u&quot;Your order has too much chocolate.&quot;        raise forms.ValidationError(msg)    return cleaned_data</code></pre><h3 id="12-4-æ¨¡å¼å››ï¼šç ´è§£è¡¨å•å­—æ®µ-2-CBVs-2-Forms-1-Model"><a href="#12-4-æ¨¡å¼å››ï¼šç ´è§£è¡¨å•å­—æ®µ-2-CBVs-2-Forms-1-Model" class="headerlink" title="12.4 æ¨¡å¼å››ï¼šç ´è§£è¡¨å•å­—æ®µ(2 CBVs, 2 Forms, 1 Model)"></a>12.4 æ¨¡å¼å››ï¼šç ´è§£è¡¨å•å­—æ®µ(2 CBVs, 2 Forms, 1 Model)</h3><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä¼šæ·±å…¥ç ”ç©¶ä¸€ä¸ªæ¨¡å‹ä¸­å¯¹åº”ä¸¤ä¸ªè§†å›¾/è¡¨å•çš„æƒ…å†µã€‚æˆ‘ä»¬å°†ä¼šç ´è§£è¡¨å•æ¥åˆ›ä½œä¸€ä¸ªè‡ªå®šä¹‰è¡Œä¸ºçš„è¡¨å•ã€‚</p><p>ä¸€ä¸ªå•†åº—åˆ—è¡¨çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›å•†åº—çš„ä¿¡æ¯èƒ½å°½å¿«çš„å­˜åˆ°ç³»ç»Ÿä¸­ï¼Œä½†æ˜¯ä¹‹åå¸Œæœ›è¿˜èƒ½æ·»åŠ ä¾‹å¦‚ç”µè¯å·ç å’Œè¡—é“åœ°å€çš„æ•°æ®ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬çš„å†°æ·‡æ·‹å•†åº—IceCreamStoreæ¨¡å‹ï¼š</p><pre><code># stores/models.pyfrom django.core.urlresolvers import reversefrom django.db import modelsclass IceCreamStore(models.Model):    title = models.CharField(max_length=100)    block_address = models.TextField()    phone = models.CharField(max_length=20, blank=True)    description = models.TextField(blank=True)    def get_absolute_url(self):        return reverse(&quot;store_detail&quot;, kwargs={&quot;pk&quot;: self.pk})</code></pre><p>é»˜è®¤ç”Ÿæˆçš„ModelFormä¼šå¼ºåˆ¶ç”¨æˆ·è¾“å…¥titleå’Œblock_addresså­—æ®µï¼Œä½†æ˜¯å…è®¸ç”¨æˆ·ä¸å¡«phoneå’Œdescriptionå­—æ®µ</p><p>æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„è¡¨å•æ¥å®ç°å•†åº—ä¿¡æ¯çš„æ›´æ–°ï¼š</p><pre><code># stores/forms.py# Call phone and description from the self.fields dict-like objectfrom django import formsfrom .models import IceCreamStoreclass IceCreamStoreUpdateForm(forms.ModelForm):    class Meta:        model = IceCreamStore    def __init__(self, *args, **kwargs):        # Call the original __init__ method before assigning        # field overloads        super(IceCreamStoreUpdateForm, self).__init__(*args,                            **kwargs)        self.fields[&quot;phone&quot;].required = True        self.fields[&quot;description&quot;].required = True</code></pre><p>ä¸€ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹éœ€è¦è®°ä½ï¼ï¼ï¼Djangoçš„è¡¨å•å°±æ˜¯pythonçš„ç±»ã€‚å®ƒä»¬å¯ä»¥ä½œä¸ºå¯¹è±¡æ¥å®ç°ï¼Œå®ƒä»¬èƒ½ç»§æ‰¿è‡ªå…¶ä»–ç±»ï¼Œä¹Ÿå¯ä»¥å½“ä½œçˆ¶ç±»ã€‚<br>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™æˆ‘ä»¬çš„ä¸¤ä¸ªè¡¨å•ï¼š</p><pre><code># stores/forms.pyfrom django import formsfrom .models import IceCreamStoreclass IceCreamStoreCreateForm(forms.ModelForm):    class Meta:        model = IceCreamStore        fields = (&quot;title&quot;, &quot;block_address&quot;, )class IceCreamStoreUpdateForm(IceCreamStoreCreateForm):    def __init__(self, *args, **kwargs):        super(IceCreamStoreUpdateForm,                self).__init__(*args, **kwargs)        self.fields[&quot;phone&quot;].required = True        self.fields[&quot;description&quot;].required = True    class Meta(IceCreamStoreCreateForm.Meta):        # show all the fields!        fields = (&quot;title&quot;, &quot;block_address&quot;, &quot;phone&quot;,                &quot;description&quot;, )</code></pre><blockquote><p>è­¦å‘Šï¼ï¼ï¼ä½¿ç”¨Meta.fieldsï¼ï¼ä¸è¦ä½¿ç”¨Meta.excludeï¼ï¼ï¼</p></blockquote><p>æœ€åï¼Œæˆ‘ä»¬æ¥å†™å¯¹åº”çš„CBVsè§†å›¾ï¼š</p><pre><code># stores/viewsfrom django.views.generic import CreateView, UpdateViewfrom .forms import IceCreamStoreCreateFormfrom .forms import IceCreamStoreUpdateFormfrom .models import IceCreamStoreclass IceCreamCreateView(CreateView):    model = IceCreamStore    form_class = IceCreamStoreCreateFormclass IceCreamUpdateView(UpdateView):    model = IceCreamStore    form_class = IceCreamStoreUpdateForm</code></pre><h3 id="12-5-æ¨¡å¼äº”ï¼šå¯å¤ç”¨çš„æœç´¢mixinè§†å›¾"><a href="#12-5-æ¨¡å¼äº”ï¼šå¯å¤ç”¨çš„æœç´¢mixinè§†å›¾" class="headerlink" title="12.5 æ¨¡å¼äº”ï¼šå¯å¤ç”¨çš„æœç´¢mixinè§†å›¾"></a>12.5 æ¨¡å¼äº”ï¼šå¯å¤ç”¨çš„æœç´¢mixinè§†å›¾</h3><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šäº†è§£å¦‚ä½•åœ¨ä¸¤ä¸ªå¯¹åº”ä¸åŒæ¨¡å‹çš„è§†å›¾ä¸­å¤ç”¨ä¸€ä¸ªæœç´¢è¡¨å•ã€‚<br>å‡è®¾è¿™ä¸¤ä¸ªæ¨¡å‹éƒ½æœ‰ä¸€ä¸ªå«åštitleçš„å­—æ®µï¼Œè¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•åœ¨Flavoræ¨¡å‹å’ŒIceCreamStoreæ¨¡å‹ä¸­ä½¿ç”¨å•ä¸€çš„CBVè§†å›¾æä¾›ç®€å•çš„æœç´¢åŠŸèƒ½ã€‚</p><p>æˆ‘ä»¬å…ˆç»™è§†å›¾åˆ›å»ºä¸€ä¸ªç®€å•çš„mixinæœç´¢ï¼š</p><pre><code># core/views.pyclass TitleSearchMixin(object):    def get_queryset(self):        # Fetch the queryset from the parent&apos;s get_queryset        queryset = super(TitleSearchMixin, self).get_queryset()        # Get the q GET parameter        q = self.request.GET.get(&quot;q&quot;)        if q:            # return a filtered queryset            return queryset.filter(title__icontains=q)        # No q is specified so we return queryset        return queryset</code></pre><p>æ¥ä¸‹æ¥å°±æ˜¯è®©å®ƒå·¥ä½œåœ¨Flavorå’ŒIceCreamUpdateViewè§†å›¾ä¸­ï¼š</p><pre><code># add to flavors/views.pyfrom django.views.generic import ListViewfrom core.views import TitleSearchMixinfrom .models import Flavorclass FlavorListView(TitleSearchMixin, ListView):    model = Flavor# add to stores/views.pyfrom django.views.generic import ListViewfrom core.views import TitleSearchMixinfrom .models import Storeclass IceCreamStoreListView(TitleSearchMixin, ListView):    model = Store</code></pre><p>ç„¶åç»™æ¯ä¸ªListViewå®šä¹‰HTMLï¼š</p><pre><code>&lt;form action=&quot;&quot; method=&quot;GET&quot;&gt;    &lt;input type=&quot;text&quot; name=&quot;q&quot; /&gt;    &lt;button type=&quot;submit&quot;&gt;search&lt;/button&gt;&lt;/form&gt;&lt;form action=&quot;&quot; method=&quot;GET&quot;&gt;    &lt;input type=&quot;text&quot; name=&quot;q&quot; /&gt;    &lt;button type=&quot;submit&quot;&gt;search&lt;/button&gt;&lt;/form&gt;</code></pre><p>Mixinsæ˜¯å¤ç”¨ä»£ç å¾ˆå¥½çš„æ–¹å¼ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ªç±»ä¸­ä½¿ç”¨å¤ªå¤šçš„mixinsä¼šåˆ¶é€ å‡ºéå¸¸éš¾ç»´æŠ¤ä»£ç ã€‚<br>ä¸€å¦‚æ—¢å¾€çš„ä¿è¯ä»£ç ç®€æ´å°±è¡Œ</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;12-è¡¨å•é€šç”¨æ¨¡å¼&quot;&gt;&lt;a href=&quot;#12-è¡¨å•é€šç”¨æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;12. è¡¨å•é€šç”¨æ¨¡å¼&quot;&gt;&lt;/a&gt;12. è¡¨å•é€šç”¨æ¨¡å¼&lt;/h2&gt;&lt;p&gt;Djangoçš„è¡¨å•å¼ºå¤§ã€çµæ´»ã€æ‰©å±•æ€§å¼ºã€å¥å…¨ã€‚å› æ­¤ï¼ŒDjango admin å’Œ CBVså¹¿æ³›çš„ä½¿ç”¨äº†è¡¨å•ã€‚&lt;br&gt;äº‹å®ä¸Šï¼Œæ‰€æœ‰é‡å¤§çš„Django API æ¡†æ¶ç”¨ModelForms æˆ–è€…ç±»ä¼¼çš„å®ç°æ¥ä½œä¸ºå®ƒä»¬æ ¡éªŒçš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;ç»“åˆè¡¨å•ã€æ¨¡å‹ã€è§†å›¾è®©æˆ‘ä»¬ç”¨è¾ƒå°‘çš„åŠªåŠ›åšäº†è¾ƒå¤šçš„äº‹ã€‚å­¦ä¹ æ›²çº¿æ˜¯å€¼å¾—çš„ï¼š&lt;br&gt;ä¸€æ—¦ä½ å­¦ä¼šäº†ä½¿ç”¨è¿™äº›ç»„ä»¶æµç•…çš„è¿›è¡Œå·¥ä½œï¼Œä½ ä¼šå‘ç°ï¼ŒDjangoæä¾›äº†ä»¥æƒŠäººçš„é€Ÿåº¦åˆ›é€ æ•°é‡æƒŠäººçš„æœ‰ç”¨ä¸”ç¨³å®šåŠŸèƒ½çš„èƒ½åŠ›&lt;/p&gt;
&lt;p&gt;è¿™ä¸€ç« æ˜ç¡®è®²è§£äº†Djangoæœ€å¥½çš„éƒ¨åˆ†ä¹‹ä¸€ï¼šforms, models, CBVsä¹‹é—´çš„ååŒå·¥ä½œã€‚&lt;br&gt;å®ƒè¦†ç›–äº†äº”ä¸ªé€šç”¨è¡¨å•æ¨¡å¼ã€‚æ¯ä¸ªDjangoå¼€å‘è€…éƒ½åº”è¯¥æŒæ¡&lt;br&gt;
    
    </summary>
    
      <category term="Backend" scheme="https://morningchen.com/categories/Backend/"/>
    
      <category term="Django" scheme="https://morningchen.com/categories/Backend/Django/"/>
    
    
      <category term="Django" scheme="https://morningchen.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>Two Scoops of Django 1.8 å­¦ä¹ ç¬”è®°å…­</title>
    <link href="https://morningchen.com/2015/09/25/Two-Scoops-of-Django-1-8-notes-6/"/>
    <id>https://morningchen.com/2015/09/25/Two-Scoops-of-Django-1-8-notes-6/</id>
    <published>2015-09-25T03:34:13.000Z</published>
    <updated>2018-09-27T03:56:47.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="11-Form-Fundamentals-è¡¨å•åŸºæœ¬åŸç†"><a href="#11-Form-Fundamentals-è¡¨å•åŸºæœ¬åŸç†" class="headerlink" title="11. Form Fundamentals è¡¨å•åŸºæœ¬åŸç†"></a>11. Form Fundamentals è¡¨å•åŸºæœ¬åŸç†</h2><p>è¡¨å•ä¸­æœ€é‡è¦çš„äº‹æƒ…æ˜¯æ ¡éªŒä¼ å…¥çš„æ•°æ®</p><h3 id="11-1-ç”¨è¡¨å•æ ¡éªŒä¼ å…¥æ•°æ®"><a href="#11-1-ç”¨è¡¨å•æ ¡éªŒä¼ å…¥æ•°æ®" class="headerlink" title="11.1 ç”¨è¡¨å•æ ¡éªŒä¼ å…¥æ•°æ®"></a>11.1 ç”¨è¡¨å•æ ¡éªŒä¼ å…¥æ•°æ®</h3><pre><code>import csvimport StringIOfrom django import formsfrom .models import Purchase, Sellerclass PurchaseForm(forms.ModelForm):    class Meta:        model = Purchase    def clean_seller(self):        seller = self.cleaned_data[&quot;seller&quot;]        try:            Seller.objects.get(name=seller)        except Seller.DoesNotExist:            msg = &quot;{0} does not exist in purchase #{1}.&quot;.format(                seller,                self.cleaned_data[&quot;purchase_number&quot;]            )            raise forms.ValidationError(msg)        return sellerdef add_csv_purchases(rows):    rows = StringIO.StringIO(rows)    records_added = 0    errors = []    # Generate a dict per row, with the first CSV row being the keys.    for row in csv.DictReader(rows, delimiter=&quot;,&quot;):        # Bind the row data to the PurchaseForm.        form = PurchaseForm(row)        # Check to see if the row data is valid.        if form.is_valid():            # Row data is valid so save the record.            form.save()            records_added += 1        else:            errors.append(form.errors)    return records_added, errors</code></pre><a id="more"></a><h3 id="11-2-åœ¨HTMLçš„è¡¨å•ä¸­ä½¿ç”¨POSTæ–¹æ³•"><a href="#11-2-åœ¨HTMLçš„è¡¨å•ä¸­ä½¿ç”¨POSTæ–¹æ³•" class="headerlink" title="11.2 åœ¨HTMLçš„è¡¨å•ä¸­ä½¿ç”¨POSTæ–¹æ³•"></a>11.2 åœ¨HTMLçš„è¡¨å•ä¸­ä½¿ç”¨POSTæ–¹æ³•</h3><pre><code>&lt;form action=&quot;{% raw %}{% url "flavor_add" %}{% endraw %}&quot; method=&quot;POST&quot;&gt;</code></pre><h3 id="11-3-é’ˆå¯¹éœ€è¦ä¿®æ”¹æ•°æ®çš„è¡¨å•ä½¿ç”¨CSRFä¿æŠ¤"><a href="#11-3-é’ˆå¯¹éœ€è¦ä¿®æ”¹æ•°æ®çš„è¡¨å•ä½¿ç”¨CSRFä¿æŠ¤" class="headerlink" title="11.3 é’ˆå¯¹éœ€è¦ä¿®æ”¹æ•°æ®çš„è¡¨å•ä½¿ç”¨CSRFä¿æŠ¤"></a>11.3 é’ˆå¯¹éœ€è¦ä¿®æ”¹æ•°æ®çš„è¡¨å•ä½¿ç”¨CSRFä¿æŠ¤</h3><pre><code>{% raw %}{% csrf_token %}{% endraw %}</code></pre><h4 id="é€šè¿‡AJAXæäº¤æ•°æ®"><a href="#é€šè¿‡AJAXæäº¤æ•°æ®" class="headerlink" title="é€šè¿‡AJAXæäº¤æ•°æ®"></a>é€šè¿‡AJAXæäº¤æ•°æ®</h4><p>ç”¨AJAXçš„æ—¶å€™ä¹Ÿè¦ç”¨åˆ°CSRFï¼Œä½ éœ€è¦è®¾ç½®å«åšX-CSRFTokençš„HTTP header</p><p>ç¬¬ä¸€æ­¥ï¼Œè·å¾—csrftokençš„cookie</p><pre><code>// using jQueryfunction getCookie(name) {    var cookieValue = null;    if (document.cookie &amp;&amp; document.cookie != &apos;&apos;) {        var cookies = document.cookie.split(&apos;;&apos;);        for (var i = 0; i &lt; cookies.length; i++) {            var cookie = jQuery.trim(cookies[i]);            // Does this cookie string begin with the name we want?            if (cookie.substring(0, name.length + 1) == (name + &apos;=&apos;)) {                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));                break;            }        }    }    return cookieValue;}var csrftoken = getCookie(&apos;csrftoken&apos;);</code></pre><p>è¿˜å¯ä»¥é€šè¿‡ <a href="https://github.com/js-cookie/js-cookie/" target="_blank" rel="noopener">https://github.com/js-cookie/js-cookie/</a> æ¥ä»£æ›¿ä¸Šé¢çš„æ–¹æ³•</p><pre><code>var csrftoken = Cookies.get(&apos;csrftoken&apos;);</code></pre><p>æœ€ååœ¨AJAXè¯·æ±‚ä¸Šè®¾ç½®HTTPå¤´</p><pre><code>function csrfSafeMethod(method) {    // these HTTP methods do not require CSRF protection    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));}$.ajaxSetup({    beforeSend: function(xhr, settings) {        if (!csrfSafeMethod(settings.type) &amp;&amp; !this.crossDomain) {            xhr.setRequestHeader(&quot;X-CSRFToken&quot;, csrftoken);        }    }});</code></pre><h3 id="11-4-äº†è§£å¦‚ä½•æ·»åŠ Djangoè¡¨å•å®ä¾‹å±æ€§"><a href="#11-4-äº†è§£å¦‚ä½•æ·»åŠ Djangoè¡¨å•å®ä¾‹å±æ€§" class="headerlink" title="11.4 äº†è§£å¦‚ä½•æ·»åŠ Djangoè¡¨å•å®ä¾‹å±æ€§"></a>11.4 äº†è§£å¦‚ä½•æ·»åŠ Djangoè¡¨å•å®ä¾‹å±æ€§</h3><pre><code>from django import formsfrom .models import Tasterclass TasterForm(forms.ModelForm):    class Meta:        model = Taster    def __init__(self, *args, **kwargs):        # set the user as an attribute of the form        self.user = kwargs.pop(&apos;user&apos;)        super(TasterForm, self).__init__(*args, **kwargs)</code></pre><p>åœ¨è®¾ç½®super()ä¹‹å‰ï¼Œæˆ‘ä»¬æŠŠkwargsä¸­çš„useræ‹¿äº†å‡ºæ¥ï¼Œèµ‹äºˆäº†self.userï¼Œçœ‹çœ‹viewï¼š</p><pre><code>from django.views.generic import UpdateViewfrom braces.views import LoginRequiredMixinfrom .forms import TasterFormfrom .models import Tasterclass TasterUpdateView(LoginRequiredMixin, UpdateView):    model = Taster    form_class = TasterForm    success_url = &quot;/someplace/&quot;    def get_form_kwargs(self):        &quot;&quot;&quot;This method is what injects forms with their keyword arguments.&quot;&quot;&quot;        # grab the current set of form #kwargs        kwargs = super(TasterUpdateView, self).get_form_kwargs()        # Update the kwargs with the user_id        kwargs[&apos;user&apos;] = self.request.user        return kwargs</code></pre><h3 id="11-5-çŸ¥é“è¡¨å•æ ¡éªŒæ˜¯å¦‚ä½•å·¥ä½œçš„"><a href="#11-5-çŸ¥é“è¡¨å•æ ¡éªŒæ˜¯å¦‚ä½•å·¥ä½œçš„" class="headerlink" title="11.5 çŸ¥é“è¡¨å•æ ¡éªŒæ˜¯å¦‚ä½•å·¥ä½œçš„"></a>11.5 çŸ¥é“è¡¨å•æ ¡éªŒæ˜¯å¦‚ä½•å·¥ä½œçš„</h3><p>è°ƒç”¨form.is_valid()çš„æ—¶å€™ï¼ŒèƒŒåå‘ç”Ÿäº†è¿™äº›äº‹æƒ…ï¼š</p><ol><li>å¦‚æœè¡¨å•ç»‘å®šäº†æ•°æ®ï¼Œform.is_valid()è°ƒç”¨form.full_clean()æ–¹æ³•</li><li><p>form.full_clean()é€šè¿‡è¡¨å•å­—æ®µè¿›è¡Œè¿­ä»£ï¼Œå¹¶ä¸”æ¯ä¸ªå­—æ®µéƒ½éªŒè¯è‡ªèº«</p><p> a. æ•°æ®å†™å…¥åˆ°å­—æ®µçš„æ—¶å€™è¢«å¼ºåˆ¶è¿›å…¥åˆ°äº†Pythonä¸­,é€šè¿‡to_python()æ–¹æ³•æˆ–è€…æŠ›å‡ºValidationErrorå¼‚å¸¸</p><p> b. æ•°æ®çš„éªŒè¯ä¾èµ–å…·ä½“çš„å­—æ®µè§„åˆ™ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰çš„æ ¡éªŒå™¨ã€‚å¤±è´¥æŠ›å‡ºValidationErrorå¼‚å¸¸</p><p> c. å¦‚æœæœ‰ä»»ä½•è‡ªå®šä¹‰çš„clean_<field>()æ–¹æ³•å­˜åœ¨äºè¡¨å•ä¸­ï¼Œåœ¨è¿™ä¸ªæ—¶å€™ä»–ä»¬éƒ½ä¼šè¢«è°ƒç”¨</field></p></li><li><p>form.full_clean()æ‰§è¡Œform.clean()æ–¹æ³•</p></li><li><p>å¦‚æœä»–æ˜¯ä¸ªModelFormçš„å®ä¾‹ï¼Œform._post_clean()åšä¸‹é¢çš„äº‹æƒ…ï¼š</p><p> a. ç»™æ¨¡å‹å®ä¾‹è®¾ç½®ModelFormæ•°æ®ï¼Œè€Œä¸ç®¡form.is_valid()æ˜¯å¦æ˜¯Trueæˆ–è€…False</p><p> b. è°ƒç”¨æ¨¡å‹çš„clean()æ–¹æ³•ï¼Œä½œä¸ºå‚è€ƒï¼Œé€šè¿‡ORMä¿å­˜æ¨¡å‹å®ä¾‹ä¸è°ƒç”¨æ¨¡å‹çš„clean()æ–¹æ³•</p></li></ol><h4 id="11-5-1-ModelForm-æ•°æ®å…ˆè¢«å­˜åˆ°è¡¨å•ä¸­ï¼Œå†å­˜åˆ°æ¨¡å‹å®ä¾‹ä¸­"><a href="#11-5-1-ModelForm-æ•°æ®å…ˆè¢«å­˜åˆ°è¡¨å•ä¸­ï¼Œå†å­˜åˆ°æ¨¡å‹å®ä¾‹ä¸­" class="headerlink" title="11.5.1 ModelForm æ•°æ®å…ˆè¢«å­˜åˆ°è¡¨å•ä¸­ï¼Œå†å­˜åˆ°æ¨¡å‹å®ä¾‹ä¸­"></a>11.5.1 ModelForm æ•°æ®å…ˆè¢«å­˜åˆ°è¡¨å•ä¸­ï¼Œå†å­˜åˆ°æ¨¡å‹å®ä¾‹ä¸­</h4><p>åœ¨ä¸€ä¸ªModelFormä¸­ï¼Œè¡¨å•æ•°æ®çš„å­˜å‚¨åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ol><li>é¦–å…ˆï¼Œè¡¨å•æ•°æ®å­˜åœ¨è¡¨å•å®ä¾‹ä¸­</li><li>ç„¶åï¼Œè¡¨å•æ•°æ®å­˜åœ¨æ¨¡å‹å®ä¾‹ä¸­</li></ol><p>åªæœ‰ä½¿ç”¨form.save()æ–¹æ³•ï¼Œæ•°æ®æ‰ä¼šè¢«å­˜åˆ°æ¨¡å‹å®ä¾‹ä¸­ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§åˆ†ç¦»ä½œä¸ºä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¹Ÿè®¸ä½ éœ€è¦æ•æ‰è¡¨å•æäº¤å¤±è´¥çš„ç»†èŠ‚ï¼Œå‚¨å­˜æ»¡è¶³ç”¨æˆ·çš„è¡¨å•æ•°æ®ä»¥åŠé¢„æœŸçš„æ¨¡å‹å®ä¾‹å˜åŒ–ã€‚<br>ä¸€ä¸ªç®€æ´çš„æ–¹å¼å¦‚ä¸‹ï¼Œé¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¡¨å•å¤±è´¥å†å²çš„æ¨¡å‹ï¼š</p><pre><code># core/models.pyfrom django.db import modelsclass ModelFormFailureHistory(models.Model):    form_data = models.TextField()    model_data = models.TextField()</code></pre><p>ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬æ·»åŠ ä¸ªFlavorActionMixinçš„ç±»</p><pre><code># flavors/views.pyimport jsonfrom django.contrib import messagesfrom django.core import serializersfrom core.models import ModelFormFailureHistoryclass FlavorActionMixin(object):    @property    def success_msg(self):        return NotImplemented    def form_valid(self, form):        messages.info(self.request, self.success_msg)        return super(FlavorActionMixin, self).form_valid(form)    def form_invalid(self, form):        &quot;&quot;&quot;Save invalid form and model data for later reference.&quot;&quot;&quot;        form_data = json.dumps(form.cleaned_data)        model_data = serializers.serialize(&quot;json&quot;,                    [form.instance])[1:-1]        ModelFormFailureHistory.objects.create(            form_data=form_data,            model_data=model_data        )        return super(FlavorActionMixin,                    self).form_invalid(form)</code></pre><p>å¦‚æœä½ è¿˜è®°å¾—ï¼ŒéªŒè¯ä¸è‰¯æ•°æ®çš„è¡¨å•å¤±è´¥åä¼šè°ƒç”¨form_invalid()ã€‚<br>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¹²å‡€çš„è¡¨å•æ•°æ®å’Œæœ€åçš„æ•°æ®ä¼šä½œä¸ºä¸€ä¸ªModelFormFailureHistoryè®°å½•å‚¨å­˜åœ¨æ•°æ®åº“ä¸­</p><h3 id="11-6-Form-add-error"><a href="#11-6-Form-add-error" class="headerlink" title="11.6 Form.add_error()"></a>11.6 Form.add_error()</h3><pre><code>from django import formsclass IceCreamReviewForm(forms.Form):    # Rest of tester form goes here    ...    def clean(self):        cleaned_data = super(TasterForm, self).clean()        flavor = cleaned_data.get(&quot;flavor&quot;)        age = cleaned_data.get(&quot;age&quot;)        if flavor == &apos;coffee&apos; and age &lt; 3:            # Record errors that will be displayed later.            msg = u&quot;Coffee Ice Cream is not for Babies.&quot;            self.add_error(&apos;flavor&apos;, msg)            self.add_error(&apos;age&apos;, msg)        # Always return the full collection of cleaned data.        return cleaned_data</code></pre><h4 id="å…¶ä»–æœ‰ç”¨çš„è¡¨å•æ–¹æ³•"><a href="#å…¶ä»–æœ‰ç”¨çš„è¡¨å•æ–¹æ³•" class="headerlink" title="å…¶ä»–æœ‰ç”¨çš„è¡¨å•æ–¹æ³•"></a>å…¶ä»–æœ‰ç”¨çš„è¡¨å•æ–¹æ³•</h4><ul><li><a href="https://docs.djangoproject.com/en/1.8/ref/forms/api/#django.forms.Form.errors.as_data" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/ref/forms/api/#django.forms.Form.errors.as_data</a></li><li><a href="https://docs.djangoproject.com/en/1.8/ref/forms/api/#django.forms.Form.errors.as_json" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/ref/forms/api/#django.forms.Form.errors.as_json</a></li><li><a href="https://docs.djangoproject.com/en/1.8/ref/forms/api/#django.forms.Form.has_error" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/ref/forms/api/#django.forms.Form.has_error</a></li><li><a href="https://docs.djangoproject.com/en/1.8/ref/forms/api/#django.forms.Form.non_field_errors" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/ref/forms/api/#django.forms.Form.non_field_errors</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;11-Form-Fundamentals-è¡¨å•åŸºæœ¬åŸç†&quot;&gt;&lt;a href=&quot;#11-Form-Fundamentals-è¡¨å•åŸºæœ¬åŸç†&quot; class=&quot;headerlink&quot; title=&quot;11. Form Fundamentals è¡¨å•åŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt;11. Form Fundamentals è¡¨å•åŸºæœ¬åŸç†&lt;/h2&gt;&lt;p&gt;è¡¨å•ä¸­æœ€é‡è¦çš„äº‹æƒ…æ˜¯æ ¡éªŒä¼ å…¥çš„æ•°æ®&lt;/p&gt;
&lt;h3 id=&quot;11-1-ç”¨è¡¨å•æ ¡éªŒä¼ å…¥æ•°æ®&quot;&gt;&lt;a href=&quot;#11-1-ç”¨è¡¨å•æ ¡éªŒä¼ å…¥æ•°æ®&quot; class=&quot;headerlink&quot; title=&quot;11.1 ç”¨è¡¨å•æ ¡éªŒä¼ å…¥æ•°æ®&quot;&gt;&lt;/a&gt;11.1 ç”¨è¡¨å•æ ¡éªŒä¼ å…¥æ•°æ®&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;import csv
import StringIO

from django import forms

from .models import Purchase, Seller

class PurchaseForm(forms.ModelForm):

    class Meta:
        model = Purchase

    def clean_seller(self):
        seller = self.cleaned_data[&amp;quot;seller&amp;quot;]
        try:
            Seller.objects.get(name=seller)
        except Seller.DoesNotExist:
            msg = &amp;quot;{0} does not exist in purchase #{1}.&amp;quot;.format(
                seller,
                self.cleaned_data[&amp;quot;purchase_number&amp;quot;]
            )
            raise forms.ValidationError(msg)
        return seller

def add_csv_purchases(rows):

    rows = StringIO.StringIO(rows)

    records_added = 0
    errors = []
    # Generate a dict per row, with the first CSV row being the keys.
    for row in csv.DictReader(rows, delimiter=&amp;quot;,&amp;quot;):

        # Bind the row data to the PurchaseForm.
        form = PurchaseForm(row)
        # Check to see if the row data is valid.
        if form.is_valid():
            # Row data is valid so save the record.
            form.save()
            records_added += 1
        else:
            errors.append(form.errors)

    return records_added, errors
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="Backend" scheme="https://morningchen.com/categories/Backend/"/>
    
      <category term="Django" scheme="https://morningchen.com/categories/Backend/Django/"/>
    
    
      <category term="Django" scheme="https://morningchen.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>Install PostgreSQL on Mac OS</title>
    <link href="https://morningchen.com/2015/09/23/Install-PostgreSQL-on-Mac-OS/"/>
    <id>https://morningchen.com/2015/09/23/Install-PostgreSQL-on-Mac-OS/</id>
    <published>2015-09-23T02:25:15.000Z</published>
    <updated>2018-09-27T03:52:28.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><pre><code>âœ  brew install postgres==&gt; Downloading https://homebrew.bintray.com/bottles/postgresql-9.4.4.yosemite.bottle.tar.######################################################################## 100.0%==&gt; Pouring postgre&lt;kbd&gt;b&lt;/kbd&gt;sql-9.4.4.yosemite.bottle.tar.gz==&gt; CaveatsIf builds of PostgreSQL 9 are failing and you have version 8.x installed,you may need to remove the previous version first. See:  https://github.com/Homebrew/homebrew/issues/2510To migrate existing data from a previous major version (pre-9.4) of PostgreSQL, see:  https://www.postgresql.org/docs/9.4/static/upgrading.htmlTo have launchd start postgresql at login:    ln -sfv /usr/local/opt/postgresql/*.plist ~/Library/LaunchAgentsThen to load postgresql now:    launchctl load ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plistOr, if you don&apos;t want/need launchctl, you can just run:    postgres -D /usr/local/var/postgres==&gt; /usr/local/Cellar/postgresql/9.4.4/bin/initdb /usr/local/var/postgres==&gt; SummaryğŸº  /usr/local/Cellar/postgresql/9.4.4: 3014 files, 40M</code></pre><a id="more"></a><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><pre><code>initdb /usr/local/var/postgresln -sfv /usr/local/opt/postgresql/*.plist ~/Library/LaunchAgentslaunchctl load ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist</code></pre><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><pre><code>vi .zshrcexport PATH=$PATH:/Applications/Postgres.app/Contents/Versions/9.4/binalias postgres.server=&quot;sudo -u postgres pg_ctl -D /Library/PostgreSQL/9.4/data&quot;</code></pre><h3 id="å¯åŠ¨åœæ­¢æœåŠ¡"><a href="#å¯åŠ¨åœæ­¢æœåŠ¡" class="headerlink" title="å¯åŠ¨åœæ­¢æœåŠ¡"></a>å¯åŠ¨åœæ­¢æœåŠ¡</h3><pre><code>postgres.server startpostgres.server stop</code></pre><h3 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h3><pre><code># åˆ›å»ºé»˜è®¤åä¸ºuserçš„æ•°æ®åº“createdb# åˆ›å»ºæŒ‡å®šåä¸ºplayçš„æ•°æ®åº“createdb play# ç”¨superuseråˆ›å»ºæ•°æ®åº“createdb -U postgres databasename</code></pre><h3 id="åˆ é™¤æ•°æ®åº“"><a href="#åˆ é™¤æ•°æ®åº“" class="headerlink" title="åˆ é™¤æ•°æ®åº“"></a>åˆ é™¤æ•°æ®åº“</h3><pre><code>dropdb -U postgres databasename</code></pre><h3 id="åˆ›å»ºç”¨æˆ·èµ‹äºˆæƒé™"><a href="#åˆ›å»ºç”¨æˆ·èµ‹äºˆæƒé™" class="headerlink" title="åˆ›å»ºç”¨æˆ·èµ‹äºˆæƒé™"></a>åˆ›å»ºç”¨æˆ·èµ‹äºˆæƒé™</h3><pre><code>createuser -U postgres usernamepsql database -c &quot;GRANT ALL ON ALL TABLES IN SCHEMA public to user;&quot;psql database -c &quot;GRANT ALL ON ALL SEQUENCES IN SCHEMA public to user;&quot;psql database -c &quot;GRANT ALL ON ALL FUNCTIONS IN SCHEMA public to user;&quot;</code></pre><h3 id="å‘½ä»¤è¡Œ"><a href="#å‘½ä»¤è¡Œ" class="headerlink" title="å‘½ä»¤è¡Œ"></a>å‘½ä»¤è¡Œ</h3><pre><code># userçš„å‘½ä»¤è¡Œpsql# playçš„å‘½ä»¤è¡Œpsql play# æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“psql -l# ä»¥æŸä¸ªç”¨æˆ·è¿æ¥æŸä¸ªæ•°æ®åº“psql -U username -d databasename# æŸ¥çœ‹ç‰ˆæœ¬å·select version()PostgreSQL 9.5.1 on x86_64-apple-darwin14.5.0, compiled by Apple LLVM version 7.0.0 (clang-700.1.76), 64-bitselect postgis_full_version()POSTGIS=&quot;2.2.1 r14555&quot; GEOS=&quot;3.5.0-CAPI-1.9.0 r4084&quot; PROJ=&quot;Rel. 4.9.2, 08 September 2015&quot; GDAL=&quot;GDAL 1.11.3, released 2015/09/16&quot; LIBXML=&quot;2.9.2&quot; LIBJSON=&quot;0.11&quot; RASTER</code></pre><p>alter table cities add id serial primary key;</p><h2 id="PostgreSQL-é«˜çº§ç‰¹æ€§"><a href="#PostgreSQL-é«˜çº§ç‰¹æ€§" class="headerlink" title="PostgreSQL é«˜çº§ç‰¹æ€§"></a>PostgreSQL é«˜çº§ç‰¹æ€§</h2><h3 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myview <span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">SELECT</span> city, temp_lo, temp_hi, prcp, <span class="built_in">date</span>, location</span><br><span class="line">        <span class="keyword">FROM</span> weather, cities</span><br><span class="line">        <span class="keyword">WHERE</span> city = <span class="keyword">name</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myview;</span><br></pre></td></tr></table></figure><h3 id="å¤–é”®"><a href="#å¤–é”®" class="headerlink" title="å¤–é”®"></a>å¤–é”®</h3><h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><p>BEGIN, COMMIT, ROLLBACK TO, SAVEPOINT</p><p>äº‹åŠ¡æ˜¯æ‰€æœ‰æ•°æ®åº“ç³»ç»Ÿçš„ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µã€‚ä¸€æ¬¡äº‹åŠ¡çš„è¦ç‚¹å°±æ˜¯æŠŠå¤šä¸ªæ­¥éª¤æ†ç»‘æˆä¸€ä¸ªå•ä¸€çš„ã€ ä¸æˆåŠŸåˆ™æˆä»çš„æ“ä½œã€‚å…¶å®ƒå¹¶å‘çš„äº‹åŠ¡æ˜¯çœ‹ä¸åˆ°åœ¨è¿™äº›æ­¥éª¤ä¹‹é—´çš„ä¸­é—´çŠ¶æ€çš„ï¼Œå¹¶ä¸”å¦‚æœå‘ç”Ÿäº†ä¸€äº›é—®é¢˜ï¼Œ å¯¼è‡´è¯¥äº‹åŠ¡æ— æ³•å®Œæˆï¼Œé‚£ä¹ˆæ‰€æœ‰è¿™äº›æ­¥éª¤éƒ½å®Œå…¨ä¸ä¼šå½±å“æ•°æ®åº“ã€‚</p><p>äº‹åŠ¡è¢«è®¤ä¸ºæ˜¯åŸå­çš„ï¼š ä»å…¶å®ƒäº‹åŠ¡çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒè¦ä¹ˆæ˜¯å…¨éƒ¨å‘ç”Ÿï¼Œè¦ä¹ˆå®Œå…¨ä¸å‘ç”Ÿã€‚</p><p>ä¸€ä¸ªäº‹åŠ¡å‹æ•°æ®åº“ä¿è¯ä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„æ‰€æœ‰æ›´æ–°åœ¨äº‹åŠ¡å‘å‡ºå®Œæˆå“åº”ä¹‹å‰éƒ½è®°å½•åˆ°æ°¸ä¹…çš„å­˜å‚¨ä¸­(ä¹Ÿå°±æ˜¯ç£ç›˜)ã€‚</p><p>äº‹åŠ¡å‹æ•°æ®åº“çš„å¦å¤–ä¸€ä¸ªé‡è¦çš„æ€§è´¨å’ŒåŸå­æ›´æ–°çš„æ¦‚å¿µå…³ç³»å¯†åˆ‡ï¼šå½“å¤šä¸ªäº‹åŠ¡å¹¶å‘åœ°è¿è¡Œçš„æ—¶å€™ï¼Œ æ¯ä¸ªäº‹åŠ¡éƒ½ä¸åº”çœ‹åˆ°å…¶å®ƒäº‹åŠ¡æ‰€åšçš„æœªå®Œæˆçš„å˜åŒ–ã€‚</p><p>ä¸€ä¸ªæ‰“å¼€çš„äº‹åŠ¡æ‰€åšçš„æ›´æ–°åœ¨å®ƒå®Œæˆä¹‹å‰æ˜¯æ— æ³•è¢«å…¶å®ƒäº‹åŠ¡çœ‹åˆ°çš„ï¼Œè€Œåˆ°æäº¤çš„æ—¶å€™æ‰€æœ‰æ›´æ–°åŒæ—¶å¯è§ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance = balance - <span class="number">100.00</span></span><br><span class="line">    <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'Alice'</span>;</span><br><span class="line"><span class="comment">-- ç­‰ç­‰</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨è¯¥äº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å†³å®šä¸åšæäº¤(å¯èƒ½æ˜¯æˆ‘ä»¬åˆšå‘ç° Alice çš„ä½™é¢æ˜¯è´Ÿæ•°)ï¼Œ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å‘å‡ºROLLBACKè€Œä¸æ˜¯COMMITå‘½ä»¤ï¼Œ é‚£ä¹ˆåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çš„æ‰€æœ‰æ›´æ–°éƒ½ä¼šè¢«å–æ¶ˆã€‚</p><p>PostgreSQL å®é™…ä¸ŠæŠŠæ¯ä¸ª SQL è¯­å¥å½“åšåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œæ¥çœ‹å¾…ã€‚ å¦‚æœä½ æ²¡æœ‰å‘å‡ºBEGINå‘½ä»¤ï¼Œé‚£ä¹ˆæ¯ä¸ªç‹¬ç«‹çš„è¯­å¥éƒ½è¢«ä¸€ä¸ªéšå«çš„BEGIN å’Œ(å¦‚æœæˆåŠŸçš„è¯)COMMITåŒ…å›´ã€‚ä¸€ç»„åŒ…å›´åœ¨BEGINå’ŒCOMMIT ä¹‹é—´çš„è¯­å¥æœ‰æ—¶å€™è¢«ç§°åšäº‹åŠ¡å—ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ä¿å­˜ç‚¹çš„æ–¹æ³•ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œæ›´åŠ ç²¾ç»†åœ°æ§åˆ¶å…¶ä¸­çš„è¯­å¥ã€‚ ä¿å­˜ç‚¹å…è®¸ä½ é€‰æ‹©æ€§åœ°æŠ›å¼ƒäº‹åŠ¡ä¸­çš„æŸäº›éƒ¨åˆ†ï¼Œè€Œæäº¤å‰©ä¸‹çš„éƒ¨åˆ†ã€‚åœ¨ç”¨SAVEPOINT å®šä¹‰äº†ä¸€ä¸ªä¿å­˜ç‚¹åï¼Œå¦‚æœéœ€è¦ï¼Œä½ å¯ä»¥ä½¿ç”¨ROLLBACK TOå›æ»šåˆ°è¯¥ä¿å­˜ç‚¹ã€‚ åˆ™è¯¥äº‹åŠ¡åœ¨å®šä¹‰ä¿å­˜ç‚¹åˆ° ROLLBACK TO ä¹‹é—´çš„æ‰€æœ‰æ•°æ®åº“æ›´æ”¹éƒ½è¢«æŠ›å¼ƒï¼Œ ä½†æ˜¯åœ¨ä¿å­˜ç‚¹ä¹‹å‰çš„ä¿®æ”¹å°†è¢«ä¿ç•™ã€‚</p><h3 id="çª—å£å‡½æ•°"><a href="#çª—å£å‡½æ•°" class="headerlink" title="çª—å£å‡½æ•°"></a>çª—å£å‡½æ•°</h3><p>OVER<br>èšåˆå‡½æ•°+over()<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> depname, empno, salary, <span class="keyword">avg</span>(salary) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> depname) <span class="keyword">FROM</span> empsalary;</span><br><span class="line">ç®—å‡ºæ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> depname, empno, salary, <span class="keyword">rank</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> depname <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>, empno) <span class="keyword">FROM</span> empsalary;</span><br><span class="line">rankï¼šæ¯ä¸ªéƒ¨é—¨äººå‘˜çš„æƒé‡ï¼ŒæŒ‰ç…§overé‡Œçš„æ–¹å¼æ’åº</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> depname, empno, salary, enroll_date, pos</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  (<span class="keyword">SELECT</span> depname, empno, salary, enroll_date,</span><br><span class="line">          <span class="keyword">rank</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> depname <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>, empno) <span class="keyword">AS</span> pos</span><br><span class="line">     <span class="keyword">FROM</span> empsalary</span><br><span class="line">  ) <span class="keyword">AS</span> ss</span><br><span class="line"><span class="keyword">WHERE</span> pos &lt; <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">å­æŸ¥è¯¢ï¼šæŸ¥è¯¢rank&lt;3çš„è¡Œ</span><br></pre></td></tr></table></figure></p><h3 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h3><p>INHERITS<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> cities (</span><br><span class="line">  <span class="keyword">name</span>       <span class="built_in">text</span>,</span><br><span class="line">  population <span class="built_in">real</span>,</span><br><span class="line">  altitude   <span class="built_in">int</span>     <span class="comment">-- (å•ä½æ˜¯è‹±å°º)</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> capitals (</span><br><span class="line">  state      <span class="built_in">char</span>(<span class="number">2</span>)</span><br><span class="line">) INHERITS (cities);</span><br></pre></td></tr></table></figure></p><p>capitalsç»§æ‰¿äº†å…¶çˆ¶è¡¨ citiesçš„æ‰€æœ‰å­—æ®µ,å·é¦–åºœæœ‰ä¸€ä¸ªé¢å¤–çš„å­—æ®µ stateæ˜¾ç¤ºå…¶æ‰€å¤„çš„å·</p><h2 id="è¯æ³•ç»“æ„"><a href="#è¯æ³•ç»“æ„" class="headerlink" title="è¯æ³•ç»“æ„"></a>è¯æ³•ç»“æ„</h2><h3 id="æ ‡è¯†ç¬¦å’Œå…³é”®å­—"><a href="#æ ‡è¯†ç¬¦å’Œå…³é”®å­—" class="headerlink" title="æ ‡è¯†ç¬¦å’Œå…³é”®å­—"></a>æ ‡è¯†ç¬¦å’Œå…³é”®å­—</h3><p>SQL æ ‡è¯†ç¬¦å’Œå…³é”®å­—å¿…é¡»ä»¥ä¸€ä¸ªå­—æ¯(a-z ä»¥åŠå¸¦å˜éŸ³ç¬¦çš„å­—æ¯å’Œéæ‹‰ä¸å­—æ¯)æˆ–ä¸‹åˆ’çº¿å¼€å¤´ï¼Œ éšåçš„å­—ç¬¦å¯ä»¥æ˜¯å­—æ¯ã€ä¸‹åˆ’çº¿ã€æ•°å­—(0-9)ã€ ç¾å…ƒç¬¦å·($)</p><h3 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> empsalary(<span class="built_in">int</span>) <span class="keyword">RETURNS</span> empsalary                                                                                                                                                                                                                           <span class="keyword">AS</span> $$ <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> empsalary <span class="keyword">WHERE</span> empno = $<span class="number">1</span> $$                                                                                                                                                                                                                               <span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span>;</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨å‡½æ•°"><a href="#è°ƒç”¨å‡½æ•°" class="headerlink" title="è°ƒç”¨å‡½æ•°"></a>è°ƒç”¨å‡½æ•°</h3><h4 id="ä½ç½®è¡¨ç¤ºæ³•"><a href="#ä½ç½®è¡¨ç¤ºæ³•" class="headerlink" title="ä½ç½®è¡¨ç¤ºæ³•"></a>ä½ç½®è¡¨ç¤ºæ³•</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> concat_lower_or_upper(a <span class="built_in">text</span>, b <span class="built_in">text</span>, uppercase <span class="built_in">boolean</span> <span class="keyword">DEFAULT</span> <span class="literal">false</span>)                                                                                                                                                                                   <span class="keyword">RETURNS</span> <span class="built_in">text</span>                                                                                                                                                                                                                                                                    <span class="keyword">AS</span>                                                                                                                                                                                                                                                                              $$                                                                                                                                                                                                                                                                                <span class="keyword">SELECT</span> <span class="keyword">CASE</span>                                                                                                                                                                                                                                                                            <span class="keyword">WHEN</span> $<span class="number">3</span> <span class="keyword">THEN</span> <span class="keyword">UPPER</span>($<span class="number">1</span> || <span class="string">' '</span> || $<span class="number">2</span>)                                                                                                                                                                                                                                             <span class="keyword">ELSE</span> <span class="keyword">LOWER</span>($<span class="number">1</span> || <span class="string">' '</span> || $<span class="number">1</span>)                                                                                                                                                                                                                                                     <span class="keyword">END</span>;                                                                                                                                                                                                                                                                   $$                                                                                                                                                                                                                                                                              LANGUAGE SQL IMMUTABLE STRICT;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">select</span> concat_lower_or_upper(<span class="string">'a'</span>, <span class="string">'b'</span>);</span><br><span class="line"> concat_lower_or_upper</span><br><span class="line"><span class="comment">-----------------------</span></span><br><span class="line"> a a</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure><h4 id="åç§°è¡¨ç¤ºæ³•"><a href="#åç§°è¡¨ç¤ºæ³•" class="headerlink" title="åç§°è¡¨ç¤ºæ³•"></a>åç§°è¡¨ç¤ºæ³•</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> concat_lower_or_upper(a := <span class="string">'Hello'</span>, b := <span class="string">'World'</span>, uppercase := <span class="literal">true</span>);</span><br><span class="line"> concat_lower_or_upper</span><br><span class="line"><span class="comment">-----------------------</span></span><br><span class="line"> HELLO WORLD</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure><h4 id="æ··åˆè¡¨ç¤ºæ³•"><a href="#æ··åˆè¡¨ç¤ºæ³•" class="headerlink" title="æ··åˆè¡¨ç¤ºæ³•"></a>æ··åˆè¡¨ç¤ºæ³•</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> concat_lower_or_upper(<span class="string">'Hello'</span>, <span class="string">'World'</span>, uppercase := <span class="literal">true</span>);</span><br><span class="line"> concat_lower_or_upper</span><br><span class="line"><span class="comment">-----------------------</span></span><br><span class="line"> HELLO WORLD</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®å®šä¹‰"><a href="#æ•°æ®å®šä¹‰" class="headerlink" title="æ•°æ®å®šä¹‰"></a>æ•°æ®å®šä¹‰</h2><h3 id="ç¼ºçœå€¼"><a href="#ç¼ºçœå€¼" class="headerlink" title="ç¼ºçœå€¼"></a>ç¼ºçœå€¼</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span><br><span class="line">    product_no <span class="built_in">integer</span> <span class="keyword">DEFAULT</span> <span class="keyword">nextval</span>(<span class="string">'products_product_no_seq'</span>),</span><br><span class="line">    ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç¼©å†™<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span><br><span class="line">    product_no <span class="built_in">SERIAL</span>,</span><br><span class="line">    ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><h3 id="çº¦æŸ"><a href="#çº¦æŸ" class="headerlink" title="çº¦æŸ"></a>çº¦æŸ</h3><ul><li>æ£€æŸ¥çº¦æŸ<ul><li>CHECK (price &gt; 0)  å­—æ®µçº¦æŸ</li><li>CONSTRAINT positive_price CHECK (price &gt; 0)  å‘½åçº¦æŸ</li><li>CHECK (price &gt; discounted_price)  è¡¨çº¦æŸ</li><li>CHECK (discounted_price &gt; 0 AND price &gt; discounted_price)</li></ul></li><li>éç©ºçº¦æŸ<ul><li>NOT NULL</li></ul></li><li>å”¯ä¸€çº¦æŸ<ul><li>UNIQUE</li><li>UNIQUE (a, b, c)</li></ul></li><li>ä¸»é”®<ul><li>PRIMARY KEY (ä¸ UNIQUE NOT NULL ç­‰ä»·)</li><li>PRIMARY KEY (a, b, c)</li></ul></li><li>å¤–é”®<ul><li>REFERENCES products (product_no) å¦‚æœç¼ºå°‘å­—æ®µåˆ—è¡¨çš„è¯ï¼Œå°±ä¼šå¼•ç”¨è¢«å¼•ç”¨è¡¨çš„ä¸»é”®</li><li>FOREIGN KEY (b, c) REFERENCES other_table (c1, c2)</li><li>ON DELETE RESTRICT  é™åˆ¶åˆ é™¤ï¼šç¦æ­¢åˆ é™¤è¢«å¼•ç”¨çš„è¡Œ</li><li>ON DELETE CASCADE  çº§è”åˆ é™¤ï¼šåœ¨åˆ é™¤ä¸€ä¸ªè¢«å¼•ç”¨çš„è¡Œçš„æ—¶å€™ï¼Œæ‰€æœ‰å¼•ç”¨å®ƒçš„è¡Œä¹Ÿä¼šè¢«è‡ªåŠ¨åˆ é™¤</li><li>SET NULL  åˆ é™¤åçš„è®¾ç½®ä¸º NULL</li><li>SET DEFAULT åˆ é™¤åè®¾ç½®ä¸º é»˜è®¤å€¼DEFAULT</li></ul></li><li>æ’é™¤çº¦æŸ<ul><li>EXCLUDE</li></ul></li></ul><h3 id="ä¿®æ”¹è¡¨"><a href="#ä¿®æ”¹è¡¨" class="headerlink" title="ä¿®æ”¹è¡¨"></a>ä¿®æ”¹è¡¨</h3><ul><li>å¢åŠ å­—æ®µ<ul><li>ALTER TABLE products ADD COLUMN description text;</li></ul></li><li>åˆ é™¤å­—æ®µ<ul><li>ALTER TABLE products DROP COLUMN description;</li><li>ALTER TABLE products DROP COLUMN description CASCADE;</li></ul></li><li>å¢åŠ çº¦æŸ<ul><li>ALTER TABLE products ADD CHECK (name &lt;&gt; â€˜â€™);</li><li>ALTER TABLE products ADD CONSTRAINT some_name UNIQUE (product_no);</li><li>ALTER TABLE products ADD FOREIGN KEY (product_group_id) REFERENCES product_groups;</li><li>ALTER TABLE products ALTER COLUMN product_no SET NOT NULL;</li></ul></li><li>åˆ é™¤çº¦æŸ<ul><li>ALTER TABLE products DROP CONSTRAINT some_name;</li><li>ALTER TABLE products DROP CONSTRAINT some_name CASCADE;</li><li>ALTER TABLE products ALTER COLUMN product_no DROP NOT NULL;</li></ul></li><li>ä¿®æ”¹ç¼ºçœå€¼<ul><li>ALTER TABLE products ALTER COLUMN price SET DEFAULT 7.77;</li><li>ALTER TABLE products ALTER COLUMN price DROP DEFAULT;</li></ul></li><li>ä¿®æ”¹å­—æ®µæ•°æ®ç±»å‹<ul><li>ALTER TABLE products ALTER COLUMN price TYPE numeric(10,2);</li></ul></li><li>é‡å‘½åå­—æ®µ<ul><li>ALTER TABLE products RENAME COLUMN product_no TO product_number;</li></ul></li><li>é‡å‘½åè¡¨<ul><li>ALTER TABLE products RENAME TO items;</li></ul></li></ul><h3 id="æ¶æ„schema"><a href="#æ¶æ„schema" class="headerlink" title="æ¶æ„schema"></a>æ¶æ„schema</h3><h4 id="è‡ªå®šä¹‰schema"><a href="#è‡ªå®šä¹‰schema" class="headerlink" title="è‡ªå®šä¹‰schema"></a>è‡ªå®šä¹‰schema</h4><p>ç”¨é€”ï¼š</p><ul><li>å…è®¸å¤šä¸ªç”¨æˆ·ä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“è€Œä¸ä¼šå¹²æ‰°å…¶å®ƒç”¨æˆ·ã€‚</li><li>æŠŠæ•°æ®åº“å¯¹è±¡ç»„ç»‡æˆé€»è¾‘ç»„ï¼Œè®©å®ƒä»¬æ›´ä¾¿äºç®¡ç†ã€‚</li><li>ç¬¬ä¸‰æ–¹çš„åº”ç”¨å¯ä»¥æ”¾åœ¨ä¸åŒçš„æ¨¡å¼ä¸­ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šå’Œå…¶å®ƒå¯¹è±¡çš„åå­—å†²çªã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">database.schema.table</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SCHEMA</span> myschema;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myschema.mytable (</span><br><span class="line"> ...</span><br><span class="line">);</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">SCHEMA</span> myschema;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">SCHEMA</span> myschema <span class="keyword">CASCADE</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SCHEMA</span> schemaname AUTHORIZATION username;</span><br></pre></td></tr></table></figure><h4 id="The-Public-Schema"><a href="#The-Public-Schema" class="headerlink" title="The Public Schema"></a>The Public Schema</h4><p>CREATE TABLE products ( â€¦ );<br>CREATE TABLE public.products ( â€¦ );</p><h4 id="The-Schema-Search-Path"><a href="#The-Schema-Search-Path" class="headerlink" title="The Schema Search Path"></a>The Schema Search Path</h4><p>SHOW search_path;<br>SET search_path TO myschema,public;<br>DROP TABLE mytable;</p><h4 id="Schemas-and-Privileges"><a href="#Schemas-and-Privileges" class="headerlink" title="Schemas and Privileges"></a>Schemas and Privileges</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">CREATE</span> <span class="keyword">ON</span> <span class="keyword">SCHEMA</span> <span class="keyword">public</span> <span class="keyword">FROM</span> <span class="keyword">PUBLIC</span>;</span><br></pre></td></tr></table></figure><p>ä¸å…è®¸æ‰€æœ‰ç”¨æˆ·æœ‰CREATEçš„æƒé™ï¼Œç¬¬ä¸€ä¸ªâ€publicâ€æ˜¯schemaï¼Œç¬¬äºŒä¸ªâ€PUBLICâ€æ„æ€æ˜¯â€æ‰€æœ‰ç”¨æˆ·â€</p><h4 id="The-System-Catalog-Schema"><a href="#The-System-Catalog-Schema" class="headerlink" title="The System Catalog Schema"></a>The System Catalog Schema</h4><p>pg_catalog å®ƒåŒ…å«ç³»ç»Ÿè¡¨å’Œæ‰€æœ‰å†…ç½®æ•°æ®ç±»å‹ã€å‡½æ•°ã€æ“ä½œç¬¦</p><h2 id="æ•°æ®æ“ä½œ"><a href="#æ•°æ®æ“ä½œ" class="headerlink" title="æ•°æ®æ“ä½œ"></a>æ•°æ®æ“ä½œ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products (<span class="keyword">name</span>, price, product_no) <span class="keyword">VALUES</span> (<span class="string">'Cheese'</span>, <span class="number">9.99</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products (product_no, <span class="keyword">name</span>, price) <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>, <span class="string">'Cheese'</span>, <span class="number">9.99</span>),</span><br><span class="line">    (<span class="number">2</span>, <span class="string">'Bread'</span>, <span class="number">1.99</span>),</span><br><span class="line">    (<span class="number">3</span>, <span class="string">'Milk'</span>, <span class="number">2.99</span>);</span><br><span class="line"><span class="keyword">UPDATE</span> mytable <span class="keyword">SET</span> a = <span class="number">5</span>, b = <span class="number">3</span>, c = <span class="number">1</span> <span class="keyword">WHERE</span> a &gt; <span class="number">0</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> price = <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h2><h3 id="è¡¨è¿æ¥"><a href="#è¡¨è¿æ¥" class="headerlink" title="è¡¨è¿æ¥"></a>è¡¨è¿æ¥</h3><ul><li>CROSS JOIN (å¡ç¬›å°”ç§¯ Cartesian product)</li><li>INNER JOIN ON</li><li>INNER JOIN USING</li><li>NATURAL INNER JOIN</li><li>LEFT JOIN</li><li>RIGHT JOIN</li><li>FULL JOIN</li></ul><h3 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h3><p>å­æŸ¥è¯¢çš„ç»“æœ(æ´¾ç”Ÿè¡¨)å¿…é¡»åŒ…å›´åœ¨åœ†æ‹¬å¼§é‡Œå¹¶ä¸”å¿…é¡»èµ‹äºˆä¸€ä¸ªåˆ«å</p><h3 id="è¡¨å‡½æ•°"><a href="#è¡¨å‡½æ•°" class="headerlink" title="è¡¨å‡½æ•°"></a>è¡¨å‡½æ•°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> foo (fooid <span class="built_in">int</span>, foosubid <span class="built_in">int</span>, fooname <span class="built_in">text</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getfoo(<span class="built_in">int</span>) <span class="keyword">RETURNS</span> SETOF foo <span class="keyword">AS</span> $$</span><br><span class="line">    <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> foo <span class="keyword">WHERE</span> fooid = $<span class="number">1</span>;</span><br><span class="line">$$ LANGUAGE SQL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> getfoo(<span class="number">1</span>) <span class="keyword">AS</span> t1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> foo</span><br><span class="line">    <span class="keyword">WHERE</span> foosubid <span class="keyword">IN</span> (</span><br><span class="line">                        <span class="keyword">SELECT</span> foosubid</span><br><span class="line">                        <span class="keyword">FROM</span> getfoo(foo.fooid) z</span><br><span class="line">                        <span class="keyword">WHERE</span> z.fooid = foo.fooid</span><br><span class="line">                      );</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> vw_getfoo <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> getfoo(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> vw_getfoo;</span><br></pre></td></tr></table></figure><h3 id="LATERAL-Subqueries"><a href="#LATERAL-Subqueries" class="headerlink" title="LATERAL Subqueries"></a>LATERAL Subqueries</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> p1.id, p2.id, v1, v2</span><br><span class="line"><span class="keyword">FROM</span> polygons p1, polygons p2,</span><br><span class="line">     LATERAL vertices(p1.poly) v1,</span><br><span class="line">     LATERAL vertices(p2.poly) v2</span><br><span class="line"><span class="keyword">WHERE</span> (v1 &lt;-&gt; v2) &lt; <span class="number">10</span> <span class="keyword">AND</span> p1.id != p2.id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> p1.id, p2.id, v1, v2</span><br><span class="line"><span class="keyword">FROM</span> polygons p1 <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> LATERAL vertices(p1.poly) v1,</span><br><span class="line">     polygons p2 <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> LATERAL vertices(p2.poly) v2</span><br><span class="line"><span class="keyword">WHERE</span> (v1 &lt;-&gt; v2) &lt; <span class="number">10</span> <span class="keyword">AND</span> p1.id != p2.id;</span><br></pre></td></tr></table></figure><h3 id="The-GROUP-BY-and-HAVING-Clauses"><a href="#The-GROUP-BY-and-HAVING-Clauses" class="headerlink" title="The GROUP BY and HAVING Clauses"></a>The GROUP BY and HAVING Clauses</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> select_list <span class="keyword">FROM</span> ... [<span class="keyword">WHERE</span> ...] <span class="keyword">GROUP</span> <span class="keyword">BY</span> ... <span class="keyword">HAVING</span> boolean_expression</span><br><span class="line"><span class="keyword">SELECT</span> product_id, p.name, (<span class="keyword">sum</span>(s.units) * (p.price - p.cost)) <span class="keyword">AS</span> profit</span><br><span class="line">    <span class="keyword">FROM</span> products p <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> sales s <span class="keyword">USING</span> (product_id)</span><br><span class="line">    <span class="keyword">WHERE</span> s.date &gt; <span class="keyword">CURRENT_DATE</span> - <span class="built_in">INTERVAL</span> <span class="string">'4 weeks'</span></span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_id, p.name, p.price, p.cost</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="keyword">sum</span>(p.price * s.units) &gt; <span class="number">5000</span>;</span><br></pre></td></tr></table></figure><h3 id="GROUPING-SETS-CUBE-and-ROLLUP"><a href="#GROUPING-SETS-CUBE-and-ROLLUP" class="headerlink" title="GROUPING SETS, CUBE, and ROLLUP"></a>GROUPING SETS, CUBE, and ROLLUP</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">=&gt; SELECT * FROM items_sold;</span><br><span class="line"> brand | size | sales</span><br><span class="line"><span class="comment">-------+------+-------</span></span><br><span class="line"> Foo   | L    |  10</span><br><span class="line"> Foo   | M    |  20</span><br><span class="line"> Bar   | M    |  15</span><br><span class="line"> Bar   | L    |  5</span><br><span class="line">(4 rows)</span><br><span class="line"></span><br><span class="line">=&gt; SELECT brand, size, sum(sales) FROM items_sold GROUP BY GROUPING SETS ((brand), (size), ());</span><br><span class="line"> brand | size | sum</span><br><span class="line"><span class="comment">-------+------+-----</span></span><br><span class="line"> Foo   |      |  30</span><br><span class="line"> Bar   |      |  20</span><br><span class="line">       | L    |  15</span><br><span class="line">       | M    |  35</span><br><span class="line">       |      |  50</span><br><span class="line">(5 rows)</span><br></pre></td></tr></table></figure><h3 id="Combining-Queries"><a href="#Combining-Queries" class="headerlink" title="Combining Queries"></a>Combining Queries</h3><p>å¯¹ä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœè¿›è¡Œé›†åˆæ“ä½œ(å¹¶ã€äº¤ã€å·®)</p><ul><li>query1 UNION [ALL] query2</li><li>query1 INTERSECT [ALL] query2</li><li>query1 EXCEPT [ALL] query2</li></ul><h3 id="Sorting-Rows"><a href="#Sorting-Rows" class="headerlink" title="Sorting Rows"></a>Sorting Rows</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> select_list</span><br><span class="line">    <span class="keyword">FROM</span> table_expression</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> sort_expression1 [<span class="keyword">ASC</span> | <span class="keyword">DESC</span>] [<span class="keyword">NULLS</span> &#123; <span class="keyword">FIRST</span> | <span class="keyword">LAST</span> &#125;]</span><br><span class="line">             [, sort_expression2 [<span class="keyword">ASC</span> | <span class="keyword">DESC</span>] [<span class="keyword">NULLS</span> &#123; <span class="keyword">FIRST</span> | <span class="keyword">LAST</span> &#125;] ...]</span><br></pre></td></tr></table></figure><h3 id="LIMIT-and-OFFSET"><a href="#LIMIT-and-OFFSET" class="headerlink" title="LIMIT and OFFSET"></a>LIMIT and OFFSET</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> select_list</span><br><span class="line">    <span class="keyword">FROM</span> table_expression</span><br><span class="line">    [ <span class="keyword">ORDER</span> <span class="keyword">BY</span> ... ]</span><br><span class="line">    [ <span class="keyword">LIMIT</span> &#123; <span class="built_in">number</span> | ALL &#125; ] [ <span class="keyword">OFFSET</span> <span class="built_in">number</span> ]</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><p>PostgreSQLæœ‰ç€ä¸°å¯Œçš„å†…ç½®æ•°æ®ç±»å‹å¯ç”¨ã€‚ ç”¨æˆ·è¿˜å¯ä»¥ä½¿ç”¨CREATE TYPEå‘½ä»¤å¢åŠ æ–°çš„æ•°æ®ç±»å‹ã€‚</p><table><thead><tr><th>åå­—</th><th>åˆ«å</th><th>æè¿°</th></tr></thead><tbody><tr><td>bigint</td><td>int8</td><td>æœ‰ç¬¦å·8å­—èŠ‚æ•´æ•°</td></tr><tr><td>bigserial</td><td>serial8</td><td>è‡ªå¢8å­—èŠ‚æ•´æ•°</td></tr><tr><td>bit [ (n) ]</td><td></td><td>å®šé•¿ä½ä¸²</td></tr><tr><td>bit varying [ (n) ]</td><td>varbit</td><td>å¯å˜é•¿ä½ä¸²</td></tr><tr><td>boolean</td><td>bool</td><td>é€»è¾‘å¸ƒå°”å€¼(çœŸ/å‡)</td></tr><tr><td>box</td><td></td><td>å¹³é¢ä¸Šçš„çŸ©å½¢</td></tr><tr><td>bytea</td><td></td><td>äºŒè¿›åˆ¶æ•°æ®(â€œå­—èŠ‚æ•°ç»„â€)</td></tr><tr><td>character varying [ (n) ]</td><td>varchar [ (n) ]</td><td>å¯å˜é•¿å­—ç¬¦ä¸²</td></tr><tr><td>character [ (n) ]</td><td>char [ (n) ]</td><td>å®šé•¿å­—ç¬¦ä¸²</td></tr><tr><td>cidr</td><td></td><td>IPv4 æˆ– IPv6 ç½‘ç»œåœ°å€</td></tr><tr><td>circle</td><td></td><td>å¹³é¢ä¸Šçš„åœ†</td></tr><tr><td>date</td><td></td><td>æ—¥å†æ—¥æœŸ(å¹´, æœˆ, æ—¥)</td></tr><tr><td>double precision</td><td>float8</td><td>åŒç²¾åº¦æµ®ç‚¹æ•°(8å­—èŠ‚)</td></tr><tr><td>inet</td><td></td><td>IPv4 æˆ– IPv6 ä¸»æœºåœ°å€</td></tr><tr><td>integer</td><td>int, int4</td><td>æœ‰ç¬¦å· 4 å­—èŠ‚æ•´æ•°</td></tr><tr><td>interval [ fields ] [ (p) ]</td><td></td><td>æ—¶é—´é—´éš”</td></tr><tr><td>line</td><td></td><td>å¹³é¢ä¸Šçš„æ— é™é•¿ç›´çº¿</td></tr><tr><td>lseg</td><td></td><td>å¹³é¢ä¸Šçš„çº¿æ®µ</td></tr><tr><td>macaddr</td><td></td><td>MAC (Media Access Control)åœ°å€</td></tr><tr><td>money</td><td></td><td>è´§å¸é‡‘é¢</td></tr><tr><td>numeric [ (p, s) ]</td><td>decimal [ (p, s) ]</td><td>å¯é€‰ç²¾åº¦çš„å‡†ç¡®æ•°å€¼æ•°æ®ç±»å‹</td></tr><tr><td>path</td><td></td><td>å¹³é¢ä¸Šçš„å‡ ä½•è·¯å¾„</td></tr><tr><td>point</td><td></td><td>å¹³é¢ä¸Šçš„ç‚¹</td></tr><tr><td>polygon</td><td></td><td>å¹³é¢ä¸Šçš„å°é—­å‡ ä½•è·¯å¾„</td></tr><tr><td>real</td><td>float4</td><td>å•ç²¾åº¦æµ®ç‚¹æ•°(4 å­—èŠ‚)</td></tr><tr><td>smallint</td><td>int2</td><td>æœ‰ç¬¦å· 2 å­—èŠ‚æ•´æ•°</td></tr><tr><td>smallserial</td><td>serial2</td><td>è‡ªå¢ 2 å­—èŠ‚æ•´æ•°</td></tr><tr><td>serial</td><td>serial4</td><td>è‡ªå¢ 4 å­—èŠ‚æ•´æ•°</td></tr><tr><td>text</td><td></td><td>å¯å˜é•¿å­—ç¬¦ä¸²</td></tr><tr><td>time [ (p) ] [ without time zone ]</td><td></td><td>ä¸€å¤©ä¸­çš„æ—¶åˆ»(æ— æ—¶åŒº)</td></tr><tr><td>time [ (p) ] with time zone</td><td>timetz</td><td>ä¸€å¤©ä¸­çš„æ—¶åˆ»ï¼Œå«æ—¶åŒº</td></tr><tr><td>timestamp [ (p) ] [ without time zone ]</td><td></td><td>æ—¥æœŸä¸æ—¶åˆ»(æ— æ—¶åŒº)</td></tr><tr><td>timestamp [ (p) ] with time zone</td><td>timestamptz</td><td>æ—¥æœŸä¸æ—¶åˆ»ï¼Œå«æ—¶åŒº</td></tr><tr><td>tsquery</td><td></td><td>æ–‡æœ¬æ£€ç´¢æŸ¥è¯¢</td></tr><tr><td>tsvector</td><td></td><td>æ–‡æœ¬æ£€ç´¢æ–‡æ¡£</td></tr><tr><td>txid_snapshot</td><td></td><td>ç”¨æˆ·çº§åˆ«çš„äº‹åŠ¡IDå¿«ç…§</td></tr><tr><td>uuid</td><td></td><td>é€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦</td></tr><tr><td>xml</td><td></td><td>XML æ•°æ®</td></tr><tr><td>json</td><td></td><td>JSON æ•°æ®</td></tr></tbody></table><p>å¦‚æœä½ è¦æ±‚ç²¾ç¡®çš„è®¡ç®—(æ¯”å¦‚è®¡ç®—è´§å¸é‡‘é¢)ï¼Œåº”ä½¿ç”¨numeric(decimal)ç±»å‹</p><h2 id="å¹¶å‘æ§åˆ¶"><a href="#å¹¶å‘æ§åˆ¶" class="headerlink" title="å¹¶å‘æ§åˆ¶"></a>å¹¶å‘æ§åˆ¶</h2><ul><li>MVCC (Multiversion Concurrency Control)</li><li>Table- and row-level locking</li></ul><h3 id="transaction-isolation"><a href="#transaction-isolation" class="headerlink" title="transaction isolation"></a>transaction isolation</h3><table><thead><tr><th>Isolation Level</th><th>Dirty Read</th><th>Nonrepeatable Read</th><th>Phantom Read</th><th>Serialization Anomaly</th></tr></thead><tbody><tr><td>Read uncommitted</td><td>Allowed, but not in PG</td><td>Possible</td><td>Possible</td><td>Possible</td></tr><tr><td>Read committed</td><td>Not possible</td><td>Possible</td><td>Possible</td><td>Possible</td></tr><tr><td>Repeatable read</td><td>Not possible</td><td>Not possible</td><td>Allowed, but not in PG</td><td>Possible</td></tr><tr><td>Serializable</td><td>Not possible</td><td>Not possible</td><td>Not possible</td><td>Not possible</td></tr></tbody></table><p>PostgreSQL ä¸­é»˜è®¤çš„éš”ç¦»çº§åˆ«æ˜¯Read committed</p><h2 id="é»˜è®¤å‡½æ•°"><a href="#é»˜è®¤å‡½æ•°" class="headerlink" title="é»˜è®¤å‡½æ•°"></a>é»˜è®¤å‡½æ•°</h2><p>random()<br>rank()</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;âœ  brew install postgres
==&amp;gt; Downloading https://homebrew.bintray.com/bottles/postgresql-9.4.4.yosemite.bottle.tar.
######################################################################## 100.0%
==&amp;gt; Pouring postgre&amp;lt;kbd&amp;gt;b&amp;lt;/kbd&amp;gt;sql-9.4.4.yosemite.bottle.tar.gz
==&amp;gt; Caveats
If builds of PostgreSQL 9 are failing and you have version 8.x installed,
you may need to remove the previous version first. See:
  https://github.com/Homebrew/homebrew/issues/2510

To migrate existing data from a previous major version (pre-9.4) of PostgreSQL, see:
  https://www.postgresql.org/docs/9.4/static/upgrading.html


To have launchd start postgresql at login:
    ln -sfv /usr/local/opt/postgresql/*.plist ~/Library/LaunchAgents
Then to load postgresql now:
    launchctl load ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist
Or, if you don&amp;apos;t want/need launchctl, you can just run:
    postgres -D /usr/local/var/postgres
==&amp;gt; /usr/local/Cellar/postgresql/9.4.4/bin/initdb /usr/local/var/postgres
==&amp;gt; Summary
ğŸº  /usr/local/Cellar/postgresql/9.4.4: 3014 files, 40M
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="DevOps" scheme="https://morningchen.com/categories/DevOps/"/>
    
    
      <category term="PostgreSQL" scheme="https://morningchen.com/tags/PostgreSQL/"/>
    
  </entry>
  
  <entry>
    <title>Install Sentry and Supervisor on Centos</title>
    <link href="https://morningchen.com/2015/09/16/install-sentry-on-centos/"/>
    <id>https://morningchen.com/2015/09/16/install-sentry-on-centos/</id>
    <published>2015-09-16T12:35:02.000Z</published>
    <updated>2018-09-27T03:52:39.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><p>å®‰è£…å‰å…ˆç”¨virtualenvåˆ›å»ºä¸€ä¸ªéš”ç¦»ç¯å¢ƒ</p><pre><code>yum updateyum -y install python-setuptools python-setuptools-develyum install libxml2-devel libxslt-devel python-devel -yyum install gcc libffi-devel openssl-devel -yyum -y install mysql-server mysql mysql-develyum install epel-release -ypip install MySQL-python</code></pre><h3 id="å¯åŠ¨mysqlå’Œredis"><a href="#å¯åŠ¨mysqlå’Œredis" class="headerlink" title="å¯åŠ¨mysqlå’Œredis"></a>å¯åŠ¨mysqlå’Œredis</h3><pre><code>sudo service mysqld startredis-server</code></pre><a id="more"></a><h3 id="å®‰è£…sentry"><a href="#å®‰è£…sentry" class="headerlink" title="å®‰è£…sentry"></a>å®‰è£…sentry</h3><pre><code>pip install sentry</code></pre><p>é…ç½®æ–‡ä»¶ï¼š</p><pre><code>sentry init</code></pre><p>ä¿®æ”¹ç”Ÿæˆæ–‡ä»¶sentry.conf.pyï¼Œä¸»è¦ä¿®æ”¹ä»¥ä¸‹å­—æ®µï¼š</p><pre><code>DATABASESSENTRY_ADMIN_EMAILSENTRY_URL_PREFIXSENTRY_REDIS_OPTIONS</code></pre><p>å¯åŠ¨sentry:</p><pre><code>sentry --config=/root/.sentry/sentry.conf.py upgradesentry start</code></pre><h3 id="å®‰è£…nginx"><a href="#å®‰è£…nginx" class="headerlink" title="å®‰è£…nginx"></a>å®‰è£…nginx</h3><pre><code>vi /etc/yum.repos.d/nginx.repo[nginx]name=nginx repobaseurl=http://nginx.org/packages/centos/6/x86_64/gpgcheck=0enabled=1yum updateyum install nginx</code></pre><p>å¯åŠ¨nginx</p><pre><code>sudo service nginx restart</code></pre><h3 id="å®‰è£…supervisor"><a href="#å®‰è£…supervisor" class="headerlink" title="å®‰è£…supervisor"></a>å®‰è£…supervisor</h3><pre><code>easy_install supervisorecho_supervisord_conf &gt; /path/to/supervisord.confvi /etc/supervisord.conf[program:sentry-web]directory=/home/work/sentry/environment=SENTRY_CONF=/root/.sentry/sentry.conf.pycommand=/home/work/sentry/bin/sentry startautostart=trueautorestart=trueredirect_stderr=truestdout_logfile=syslogstderr_logfile=syslog[program:sentry-worker]directory=/home/work/sentry/environment=SENTRY_CONF=/root/.sentry/sentry.conf.pycommand=/home/work/sentry/bin/sentry celery worker -Bautorestart=trueredirect_stderr=truestdout_logfile=syslogstderr_logfile=syslogvi /etc/nginx/conf.d/sentry.confserver {    listen 80;    server_name sentry.yourhost.com;    location / {        proxy_pass         http://127.0.0.1:9000;        proxy_redirect     off;        proxy_set_header   Host              $host;        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;        proxy_set_header   X-Forwarded-Proto $scheme;    }}supervisord -c /etc/supervisord.confsupervisorctl updatesupervisorctl</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å®‰è£…ä¾èµ–&quot;&gt;&lt;a href=&quot;#å®‰è£…ä¾èµ–&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…ä¾èµ–&quot;&gt;&lt;/a&gt;å®‰è£…ä¾èµ–&lt;/h3&gt;&lt;p&gt;å®‰è£…å‰å…ˆç”¨virtualenvåˆ›å»ºä¸€ä¸ªéš”ç¦»ç¯å¢ƒ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;yum update
yum -y install python-setuptools python-setuptools-devel
yum install libxml2-devel libxslt-devel python-devel -y
yum install gcc libffi-devel openssl-devel -y
yum -y install mysql-server mysql mysql-devel
yum install epel-release -y
pip install MySQL-python
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;å¯åŠ¨mysqlå’Œredis&quot;&gt;&lt;a href=&quot;#å¯åŠ¨mysqlå’Œredis&quot; class=&quot;headerlink&quot; title=&quot;å¯åŠ¨mysqlå’Œredis&quot;&gt;&lt;/a&gt;å¯åŠ¨mysqlå’Œredis&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;sudo service mysqld start
redis-server
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="DevOps" scheme="https://morningchen.com/categories/DevOps/"/>
    
    
      <category term="Sentry" scheme="https://morningchen.com/tags/Sentry/"/>
    
      <category term="Supervisor" scheme="https://morningchen.com/tags/Supervisor/"/>
    
      <category term="Nginx" scheme="https://morningchen.com/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>Two Scoops of Django 1.8 å­¦ä¹ ç¬”è®°äº”</title>
    <link href="https://morningchen.com/2015/09/14/Two-Scoops-of-Django-1-8-notes-5/"/>
    <id>https://morningchen.com/2015/09/14/Two-Scoops-of-Django-1-8-notes-5/</id>
    <published>2015-09-14T15:38:38.000Z</published>
    <updated>2018-09-27T14:12:31.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="9-FBVsæœ€ä½³å®è·µ"><a href="#9-FBVsæœ€ä½³å®è·µ" class="headerlink" title="9. FBVsæœ€ä½³å®è·µ"></a>9. FBVsæœ€ä½³å®è·µ</h2><h3 id="9-1-FBVsçš„ä¼˜åŠ¿"><a href="#9-1-FBVsçš„ä¼˜åŠ¿" class="headerlink" title="9.1 FBVsçš„ä¼˜åŠ¿"></a>9.1 FBVsçš„ä¼˜åŠ¿</h3><p>è™½ç„¶FBVsä¸èƒ½åƒCBVsä¸€æ ·æœ‰ç»§æ‰¿ã€‚ä½†å®ƒç¡®å®æœ‰æ›´æ˜¾è‘—çš„åŠŸèƒ½ä¼˜åŠ¿<br>å†™FBVsçš„æ—¶å€™æˆ‘ä»¬éµå¾ªä»¥ä¸‹æŒ‡å—ï¼š</p><ul><li>è¶Šå°‘ä»£ç è¶Šå¥½</li><li>æœç»é‡å¤çš„ä»£ç </li><li>Viewsåº”è¯¥å¤„ç†æ¼”ç¤ºé€»è¾‘ã€‚å¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œè¯•ç€æŠŠä¸šåŠ¡é€»è¾‘æ”¾åœ¨modelsä¸­æˆ–è€…formsä¸­</li><li>ä¿è¯viewsçš„ç®€æ´</li><li>ç”¨ä»–ä»¬å†™è‡ªå®šä¹‰çš„403ï¼Œ404ï¼Œ500é”™è¯¯å¤„ç†</li><li>ä½¿ç”¨å¤æ‚çš„åµŒå¥—-å¦‚æœè¦é¿å…é˜»å¡çš„è¯</li></ul><h3 id="9-2-ä¼ é€’HttpRequestå¯¹è±¡"><a href="#9-2-ä¼ é€’HttpRequestå¯¹è±¡" class="headerlink" title="9.2 ä¼ é€’HttpRequestå¯¹è±¡"></a>9.2 ä¼ é€’HttpRequestå¯¹è±¡</h3><p>æœ‰äº›æ—¶å€™æˆ‘ä»¬æƒ³åœ¨viewsä¸­é‡ç”¨ä»£ç ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æƒ³ä¸­é—´ä»¶å’Œä¸Šä¸‹æ–‡å¤„ç†å™¨ä¸€æ ·æŠŠå®ƒå’Œå…¨å±€åŠŸèƒ½è”ç³»èµ·æ¥ã€‚<br>åœ¨è¿™æœ¬ä¹¦çš„å¼€å¤´ï¼Œæˆ‘ä»¬å»ºè®®åˆ›å»ºè·¨é¡¹ç›®çš„åŠŸèƒ½å‡½æ•°ã€‚<br>å¯¹äºå¤šæ•°åŠŸèƒ½å‡½æ•°è€Œè¨€ï¼Œæˆ‘ä»¬ä»<code>django.http.HttpRequest</code>å¯¹è±¡ä¸­æ‹¿åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ï¼Œæ¥æ”¶é›†æ•°æ®æˆ–è€…æ‰§è¡Œæ“ä½œã€‚<br>é€šè¿‡æŠŠrequestå¯¹è±¡ä½œä¸ºé¦–è¦å‚æ•°ï¼Œæˆ‘ä»¬èƒ½åœ¨æ›´å¤šçš„æ–¹æ³•ä¸Šæ‹¥æœ‰æ›´ç®€å•çš„å‚æ•°ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åªéœ€è¦ä¼ ä¸€ä¸ªHttpRequestå¯¹è±¡å°±å¯ä»¥äº†<br><a id="more"></a></p><pre><code># sprinkles/utils.pyfrom django.core.exceptions import PermissionDenieddef check_sprinkle_rights(request):    if request.user.can_sprinkle or request.user.is_staff:        return request    # Return a HTTP 403 back to the user    raise PermissionDenied</code></pre><p><code>check_sprinkle_rights()</code>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ£€æŸ¥ç”¨æˆ·çš„æƒé™ï¼ŒæŠ›å‡º<code>django.core.exceptions.PermissionDenied</code>å¼‚å¸¸</p><p>ä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬è¿”å›äº†ä¸€ä¸ªHttpRequestå¯¹è±¡ï¼Œè€Œä¸æ˜¯è¿”å›ä»»æ„çš„å€¼æˆ–è€…è¿”å›Noneã€‚æˆ‘ä»¬è¿™æ ·åšçš„åŸå› æ˜¯ï¼Œpythonä½œä¸ºåŠ¨æ€ç±»å‹çš„è¯­è¨€ï¼Œæˆ‘ä»¬èƒ½ç»™HttpRequeståŠ ä¸Šé¢å¤–çš„å±æ€§ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><pre><code># sprinkles/utils.pyfrom django.core.exceptions import PermissionDenieddef check_sprinkles(request):    if request.user.can_sprinkle or request.user.is_staff:        # By adding this value here it means our display templates        #   can be more generic. We don&apos;t need to have        {% raw %}            #   {% if request.user.can_sprinkle or request.user.is_staff %}            #   instead just using            #   {% if request.can_sprinkle %}            {% endraw %}        request.can_sprinkle = True        return request    # Return a HTTP 403 back to the user    raise PermissionDenied</code></pre><p>è¿˜æœ‰ä¸€ä¸ªåŸå› è¦ç®€å•è¯´ä¸‹ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬çœ‹ä¸‹viewsçš„ä»£ç </p><pre><code># sprinkles/views.pyfrom django.shortcuts import get_object_or_404from django.shortcuts import renderfrom .utils import check_sprinklesfrom .models import Sprinkledef sprinkle_list(request):    &quot;&quot;&quot;Standard list view&quot;&quot;&quot;    request = check_sprinkles(request)    return render(request,        &quot;sprinkles/sprinkle_list.html&quot;,        {&quot;sprinkles&quot;: Sprinkle.objects.all()})def sprinkle_detail(request, pk):    &quot;&quot;&quot;Standard detail view&quot;&quot;&quot;    request = check_sprinkles(request)    sprinkle = get_object_or_404(Sprinkle, pk=pk)    return render(request, &quot;sprinkles/sprinkle_detail.html&quot;,        {&quot;sprinkle&quot;: sprinkle})def sprinkle_preview(request):    &quot;&quot;&quot;&quot;preview of new sprinkle, but without the            check_sprinkles function being used.    &quot;&quot;&quot;    sprinkle = Sprinkle.objects.all()    return render(request,        &quot;sprinkles/sprinkle_preview.html&quot;,        {&quot;sprinkle&quot;: sprinkle})</code></pre><p>è¿™ä¸ªæ–¹æ³•çš„å¦ä¸€ä¸ªç‰¹ç‚¹æ˜¯å¯ä»¥é›†æˆåˆ°CBVsé‡Œï¼š</p><pre><code># sprinkles/views.pyfrom django.views.generic import DetailViewfrom .utils import check_sprinklesfrom .models import Sprinkleclass SprinkleDetail(DetailView):    &quot;&quot;&quot;Standard detail view&quot;&quot;&quot;    model = Sprinkle    def dispatch(self, request, *args, **kwargs):        request = check_sprinkles(request)        return super(SprinkleDetail, self).dispatch(                                request, *args, **kwargs)</code></pre><h3 id="9-3-Decorators-Are-Sweet"><a href="#9-3-Decorators-Are-Sweet" class="headerlink" title="9.3 Decorators Are Sweet"></a>9.3 Decorators Are Sweet</h3><p>åœ¨è®¡ç®—æœºç§‘å­¦çš„è¯´æ³•ä¸­ï¼Œç»™ç¼–ç¨‹è¯­è¨€åŠ ä¸Šè¯­æ³•ç³–çš„åšæ³•æ˜¯ä¸ºäº†è®©äº‹æƒ…æ›´å®¹æ˜“ç†è§£å’Œè¡¨è¾¾ã€‚åœ¨pythonä¸­ï¼Œè£…é¥°å™¨çš„åŠŸèƒ½æ·»åŠ å¯ä»¥è®©äººç±»é˜…è¯»èµ·æ¥æ›´æ¸…æ™°æ›´ç”œç¾ã€‚ ä¸‹é¢æ˜¯è£…é¥°å™¨ç”¨äºFBVsçš„æ ·æ¿ï¼š</p><pre><code># simple decorator templateimport functoolsdef decorator(view_func):    @functools.wraps(view_func)    def new_view_func(request, *args, **kwargs):        # You can modify the request (HttpRequest) object here.        response = view_func(request, *args, **kwargs)        # You can modify the response (HttpResponse) object here.        return response    return new_view_func</code></pre><p>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p><pre><code># sprinkles/decorators.pyfrom functools import wrapsfrom . import utils# based off the decorator template from Example 8.5def check_sprinkles(view_func):    &quot;&quot;&quot;Check if a user can add sprinkles&quot;&quot;&quot;    @wraps(view_func)    def new_view_func(request, *args, **kwargs):        # Act on the request object with utils.can_sprinkle()        request = utils.can_sprinkle(request)        # Call the view function        response = view_func(request, *args, **kwargs)        # Return the HttpResponse object        return response    return new_view_func</code></pre><p>ä¸Šé¢å†™å¥½äº†ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°ã€‚æˆ‘ä»¬æŠŠä»–ç”¨åˆ°viewé‡Œï¼š</p><pre><code># views.pyfrom django.shortcuts import get_object_or_404, renderfrom .decorators import check_sprinklesfrom .models import Sprinkle# Attach the decorator to the view@check_sprinklesdef sprinkle_detail(request, pk):    &quot;&quot;&quot;Standard detail view&quot;&quot;&quot;    sprinkle = get_object_or_404(Sprinkle, pk=pk)    return render(request, &quot;sprinkles/sprinkle_detail.html&quot;,        {&quot;sprinkle&quot;: sprinkle})</code></pre><h4 id="è£…é¥°å™¨çš„æ‰©å±•é˜…è¯»èµ„æ–™"><a href="#è£…é¥°å™¨çš„æ‰©å±•é˜…è¯»èµ„æ–™" class="headerlink" title="è£…é¥°å™¨çš„æ‰©å±•é˜…è¯»èµ„æ–™"></a>è£…é¥°å™¨çš„æ‰©å±•é˜…è¯»èµ„æ–™</h4><ul><li>Decorator Explained<br><a href="http://www.jeffknupp.com/blog/2013/11/29/improve-your-python-decorators-explained/" target="_blank" rel="noopener">http://www.jeffknupp.com/blog/2013/11/29/improve-your-python-decorators-explained/</a></li><li>Decorator and Functional Python<br><a href="http://www.brianholdefehr.com/decorators-and-functional-python" target="_blank" rel="noopener">http://www.brianholdefehr.com/decorators-and-functional-python</a></li><li>Decorator Cheat Sheet by author Daniel Roy Greenfeld<br><a href="http://www.pydanny.com/python-decorator-cheatsheet.html" target="_blank" rel="noopener">http://www.pydanny.com/python-decorator-cheatsheet.html</a></li><li>æœ¬ä¹¦çš„é™„å½•C</li></ul><h3 id="9-4-ä¼ é€’HttpResponseå¯¹è±¡"><a href="#9-4-ä¼ é€’HttpResponseå¯¹è±¡" class="headerlink" title="9.4 ä¼ é€’HttpResponseå¯¹è±¡"></a>9.4 ä¼ é€’HttpResponseå¯¹è±¡</h3><p>å°±åƒç”¨HttpRequestå¯¹è±¡ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å‡½æ•°ä¹‹é—´ä¼ é€’HttpResponseå¯¹è±¡ã€‚<br>ä¸€ä¸ªå¯ä¾›é€‰æ‹©çš„<code>Middleware.process_request()</code>çš„æ–¹æ³•ã€‚</p><ul><li><a href="https://docs.djangoproject.com/en/1.8/topics/http/middleware/#process-response" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/topics/http/middleware/#process-response</a></li></ul><h2 id="10-CBVsæœ€ä½³å®è·µ"><a href="#10-CBVsæœ€ä½³å®è·µ" class="headerlink" title="10. CBVsæœ€ä½³å®è·µ"></a>10. CBVsæœ€ä½³å®è·µ</h2><p>Djangoæä¾›äº†ä¸€ä¸ªæ ‡å‡†æ–¹å¼æ¥å†™CBVsã€‚äº‹å®ä¸Šï¼Œåœ¨å‰é¢ç« èŠ‚æåˆ°è¿‡ï¼Œdjangoçš„è§†å›¾äº‹å®ä¸Šå°±æ˜¯ä¸€ä¸ªè°ƒç”¨ï¼Œ ä»–æ¥å—ä¸€ä¸ªè¯·æ±‚å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªå“åº”å¯¹è±¡ã€‚å¯¹äºFBVsæ¥è¯´ï¼Œè¿™ä¸ªè°ƒç”¨å°±æ˜¯è§†å›¾å‡½æ•°ï¼›å¯¹äºCBVsæ¥è¯´ï¼Œ å®ƒæä¾›äº†ä¸€ä¸ª<code>as_view()</code>çš„ç±»æ–¹æ³•æ¥è¿”å›è¿™ä¸ªè°ƒç”¨ã€‚è¿™ä¸ªæœºåˆ¶æ˜¯åœ¨<code>django.views.generic.View</code>ä¸­å®ç°çš„ã€‚ æ‰€æœ‰çš„CBVséƒ½åº”è¯¥ç›´æ¥æˆ–è€…é—´æ¥çš„ç»§æ‰¿è¿™ä¸ªç±»ã€‚<br>Django ä¹Ÿæä¾›äº†ä¸€ç³»åˆ—çš„é€šç”¨ç±»è§†å›¾(generic class-based views, GCBVs)ï¼Œå®ƒèƒ½å®ç°åœ¨å¤§å¤šæ•°webé¡¹ç›®ä¸­å®ç°é€šç”¨çš„æ¨¡å¼ã€‚</p><h3 id="10-1-CBVsæŒ‡å—"><a href="#10-1-CBVsæŒ‡å—" class="headerlink" title="10.1 CBVsæŒ‡å—"></a>10.1 CBVsæŒ‡å—</h3><ul><li>è¶Šå°‘ä»£ç è¶Šå¥½</li><li>æœç»é‡å¤çš„ä»£ç </li><li>Viewsåº”è¯¥å¤„ç†æ¼”ç¤ºé€»è¾‘ã€‚å¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œè¯•ç€æŠŠä¸šåŠ¡é€»è¾‘æ”¾åœ¨modelsä¸­æˆ–è€…formsä¸­</li><li>ä¿è¯viewsçš„ç®€æ´</li><li>ä¸è¦ç”¨CBVså†™è‡ªå®šä¹‰çš„403,404,500é”™è¯¯å¤„ç†ç¨‹åºã€‚ç”¨FBVsä»£æ›¿</li><li>æ›´ç®€æ´çš„ mixins</li></ul><h3 id="10-2-Using-Mixins-With-CBVs"><a href="#10-2-Using-Mixins-With-CBVs" class="headerlink" title="10.2 Using Mixins With CBVs"></a>10.2 Using Mixins With CBVs</h3><p>ç¼–ç¨‹ä¸­ï¼Œmixinæ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒæä¾›ä¸€äº›åŠŸèƒ½æ¥è¢«ç»§æ‰¿ï¼Œä½†å¹¶ä¸æ„å‘³ç€å®ƒèƒ½å®ä¾‹åŒ–è‡ªå·±ã€‚ Mixinsèƒ½å¢åŠ ç±»çš„åŠŸèƒ½å’Œè¡¨ç°ã€‚<br>æˆ‘ä»¬èƒ½ä½¿ç”¨mixinsçš„åŠŸèƒ½æ¥ç»™æˆ‘ä»¬çš„appsæ„å»ºè‡ªå·±çš„view classesã€‚é‚£ä¹ˆæ˜¯æŒ‰ç…§ä»€ä¹ˆé¡ºåºç»§æ‰¿çš„å‘¢ï¼Ÿ å®ƒéµå¾ªpythonçš„æ–¹æ³•è§£æé¡ºåº(method resolution order)ï¼Œæœ€ç®€å•çš„å®šä¹‰æ˜¯ï¼ŒæŒ‰ç…§ä¸‹åˆ—è§„åˆ™ä»å·¦åˆ°å³ä¾æ¬¡æ‰§è¡Œï¼š</p><ol><li>djangoæœ¬èº«æä¾›çš„base view classesæ€»æ˜¯åœ¨å³è¾¹</li><li>Mixinsåœ¨base viewçš„å·¦è¾¹</li><li>Mixinsåº”è¯¥ç»§æ‰¿è‡ªpythonçš„å†…å»ºobject</li></ol><pre><code>from django.views.generic import TemplateViewclass FreshFruitMixin(object):    def get_context_data(self, **kwargs):        context = super(FreshFruitMixin,                    self).get_context_data(**kwargs)        context[&quot;has_fresh_fruit&quot;] = True        return contextclass FruityFlavorView(FreshFruitMixin, TemplateView):    template_name = &quot;fruity_flavor.html&quot;</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒFruityFlavorViewç»§æ‰¿è‡ª FreshFruitMixinå’Œ TemplateViewï¼Œ<br>å› ä¸º TemplateViewæ˜¯Djangoæä¾›çš„base view classï¼Œå› æ­¤å®ƒåœ¨æœ€å³è¾¹(è§„åˆ™1)ï¼Œ<br>å®ƒå·¦è¾¹æ˜¯ FreshFruitMixin(è§„åˆ™2)ã€‚æœ€å FreshFruitMixinç»§æ‰¿è‡ªobject(è§„åˆ™3)</p><h3 id="10-3-å“ªç§ä»»åŠ¡ç”¨å“ªä¸ªGCBV"><a href="#10-3-å“ªç§ä»»åŠ¡ç”¨å“ªä¸ªGCBV" class="headerlink" title="10.3 å“ªç§ä»»åŠ¡ç”¨å“ªä¸ªGCBV?"></a>10.3 å“ªç§ä»»åŠ¡ç”¨å“ªä¸ªGCBV?</h3><table><thead><tr><th>åç§°</th><th>ç”¨é€”</th><th>Two Scoops çš„ä¾‹å­</th></tr></thead><tbody><tr><td>View</td><td>èƒ½ä½¿ç”¨åœ¨ä»»ä½•åœ°æ–¹</td><td>çœ‹10.6èŠ‚</td></tr><tr><td>RedirectView</td><td>é‡å®šå‘åˆ°å…¶ä»–çš„URL</td><td>å°†ç”¨æˆ·ä»â€™/log-in/â€˜é¡µé¢å¸¦åˆ°â€™/login/â€˜é¡µé¢</td></tr><tr><td>TemplateView</td><td>å‘ˆç°ä¸€ä¸ªHTMLæ¨¡æ¿</td><td>â€˜/about/â€˜é¡µé¢</td></tr><tr><td>ListView</td><td>åˆ—å‡ºä¸€ç³»åˆ—å¯¹è±¡</td><td>å„ç§å†°æ·‡æ·‹å£å‘³çš„åˆ—è¡¨</td></tr><tr><td>DetailView</td><td>å‘ˆç°ä¸€ä¸ªå¯¹è±¡</td><td>å†°æ·‡æ·‹å£å‘³çš„è¯¦æƒ…</td></tr><tr><td>FormView</td><td>æäº¤ä¸€ä¸ªè¡¨å•</td><td>ç«™ç‚¹çš„è”ç³»æˆ–è€…emailè¡¨å•</td></tr><tr><td>CreateView</td><td>åˆ›å»ºä¸€ä¸ªå¯¹è±¡</td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„å†°æ·‡æ·‹å£å‘³</td></tr><tr><td>UpdateView</td><td>æ›´æ–°ä¸€ä¸ªå¯¹è±¡</td><td>æ›´æ–°ä¸€ä¸ªå·²å­˜åœ¨çš„å†°æ·‡æ·‹å£å‘³</td></tr><tr><td>DeleteView</td><td>åˆ é™¤ä¸€ä¸ªå¯¹è±¡</td><td>åˆ é™¤ä¸€ä¸ªä¸å¥½åƒçš„å†°æ·‡æ·‹å£å‘³ï¼Œæ¯”å¦‚è¯´é¦™è‰ç‰›æ’å‘³</td></tr><tr><td>Generic date views</td><td>ç”¨äºä¸€æ®µæ—¶é—´å†…çš„å¯¹è±¡å±•ç¤º</td><td>åˆ›å»ºä¸€ä¸ªå…¬å…±çš„å†å²è®°å½•ï¼Œå®ƒèƒ½æ˜¾ç¤ºå†°æ·‡æ·‹å£å‘³æ˜¯ä»€ä¹ˆæ—¶å€™æ·»åŠ åˆ°æ•°æ®åº“çš„</td></tr></tbody></table><h3 id="10-4-CBVsçš„å¸¸è§„tips"><a href="#10-4-CBVsçš„å¸¸è§„tips" class="headerlink" title="10.4 CBVsçš„å¸¸è§„tips"></a>10.4 CBVsçš„å¸¸è§„tips</h3><p>è¿™ä¸€ç« æ¶µç›–äº†å¤§å¤šæ•°CBV å’ŒGCBVå®ç°çš„æœ‰ç”¨çš„æŠ€å·§ã€‚</p><h4 id="10-4-1-é€šè¿‡èº«ä»½è®¤è¯åˆ¶çº¦ç”¨æˆ·è®¿é—®CBV-GCBV"><a href="#10-4-1-é€šè¿‡èº«ä»½è®¤è¯åˆ¶çº¦ç”¨æˆ·è®¿é—®CBV-GCBV" class="headerlink" title="10.4.1 é€šè¿‡èº«ä»½è®¤è¯åˆ¶çº¦ç”¨æˆ·è®¿é—®CBV/GCBV"></a>10.4.1 é€šè¿‡èº«ä»½è®¤è¯åˆ¶çº¦ç”¨æˆ·è®¿é—®CBV/GCBV</h4><p>Djangoçš„CBVæ–‡æ¡£ç»™å‡ºäº†ä¸€ä¸ªæœ‰ç”¨çš„ä¾‹å­ï¼Œä½¿ç”¨<code>django.contrib.auth.decorators.login_required</code>è£…é¥°å™¨ã€‚<br><a href="https://docs.djangoproject.com/en/1.8/topics/class-based-views/intro/#decorating-class-based-views" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/topics/class-based-views/intro/#decorating-class-based-views</a></p><p>å¹¸è¿çš„æ˜¯ï¼Œdjangoç¬¬ä¸‰æ–¹app <a href="https://github.com/brack3t/django-braces" target="_blank" rel="noopener">django-braces</a>æä¾›äº†ä¸€ä¸ª<code>LogubRequireMixin</code>å®ç°æ–¹å¼ã€‚</p><pre><code># flavors/views.pyfrom django.views.generic import DetailViewfrom braces.views import LoginRequiredMixinfrom .models import Flavorclass FlavorDetailView(LoginRequiredMixin, DetailView):    model = Flavor</code></pre><p>åˆ«å¿˜äº†Mixiné¡ºåºï¼š</p><ul><li>LoginRequiredMixin ä¸€å®šæ˜¯åœ¨æœ€å·¦è¾¹</li><li>Base view class ä¸€å®šå®åœ¨æœ€å³è¾¹</li></ul><p>å¦‚æœæ‰“ä¹±äº†é¡ºåºï¼Œå°†ä¼šå¾—åˆ°ä¸å¯é¢„æµ‹çš„ç»“æœ</p><h4 id="10-4-2-åœ¨æ•°æ®æœ‰æ•ˆçš„è¡¨å•ä¸Šæ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ"><a href="#10-4-2-åœ¨æ•°æ®æœ‰æ•ˆçš„è¡¨å•ä¸Šæ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ" class="headerlink" title="10.4.2 åœ¨æ•°æ®æœ‰æ•ˆçš„è¡¨å•ä¸Šæ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ"></a>10.4.2 åœ¨æ•°æ®æœ‰æ•ˆçš„è¡¨å•ä¸Šæ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ</h4><pre><code>from django.views.generic import CreateViewfrom braces.views import LoginRequiredMixinfrom .models import Flavorclass FlavorCreateView(LoginRequiredMixin, CreateView):    model = Flavor    fields = (&apos;title&apos;, &apos;slug&apos;, &apos;scoops_remaining&apos;)    def form_valid(self, form):        # Do custom logic here        return super(FlavorCreateView, self).form_valid(form)</code></pre><p>ä¸ºäº†åœ¨å·²éªŒè¯æœ‰æ•ˆçš„è¡¨å•æ•°æ®ä¸Šæ‰§è¡Œè‡ªå®šä¹‰çš„é€»è¾‘ï¼Œç®€å•çš„åŠ ä¸Š<code>form_valid()</code>é€»è¾‘å°±å¥½äº†ã€‚<br><code>form_valid()</code>çš„è¿”å›å€¼åº”è¯¥æ˜¯ä¸ª<code>django.http.HttpResponseRedirect</code></p><h4 id="10-4-3-åœ¨æ•°æ®æ— æ•ˆçš„è¡¨å•ä¸Šæ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ"><a href="#10-4-3-åœ¨æ•°æ®æ— æ•ˆçš„è¡¨å•ä¸Šæ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ" class="headerlink" title="10.4.3 åœ¨æ•°æ®æ— æ•ˆçš„è¡¨å•ä¸Šæ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ"></a>10.4.3 åœ¨æ•°æ®æ— æ•ˆçš„è¡¨å•ä¸Šæ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ</h4><p>è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª<code>django.http.HttpResponse</code></p><pre><code>from django.views.generic import CreateViewfrom braces.views import LoginRequiredMixinfrom .models import Flavorclass FlavorCreateView(LoginRequiredMixin, CreateView):    model = Flavor    def form_invalid(self, form):        # Do custom logic here        return super(FlavorCreateView, self).form_invalid(form)</code></pre><h4 id="10-4-4-ä½¿ç”¨viewå¯¹è±¡"><a href="#10-4-4-ä½¿ç”¨viewå¯¹è±¡" class="headerlink" title="10.4.4 ä½¿ç”¨viewå¯¹è±¡"></a>10.4.4 ä½¿ç”¨viewå¯¹è±¡</h4><p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨CBVsæ¥æ¸²æŸ“å†…å®¹ï¼Œè€ƒè™‘ä¸‹ä½¿ç”¨viewå¯¹è±¡å®ƒè‡ªå·±æ¥æä¾›è®¿é—®å±æ€§å’Œæ–¹æ³•ï¼Œ<br>è¿™æ ·å°±å¯ä»¥è¢«å…¶ä»–å±æ€§å’Œæ–¹æ³•è°ƒç”¨ã€‚å®ƒä»¬ä¹Ÿå¯ä»¥åœ¨æ¨¡æ¿ä¸­è¢«è°ƒç”¨ï¼Œä¾‹å­ï¼š</p><pre><code>from django.utils.functional import cached_propertyfrom django.views.generic import UpdateView, TemplateViewfrom braces.views import LoginRequiredMixinfrom .models import Flavorfrom .tasks import update_users_who_favoritedclass FavoriteMixin(object):    @cached_property    def likes_and_favorites(self):        &quot;&quot;&quot;Returns a dictionary of likes and favorites&quot;&quot;&quot;        likes = self.object.likes()        favorites = self.object.favorites()        return {            &quot;likes&quot;: likes,            &quot;favorites&quot;: favorites,            &quot;favorites_count&quot;: favorites.count(),        }class FlavorUpdateView(LoginRequiredMixin, FavoriteMixin, UpdateView):    model = Flavor    fields = (&apos;title&apos;, &apos;slug&apos;, &apos;scoops_remaining&apos;)    def form_valid(self, form):        update_users_who_favorited(            instance=self.object,            favorites=self.likes_and_favorites[&apos;favorites&apos;]        )        return super(FlavorCreateView, self).form_valid(form)class FlavorDetailView(LoginRequiredMixin, FavoriteMixin, TemplateView):    model = Flavor</code></pre><p>è¿™ä¸ªflavors appæ¨¡æ¿èƒ½è®¿é—®è¿™ä¸ªå±æ€§äº†ï¼š</p><pre><code>{% raw %}    {# flavors/base.html #}    {% extends "base.html" %}    {% block likes_and_favorites %}    {% endraw %}&lt;ul&gt;  &lt;li&gt;Likes: {% raw %}{{ view.likes_and_favorites.likes }}{% endraw %}&lt;/li&gt;  &lt;li&gt;Favorites: {% raw %}{{ view.likes_and_favorites.favorites_count }}{% endraw %}&lt;/li&gt;&lt;/ul&gt;{% raw %}    {% endblock likes_and_favorites %}    {% endraw %}</code></pre><h3 id="10-5-GCBVså’Œè¡¨å•æ˜¯å¦‚ä½•å…¼å®¹çš„"><a href="#10-5-GCBVså’Œè¡¨å•æ˜¯å¦‚ä½•å…¼å®¹çš„" class="headerlink" title="10.5 GCBVså’Œè¡¨å•æ˜¯å¦‚ä½•å…¼å®¹çš„"></a>10.5 GCBVså’Œè¡¨å•æ˜¯å¦‚ä½•å…¼å®¹çš„</h3><p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªflavor modelç”¨åœ¨è¿™ä¸€ç« çš„viewä¸­ï¼š</p><pre><code># flavors/models.pyfrom django.core.urlresolvers import reversefrom django.db import modelsSTATUS = (    (0, &quot;zero&quot;),    (1, &quot;one&quot;),)class Flavor(models.Model):    title = models.CharField(max_length=255)    slug = models.SlugField(unique=True)    scoops_remaining = models.IntegerField(default=0, choices=STATUS)    def get_absolute_url(self):        return reverse(&quot;flavors:detail&quot;, kwargs={&quot;slug&quot;: self.slug})</code></pre><p>ç°åœ¨æˆ‘ä»¬æ¥æ¢è®¨ä¸€äº›æ™®éçš„è¡¨å•åœºæ™¯</p><h4 id="10-5-1-Views-ModelFormçš„ä¾‹å­"><a href="#10-5-1-Views-ModelFormçš„ä¾‹å­" class="headerlink" title="10.5.1 Views + ModelFormçš„ä¾‹å­"></a>10.5.1 Views + ModelFormçš„ä¾‹å­</h4><p>è¿™æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€æ™®éçš„è¡¨å•åœºæ™¯ã€‚é€šå¸¸å½“ä½ åˆ›å»ºä¸€ä¸ªmodelæ—¶ï¼Œä½ å¯èƒ½æƒ³å¢åŠ ä¸€ä¸ªæ–°çš„è®°å½•æˆ–è€…<br>æ›´æ–°å·²å­˜åœ¨çš„è®°å½•ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼šçŸ¥é“å¦‚ä½•æ„é€ ä¸€ç³»åˆ—çš„viewsï¼Œè¿™äº›viewå¯ä»¥åˆ›å»ºã€ä¿®æ”¹ã€å±•ç¤ºflavorè®°å½•ã€‚<br>æˆ‘ä»¬ä¹Ÿä¼šæ¼”ç¤ºå¦‚ä½•æä¾›ç¡®è®¤å˜æ›´ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬éœ€è¦çš„views:</p><ol><li>FlavorCreateView å¯¹åº”åœ¨ä¸€ä¸ªè¡¨å•ä¸­æ·»åŠ æ–°å£å‘³</li><li>FlavorUpdateView å¯¹åº”åœ¨ä¸€ä¸ªè¡¨å•ä¸­ç¼–è¾‘å£å‘³</li><li>FlavorDetailView å¯¹åº”ç”¨äºé£å‘³åˆ›ä½œå’Œé£å‘³æ›´æ–°çš„ç¡®è®¤é¡µé¢</li></ol><p><img src="view+modelform_flow.png" alt="views+modelform_flow"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬è¦å°½å¯èƒ½çš„ç´§æ‰£Djangoçš„å‘½åçº¦å®šã€‚è¿™ä¸‰ä¸ªviewåˆ†åˆ«æ˜¯Djangoä¸­CreateView, UpdateViewå’ŒDetailViewçš„å­ç±»ã€‚<br>å¾ˆå®¹æ˜“å°±èƒ½å†™å‡ºè¿™äº›viewsï¼Œå› ä¸ºDjangoç»™æˆ‘ä»¬æä¾›äº†å¤§éƒ¨åˆ†çš„ç”¨æ³•ï¼š</p><pre><code># flavors/views.pyfrom django.views.generic import CreateView, UpdateView, DetailViewfrom braces.views import LoginRequiredMixinfrom .models import Flavorclass FlavorCreateView(LoginRequiredMixin, CreateView):    model = Flavor    fields = (&apos;title&apos;, &apos;slug&apos;, &apos;scoops_remaining&apos;)class FlavorUpdateView(LoginRequiredMixin, UpdateView):    model = Flavor    fields = (&apos;title&apos;, &apos;slug&apos;, &apos;scoops_remaining&apos;)class FlavorDetailView(DetailView):    model = Flavor</code></pre><p>ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬å†™å‡ºè¿™äº›viewçš„urls.pyå’Œå¿…è¦çš„æ¨¡æ¿æ—¶ï¼Œä¼šå‘ç°è¿™ä¸ªé—®é¢˜ï¼š</p><ul><li>è¿™ä¸ªFlavorDetailView ä¸æ˜¯ä¸€ä¸ªç¡®è®¤é¡µé¢</li></ul><p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬åªéœ€è¦å°å°çš„ä¿®æ”¹ä¸€ä¸‹å°±å¥½äº†ã€‚</p><p>ä¿®æ”¹çš„ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨<code>django.contrib.messages</code>æ¥å‘ŠçŸ¥ç”¨æˆ·åªéœ€è¦å¢åŠ æˆ–è€…ä¿®æ”¹è¿™ä¸ªfalvoræ¥è®¿é—®FlavorDetailViewã€‚<br>æˆ‘ä»¬éœ€è¦é‡å†™<code>FlavorCreateView.form_valid()</code>å’Œ<code>FlavorUpdateView.form_valid()</code>æ–¹æ³•ã€‚<br>åªéœ€è¦ç»™è¿™ä¸¤ä¸ªviewsåŠ ä¸Š<code>FlavorActionMixin</code>å°±å¯ä»¥äº†ï¼Œç®€ç›´æ–¹ä¾¿å¾—ä¸è¡Œã€‚</p><pre><code># flavors/views.pyfrom django.contrib import messagesfrom django.views.generic import CreateView, UpdateView, DetailViewfrom braces.views import LoginRequiredMixinfrom .models import Flavorclass FlavorActionMixin(object):    fields = (&apos;title&apos;, &apos;slug&apos;, &apos;scoops_remaining&apos;)    @property    def success_msg(self):        return NotImplemented    def form_valid(self, form):        messages.info(self.request, self.success_msg)        return super(FlavorActionMixin, self).form_valid(form)class FlavorCreateView(LoginRequiredMixin, FlavorActionMixin,                        CreateView):    model = Flavor    success_msg = &quot;Flavor created!&quot;class FlavorUpdateView(LoginRequiredMixin, FlavorActionMixin,                        UpdateView):    model = Flavor    success_msg = &quot;Flavor updated!&quot;class FlavorDetailView(DetailView):    model = Flavor</code></pre><p>åœ¨æœ¬ç« ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸¾äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚ä½•åœ¨GCBVä¸­è¦†å†™<code>form_valid()</code>ã€‚<br>è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ç»™å¤šä¸ªviewsåˆ›å»ºä¸€ä¸ªmixinç»§æ‰¿çš„æ–¹å¼æ¥å¤ç”¨<code>form_valid()</code>ã€‚</p><p>ç°åœ¨æˆ‘ä»¬ä½¿ç”¨djangoçš„æ¶ˆæ¯æ¡†æ¶æ¥ç»™ç”¨æˆ·å±•ç¤ºç¡®è®¤æ¶ˆæ¯ã€‚<code>FlavorActionMixin</code>çš„ä½œç”¨æ˜¯æ ¹æ®ç”¨æˆ·åŠ¨ä½œçš„æ‰§è¡Œæ¥æ’åˆ—ä¸€ä¸ªç¡®è®¤æ¶ˆæ¯ï¼Œ</p><p>flavorè¢«æ·»åŠ æˆ–ä¿®æ”¹åï¼Œä¸€ä¸ªæ¶ˆæ¯åˆ—è¡¨è¢«ä¼ é€’åˆ°äº†<code>FlavorDetailView</code>çš„ä¸Šä¸‹æ–‡ã€‚<br>æˆ‘ä»¬ç»™viewçš„æ¨¡æ¿åŠ ä¸Šä¸‹é¢çš„ä»£ç ï¼Œå†åˆ›å»ºæˆ–è€…ä¿®æ”¹flavorå°±èƒ½çœ‹åˆ°è¿™äº›æ¶ˆæ¯ï¼š</p><pre><code>{% raw %}    {# templates/flavors/flavor_detail.html #}    {% if messages %}    {% endraw %}    &lt;ul class=&quot;messages&quot;&gt;{% raw %}            {% for message in messages %}    {% endraw %}        &lt;li id=&quot;{% raw %}message_{{ forloop.counter }}{% endraw %}&quot;            {% raw %}                {% if message.tags %} class="{{ message.tags }}"                    {% endif %}>                {{ message }}                {% endraw %}        &lt;/li&gt;{% raw %}            {% endfor %}    {% endraw %}    &lt;/ul&gt;{% raw %}    {% endif %}    {% endraw %}</code></pre><p>å›é¡¾ä¸‹ï¼Œè¿™ä¸ªä¾‹å­å†æ¬¡æ¼”ç¤ºäº†å¦‚ä½•è¦†å†™<code>form_valid</code>æ–¹æ³•ï¼Œåˆå¹¶åˆ°mixinä¸­ï¼Œ<br>å¦‚ä½•åˆå¹¶å¤šä¸ªmixinsåˆ°ä¸€ä¸ªviewï¼Œå¹¶ä¸”ç»™å‡ºäº†éå¸¸æœ‰ç”¨çš„<code>django.contrib.messages</code>æ¡†æ¶çš„å¿«é€Ÿä»‹ç»</p><h4 id="10-5-2-Views-Formçš„ä¾‹å­"><a href="#10-5-2-Views-Formçš„ä¾‹å­" class="headerlink" title="10.5.2 Views + Formçš„ä¾‹å­"></a>10.5.2 Views + Formçš„ä¾‹å­</h4><p>å¯¹äºModelFormæœ‰æ—¶å€™ä½ æ›´æƒ³ä½¿ç”¨Formï¼Œæœç´¢è¡¨å•æ˜¯ä¸€ä¸ªç‰¹åˆ«å¥½çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œä½ å¯èƒ½è¿˜ä¼šç¢°ä¸Šå…¶ä»–çš„çœŸå®åœºæ™¯ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„flavoræœç´¢è¡¨å•ã€‚å®ƒä¸ä¼šæ”¹å˜ä»»ä½•flavoræ•°æ®ã€‚<br>åªä¼šæŸ¥è¯¢ORMï¼Œç„¶ååœ¨æœç´¢ç»“æœé¡µé¢æŠŠæ•°æ®å±•ç¤ºå‡ºæ¥ã€‚</p><p>æœ‰å¾ˆå¤šå¤æ‚çš„æ–¹æ³•å¯ä»¥å®ç°ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬è¿™ä¸ªç®€å•çš„ä¾‹å­ï¼Œåªéœ€è¦åŠ ä¸Šä¸€ä¸ªviewå°±è¶³å¤Ÿã€‚<br>æˆ‘ä»¬æŠŠ<code>FlavorListView</code>ç”¨ä½œæœç´¢é¡µé¢å’Œæœç´¢ç»“æœé¡µé¢ã€‚</p><p>è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¼šæŠŠ<code>q</code>ç”¨ä½œæŸ¥è¯¢å‚æ•°ï¼Œå€¾å‘äºä½¿ç”¨<code>GET</code>è¯·æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ¶‰åŠåˆ°æ·»åŠ ï¼Œä¿®æ”¹ï¼Œåˆ é™¤å¯¹è±¡çš„æ“ä½œï¼Œå› æ­¤ä¸å¿…ä½¿ç”¨<code>POST</code>è¯·æ±‚ã€‚</p><p>ä¸ºäº†è¿”å›åŒ¹é…çš„æœç´¢ç»“æœï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹æ ‡å‡†æŸ¥è¯¢é›†(queryset)ã€‚æˆ‘ä»¬åœ¨<code>flavor/view.py</code>ä¸­æ·»åŠ ä¸‹é¢ä»£ç ï¼š</p><pre><code>from django.views.generic import ListViewfrom .models import Flavorclass FlavorListView(ListView):    model = Flavor    def get_queryset(self):        # Fetch the queryset from the parent get_queryset        queryset = super(FlavorListView, self).get_queryset()        # Get the q GET parameter        q = self.request.GET.get(&quot;q&quot;)        if q:            # Return a filtered queryset            return queryset.filter(title__icontains=q)        # Return the base queryset        return queryset</code></pre><p>æœç´¢è¡¨å•åº”è¯¥çœ‹èµ·æ¥å’Œä¸‹é¢å·®ä¸å¤šï¼š</p><pre><code>{% raw %}    {# templates/flavors/_flavor_search.html #}    {% comment %}        Usage: {% include "flavors/_flavor_search.html" %}    {% endcomment %}    {% endraw %}&lt;form action=&quot;{% raw %}{% url "flavor_list" %}{% endraw %}&quot; method=&quot;GET&quot;&gt;    &lt;input type=&quot;text&quot; name=&quot;q&quot; /&gt;    &lt;button type=&quot;submit&quot;&gt;search&lt;/button&gt;&lt;/form&gt;</code></pre><h3 id="10-6-åªä½¿ç”¨django-views-generic-View"><a href="#10-6-åªä½¿ç”¨django-views-generic-View" class="headerlink" title="10.6 åªä½¿ç”¨django.views.generic.View"></a>10.6 åªä½¿ç”¨django.views.generic.View</h3><p>åªåœ¨é¡¹ç›®ä¸­ä½¿ç”¨<code>django.views.generic.View</code>ä¹Ÿæ˜¯å®Œå…¨å¯èƒ½çš„ã€‚å®ƒæ²¡æœ‰æˆ‘ä»¬æƒ³è±¡å¾—é‚£ä¹ˆæç«¯ã€‚</p><p>å¦‚æœç”¨FBVsæ¥å†™çš„è¯ï¼Œéœ€è¦å¤šä¸ªifåµŒå¥—HTTPæ–¹æ³•ï¼Œ<code>if request.method == ...</code>ã€‚<br>ä½†æ˜¯æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼æ¥å†™çš„è¯ï¼Œå¼€å‘è€…ç†è§£èµ·æ¥æ¯«æ— å›°éš¾ï¼š</p><pre><code>from django.shortcuts import get_object_or_404from django.shortcuts import render, redirectfrom django.views.generic import Viewfrom braces.views import LoginRequiredMixinfrom .forms import FlavorFormfrom .models import Flavorclass FlavorView(LoginRequiredMixin, View):    def get(self, request, *args, **kwargs):        # Handles display of the Flavor object        flavor = get_object_or_404(Flavor, slug=kwargs[&apos;slug&apos;])        return render(request,            &quot;flavors/flavor_detail.html&quot;,                {&quot;flavor&quot;: flavor}            )    def post(self, request, *args, **kwargs):        # Handles updates of the Flavor object        flavor = get_object_or_404(Flavor, slug=kwargs[&apos;slug&apos;])        form = FlavorForm(request.POST)        if form.is_valid():            form.save()        return redirect(&quot;flavors:detail&quot;, flavor.slug)</code></pre><p>æˆ‘ä»¬å‘ç°åœ¨é¡¹ç›®ä¸­ä½¿ç”¨<code>django.views.generic.View</code>ç±»ï¼Œç”¨GETæ–¹æ³•æ¥å±•ç°JSON,PDFæˆ–è€…å…¶ä»–éHTMLå†…å®¹æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚<br>æˆ‘ä»¬ç”¨æ¥åœ¨FBVsä¸­æ¸²æŸ“CSV, Excel, PDFæ–‡ä»¶çš„æŠ€å·§åœ¨CBVsä¸­ä¹Ÿå¯ä»¥å®ç°ã€‚</p><pre><code>from django.http import HttpResponsefrom django.shortcuts import get_object_or_404from django.views.generic import Viewfrom braces.views import LoginRequiredMixinfrom .models import Flavorfrom .reports import make_flavor_pdfclass PDFFlavorView(LoginRequiredMixin, View):    def get(self, request, *args, **kwargs):        # Get the flavor        flavor = get_object_or_404(Flavor, slug=kwargs[&apos;slug&apos;])        # create the response        response = HttpResponse(content_type=&apos;application/pdf&apos;)        # generate the PDF stream and attach to the response        response = make_flavor_pdf(response, flavor)        return response</code></pre><p>è¿™ä¸ªä¾‹å­ç›¸å½“ç›´æ¥ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦æ›´å¤šçš„mixinsï¼Œå¤„ç†æ›´å¤šçš„è‡ªå®šä¹‰é€»è¾‘çš„è¯ï¼Œç›¸æ¯”å…¶ä»–åšé‡çš„viewsï¼Œ<code>django.views.generic</code>çš„ç®€æ´æ€§èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å®¹æ˜“çš„å¤„ç†ã€‚</p><h3 id="10-7-æ›´å¤šèµ„æº"><a href="#10-7-æ›´å¤šèµ„æº" class="headerlink" title="10.7 æ›´å¤šèµ„æº"></a>10.7 æ›´å¤šèµ„æº</h3><ul><li><a href="https://docs.djangoproject.com/en/1.8/topics/class-based-views/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/topics/class-based-views/</a></li><li><a href="https://docs.djangoproject.com/en/1.8/topics/class-based-views/generic-display/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/topics/class-based-views/generic-display/</a></li><li><a href="https://docs.djangoproject.com/en/1.8/topics/class-based-views/generic-editing/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/topics/class-based-views/generic-editing/</a></li><li><a href="https://docs.djangoproject.com/en/1.8/topics/class-based-views/mixins/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/topics/class-based-views/mixins/</a></li><li><a href="https://docs.djangoproject.com/en/1.8/ref/class-based-views/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/ref/class-based-views/</a></li><li><a href="http://ccbv.co.uk/" target="_blank" rel="noopener">http://ccbv.co.uk/</a></li><li><a href="http://www.pydanny.com/tag/class-based-views.html" target="_blank" rel="noopener">http://www.pydanny.com/tag/class-based-views.html</a></li></ul><p>å…¶ä»–æœ‰ç”¨çš„CBVåº“</p><ul><li>django-extra-views</li><li>django-vanilla-views</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;9-FBVsæœ€ä½³å®è·µ&quot;&gt;&lt;a href=&quot;#9-FBVsæœ€ä½³å®è·µ&quot; class=&quot;headerlink&quot; title=&quot;9. FBVsæœ€ä½³å®è·µ&quot;&gt;&lt;/a&gt;9. FBVsæœ€ä½³å®è·µ&lt;/h2&gt;&lt;h3 id=&quot;9-1-FBVsçš„ä¼˜åŠ¿&quot;&gt;&lt;a href=&quot;#9-1-FBVsçš„ä¼˜åŠ¿&quot; class=&quot;headerlink&quot; title=&quot;9.1 FBVsçš„ä¼˜åŠ¿&quot;&gt;&lt;/a&gt;9.1 FBVsçš„ä¼˜åŠ¿&lt;/h3&gt;&lt;p&gt;è™½ç„¶FBVsä¸èƒ½åƒCBVsä¸€æ ·æœ‰ç»§æ‰¿ã€‚ä½†å®ƒç¡®å®æœ‰æ›´æ˜¾è‘—çš„åŠŸèƒ½ä¼˜åŠ¿&lt;br&gt;å†™FBVsçš„æ—¶å€™æˆ‘ä»¬éµå¾ªä»¥ä¸‹æŒ‡å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¶Šå°‘ä»£ç è¶Šå¥½&lt;/li&gt;
&lt;li&gt;æœç»é‡å¤çš„ä»£ç &lt;/li&gt;
&lt;li&gt;Viewsåº”è¯¥å¤„ç†æ¼”ç¤ºé€»è¾‘ã€‚å¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œè¯•ç€æŠŠä¸šåŠ¡é€»è¾‘æ”¾åœ¨modelsä¸­æˆ–è€…formsä¸­&lt;/li&gt;
&lt;li&gt;ä¿è¯viewsçš„ç®€æ´&lt;/li&gt;
&lt;li&gt;ç”¨ä»–ä»¬å†™è‡ªå®šä¹‰çš„403ï¼Œ404ï¼Œ500é”™è¯¯å¤„ç†&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¤æ‚çš„åµŒå¥—-å¦‚æœè¦é¿å…é˜»å¡çš„è¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;9-2-ä¼ é€’HttpRequestå¯¹è±¡&quot;&gt;&lt;a href=&quot;#9-2-ä¼ é€’HttpRequestå¯¹è±¡&quot; class=&quot;headerlink&quot; title=&quot;9.2 ä¼ é€’HttpRequestå¯¹è±¡&quot;&gt;&lt;/a&gt;9.2 ä¼ é€’HttpRequestå¯¹è±¡&lt;/h3&gt;&lt;p&gt;æœ‰äº›æ—¶å€™æˆ‘ä»¬æƒ³åœ¨viewsä¸­é‡ç”¨ä»£ç ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æƒ³ä¸­é—´ä»¶å’Œä¸Šä¸‹æ–‡å¤„ç†å™¨ä¸€æ ·æŠŠå®ƒå’Œå…¨å±€åŠŸèƒ½è”ç³»èµ·æ¥ã€‚&lt;br&gt;åœ¨è¿™æœ¬ä¹¦çš„å¼€å¤´ï¼Œæˆ‘ä»¬å»ºè®®åˆ›å»ºè·¨é¡¹ç›®çš„åŠŸèƒ½å‡½æ•°ã€‚&lt;br&gt;å¯¹äºå¤šæ•°åŠŸèƒ½å‡½æ•°è€Œè¨€ï¼Œæˆ‘ä»¬ä»&lt;code&gt;django.http.HttpRequest&lt;/code&gt;å¯¹è±¡ä¸­æ‹¿åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ï¼Œæ¥æ”¶é›†æ•°æ®æˆ–è€…æ‰§è¡Œæ“ä½œã€‚&lt;br&gt;é€šè¿‡æŠŠrequestå¯¹è±¡ä½œä¸ºé¦–è¦å‚æ•°ï¼Œæˆ‘ä»¬èƒ½åœ¨æ›´å¤šçš„æ–¹æ³•ä¸Šæ‹¥æœ‰æ›´ç®€å•çš„å‚æ•°ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åªéœ€è¦ä¼ ä¸€ä¸ªHttpRequestå¯¹è±¡å°±å¯ä»¥äº†&lt;br&gt;
    
    </summary>
    
      <category term="Backend" scheme="https://morningchen.com/categories/Backend/"/>
    
      <category term="Django" scheme="https://morningchen.com/categories/Backend/Django/"/>
    
    
      <category term="Django" scheme="https://morningchen.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>Two Scoops of Django 1.8 å­¦ä¹ ç¬”è®°å››</title>
    <link href="https://morningchen.com/2015/09/12/Two-Scoops-of-Django-1-8-notes-4/"/>
    <id>https://morningchen.com/2015/09/12/Two-Scoops-of-Django-1-8-notes-4/</id>
    <published>2015-09-12T12:26:26.000Z</published>
    <updated>2018-09-27T14:11:28.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="8-Function-and-Class-Based-Views"><a href="#8-Function-and-Class-Based-Views" class="headerlink" title="8. Function- and Class-Based Views"></a>8. Function- and Class-Based Views</h2><ul><li>Function-based views(FBVs) å‡½æ•°è§†å›¾</li><li>Class-based views(CBVs)  ç±»è§†å›¾</li></ul><h3 id="8-1-ä»€ä¹ˆæ—¶å€™ä½¿ç”¨FBVsæˆ–è€…CBVs"><a href="#8-1-ä»€ä¹ˆæ—¶å€™ä½¿ç”¨FBVsæˆ–è€…CBVs" class="headerlink" title="8.1 ä»€ä¹ˆæ—¶å€™ä½¿ç”¨FBVsæˆ–è€…CBVs"></a>8.1 ä»€ä¹ˆæ—¶å€™ä½¿ç”¨FBVsæˆ–è€…CBVs</h3><p>æ¯å½“ä½ æƒ³å®ç°ä¸€ä¸ªviewçš„æ—¶å€™ï¼Œè€ƒè™‘ä¸‹ç”¨å“ªç§æ–¹æ³•æ¯”è¾ƒå¥½ï¼Œä¸‹é¢æ˜¯å„ç§æƒ…å†µä¸‹è¯¥ä½¿ç”¨FBVsè¿˜æ˜¯CBVsæµç¨‹å›¾<br><img src="FBVs_CBVs.png" alt="FBVs_CBVs"><br>æˆ‘ä»¬æ›´å€¾å‘äºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨CBVsæ¥å®ç°</p><a id="more"></a><h3 id="8-2-å°†Viewçš„é€»è¾‘æ”¾åœ¨URLConfsä¹‹å¤–"><a href="#8-2-å°†Viewçš„é€»è¾‘æ”¾åœ¨URLConfsä¹‹å¤–" class="headerlink" title="8.2 å°†Viewçš„é€»è¾‘æ”¾åœ¨URLConfsä¹‹å¤–"></a>8.2 å°†Viewçš„é€»è¾‘æ”¾åœ¨URLConfsä¹‹å¤–</h3><p>requestsé€šè¿‡URLConfsè¢«è·¯ç”±åˆ°viewsä¸Šï¼Œåœ¨ä¸€ä¸ªæ¨¡å—ä¸­é€šå¸¸ç”¨urls.pyè¡¨ç¤ºã€‚</p><p>URLè®¾è®¡å“²å­¦ <a href="https://docs.djangoproject.com/en/1.8/misc/design-philosophies/#url-design" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/misc/design-philosophies/#url-design</a></p><p>è¦ç‚¹å¾ˆæ˜ç¡®ï¼š</p><ul><li>viewæ¨¡å—åº”è¯¥åŒ…å«viewçš„é€»è¾‘</li><li>URLæ¨¡å—åº”è¯¥åŒ…å«URLçš„é€»è¾‘</li></ul><p>ä¸‹é¢çš„ä»£ç ï¼Œä½ å¯èƒ½åœ¨å®˜æ–¹æ–‡æ¡£é‡Œè§è¿‡ï¼š</p><pre><code>Bad Examplefrom django.conf.urls import urlfrom django.views.generic import DetailViewfrom tastings.models import Tastingurlpatterns = [    url(r&quot;^(?P&lt;pk&gt;\d+)/$&quot;,        DetailView.as_view(            model=Tasting,            template_name=&quot;tastings/detail.html&quot;),        name=&quot;detail&quot;),    url(r&quot;^(?P&lt;pk&gt;\d+)/results/$&quot;,        DetailView.as_view(            model=Tasting,            template_name=&quot;tastings/results.html&quot;),        name=&quot;results&quot;),]</code></pre><p>çŸä¸€çœ¼ä»£ç å¯èƒ½æ„Ÿè§‰æ˜¯å¯¹çš„ï¼Œä½†æ˜¯å®ƒè¿åäº†Djangoçš„è®¾è®¡å“²å­¦ï¼š</p><ul><li>å®ƒç”¨tight coupling(ç´§è€¦åˆ)å–ä»£äº†Loose coupling(æ¾è€¦åˆ),æ„å‘³ç€ä¸èƒ½é‡ç”¨è¿™ä¸ªview</li><li>è¿åäº†DRYåŸåˆ™ï¼Œåœ¨CBVsä¹‹é—´ä½¿ç”¨äº†åŒä¸€ä¸ªæˆ–è€…ç›¸ä¼¼çš„å‚æ•°</li><li>ç ´åäº†å¯æ‰©å±•æ€§ï¼ŒCBVsçš„ä¼˜åŠ¿æ˜¯ç±»çš„ç»§æ‰¿ï¼Œå¯ä»–åœ¨ç”¨<a href="https://zh.wikipedia.org/wiki/%E5%8F%8D%E9%9D%A2%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">åé¢æ¨¡å¼</a></li><li>å¤ªå¤šå…¶ä»–é—®é¢˜ï¼šå½“ä½ åŠ ä¸Šèº«ä»½è®¤è¯çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæˆæƒæ€ä¹ˆåŠï¼Ÿä½ å‡†å¤‡ç”¨ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„è£…é¥°å™¨å°è£…æ¯ä¸ªURLConfsè§†å›¾å—ï¼Ÿ<br>æŠŠä½ çš„viewä»£ç æ”¾åœ¨URLConfsä¸­å¯¼è‡´ä½ çš„URLConfsæ··ä¹±ä¸åˆ©äºç»´æŠ¤</li></ul><h3 id="8-3-åšæŒæ¾è€¦åˆçš„URLConfs"><a href="#8-3-åšæŒæ¾è€¦åˆçš„URLConfs" class="headerlink" title="8.3 åšæŒæ¾è€¦åˆçš„URLConfs"></a>8.3 åšæŒæ¾è€¦åˆçš„URLConfs</h3><p>ä¸ºäº†é¿å…ä¸Šé¢æåˆ°è¿‡çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿™æ ·åˆ›å»ºURLConfsï¼Œå…ˆå†™ä¸ªviews</p><pre><code># tastings/views.pyfrom django.views.generic import ListView, DetailView, UpdateViewfrom django.core.urlresolvers import reversefrom .models import Tastingclass TasteListView(ListView):    model = Tastingclass TasteDetailView(DetailView):    model = Tastingclass TasteResultsView(TasteDetailView):    template_name = &quot;tastings/results.html&quot;class TasteUpdateView(UpdateView):    model = Tasting    def get_success_url(self):        return reverse(&quot;tastings:detail&quot;,            kwargs={&quot;pk&quot;: self.object.pk})</code></pre><p>å†å†™ä¸ªurls</p><pre><code># tastings/urls.pyfrom django.conf.urls import urlfrom . import viewsurlpatterns = [    url(        regex=r&quot;^$&quot;,        view=views.TasteListView.as_view(),        name=&quot;list&quot;    ),    url(        regex=r&quot;^(?P&lt;pk&gt;\d+)/$&quot;,        view=views.TasteDetailView.as_view(),        name=&quot;detail&quot;    ),    url(        regex=r&quot;^(?P&lt;pk&gt;\d+)/results/$&quot;,        view=views.TasteResultsView.as_view(),        name=&quot;results&quot;    ),    url(        regex=r&quot;^(?P&lt;pk&gt;\d+)/update/$&quot;,        view=views.TasteUpdateView.as_view(),        name=&quot;update&quot;    )]</code></pre><p>ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™å‘¢ï¼š</p><ul><li>DRYåŸåˆ™ï¼šæ²¡æœ‰å‚æ•°å’Œå±æ€§çš„é‡å¤</li><li>æ¾è€¦åˆï¼šæˆ‘ä»¬ä»URLConfsä¸­ç§»é™¤äº†modelå’Œtemplate nameï¼Œå› ä¸ºURLConfså°±æ˜¯URLConfsï¼Œviewå°±æ˜¯viewã€‚<br>æˆ‘ä»¬åº”è¯¥å°½å¯èƒ½çš„ä»ä¸€ä¸ªæˆ–è€…æ›´å¤šçš„URLConfsè°ƒç”¨viewsï¼Œè¿™ä¸ªä¾‹å­å°±åšåˆ°äº†</li><li>URLConfs should do one thing and do it wellï¼šè¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬çš„URLConfsåªä¸“æ³¨äºroating</li><li>views èƒ½ä»Class-basedä¸­å—ç›Šï¼šviewså¯ä»¥ç»§æ‰¿è‡ªå…¶ä»–çš„ç±»ï¼Œè¿™æ ·ï¼ŒåŠ ä¸ªèº«ä»½è®¤è¯ï¼Œæˆæƒï¼Œæ–°çš„è¯„è®ºæ ¼å¼æˆ–è€…å…¶ä»–çš„ä¸šåŠ¡éœ€æ±‚å°±å˜å¾—æ›´å®¹æ˜“äº†</li><li>æ— é™çš„æ‰©å±•æ€§ï¼šåœ¨viewsä¸­ï¼Œæˆ‘ä»¬èƒ½å®ç°è‡ªå®šä¹‰é€»è¾‘</li></ul><h3 id="8-4-ä½¿ç”¨URL-å‘½åç©ºé—´"><a href="#8-4-ä½¿ç”¨URL-å‘½åç©ºé—´" class="headerlink" title="8.4 ä½¿ç”¨URL å‘½åç©ºé—´"></a>8.4 ä½¿ç”¨URL å‘½åç©ºé—´</h3><p>URL å‘½åç©ºé—´ç»™app-levelæä¾›äº†ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå‘½åç©ºé—´åœ¨è¡¨é¢ä¸Šçœ‹èµ·æ¥æ²¡ä»€ä¹ˆè½¯ç”¨ï¼Œä½†æ˜¯ä¸€æ—¦å¼€å‘è€…å¼€å§‹ç”¨çš„æ—¶å€™å°±ä¼šæŠ±æ€¨ä¸ºä»€ä¹ˆä¸æ—©ç‚¹ä½¿ç”¨ã€‚<br>æˆ‘ä»¬æ€»ç»“äº†ä½¿ç”¨å‘½åç©ºé—´çš„è§„åˆ™ï¼š</p><ul><li>æˆ‘ä»¬åƒè¿™æ ·å†™ tastings:detail (å†’å·åé¢ä¸è¦å†™ç©ºæ ¼ï¼ä¸è¦å†™ç©ºæ ¼ï¼ä¸è¦å†™ç©ºæ ¼ï¼)</li></ul><p>åœ¨root URLConfsä¸Šä»¬åŠ ä¸Šï¼š</p><pre><code># urls.py at root of projecturlpatterns += [    url(r&apos;^tastings/&apos;, include(&apos;tastings.urls&apos;, namespace=&apos;tastings&apos;)),]</code></pre><p>å†çœ‹ä¸‹viewçš„ä»£ç ç‰‡æ®µï¼š</p><pre><code># tastings/views.py snippetclass TasteUpdateView(UpdateView):    model = Tasting    def get_success_url(self):        return reverse(&quot;tastings:detail&quot;,            kwargs={&quot;pk&quot;: self.object.pk})</code></pre><p>åœ¨HTMLè¿™æ ·ä½¿ç”¨ï¼š</p><pre><code>{% raw %}    {% extends "base.html" %}    {% block title %}Tastings{% endblock title %}    {% block content %}    {% endraw %}&lt;ul&gt;{% raw %}      {% for taste in tastings %}    {% endraw %}    &lt;li&gt;      &lt;a href=&quot;{% raw %}{% url "tastings:detail" taste.pk %}">{{ taste.title }}{% endraw %}&lt;/a&gt;      &lt;small&gt;        &lt;a {% raw %}href="{% url "tastings:update" taste.pk %}">update{% endraw %}&lt;/a&gt;      &lt;/small&gt;    &lt;/li&gt;{% raw %}      {% endfor %}    {% endraw %}&lt;/ul&gt;{% raw %}    {% endblock content %}    {% endraw %}</code></pre><h4 id="8-4-1åˆ›å»ºæ›´çŸ­ï¼Œæ›´æ˜¾è€Œæ˜“è§ï¼ŒDRYçš„URLå"><a href="#8-4-1åˆ›å»ºæ›´çŸ­ï¼Œæ›´æ˜¾è€Œæ˜“è§ï¼ŒDRYçš„URLå" class="headerlink" title="8.4.1åˆ›å»ºæ›´çŸ­ï¼Œæ›´æ˜¾è€Œæ˜“è§ï¼ŒDRYçš„URLå"></a>8.4.1åˆ›å»ºæ›´çŸ­ï¼Œæ›´æ˜¾è€Œæ˜“è§ï¼ŒDRYçš„URLå</h4><h4 id="8-4-2é€šè¿‡ç¬¬ä¸‰æ–¹åº“å¢åŠ äº’é€šæ€§"><a href="#8-4-2é€šè¿‡ç¬¬ä¸‰æ–¹åº“å¢åŠ äº’é€šæ€§" class="headerlink" title="8.4.2é€šè¿‡ç¬¬ä¸‰æ–¹åº“å¢åŠ äº’é€šæ€§"></a>8.4.2é€šè¿‡ç¬¬ä¸‰æ–¹åº“å¢åŠ äº’é€šæ€§</h4><p>å¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ªcontactçš„appï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜è¦åŠ ä¸€ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š</p><pre><code># urls.py at root of projecturlpatterns += [    url(r&apos;^contact/&apos;, include(&apos;contactmonger.urls&apos;,        namespace=&apos;contactmonger&apos;)),    url(r&apos;^report-problem/&apos;, include(&apos;contactapp.urls&apos;,        namespace=&apos;contactapp&apos;)),]</code></pre><p>åœ¨templatesè®©å®ƒç”Ÿæ•ˆ</p><pre><code>{% raw %}    {% extends "base.html" %}    {% block title %}Contact{% endblock title %}    {% block content %}    {% endraw %}    &lt;p&gt;  &lt;a href=&quot;{% raw %}{% url "contactmonger:create" %}{% endraw %}&quot;&gt;Contact Us&lt;/a&gt;    &lt;/p&gt;    &lt;p&gt;  &lt;a href=&quot;{% raw %}{% url "contactapp:report" %}{% endraw %}&quot;&gt;Report a Problem&lt;/a&gt;    &lt;/p&gt;{% raw %}    {% endblock content %}    {% endraw %}</code></pre><h3 id="8-5-åœ¨URLConfsä¸­å¼•ç”¨viewsçš„æ—¶å€™ä¸è¦ç”¨å­—ç¬¦ä¸²"><a href="#8-5-åœ¨URLConfsä¸­å¼•ç”¨viewsçš„æ—¶å€™ä¸è¦ç”¨å­—ç¬¦ä¸²" class="headerlink" title="8.5 åœ¨URLConfsä¸­å¼•ç”¨viewsçš„æ—¶å€™ä¸è¦ç”¨å­—ç¬¦ä¸²"></a>8.5 åœ¨URLConfsä¸­å¼•ç”¨viewsçš„æ—¶å€™ä¸è¦ç”¨å­—ç¬¦ä¸²</h3><p>åœ¨Django1.8ä¹‹å‰çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œåœ¨URLConfså¼•ç”¨viewsçš„æ—¶å€™ï¼Œä¼šæŠŠviewsä½œä¸ºå­—ç¬¦ä¸²ï¼š</p><pre><code>BAD Example# DON&apos;T DO THIS!# polls/urls.pyfrom django.conf.urls import patterns, urlurlpatterns = patterns(&apos;&apos;,    # Defining the view as a string    url(r&apos;^$&apos;, &apos;polls.views.index&apos;, name=&apos;index&apos;),)</code></pre><p>è¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>Django ç¥å¥‡çš„æ·»åŠ äº†viewå‡½æ•°/ç±»ï¼Œè¿™ä¸ªé­”æ³•ç‰¹æ€§çš„é—®é¢˜æ˜¯å½“viewæœ‰ä¸ªé”™è¯¯æ—¶ï¼Œå¢åŠ äº†è°ƒè¯•çš„å›°éš¾æ€§</li><li>è¿™ä¸ªæ–¹æ³•éœ€è¦æŠŠç©ºå­—ç¬¦ä¸²ä½œä¸ºpatternsçš„å‰ç¼€ï¼Œå¤ªéº»çƒ¦</li></ul><p>æ¥çœ‹çœ‹patternsçš„æºç ï¼š</p><pre><code>def patterns(prefix, *args):    warnings.warn(        &apos;django.conf.urls.patterns() is deprecated and will be removed in &apos;        &apos;Django 1.10. Update your urlpatterns to be a list of &apos;        &apos;django.conf.urls.url() instances instead.&apos;,        RemovedInDjango110Warning, stacklevel=2    )    pattern_list = []    for t in args:        if isinstance(t, (list, tuple)):            t = url(prefix=prefix, *t)        elif isinstance(t, RegexURLPattern):            t.add_prefix(prefix)        pattern_list.append(t)    return pattern_list</code></pre><p>å®ƒè‡ªå·±éƒ½è¯´äº†åœ¨1.10ç‰ˆæœ¬ä¹‹åå°±ä¼šç§»é™¤ï¼Œå¯å®˜æ–¹æ–‡æ¡£è¿˜åœ¨è¿™æ ·å†™ï¼Œsibusishaâ€¦.</p><p>ä»¥ä¸‹æ˜¯å®šä¹‰viewsçš„æ­£ç¡®æ–¹æ³•ï¼š</p><pre><code># polls/urls.pyfrom django.conf.urls import urlfrom . import viewsurlpatterns = [    # Defining the views explicitly    url(r&apos;^$&apos;, views.index, name=&apos;index&apos;),]</code></pre><p>å‚è€ƒ: <a href="https://docs.djangoproject.com/en/1.8/releases/1.8/#django-conf-urls-patterns" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/releases/1.8/#django-conf-urls-patterns</a></p><h3 id="8-6-å°†ä¸šåŠ¡é€»è¾‘æ”¾åœ¨viewsä¹‹å¤–"><a href="#8-6-å°†ä¸šåŠ¡é€»è¾‘æ”¾åœ¨viewsä¹‹å¤–" class="headerlink" title="8.6 å°†ä¸šåŠ¡é€»è¾‘æ”¾åœ¨viewsä¹‹å¤–"></a>8.6 å°†ä¸šåŠ¡é€»è¾‘æ”¾åœ¨viewsä¹‹å¤–</h3><p>è¿‡å»ï¼Œæˆ‘ä»¬ä¼šæŠŠå¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ”¾åœ¨viewsé‡Œé¢ï¼Œä¸å¹¸çš„æ˜¯ï¼Œå½“éœ€è¦åœ¨æˆ‘ä»¬çš„viewsä¸­ç”ŸæˆPDFï¼ŒåŠ ä¸€ä¸ª REST APIï¼Œæˆ–è€…è¦æœåŠ¡äºå…¶ä»–ç‰ˆå¼æ—¶ï¼Œå®ƒå®ç°èµ·æ¥ä¼šå˜å¾—å¾ˆå›°éš¾ã€‚<br>è¿™å°±æ˜¯æˆ‘ä»¬æ›´å€¾å‘ä½¿ç”¨model methods, manager methods, æˆ–è€…å¸¸è§„å®ç”¨çš„è¾…åŠ©åŠŸèƒ½çš„åŸå› ã€‚å½“æŠŠä¸šåŠ¡é€»è¾‘æ”¾åœ¨æ›´å®¹æ˜“å¤ç”¨çš„ç»„ä»¶ä¸­ï¼Œå†ä»viewså†…è°ƒç”¨ï¼Œ<br>é€šè¿‡æ‰©å±•ç»„ä»¶å¯ä»¥è®©é¡¹ç›®æ›´å®¹æ˜“åšæ›´å¤šçš„äº‹æƒ…ã€‚</p><h3 id="8-7-Django-Views-Are-Functions"><a href="#8-7-Django-Views-Are-Functions" class="headerlink" title="8.7 Django Views Are Functions"></a>8.7 Django Views Are Functions</h3><pre><code># Django FBV as a functionHttpResponse = view(HttpRequest)# Deciphered into basic math (remember functions from algebra?)y = f(x)# ... and then translated into a CBV exampleHttpResponse = View.as_view()(HttpRequest)</code></pre><p>è¿™ä¸ªå‡½æ•°å°†ä¸€ä¸ªHTTP è¯·æ±‚å¯¹è±¡è½¬æ¢æˆäº†HTTP å“åº”å¯¹è±¡ã€‚ä½ å¯ä»¥ç†è§£æˆæ•°å­¦ä¸­çš„å‡½æ•°ã€‚<br>CBVé€šè¿‡as_view()ä¹Ÿå¯ä»¥ä½œä¸ºå‡½æ•°ä½¿ç”¨ã€‚</p><h4 id="æœ€ç®€å•çš„views"><a href="#æœ€ç®€å•çš„views" class="headerlink" title="æœ€ç®€å•çš„views"></a>æœ€ç®€å•çš„views</h4><pre><code># simplest_views.pyfrom django.http import HttpResponsefrom django.views.generic import View# The simplest FBVdef simplest_view(request):    # Business logic goes here    return HttpResponse(&quot;FBV&quot;)# The simplest CBVclass SimplestView(View):    def get(self, request, *args, **kwargs):        # Business logic goes here        return HttpResponse(&quot;CBV&quot;)</code></pre><p>ä¸ºä»€ä¹ˆéœ€è¦äº†è§£ï¼Ÿ</p><ul><li>æœ‰æ—¶æˆ‘ä»¬éœ€è¦ä¸€æ¬¡æ€§çš„viewsæ¥åšä¸€ä»¶å°äº‹</li><li>ç†è§£äº†æœ€ç®€å•çš„viewsæ„å‘³ç€æˆ‘ä»¬èƒ½æ›´å¥½çš„ç†è§£è¿™æ ·åšçš„ç›®çš„</li><li>è¯´æ˜ FBVsä¸ç”¨æŒ‡å®šHTTPæ–¹æ³•(GET,POST,DELETEç­‰ç­‰)ï¼Œè€ŒCBVséœ€è¦æŒ‡å®šç‰¹å®šçš„HTTPæ–¹æ³•</li></ul><h3 id="8-8-ä¸è¦ä½¿ç”¨locals-ä½œä¸ºViews-Context"><a href="#8-8-ä¸è¦ä½¿ç”¨locals-ä½œä¸ºViews-Context" class="headerlink" title="8.8 ä¸è¦ä½¿ç”¨locals()ä½œä¸ºViews Context"></a>8.8 ä¸è¦ä½¿ç”¨locals()ä½œä¸ºViews Context</h3><p>ä»ä»»ä½•è°ƒç”¨ä¸­è¿”å› locals() æ˜¯ anti-pattern(åé¢æ¨¡å¼)ã€‚è™½ç„¶å®ƒçœ‹ä¸Šå»æ–¹ä¾¿å¿«æ·ï¼Œäº‹å®ä¸Šå®ƒå¤ªç‰¹ä¹ˆè€—æ—¶äº†ã€‚<br>æˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªanti-patternçš„ä¾‹å­ï¼š</p><pre><code>BAD Exampledef ice_cream_store_display(request, store_id):    store = get_object_or_404(Store, id=store_id)    date = timezone.now()    return render(request, &apos;melted_ice_cream_report.html&apos;, locals())</code></pre><p>è¡¨é¢çœ‹èµ·æ¥ä¸€åˆ‡OKï¼Œç„¶è€Œï¼Œå› ä¸ºæˆ‘ä»¬æŠŠä¸€ä¸ªæœ¬åº”è¯¥æ˜¾å¼çš„è®¾è®¡ï¼Œæ£é¼“æˆäº†éšå¼çš„anti-patternï¼Œè®©è¿™ä¸ªç®€å•çš„viewæœ‰äº†ç»´æŠ¤çš„çƒ¦æ¼ã€‚<br>ç‰¹åˆ«å¼ºè°ƒçš„æ˜¯æˆ‘ä»¬æ ¹æœ¬ä¸çŸ¥é“å®ƒä¼šè¿”å›ä»€ä¹ˆç»“æœã€‚æˆ‘ä»¬æ”¹å˜ä»»ä¸€ä¸ªå˜é‡ï¼Œè¿”å›ç»“æœéƒ½ä¸ä¼šç«‹åˆ»å‘ˆç°ã€‚<br>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¼ºçƒˆçš„æå€¡åœ¨viewsä¸­ä½¿ç”¨æ˜ç¡®çš„ä¸Šä¸‹æ–‡ï¼š</p><pre><code>def ice_cream_store_display(request, store_id):    return render(request, &apos;melted_ice_cream_report.html&apos;, dict{        &apos;store&apos;: get_object_or_404(Store, id=store_id),        &apos;now&apos;: timezone.now()    })</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;8-Function-and-Class-Based-Views&quot;&gt;&lt;a href=&quot;#8-Function-and-Class-Based-Views&quot; class=&quot;headerlink&quot; title=&quot;8. Function- and Class-Based Views&quot;&gt;&lt;/a&gt;8. Function- and Class-Based Views&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Function-based views(FBVs) å‡½æ•°è§†å›¾&lt;/li&gt;
&lt;li&gt;Class-based views(CBVs)  ç±»è§†å›¾&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;8-1-ä»€ä¹ˆæ—¶å€™ä½¿ç”¨FBVsæˆ–è€…CBVs&quot;&gt;&lt;a href=&quot;#8-1-ä»€ä¹ˆæ—¶å€™ä½¿ç”¨FBVsæˆ–è€…CBVs&quot; class=&quot;headerlink&quot; title=&quot;8.1 ä»€ä¹ˆæ—¶å€™ä½¿ç”¨FBVsæˆ–è€…CBVs&quot;&gt;&lt;/a&gt;8.1 ä»€ä¹ˆæ—¶å€™ä½¿ç”¨FBVsæˆ–è€…CBVs&lt;/h3&gt;&lt;p&gt;æ¯å½“ä½ æƒ³å®ç°ä¸€ä¸ªviewçš„æ—¶å€™ï¼Œè€ƒè™‘ä¸‹ç”¨å“ªç§æ–¹æ³•æ¯”è¾ƒå¥½ï¼Œä¸‹é¢æ˜¯å„ç§æƒ…å†µä¸‹è¯¥ä½¿ç”¨FBVsè¿˜æ˜¯CBVsæµç¨‹å›¾&lt;br&gt;&lt;img src=&quot;FBVs_CBVs.png&quot; alt=&quot;FBVs_CBVs&quot;&gt;&lt;br&gt;æˆ‘ä»¬æ›´å€¾å‘äºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨CBVsæ¥å®ç°&lt;/p&gt;
    
    </summary>
    
      <category term="Backend" scheme="https://morningchen.com/categories/Backend/"/>
    
      <category term="Django" scheme="https://morningchen.com/categories/Backend/Django/"/>
    
    
      <category term="Django" scheme="https://morningchen.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>Two Scoops of Django 1.8  å­¦ä¹ ç¬”è®°ä¸‰</title>
    <link href="https://morningchen.com/2015/09/10/Two-Scoops-of-Django-1-8-notes-3/"/>
    <id>https://morningchen.com/2015/09/10/Two-Scoops-of-Django-1-8-notes-3/</id>
    <published>2015-09-10T01:50:17.000Z</published>
    <updated>2018-09-27T03:56:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="7-æŸ¥è¯¢å’Œæ•°æ®åº“å±‚"><a href="#7-æŸ¥è¯¢å’Œæ•°æ®åº“å±‚" class="headerlink" title="7. æŸ¥è¯¢å’Œæ•°æ®åº“å±‚"></a>7. æŸ¥è¯¢å’Œæ•°æ®åº“å±‚</h2><h3 id="7-1-å¯¹å•ä¸ªå¯¹è±¡ä½¿ç”¨get-object-or-404"><a href="#7-1-å¯¹å•ä¸ªå¯¹è±¡ä½¿ç”¨get-object-or-404" class="headerlink" title="7.1 å¯¹å•ä¸ªå¯¹è±¡ä½¿ç”¨get_object_or_404()"></a>7.1 å¯¹å•ä¸ªå¯¹è±¡ä½¿ç”¨<code>get_object_or_404()</code></h3><p>åœ¨è¯¦æƒ…é¡µé¢è§†å›¾ä¸­ï¼Œå¦‚æœä½ æƒ³æ¥å—å•ä¸ªå¯¹è±¡ï¼Œç”¨<code>get_object_or_404()</code>ä»£æ›¿<code>get()</code><br>è­¦å‘Šï¼šåªåœ¨è§†å›¾ä¸­ä½¿ç”¨!!!åªåœ¨è§†å›¾ä¸­ä½¿ç”¨!!!åªåœ¨è§†å›¾ä¸­ä½¿ç”¨!!!</p><h3 id="7-2-è°¨æ…çš„ä½¿ç”¨æŸ¥è¯¢ï¼Œå®ƒå¯èƒ½æŠ›å‡ºå¼‚å¸¸"><a href="#7-2-è°¨æ…çš„ä½¿ç”¨æŸ¥è¯¢ï¼Œå®ƒå¯èƒ½æŠ›å‡ºå¼‚å¸¸" class="headerlink" title="7.2 è°¨æ…çš„ä½¿ç”¨æŸ¥è¯¢ï¼Œå®ƒå¯èƒ½æŠ›å‡ºå¼‚å¸¸"></a>7.2 è°¨æ…çš„ä½¿ç”¨æŸ¥è¯¢ï¼Œå®ƒå¯èƒ½æŠ›å‡ºå¼‚å¸¸</h3><p>å½“ä½ é€šè¿‡<code>get_object_or_404()</code>è¿™ä¸ªå¿«æ·æ–¹å¼å¾—åˆ°Modelçš„å®ä¾‹çš„æ—¶å€™ï¼Œä¸éœ€è¦ç”¨try-exceptå°è£…ï¼Œ<br>å› ä¸º<code>get_object_or_404()</code>å·²ç»å¸®ä½ å°è£…å¥½äº†ã€‚<br>ç„¶è€Œï¼Œåœ¨å…¶ä»–å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ éœ€è¦ä½¿ç”¨try-exceptã€‚ä¸€äº›tips:</p><h4 id="7-2-1-ObjectDoesNotExist-vs-DoesNotExist"><a href="#7-2-1-ObjectDoesNotExist-vs-DoesNotExist" class="headerlink" title="7.2.1 ObjectDoesNotExist vs. DoesNotExist"></a>7.2.1 ObjectDoesNotExist vs. DoesNotExist</h4><p>ObjectDoesNotExistå…è®¸è¢«ä½¿ç”¨åœ¨ä»»ä½•modelå¯¹è±¡ä¸­ï¼Œä½†æ˜¯DoesNotExiståªèƒ½åœ¨ä¸€äº›ç‰¹å®šçš„modelä¸­ä½¿ç”¨</p><pre><code>from django.core.exceptions import ObjectDoesNotExistfrom flavors.models import Flavorfrom store.exceptions import OutOfStockdef list_flavor_line_item(sku):    try:        return Flavor.objects.get(sku=sku, quantity__gt=0)    except Flavor.DoesNotExist:        msg = &quot;We are out of {0}&quot;.format(sku)        raise OutOfStock(msg)def list_any_line_item(model, sku):    try:        return model.objects.get(sku=sku, quantity__gt=0)    except ObjectDoesNotExist:        msg = &quot;We are out of {0}&quot;.format(sku)        raise OutOfStock(msg)</code></pre><a id="more"></a><h4 id="7-2-2-å½“ä½ åªæ˜¯æƒ³è¦ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å¾—åˆ°äº†å¤šä¸ª"><a href="#7-2-2-å½“ä½ åªæ˜¯æƒ³è¦ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å¾—åˆ°äº†å¤šä¸ª" class="headerlink" title="7.2.2 å½“ä½ åªæ˜¯æƒ³è¦ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å¾—åˆ°äº†å¤šä¸ª"></a>7.2.2 å½“ä½ åªæ˜¯æƒ³è¦ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å¾—åˆ°äº†å¤šä¸ª</h4><p>å¦‚æœä½ çš„æŸ¥è¯¢å¯èƒ½ä¼šè¿”å›å¤šä¸ªå¯¹è±¡ï¼Œç”¨<code>MultipleObjectsReturned</code>æ¥æ£€æŸ¥</p><pre><code>from flavors.models import Flavorfrom store.exceptions import OutOfStock, CorruptedDatabasedef list_flavor_line_item(sku):    try:        return Flavor.objects.get(sku=sku, quantity__gt=0)    except Flavor.DoesNotExist:        msg = &quot;We are out of {}&quot;.format(sku)        raise OutOfStock(msg)    except Flavor.MultipleObjectsReturned:        msg = &quot;Multiple items have SKU {}. Please fix!&quot;.format(sku)        raise CorruptedDatabase(msg)</code></pre><h3 id="7-3-ä½¿ç”¨lazy-evaluation-è®©æŸ¥è¯¢æ›´æ¸…æ™°"><a href="#7-3-ä½¿ç”¨lazy-evaluation-è®©æŸ¥è¯¢æ›´æ¸…æ™°" class="headerlink" title="7.3 ä½¿ç”¨lazy evaluation è®©æŸ¥è¯¢æ›´æ¸…æ™°"></a>7.3 ä½¿ç”¨lazy evaluation è®©æŸ¥è¯¢æ›´æ¸…æ™°</h3><p>Django çš„ORM éå¸¸å¼ºå¤§ï¼Œå®ƒè®©ä»£ç æ¸…æ™°æ˜“è¯»ï¼Œåˆ©äºç»´æŠ¤ã€‚<br>é€šè¿‡lazy evaluationï¼Œ æ„å‘³ç€åœ¨æ•°æ®çœŸæ­£è¢«ä½¿ç”¨ä¹‹å‰ï¼ŒORMä¸ä¼šè°ƒç”¨SQLã€‚<br>æˆ‘ä»¬å¯ä»¥å°½å¯èƒ½å¤šçš„è¿æ¥ORMæ–¹æ³•å’Œå‡½æ•°ï¼Œç›´åˆ°æ‹¿åˆ°ç»“æœï¼Œdjangoéƒ½ä¸ä¼šæ¥è§¦åˆ°æ•°æ®åº“å±‚ã€‚</p><h3 id="7-4-å­¦ä¹ é«˜çº§çš„æŸ¥è¯¢å·¥å…·"><a href="#7-4-å­¦ä¹ é«˜çº§çš„æŸ¥è¯¢å·¥å…·" class="headerlink" title="7.4 å­¦ä¹ é«˜çº§çš„æŸ¥è¯¢å·¥å…·"></a>7.4 å­¦ä¹ é«˜çº§çš„æŸ¥è¯¢å·¥å…·</h3><p>ORM å®¹æ˜“å­¦ï¼Œç›´è§‚ï¼Œæ¶µç›–äº†è®¸å¤šç”¨ä¾‹ï¼Œç„¶è€Œè¿˜æœ‰è‹¥å¹²ä»¶äº‹æƒ…ä¸èƒ½åšå¥½ã€‚åœ¨æŸ¥è¯¢é›†è¿”å›åï¼Œæˆ‘ä»¬ä¼šåœ¨pythoné‡Œå¤„ç†æ›´å¤šçš„æ•°æ®ã€‚<br>è¿™æ˜¯è€»è¾±ï¼Œå› ä¸ºæ¯ä¸€ä¸ªæ•°æ®åº“çš„ç®¡ç†å’Œä¼ è¾“éƒ½æ¯”python(æˆ–ruby, javascript, go, javaç­‰ç­‰è¿™äº›è¯­è¨€)è¦å¿«ã€‚<br>å–ä»£ç”¨pythonç®¡ç†æ•°æ®ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨djangoçš„é«˜çº§æŸ¥è¯¢å·¥å…·ã€‚è¿™æ ·åšï¼Œæˆ‘ä»¬ä¸ä»…æé«˜äº†æ€§èƒ½ï¼Œ<br>è€Œä¸”æ¯”èµ·æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„åŸºäºpythonçš„è§£å†³åŠæ³•çš„ä»£ç ï¼Œæˆ‘ä»¬æ›´å–œæ¬¢ä½¿ç”¨å·²ç»è¢«æµ‹è¯•è¿‡çš„ä»£ç ã€‚</p><h4 id="7-4-1-æŸ¥è¯¢è¡¨è¾¾å¼"><a href="#7-4-1-æŸ¥è¯¢è¡¨è¾¾å¼" class="headerlink" title="7.4.1 æŸ¥è¯¢è¡¨è¾¾å¼"></a>7.4.1 æŸ¥è¯¢è¡¨è¾¾å¼</h4><p>å½“åœ¨æ•°æ®åº“ä¸Šæ‰§è¡Œè¯»å–æ—¶ï¼ŒæŸ¥è¯¢è¡¨è¾¾å¼è¢«ä½¿ç”¨åœ¨åˆ›å»ºå€¼æˆ–è®¡ç®—ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ—å‡ºæ‰€æœ‰å¹³å‡è®¢å•æ•°å¤§äºä¸€æ¬¡çš„å®¢æˆ·</p><pre><code># Bad Examplefrom models.customers import Customercustomers = []for customer in Customer.objects.iterate():    if customer.scoop_ordered &gt; customer.srore_visits:        customers.append(customer)</code></pre><p>è¿™ä¸ªä¾‹å­è®©æˆ‘ä»¬ä¸å¯’è€Œæ —ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><ul><li>å®ƒç”¨pythonæ¥ä¸€ä¸ªä¸ªéå†æ•°æ®åº“ä¸­æ‰€æœ‰çš„é¡¾å®¢è®°å½•ï¼Œè¿™å¤ªæ…¢äº†è€Œä¸”è¿˜å ç”¨å†…å­˜</li><li>åœ¨ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œå®ƒéƒ½å¯èƒ½äº§ç”Ÿç«æ€(race condition)ï¼Œå½“æˆ‘ä»¬è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼Œ<br>å¦‚æœåœ¨åˆ«çš„åœ°æ–¹ï¼Œæ°å¥½customersæ­£åœ¨ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œä¸æ˜¯READ,è€Œæ˜¯UPDATEï¼Œé‚£ä¹ˆè¿™æ®µä»£ç çš„éå†ä¼šæŸå¤±æ‰ä¸€äº›æ•°æ®</li></ul><p>å¹¸è¿çš„æ˜¯ï¼Œdjangoæä¾›äº†ä¸€ä¸ªæ›´æœ‰æ•ˆçš„ï¼Œè§£å†³ç«æ€(race condition)é—®é¢˜çš„æ–¹æ³•</p><pre><code>from django.db.models import Ffrom models.customers import Customercustomers = Customer.objects.filter(scoops_ordered__gt=F(&apos;store_visits&apos;))</code></pre><p><code>F()</code>è¿™ä¸ªæ–¹æ³•å¯ä»¥è®©æ•°æ®åº“å®ƒè‡ªå·±æ¥æ‰§è¡Œæ¯”è¾ƒï¼Œç±»ä¼¼ä¸‹é¢çš„SQLè¯­å¥ï¼š</p><pre><code>SELECT * from customers_customer where scoops_ordered &gt; store_visits</code></pre><h4 id="7-4-2-æ•°æ®åº“å‡½æ•°"><a href="#7-4-2-æ•°æ®åº“å‡½æ•°" class="headerlink" title="7.4.2 æ•°æ®åº“å‡½æ•°"></a>7.4.2 æ•°æ®åº“å‡½æ•°</h4><p>UPPER(), LOWER(), COALESCE(), CONCAT(), LENGTH(), SUBSTR()</p><p><a href="https://docs.djangoproject.com/en/1.8/ref/models/database-functions/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/ref/models/database-functions/</a></p><h3 id="7-5-ä¸è¦æŠ›å¼ƒåŸå§‹çš„SQLè¯­å¥ï¼Œé™¤éæœ‰å¿…è¦"><a href="#7-5-ä¸è¦æŠ›å¼ƒåŸå§‹çš„SQLè¯­å¥ï¼Œé™¤éæœ‰å¿…è¦" class="headerlink" title="7.5 ä¸è¦æŠ›å¼ƒåŸå§‹çš„SQLè¯­å¥ï¼Œé™¤éæœ‰å¿…è¦"></a>7.5 ä¸è¦æŠ›å¼ƒåŸå§‹çš„SQLè¯­å¥ï¼Œé™¤éæœ‰å¿…è¦</h3><p>å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ORMæ¥è¿›è¡Œæ•°æ®ç®¡ç†å’Œæ“ä½œï¼Œ<br>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™è¯¥ä½¿ç”¨SQLè¯­å¥å‘¢ï¼Œå¦‚æœä½¿ç”¨SQLè¯­å¥èƒ½å¤§å¤§çš„ç®€åŒ–pythonä»£ç ï¼Œä¸è¦çŠ¹è±«ï¼Œç”¨å§ã€‚<br>æ¯”å¦‚è¯´ä½ è¿ç»“äº†è‹¥å¹²ä¸ªæŸ¥è¯¢é›†æ“ä½œï¼Œè€Œä¸”æ¯ä¸ªæ“ä½œéƒ½æ˜¯åœ¨åºå¤§çš„æ•°æ®ä¸‹è¿›è¡Œçš„ï¼Œç”¨SQLè¯­å¥ä¹Ÿè®¸ä¼šæ›´æœ‰æ•ˆã€‚</p><h3 id="7-6-æ ¹æ®éœ€è¦åŠ ä¸Šç´¢å¼•"><a href="#7-6-æ ¹æ®éœ€è¦åŠ ä¸Šç´¢å¼•" class="headerlink" title="7.6 æ ¹æ®éœ€è¦åŠ ä¸Šç´¢å¼•"></a>7.6 æ ¹æ®éœ€è¦åŠ ä¸Šç´¢å¼•</h3><p>ç»™ä»»ä½•modelå­—æ®µåŠ ä¸Š<code>db_index=True</code>éƒ½æ˜¯å®¹æ˜“çš„ï¼Œä½†æ˜¯åˆ¤æ–­è¯¥ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çš„è¯å°±ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“äº†ã€‚<br>æˆ‘ä»¬æ›´å€¾å‘äºå¼€å§‹çš„æ—¶å€™ä¸åŠ ç´¢å¼•ï¼Œæ ¹æ®éœ€è¦å†åŠ <br>ä»€ä¹ˆæ—¶å€™è€ƒè™‘åŠ ä¸Šç´¢å¼•ï¼š</p><ul><li>è¿™ä¸ªç´¢å¼•ä½¿ç”¨é¢‘ç¹ï¼Œå æ®äº†æ‰€æœ‰æŸ¥è¯¢çš„10-20%</li><li>æœ‰çœŸå®æ•°æ®ï¼Œæˆ–è€…æ¥è¿‘çœŸå®æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ†æå‡ºç´¢å¼•çš„ç»“æœ</li><li>æˆ‘ä»¬èƒ½é€šè¿‡è·‘æµ‹è¯•æ¥åˆ¤æ–­è¿™ä¸ªç´¢å¼•æ˜¯å¦äº§ç”Ÿäº†æ”¹å–„çš„ç»“æœ</li></ul><h3 id="7-7-äº‹åŠ¡-Transactions"><a href="#7-7-äº‹åŠ¡-Transactions" class="headerlink" title="7.7 äº‹åŠ¡(Transactions)"></a>7.7 äº‹åŠ¡(Transactions)</h3><p>django1.8çš„ORMé»˜è®¤è¡Œä¸ºæ˜¯å½“æŸ¥è¯¢è°ƒç”¨æ—¶è‡ªåŠ¨æäº¤ï¼Œåœ¨æ•°æ®æ”¹å˜çš„æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€æ¯æ—¶æ¯åˆ»a.create() æˆ–è€… update()éƒ½åœ¨è¢«è°ƒç”¨ï¼Œ<br>å®ƒç«‹åˆ»æ”¹å˜äº†æ•°æ®åº“é‡Œçš„æ•°æ®ã€‚å®ƒçš„ä¼˜åŠ¿æ˜¯è®©åˆæœŸå¼€å‘è€…æ›´å¥½çš„ç†è§£ORMï¼Œ<br>åŠ£åŠ¿æ˜¯å¦‚æœä¸€ä¸ªè§†å›¾éœ€è¦å­˜åœ¨2ä¸ªæˆ–è€…å¤šä¸ªæ•°æ®æ›´æ”¹ï¼Œè€Œåªæœ‰ä¸€ä¸ªæ›´æ”¹æˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®å¯èƒ½æœ‰å´©æºƒçš„é£é™©</p><p>è§£å†³è¿™ä¸ªé£é™©çš„åŠæ³•æ˜¯é€šè¿‡ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ï¼Œ<br>ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡é€šå¸¸åŒ…å«äº†ä¸€ä¸ªåºåˆ—çš„å¯¹æ•°æ®åº“çš„è¯»/å†™æ“ä½œã€‚å®ƒçš„å­˜åœ¨åŒ…å«æœ‰ä»¥ä¸‹ä¸¤ä¸ªç›®çš„ï¼š</p><ol><li>ä¸ºæ•°æ®åº“æ“ä½œåºåˆ—æä¾›äº†ä¸€ä¸ªä»å¤±è´¥ä¸­æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€çš„æ–¹æ³•ï¼ŒåŒæ—¶æä¾›äº†æ•°æ®åº“å³ä½¿åœ¨å¼‚å¸¸çŠ¶æ€ä¸‹ä»èƒ½ä¿æŒä¸€è‡´æ€§çš„æ–¹æ³•ã€‚</li><li>å½“å¤šä¸ªåº”ç”¨ç¨‹åºåœ¨å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œå¯ä»¥åœ¨è¿™äº›åº”ç”¨ç¨‹åºä¹‹é—´æä¾›ä¸€ä¸ªéš”ç¦»æ–¹æ³•ï¼Œä»¥é˜²æ­¢å½¼æ­¤çš„æ“ä½œäº’ç›¸å¹²æ‰°ã€‚<br>å½“äº‹åŠ¡è¢«æäº¤ç»™äº†DBMSï¼ˆæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼‰ï¼Œåˆ™DBMSï¼ˆæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼‰éœ€è¦ç¡®ä¿è¯¥äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½æˆåŠŸå®Œæˆä¸”å…¶ç»“æœè¢«æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå¦‚æœäº‹åŠ¡ä¸­æœ‰çš„æ“ä½œæ²¡æœ‰æˆåŠŸå®Œæˆï¼Œåˆ™äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½éœ€è¦è¢«å›æ»šï¼Œå›åˆ°äº‹åŠ¡æ‰§è¡Œå‰çš„çŠ¶æ€;åŒæ—¶ï¼Œè¯¥äº‹åŠ¡å¯¹æ•°æ®åº“æˆ–è€…å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œæ— å½±å“ï¼Œæ‰€æœ‰çš„äº‹åŠ¡éƒ½å¥½åƒåœ¨ç‹¬ç«‹çš„è¿è¡Œã€‚</li></ol><p>å¹¶éä»»æ„çš„å¯¹æ•°æ®åº“çš„æ“ä½œåºåˆ—éƒ½æ˜¯æ•°æ®åº“äº‹åŠ¡ã€‚æ•°æ®åº“äº‹åŠ¡æ‹¥æœ‰ä»¥ä¸‹å››ä¸ªç‰¹æ€§ï¼Œä¹ æƒ¯ä¸Šè¢«ç§°ä¹‹ä¸ºACIDç‰¹æ€§ã€‚</p><ul><li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡ä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«æ‰§è¡Œï¼ŒåŒ…å«åœ¨å…¶ä¸­çš„å¯¹æ•°æ®åº“çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</li><li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡åº”ç¡®ä¿æ•°æ®åº“çš„çŠ¶æ€ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚ä¸€è‡´çŠ¶æ€çš„å«ä¹‰æ˜¯æ•°æ®åº“ä¸­çš„æ•°æ®åº”æ»¡è¶³å®Œæ•´æ€§çº¦æŸã€‚</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šå¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”å½±å“å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œã€‚</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šå·²è¢«æäº¤çš„äº‹åŠ¡å¯¹æ•°æ®åº“çš„ä¿®æ”¹åº”è¯¥æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚</li></ul><p>djangoæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„ï¼Œç›¸å½“æ˜“ç”¨çš„äº‹åŠ¡æœºåˆ¶ï¼Œåœ¨ç›¸å¯¹ç›´è§‚çš„æ¨¡å¼ä¸­ä½¿ç”¨è£…é¥°å™¨å’Œä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¿éšœäº†é¡¹ç›®ä¸­æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><h4 id="7-7-1-åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å°è£…æ¯ä¸ªhttp-request"><a href="#7-7-1-åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å°è£…æ¯ä¸ªhttp-request" class="headerlink" title="7.7.1 åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å°è£…æ¯ä¸ªhttp request"></a>7.7.1 åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å°è£…æ¯ä¸ªhttp request</h4><pre><code># settings/base.pyDATABASES = {    &apos;default&apos;: {        # ...        &apos;ATOMIC_REQUESTS&apos;: True,    },}</code></pre><p>djangoä¸­é€šè¿‡è®¾ç½®ATOMIC_REQUESTS è®©å¤„ç†äº‹åŠ¡é‡Œçš„æ‰€æœ‰webè¯·æ±‚å˜å¾—æ›´å®¹æ˜“ã€‚é€šè¿‡è®¾ç½®â€™ATOMIC_REQUESTSâ€™: True,<br>æ‰€æœ‰çš„requestséƒ½è¢«å°è£…åœ¨äº†äº‹åŠ¡ä¸­ï¼ŒåŒ…æ‹¬åªè¯»æ•°æ®ã€‚è¿™ç§æ–¹æ³•çš„ä¼˜åŠ¿æ˜¯ä¿è¯äº†å®‰å…¨æ€§ï¼šæ‰€æœ‰åœ¨è§†å›¾ä¸­çš„æ•°æ®æŸ¥è¯¢éƒ½è¢«ä¿æŠ¤èµ·æ¥äº†ï¼Œ<br>åŠ£åŠ¿æ˜¯æ€§èƒ½å—åˆ°äº†å½±å“ã€‚æˆ‘ä»¬æ— æ³•å‘Šè¯‰ä½ è¿™ä¼šå½±å“å¤šå°‘æ€§èƒ½ï¼Œå› ä¸ºå®ƒä¾èµ–ç‹¬ç«‹çš„æ•°æ®åº“è®¾è®¡å’Œä¸åŒçš„æ•°æ®åº“å¼•æ“</p><p>å½“ç”¨ATOMIC_REQUESTSçš„æ—¶å€™ï¼Œè¿˜æœ‰ä¸€ä»¶äº‹æƒ…éœ€è¦ç‰¢è®°ï¼Œå‡ºç°é”™è¯¯çš„æ—¶å€™åªæœ‰æ•°æ®åº“çš„çŠ¶æ€ä¼šå›æ»šã€‚<br>å‘å‡ºä¸€å°ç¡®è®¤é‚®ä»¶ï¼Œç„¶åå°è£…çš„requestäº‹åŠ¡å›æ»šäº†ï¼Œå‡ºç°è¿™ç§æƒ…å†µä¼šä»¤äººç›¸å½“å°´å°¬ã€‚è¿™ä¸ªé—®é¢˜å¯èƒ½ä¼šå‘ç”Ÿåœ¨æ•°æ®åº“ä»¥å¤–çš„ä»»ä½•çš„<code>å†™å…¥</code>è¿‡ç¨‹ä¸­ï¼š<br>å‘é€é‚®ä»¶ï¼ŒçŸ­ä¿¡æœåŠ¡ï¼Œè°ƒç”¨ç¬¬ä¸‰æ–¹APIï¼Œå†™å…¥ç³»ç»Ÿæ–‡ä»¶ç­‰ç­‰ã€‚ç„¶è€Œï¼Œå½“å†™ä¸€ä¸ªèƒ½create/update/deleteçš„viewsçš„æ—¶å€™ï¼Œè€Œä¸”å®ƒä¸ä¸æ•°æ®åº“æ¡ç›®è¿›è¡Œäº¤äº’ï¼Œ<br>ä½ åº”è¯¥ç»™viewåŠ ä¸Štransaction.non_atomic_requests()è£…é¥°å™¨</p><pre><code># flavors/views.pyfrom django.db import transactionfrom django.http import HttpResponsefrom django.shortcuts import get_object_or_404from django.utils import timezonefrom .models import Flavor@transaction.non_atomic_requestsdef posting_flavor_status(request, pk, status):    flavor = get_object_or_404(Flavor, pk=pk)    # This will execute in autocommit mode (Django&apos;s default).    flavor.latest_status_change_attempt = timezone.now()    flavor.save()    with transaction.atomic():        # This code executes inside a transaction.        flavor.status = status        flavor.latest_status_change_success = timezone.now()        flavor.save()        return HttpResponse(&quot;Hooray&quot;)    # If the transaction fails, return the appropriate status    return HttpResponse(&quot;Sadness&quot;, status_code=400)</code></pre><h4 id="7-7-2-æ˜ç¡®çš„äº‹åŠ¡å£°æ˜"><a href="#7-7-2-æ˜ç¡®çš„äº‹åŠ¡å£°æ˜" class="headerlink" title="7.7.2 æ˜ç¡®çš„äº‹åŠ¡å£°æ˜"></a>7.7.2 æ˜ç¡®çš„äº‹åŠ¡å£°æ˜</h4><p>æ˜ç¡®çš„äº‹åŠ¡å£°æ˜æ˜¯ç»™ç«™ç‚¹å¢åŠ æ€§èƒ½çš„æ–¹å¼ä¹‹ä¸€ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æŒ‡å®šå“ªä¸ªè§†å›¾å’Œä¸šåŠ¡é€»è¾‘å°è£…åœ¨äº‹åŠ¡ä¸­ï¼Œå“ªä¸ªä¸å°è£…ã€‚<br>å½“è°ˆåˆ°äº‹åŠ¡çš„æ—¶å€™ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¥½çš„å‡†åˆ™ï¼š</p><ul><li>ä¸ä¿®æ”¹æ•°æ®çš„æ•°æ®åº“æ“ä½œä¸è¯¥è¢«å°è£…åœ¨äº‹åŠ¡ä¸­</li><li>ä¿®æ”¹æ•°æ®çš„æ•°æ®åº“æ“ä½œåº”è¯¥è¢«å°è£…åœ¨äº‹åŠ¡ä¸­</li><li>åŒ…å«æ•°æ®åº“çš„ä¿®æ”¹çš„ç‰¹æ®Šæƒ…å†µï¼Œéœ€è¦æ•°æ®åº“çš„è¯»å–å’Œæ€§èƒ½æ–¹é¢çš„è€ƒè™‘å¯èƒ½ä¼šå½±å“åˆ°å‰ä¸¤ä¸ªå‡†åˆ™</li></ul><p>å¦‚æœè¿˜æ˜¯ä¸å¤ªæ¸…æ¥šçš„è¯ï¼Œä¸‹é¢è¿™å¼ è¡¨å¯ä»¥å¾ˆå¥½çš„è§£é‡Šï¼š</p><table><thead><tr><th>ç›®çš„</th><th>ORMæ–¹æ³•</th><th>é€šå¸¸æƒ…å†µä¸‹ä½¿ç”¨äº‹åŠ¡</th></tr></thead><tbody><tr><td>åˆ›å»ºæ•°æ®</td><td>.create(), .bulk_create(), .get_or_create()</td><td>å¯ä»¥</td></tr><tr><td>æ¥æ”¶æ•°æ®</td><td>.get(), .filter(), .count(), .iterate(), .exists(), .exclude(), .in_bulk, ç­‰ç­‰</td><td></td></tr><tr><td>ä¿®æ”¹æ•°æ®</td><td>.update()</td><td>å¯ä»¥</td></tr><tr><td>åˆ é™¤æ•°æ®</td><td>.delete()</td><td>å¯ä»¥</td></tr></tbody></table><h4 id="7-7-3-django-http-StreamingHttpResponse-and-Transactions"><a href="#7-7-3-django-http-StreamingHttpResponse-and-Transactions" class="headerlink" title="7.7.3 django.http.StreamingHttpResponse and Transactions"></a>7.7.3 django.http.StreamingHttpResponse and Transactions</h4><p>å¦‚æœè§†å›¾å‡½æ•°æ­£åœ¨è¿”å›ä¸€ä¸ªdjango.http.StreamingHttpResponseï¼Œä¸€æ—¦responseå‘ç”Ÿï¼Œå®ƒä¸å¯èƒ½å»å¤„ç†äº‹åŠ¡é”™è¯¯ã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸­ç”¨åˆ°äº†è¿™ä¸ªresponseæ–¹æ³•ï¼Œé‚£ä¹ˆATOMIC_REQUESTSåº”è¯¥éµå¾ªä¸‹é¢å…¶ä¸­ä¸€ä¸ªï¼š</p><ul><li>æŠŠATOMIC_REQUESTSè®¾ç½®æˆé»˜è®¤çš„Falseï¼Œç„¶åæ˜ç¡®äº‹åŠ¡å£°æ˜ï¼Œæˆ–è€…â€¦</li><li>åœ¨django.db.transaction.non_atomic_requestsè£…é¥°å™¨ä¸­å°è£…view</li></ul><h4 id="7-7-4-MySQLä¸­çš„äº‹åŠ¡å¤„ç†"><a href="#7-7-4-MySQLä¸­çš„äº‹åŠ¡å¤„ç†" class="headerlink" title="7.7.4 MySQLä¸­çš„äº‹åŠ¡å¤„ç†"></a>7.7.4 MySQLä¸­çš„äº‹åŠ¡å¤„ç†</h4><p>MyISAMä¸æ”¯æŒäº‹åŠ¡å¤„ç†ï¼ŒInnoDBæ”¯æŒ</p><ul><li><a href="https://docs.djangoproject.com/en/1.8/topics/db/transactions/#transactions-in-mysql" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/topics/db/transactions/#transactions-in-mysql</a></li><li><a href="http://dev.mysql.com/doc/refman/5.0/en/sql-syntax-transactions.html" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.0/en/sql-syntax-transactions.html</a></li></ul><h4 id="7-7-5-å…³äºDjango-ORM-äº‹åŠ¡å¤„ç†çš„èµ„æ–™"><a href="#7-7-5-å…³äºDjango-ORM-äº‹åŠ¡å¤„ç†çš„èµ„æ–™" class="headerlink" title="7.7.5 å…³äºDjango ORM äº‹åŠ¡å¤„ç†çš„èµ„æ–™"></a>7.7.5 å…³äºDjango ORM äº‹åŠ¡å¤„ç†çš„èµ„æ–™</h4><ul><li>æ–‡æ¡£ <a href="https://docs.djangoproject.com/en/1.8/topics/db/transactions/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/topics/db/transactions/</a></li><li>real python <a href="https://realpython.com/blog/python/transaction-management-with-django-1-6/" target="_blank" rel="noopener">https://realpython.com/blog/python/transaction-management-with-django-1-6/</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;7-æŸ¥è¯¢å’Œæ•°æ®åº“å±‚&quot;&gt;&lt;a href=&quot;#7-æŸ¥è¯¢å’Œæ•°æ®åº“å±‚&quot; class=&quot;headerlink&quot; title=&quot;7. æŸ¥è¯¢å’Œæ•°æ®åº“å±‚&quot;&gt;&lt;/a&gt;7. æŸ¥è¯¢å’Œæ•°æ®åº“å±‚&lt;/h2&gt;&lt;h3 id=&quot;7-1-å¯¹å•ä¸ªå¯¹è±¡ä½¿ç”¨get-object-or-404&quot;&gt;&lt;a href=&quot;#7-1-å¯¹å•ä¸ªå¯¹è±¡ä½¿ç”¨get-object-or-404&quot; class=&quot;headerlink&quot; title=&quot;7.1 å¯¹å•ä¸ªå¯¹è±¡ä½¿ç”¨get_object_or_404()&quot;&gt;&lt;/a&gt;7.1 å¯¹å•ä¸ªå¯¹è±¡ä½¿ç”¨&lt;code&gt;get_object_or_404()&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;åœ¨è¯¦æƒ…é¡µé¢è§†å›¾ä¸­ï¼Œå¦‚æœä½ æƒ³æ¥å—å•ä¸ªå¯¹è±¡ï¼Œç”¨&lt;code&gt;get_object_or_404()&lt;/code&gt;ä»£æ›¿&lt;code&gt;get()&lt;/code&gt;&lt;br&gt;è­¦å‘Šï¼šåªåœ¨è§†å›¾ä¸­ä½¿ç”¨!!!åªåœ¨è§†å›¾ä¸­ä½¿ç”¨!!!åªåœ¨è§†å›¾ä¸­ä½¿ç”¨!!!&lt;/p&gt;
&lt;h3 id=&quot;7-2-è°¨æ…çš„ä½¿ç”¨æŸ¥è¯¢ï¼Œå®ƒå¯èƒ½æŠ›å‡ºå¼‚å¸¸&quot;&gt;&lt;a href=&quot;#7-2-è°¨æ…çš„ä½¿ç”¨æŸ¥è¯¢ï¼Œå®ƒå¯èƒ½æŠ›å‡ºå¼‚å¸¸&quot; class=&quot;headerlink&quot; title=&quot;7.2 è°¨æ…çš„ä½¿ç”¨æŸ¥è¯¢ï¼Œå®ƒå¯èƒ½æŠ›å‡ºå¼‚å¸¸&quot;&gt;&lt;/a&gt;7.2 è°¨æ…çš„ä½¿ç”¨æŸ¥è¯¢ï¼Œå®ƒå¯èƒ½æŠ›å‡ºå¼‚å¸¸&lt;/h3&gt;&lt;p&gt;å½“ä½ é€šè¿‡&lt;code&gt;get_object_or_404()&lt;/code&gt;è¿™ä¸ªå¿«æ·æ–¹å¼å¾—åˆ°Modelçš„å®ä¾‹çš„æ—¶å€™ï¼Œä¸éœ€è¦ç”¨try-exceptå°è£…ï¼Œ&lt;br&gt;å› ä¸º&lt;code&gt;get_object_or_404()&lt;/code&gt;å·²ç»å¸®ä½ å°è£…å¥½äº†ã€‚&lt;br&gt;ç„¶è€Œï¼Œåœ¨å…¶ä»–å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ éœ€è¦ä½¿ç”¨try-exceptã€‚ä¸€äº›tips:&lt;/p&gt;
&lt;h4 id=&quot;7-2-1-ObjectDoesNotExist-vs-DoesNotExist&quot;&gt;&lt;a href=&quot;#7-2-1-ObjectDoesNotExist-vs-DoesNotExist&quot; class=&quot;headerlink&quot; title=&quot;7.2.1 ObjectDoesNotExist vs. DoesNotExist&quot;&gt;&lt;/a&gt;7.2.1 ObjectDoesNotExist vs. DoesNotExist&lt;/h4&gt;&lt;p&gt;ObjectDoesNotExistå…è®¸è¢«ä½¿ç”¨åœ¨ä»»ä½•modelå¯¹è±¡ä¸­ï¼Œä½†æ˜¯DoesNotExiståªèƒ½åœ¨ä¸€äº›ç‰¹å®šçš„modelä¸­ä½¿ç”¨&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from django.core.exceptions import ObjectDoesNotExist

from flavors.models import Flavor
from store.exceptions import OutOfStock

def list_flavor_line_item(sku):
    try:
        return Flavor.objects.get(sku=sku, quantity__gt=0)
    except Flavor.DoesNotExist:
        msg = &amp;quot;We are out of {0}&amp;quot;.format(sku)
        raise OutOfStock(msg)

def list_any_line_item(model, sku):
    try:
        return model.objects.get(sku=sku, quantity__gt=0)
    except ObjectDoesNotExist:
        msg = &amp;quot;We are out of {0}&amp;quot;.format(sku)
        raise OutOfStock(msg)
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="Backend" scheme="https://morningchen.com/categories/Backend/"/>
    
      <category term="Django" scheme="https://morningchen.com/categories/Backend/Django/"/>
    
    
      <category term="Django" scheme="https://morningchen.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>Two Scoops of Django 1.8 å­¦ä¹ ç¬”è®°äºŒ</title>
    <link href="https://morningchen.com/2015/09/07/Two-Scoops-of-Django-1-8-notes-2/"/>
    <id>https://morningchen.com/2015/09/07/Two-Scoops-of-Django-1-8-notes-2/</id>
    <published>2015-09-07T09:27:03.000Z</published>
    <updated>2018-09-27T03:56:31.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="6-Model-æœ€ä½³å®è·µ"><a href="#6-Model-æœ€ä½³å®è·µ" class="headerlink" title="6. Model æœ€ä½³å®è·µ"></a>6. Model æœ€ä½³å®è·µ</h2><p>Modelsæ˜¯å¤§å¤šæ•°djangoé¡¹ç›®çš„åŸºç¡€ï¼Œåœ¨åˆ›å»ºModelçš„æ—¶å€™è¯·ä¸‰æ€è€Œåè¡Œï¼Œå……åˆ†è€ƒè™‘ä¹‹åå†åˆ›å»ºå¤§è€Œå…¨çš„Modelã€‚</p><h3 id="6-1-åŸºç¡€"><a href="#6-1-åŸºç¡€" class="headerlink" title="6.1 åŸºç¡€"></a>6.1 åŸºç¡€</h3><h4 id="6-1-1-æ‹†åˆ†æ‹¥æœ‰è¿‡å¤šmodelsçš„app"><a href="#6-1-1-æ‹†åˆ†æ‹¥æœ‰è¿‡å¤šmodelsçš„app" class="headerlink" title="6.1.1 æ‹†åˆ†æ‹¥æœ‰è¿‡å¤šmodelsçš„app"></a>6.1.1 æ‹†åˆ†æ‹¥æœ‰è¿‡å¤šmodelsçš„app</h4><p>å¦‚æœä¸€ä¸ªappæœ‰20+ models,è€ƒè™‘ä¸‹èƒ½ä¸èƒ½æŠŠè¿™äº›modelsæ‹†åˆ†åˆ°æ›´å°çš„appé‡Œé¢ï¼Œå› ä¸ºè¿™å¯èƒ½æ„å‘³ç€ä½ çš„appåšäº†å¤ªå¤šçš„äº‹æƒ…ã€‚<br>åœ¨å®é™…ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå°†è¿™ä¸ªæ•°å€¼å‡å°è‡³æ¯ä¸ªappä¸è¶…è¿‡5ä¸ªmodels</p><h4 id="6-1-2-è°¨æ…ä½¿ç”¨modelç»§æ‰¿"><a href="#6-1-2-è°¨æ…ä½¿ç”¨modelç»§æ‰¿" class="headerlink" title="6.1.2 è°¨æ…ä½¿ç”¨modelç»§æ‰¿"></a>6.1.2 è°¨æ…ä½¿ç”¨modelç»§æ‰¿</h4><p>Djangoä¸­çš„modelç»§æ‰¿æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼ŒDjangoæä¾›äº†ä¸‰ç§ç»§æ‰¿æ–¹å¼ï¼š</p><ul><li>Abstract base classes</li><li>Multi-table inheritance</li><li>Proxy models</li></ul><p>ä»–ä»¬ä¹‹é—´çš„å…·ä½“ä¼˜ç¼ºç‚¹æ¯”è¾ƒå¦‚ä¸‹ï¼š</p><a id="more"></a><table><thead><tr><th>modelç»§æ‰¿ç±»å‹</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>ä¸ä½¿ç”¨modelç»§æ‰¿ï¼šå¦‚æœmodelsæœ‰ä¸€ä¸ªå…±åŒçš„å­—æ®µï¼Œç»™æ¯ä¸ªmodeléƒ½èµ‹äºˆé‚£ä¸ªå­—æ®µ</td><td>ä¾¿äºç†è§£modelså’Œæ•°æ®åº“è¡¨ä¹‹é—´çš„å…³ç³»</td><td>è¿‡å¤šçš„å­—æ®µç©¿æ’åœ¨modelsä¸­ï¼Œä¸åˆ©äºç»´æŠ¤</td></tr><tr><td>Abstract base classes(æŠ½è±¡åŸºç±»)ï¼šä»…ç”¨äºè¡ç”Ÿæ¨¡å‹</td><td>ä¸€ä¸ªæŠ½è±¡çˆ¶ç±»ä¸­æ‹¥æœ‰å…±åŒçš„å­—æ®µï¼Œä»è€Œå‡å°‘äº†æˆ‘ä»¬çš„è¾“å…¥ã€‚</td><td>ä¸èƒ½å•ç‹¬ä½¿ç”¨çˆ¶ç±»ã€‚</td></tr><tr><td>Multi-table inheritanceï¼ˆå¤šè¡¨ç»§æ‰¿ï¼‰ï¼šç”¨äºå°†çˆ¶ç±»å­ç±»è”ç³»èµ·æ¥ï¼Œéšæ™¦çš„æ„æ€å°±æ˜¯OneToOneField</td><td>ç»™äº†æ¯ä¸ªmodelä¸€å¼ è¡¨ï¼Œå› æ­¤æˆ‘ä»¬æ—¢èƒ½æŸ¥è¯¢çˆ¶ç±»ä¹Ÿå¯ä»¥æŸ¥è¯¢å­ç±»ã€‚è€Œä¸”æˆ‘ä»¬ä»çˆ¶ç±»ä¸­å¾—åˆ°äº†ä¸€ä¸ªå­å¯¹è±¡ï¼šparent.child</td><td>å¢åŠ äº†å¤§é‡çš„å¼€é”€ï¼Œå› ä¸ºä¸Šä¸€ä¸ªå­è¡¨çš„æ¯ä¸ªæŸ¥è¯¢éœ€è¦åŠ å…¥åˆ°æ‰€æœ‰çˆ¶è¡¨ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨å¤šè¡¨ç»§æ‰¿ã€‚</td></tr><tr><td>Proxy modelsï¼ˆä»£ç†æ¨¡å‹ï¼‰ï¼šä»…ç”¨äºåŸå§‹æ¨¡å‹</td><td>è®©æˆ‘ä»¬æ‹¥æœ‰å…·å¤‡ä¸åŒPythonè¡Œä¸ºçš„modelåˆ«åã€‚</td><td>æˆ‘ä»¬ä¸èƒ½ä¿®æ”¹modelçš„å­—æ®µ</td></tr></tbody></table><p>é‚£ä¹ˆå…·ä½“ä»€ä¹ˆæ—¶å€™è¯¥ä½¿ç”¨å“ªä¸€ç§ modelç»§æ‰¿å‘¢ï¼Ÿä¸‹é¢æä¾›ä¸€ä¸ªç®€å•çš„è§„åˆ™ï¼š</p><ul><li>å¦‚æœmodelsä¹‹é—´åªæœ‰æå°çš„é‡å éƒ¨åˆ†ï¼ˆæ¯”å¦‚è¯´ä¸¤ä¸ªæ¨¡å‹åªæœ‰ä¸€ä¸¤ä¸ªå…±åŒçš„å­—æ®µï¼‰ï¼Œé‚£ä¹ˆå°±ä¸å¿…ä½¿ç”¨ modelç»§æ‰¿ï¼Œç»™æ¯ä¸ªmodeléƒ½åŠ ä¸Šé‚£ä¸ªå­—æ®µå°±å¥½å•¦</li><li>å¦‚æœmodelsä¹‹é—´æœ‰å¾ˆå¤šé‡å éƒ¨åˆ†ï¼Œè€Œä¸”è¿™äº›é‡å¤çš„å­—æ®µçš„ç»´æŠ¤ä¼šç»™æˆ‘ä»¬é€ æˆå›°æƒ‘å’Œæ„æƒ³ä¸åˆ°çš„é”™è¯¯ï¼Œ<br>é‚£ä¹ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å°±éœ€è¦è€ƒè™‘ä»£ç é‡æ„äº†ã€‚å› æ­¤æˆ‘ä»¬æŠŠè¿™äº›å…±åŒçš„å­—æ®µå†™åˆ°Abstract base classesä¸­</li><li>Proxy models æ˜¯ä¸€ä¸ªå¶å°”æœ‰ç”¨çš„ä¾¿æ·åŠŸèƒ½ï¼Œä½†æ˜¯ä»–å’Œå…¶ä»–ä¸¤ç§ modelç»§æ‰¿æ–¹å¼æœ‰éå¸¸å¤§çš„ä¸åŒ</li><li>æ¯ä¸ªäººéƒ½åº”è¯¥é¿å…ä½¿ç”¨Multi-table inheritanceï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä½¿ç”¨ OneToOneField å’Œ ForeignKey</li></ul><h4 id="6-1-3-å®è·µä¸­çš„-modelç»§æ‰¿-TimeStampedModel"><a href="#6-1-3-å®è·µä¸­çš„-modelç»§æ‰¿-TimeStampedModel" class="headerlink" title="6.1.3 å®è·µä¸­çš„ modelç»§æ‰¿: TimeStampedModel"></a>6.1.3 å®è·µä¸­çš„ modelç»§æ‰¿: TimeStampedModel</h4><p>åœ¨Djangoé¡¹ç›®ä¸­å¤§å¤šæ•° modeléƒ½ä¼šåŒ…å«ä¸€ä¸ªèƒ½åˆ›å»ºå’Œä¿®æ”¹çš„æ—¶é—´æˆ³å­—æ®µã€‚æœ€å¥½çš„æ–¹æ³•å°±æ˜¯å†™ä¸€ä¸ªTimeStampedModel</p><pre><code># core/models.pyfrom django.db import modelsclass TimeStampedModel(models.Model):    &quot;&quot;&quot;    An abstract base class model that provides    self-updating created and modified fields.    &quot;&quot;&quot;    created = models.DateTimeField(auto_now_add=True)    modified = models.DateTimeField(auto_now=True)    class Meta:        abstract = True</code></pre><p>æ³¨æ„ä¸Šé¢ä»£ç çš„æœ€å2å¥ï¼Œä»–æŠŠè¿™ä¸ªmodelè½¬åŒ–æˆäº†abstract base class.<br>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»§æ‰¿TimeStampedModelçš„æ–°çš„classçš„ä¹‹åï¼Œè¿è¡Œmigrate,<br>Djangoä¸ä¼šåœ¨æ•°æ®åº“åˆ›å»ºä¸€å¼ åä¸º core_timestampedmodelçš„è¡¨ã€‚</p><pre><code># flavors/models.pyfrom django.db import modelsfrom core.models import TimeStampedModelclass Flavor(TimeStampedModel):    title = models.CharField(max_length=200)</code></pre><p>Flavorç»§æ‰¿è‡ª TimeStampedModel å½“æˆ‘ä»¬migrateçš„æ—¶å€™åªä¼šåˆ›å»ºä¸€å¼ åä¸º flavors_flavorçš„è¡¨ã€‚è¿™è¯´æ˜Abstract base classesä¸ä¼šå•ç‹¬çš„åˆ›å»ºä¸€å¼ è¡¨ï¼Œç®€ç›´å®Œç¾ã€‚</p><h4 id="6-1-4-Database-Migrations-æ•°æ®è¿ç§»"><a href="#6-1-4-Database-Migrations-æ•°æ®è¿ç§»" class="headerlink" title="6.1.4 Database Migrations æ•°æ®è¿ç§»"></a>6.1.4 Database Migrations æ•°æ®è¿ç§»</h4><p>åˆ›å»ºè¿ç§»æ–‡ä»¶çš„tipsï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªæ–°çš„app æˆ–è€… modelä¹‹åï¼ŒèŠ±ä¸€ç‚¹ç‚¹æ—¶é—´æ¥ç»™è¿™ä¸ª modelåˆ›å»ºä¸€ä¸ªåˆå§‹çš„ django.db.migrationsã€‚æˆ‘ä»¬åªéœ€è¦python manage.py makemigrations</li><li>åœ¨è¿è¡Œä¹‹å‰æ£€æŸ¥ä¸€ä¸‹ç”Ÿæˆçš„migrationä»£ç ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ°è¾ƒå¤æ‚çš„æ”¹å˜çš„æ—¶å€™ã€‚å¹¶ä¸”å¤æŸ¥ä¸€ä¸‹SQL</li><li>ç”¨<a href="https://docs.djangoproject.com/en/1.8/ref/settings/#std:setting-MIGRATION_MODULES" target="_blank" rel="noopener">MIGRATION_MODULES</a> æ¥ç®¡ç†é‚£äº›æ²¡æœ‰è‡ªå·±çš„django.db.migrationsé£æ ¼çš„è¿ç§»æ–‡ä»¶</li><li>ä¸ç”¨æ‹…å¿ƒåˆ›å»ºäº†å¤šå°‘ä¸ªè¿ç§»æ–‡ä»¶ï¼Œå¦‚æœæ•°é‡å¤ªè¿‡ç¬¨æ‹™ï¼Œä½¿ç”¨ <a href="https://docs.djangoproject.com/en/1.8/topics/migrations/#squashing-migrations" target="_blank" rel="noopener">squashmigrations</a>ä½¿ä»–ä»¬å°±èŒƒ</li></ul><p>migrationsçš„éƒ¨ç½²å’Œç®¡ç†ï¼š</p><ul><li>åœ¨é¡¹ç›®éƒ¨ç½²ä¹‹å‰ï¼Œä¸€å®šè¦æ£€æŸ¥æ˜¯å¦å¯ä»¥å›æ»šmigrationsã€‚</li><li>å¦‚æœä¸€ä¸ªé¡¹ç›®æœ‰ä¸Šç™¾ä¸‡æ¡æ•°æ®ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨ä¸Šè¿è¡Œmigrationä¹‹å‰ï¼Œè¯·åœ¨stagingæœåŠ¡å™¨ä¸Šåšç²—çŠ·æµ‹è¯•ï¼Œåœ¨çœŸå®æ•°æ®ä¸Šè·‘migrationsä¼šæ¯”é¢„æƒ³ä¸­èŠ±æ›´å¤šæ›´å¤šæ›´å¤šæ—¶é—´ï¼</li><li><p>å¦‚æœä½ åœ¨ç”¨Mysql:</p><ol><li>åœ¨ä»»ä¸€æ¶æ„æ”¹å˜ä¹‹å‰å¿…é¡»æ‹†åˆ†æ•°æ®åº“ï¼ŒMYSQLç¼ºä¹å›´ç»•æ¶æ„æ›´æ”¹çš„äº‹åŠ¡æ”¯æŒï¼Œå› æ­¤ä¸å¯èƒ½å›æ»š</li><li>å¦‚æœå¯ä»¥çš„è¯ï¼Œåœ¨æ‰§è¡Œä¿®æ”¹ä¹‹å‰æŠŠè¿™ä¸ªé¡¹ç›®è®¾ç½®æˆåªè¯»æ¨¡å¼</li><li>å¦‚æœä¸å°å¿ƒï¼Œåœ¨åºå¤§çš„è¡¨ä¸­ä¿®æ”¹äº†æ¶æ„ï¼Œé‚£ä¹ˆå°†ä¼šèŠ±å¾ˆé•¿çš„æ—¶é—´ï¼Œä¸æ˜¯å‡ ç§’å‡ åˆ†çš„æ¦‚å¿µï¼Œè€Œæ˜¯å‡ å°æ—¶</li></ol></li></ul><h3 id="6-2-Django-Model-è®¾è®¡"><a href="#6-2-Django-Model-è®¾è®¡" class="headerlink" title="6.2 Django Model è®¾è®¡"></a>6.2 Django Model è®¾è®¡</h3><p>å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¥½çš„django models æ˜¯æœ€éš¾çš„ä¸»é¢˜ä¹‹ä¸€</p><h4 id="6-2-1-è§„èŒƒåŒ–å¼€ç«¯"><a href="#6-2-1-è§„èŒƒåŒ–å¼€ç«¯" class="headerlink" title="6.2.1 è§„èŒƒåŒ–å¼€ç«¯"></a>6.2.1 è§„èŒƒåŒ–å¼€ç«¯</h4><p>å¼€å§‹ä¹‹å‰ï¼Œè¯·ç†Ÿæ‚‰ä¸‹æ•°æ®åº“æ ‡å‡†åŒ–(Database normalization)</p><ul><li><a href="https://en.wikipedia.org/wiki/Database_normalization" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Database_normalization</a></li><li><a href="https://en.wikibooks.org/wiki/Relational_Database_Design/Normalization" target="_blank" rel="noopener">https://en.wikibooks.org/wiki/Relational_Database_Design/Normalization</a></li></ul><h4 id="6-2-2-ä»€ä¹ˆæ—¶å€™ç”¨nullå’Œblank"><a href="#6-2-2-ä»€ä¹ˆæ—¶å€™ç”¨nullå’Œblank" class="headerlink" title="6.2.2 ä»€ä¹ˆæ—¶å€™ç”¨nullå’Œblank"></a>6.2.2 ä»€ä¹ˆæ—¶å€™ç”¨nullå’Œblank</h4><table><thead><tr><th>å­—æ®µç±»å‹</th><th>è®¾ç½® null=True</th><th>è®¾ç½® blank=True</th></tr></thead><tbody><tr><td>CharField, TextField, SlugField, EmailField, CommaSepararedIntegerField, UUIDField</td><td>ä¸è¡Œ</td><td>å¯ä»¥</td></tr><tr><td>FileField, ImageField</td><td>ä¸è¡Œ</td><td>å¯ä»¥</td></tr><tr><td>BooleanField</td><td>ä¸è¡Œ ç”¨NullBooleanFieldä»£æ›¿</td><td>ä¸è¡Œ</td></tr><tr><td>IntegerField, FloatField, DecimalField, DurationField, etc</td><td>å¯ä»¥</td><td>å¯ä»¥</td></tr><tr><td>DateTimeField, DateField, TimeField, etc</td><td>å¯ä»¥</td><td>å¯ä»¥</td></tr><tr><td>ForeignKey, ManyToManyField, OneToOneField</td><td>å¯ä»¥</td><td>å¯ä»¥</td></tr><tr><td>GenericIPAddressField</td><td>å¯ä»¥</td><td>å¯ä»¥</td></tr><tr><td>IPAddressField</td><td>å·²å¼ƒç”¨  ç”¨GenericIPAddressFieldä»£æ›¿</td><td>å·²å¼ƒç”¨  ç”¨GenericIPAddressFieldä»£æ›¿</td></tr></tbody></table><h4 id="6-2-3-é¿å…ä½¿ç”¨Generic-Relations"><a href="#6-2-3-é¿å…ä½¿ç”¨Generic-Relations" class="headerlink" title="6.2.3 é¿å…ä½¿ç”¨Generic Relations"></a>6.2.3 é¿å…ä½¿ç”¨Generic Relations</h4><p>ä½¿ç”¨Generic Relationsçš„å¼Šå¤§äºåˆ©ï¼Œç®€è€Œè¨€ä¹‹ï¼š</p><ul><li>é¿å…ä½¿ç”¨ Generic Relations å’Œ GenericForeignKey</li><li>å¦‚æœä½ è§‰å¾—ä½ éœ€è¦ä½¿ç”¨ Generic Relationsçš„è¯ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½é€šè¿‡æ›´å¥½çš„ modelè®¾è®¡æˆ–è€… PostgreSQLé‡Œçš„æ–°å­—æ®µä»£æ›¿</li><li>å¦‚æœå¿…é¡»è¦ç”¨ï¼Œå°è¯•ä½¿ç”¨ç°æˆçš„ç¬¬ä¸‰æ–¹appï¼Œç¬¬ä¸‰æ–¹appæä¾›çš„éš”ç¦»å°†æœ‰åŠ©äºä¿è¯æ•°æ®æ›´å¹²å‡€</li></ul><h4 id="6-2-4-PostgreSQLä¸­çš„ç‰¹åˆ«å­—æ®µä»€ä¹ˆæ—¶å€™ç”¨nullå’Œblank"><a href="#6-2-4-PostgreSQLä¸­çš„ç‰¹åˆ«å­—æ®µä»€ä¹ˆæ—¶å€™ç”¨nullå’Œblank" class="headerlink" title="6.2.4 PostgreSQLä¸­çš„ç‰¹åˆ«å­—æ®µä»€ä¹ˆæ—¶å€™ç”¨nullå’Œblank"></a>6.2.4 PostgreSQLä¸­çš„ç‰¹åˆ«å­—æ®µä»€ä¹ˆæ—¶å€™ç”¨nullå’Œblank</h4><table><thead><tr><th>å­—æ®µç±»å‹</th><th>è®¾ç½® null=True</th><th>è®¾ç½® blank=True</th></tr></thead><tbody><tr><td>ArrayField</td><td>å¯ä»¥</td><td>å¯ä»¥</td></tr><tr><td>HStoreField</td><td>å¯ä»¥</td><td>å¯ä»¥</td></tr><tr><td>IntegerRangeField, BigIntegerRangeField, FloatRangeField</td><td>å¯ä»¥</td><td>å¯ä»¥</td></tr><tr><td>DateTimeRangeField, DateRangeField</td><td>å¯ä»¥</td><td>å¯ä»¥</td></tr></tbody></table><h3 id="6-3-The-Model-meta-API"><a href="#6-3-The-Model-meta-API" class="headerlink" title="6.3 The Model _meta API"></a>6.3 The Model <code>_meta</code> API</h3><p>Django 1.8ä¹‹å‰ï¼ŒModel <code>_meta</code> API éƒ½è¿˜æ˜¯éå®˜æ–¹çš„ï¼Œå³ä½¿ä¿®æ”¹äº†apiçš„å†…å®¹ä¹Ÿä¸ä¼šæåŠã€‚<br>æœ€åˆçš„ç›®çš„åªæ˜¯è®©Modelå®ƒè‡ªå·±å‚¨å­˜ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œç„¶è€Œè¿™ä¸€åŠŸèƒ½å·²ç»è¯å®<code>_meta</code>æ˜¯ç›¸å½“æœ‰ç”¨çš„ï¼Œæ‰€ä»¥ç°åœ¨æœ‰APIæ–‡æ¡£äº†</p><p>å¤§å¤šæ•°é¡¹ç›®é‡Œä½ éƒ½ä¸ä¼šéœ€è¦ <code>_meta</code>ï¼Œå®ƒçš„ä¸»è¦ç”¨é€”æ˜¯ï¼Œå½“ä½ éœ€è¦</p><ul><li>å¾—åˆ°modelçš„å­—æ®µåˆ—è¡¨</li><li>å¾—åˆ°classçš„ç‰¹å®šå­—æ®µï¼ˆæˆ–è€…å®ƒçš„ç»§æ‰¿é“¾ï¼Œæˆ–è€…å®ƒçš„æ´¾ç”Ÿï¼‰</li><li>åœ¨è·¨æœªæ¥çš„djangoç‰ˆæœ¬ä¸­ï¼Œç¡®ä¿å¦‚ä½•è®©ä½ å¾—åˆ°è¿™äº›ä¿¡æ¯ä¿æŒä¸å˜</li></ul><p>ä¾‹å¦‚ä¸‹é¢è¿™äº›ä¾‹å­ï¼š</p><ul><li>æ„é€ ä¸€ä¸ªdjango modelçš„è‡ªçœå·¥å…·</li><li>æ„é€ è‡ªå®šä¹‰çš„è¡¨å•åº“</li><li>åˆ›å»ºä¸€ä¸ªç±»ç®¡ç†å‘˜å·¥å…·æ¥ä¸django modelè¿›è¡Œç¼–è¾‘å’Œäº¤äº’</li><li>å†™ä¸€ä¸ªå¯è§†åŒ–çš„æˆ–è€…å…·æœ‰åˆ†æåŠ›çš„åº“</li></ul><p>æ‰©å±•é˜…è¯»ï¼š</p><ul><li>Model <code>_meta</code> æ–‡æ¡£: <a href="https://docs.djangoproject.com/en/1.8/ref/models/meta/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/ref/models/meta/</a></li><li>django 1.8 çš„æ›´æ–°è¯´æ˜ä¸­å…³äº model <code>_meta</code> çš„è§£é‡Š<a href="https://docs.djangoproject.com/en/1.8/releases/1.8/#model-meta-api" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/releases/1.8/#model-meta-api</a></li></ul><h3 id="6-4-Model-Managers-æ¨¡å‹ç®¡ç†å™¨"><a href="#6-4-Model-Managers-æ¨¡å‹ç®¡ç†å™¨" class="headerlink" title="6.4 Model Managers æ¨¡å‹ç®¡ç†å™¨"></a>6.4 Model Managers æ¨¡å‹ç®¡ç†å™¨</h3><p>æ¯å½“æˆ‘ä»¬ç”¨djangoçš„ORMæ¥æŸ¥è¯¢modelçš„æ—¶å€™ï¼Œ æˆ‘ä»¬éƒ½ä¼šç”¨åˆ°ä¸€ä¸ªåå« Model Managersçš„æ¥å£æ¥ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’, Model Managerså¯ä»¥è¯´æ˜¯è¿™ä¸ªæ¨¡å‹ç±»çš„æ‰€æœ‰å¯èƒ½çš„å®ä¾‹ã€‚<br>Djangoç»™æ¯ä¸ªmodeléƒ½æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„ Model Managersï¼Œä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å¯ä»¥å®šä¹‰è‡ªå·±çš„Model Managers.</p><pre><code>from django.db import modelsfrom django.utils import timezoneclass PublishedManager(models.Manager):    use_for_related_fields = True    def published(self, **kwargs):        return self.filter(pub_date__lte=timezone.now(), **kwargs)class FlavorReview(models.Model):    review = models.CharField(max_length=255)    pub_date = models.DateTimeField()    # add our custom model manager    objects = PublishedManager()</code></pre><p>ç°åœ¨å¦‚æœæˆ‘ä»¬æƒ³è¦å…ˆæ˜¾ç¤ºæ‰€æœ‰çš„è¯„è®ºï¼Œç„¶åæ˜¾ç¤ºå·²å‘å¸ƒçš„è¯„è®ºï¼Œå¯ä»¥è¿™æ ·åš</p><pre><code>&gt;&gt;&gt; from reviews.models import FlavorReview&gt;&gt;&gt; FlavorReview.objects.count()35&gt;&gt;&gt; FlavorReview.objects.published().count()31</code></pre><p>å¾ˆç®€å•ä¸æ˜¯å—ï¼Ÿä½†æ˜¯å¦‚æœä½ åªæ˜¯å¢åŠ äº†ç¬¬äºŒä¸ªModel Managersï¼Œä½ å¯èƒ½ä¼šç”¨åˆ°ä¸‹é¢çš„æ–¹æ³•ï¼š</p><pre><code># Bad example&gt;&gt;&gt; from reviews.models import FlavorReview&gt;&gt;&gt; FlavorReview.objects.filter().count()35&gt;&gt;&gt; FlavorReview.published().filter.count()31</code></pre><p>è¡¨é¢ä¸Šçœ‹æ¥ï¼Œå–ä»£é»˜è®¤çš„Model Managers æ˜¯å¸¸ç†çš„åšæ³•ï¼Œä¸å¹¸çš„æ˜¯ï¼Œåœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­å½“æˆ‘ä»¬ç”¨åˆ°è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™åº”è¯¥éå¸¸çš„å°å¿ƒã€‚ä¸ºå•¥ï¼Ÿ</p><ul><li>ç¬¬ä¸€ï¼Œå½“æˆ‘ä»¬ç”¨modelç»§æ‰¿çš„æ—¶å€™ï¼Œabstract base classesçš„å­ç±»æ¥å—æ¥è‡ªä»–ä»¬çˆ¶ç±»çš„managerï¼Œä½†æ˜¯concrete base classeså°±ä¸ä¼šã€‚</li><li>ç¬¬äºŒï¼Œåº”ç”¨åˆ°model classçš„ç¬¬ä¸€ä¸ªmanagerä¼šè¢«djangoå½“ä½œé»˜è®¤çš„managerï¼Œè¿™æ˜¾ç„¶æ‰“ç ´äº†pythonçš„æ¨¡å¼ï¼Œå¯¼è‡´ä¼šä»QuerySetä¸­å‡ºç°ä¸å¯é¢„çŸ¥çš„ç»“æœ<br>äº†è§£åˆ°ä»¥ä¸ŠçŸ¥è¯†ä¹‹åï¼Œä½ åº”è¯¥åœ¨è‡ªå®šä¹‰model managerä¹‹å‰å…ˆå®šä¹‰å¥½<code>objects = models.Managers()</code></li></ul><p>æ‰©å±•é˜…è¯»ï¼š<a href="https://docs.djangoproject.com/en/1.8/topics/db/managers/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.8/topics/db/managers/</a></p><h3 id="6-5-ç†è§£-Fat-Models"><a href="#6-5-ç†è§£-Fat-Models" class="headerlink" title="6.5 ç†è§£ Fat Models"></a>6.5 ç†è§£ Fat Models</h3><p>ä¹‹å‰æåˆ°è¿‡ Fat Modelsï¼Œæ„æ€æ˜¯ä¸è¦æŠŠæ•°æ®ç›¸å…³çš„ä»£ç éƒ½æ”¾åœ¨Viewså’ŒTemplatesé‡Œé¢ï¼Œ<br>è€Œæ˜¯å°†ä»–ä»¬çš„é€»è¾‘å°è£…åœ¨models methods, classmethods, properties,ç”šè‡³å¯ä»¥æ˜¯manager methodé‡Œã€‚<br>è¿™æ ·ï¼Œä»»æ„ä¸€ä¸ªviewsæˆ–è€…ä»»åŠ¡éƒ½å¯ä»¥ç”¨è¿™ä¸ªç›¸åŒçš„é€»è¾‘ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸ªIce Creamçš„è¯„è®ºmodelï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ¥è§¦åˆ°ä»¥ä¸‹çš„æ–¹æ³•ï¼š</p><ul><li><code>Review.create_review(cls, user, rating, title, description)</code><br>  ä¸€ä¸ªåˆ›å»ºè¯„è®ºçš„æ–¹æ³•ï¼Œä»HTMLå’ŒRESTè§†å›¾è°ƒç”¨model classæœ¬èº«ï¼Œä»¥åŠä¸€ä¸ªæ¥å—ç”µå­è¡¨æ ¼çš„å¯¼å…¥å·¥å…·</li><li><code>review.product_average</code>ä¸€ä¸ªè¯„è®ºçš„å®ä¾‹å±æ€§ï¼Œè¿”å›è¿™ä¸ªè¯„è®ºé¡¹ç›®çš„å¹³å‡æ’åã€‚ç”¨äºå®¡æŸ¥çš„ç»†èŠ‚è§†å›¾ï¼Œä»¥ä¾¿è¯»è€…ä¸ç¦»å¼€é¡µé¢å°±èƒ½æ„Ÿå—åˆ°æ•´ä½“çš„æ„è§</li><li><code>review.found_useful(self, user, yes)</code>è¿™ä¸ªæ–¹æ³•å¯ä»¥è®¾ç½®æˆæ˜¯æˆ–è€…å¦ï¼Œè®©è¯»è€…å‘ç°è¯„è®ºæ˜¯å¦æœ‰ç”¨ã€‚ç”¨äºè¯¦æƒ…å’Œåˆ—è¡¨è§†å›¾ï¼Œæ¥å®ç°HTMLå’ŒREST</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;6-Model-æœ€ä½³å®è·µ&quot;&gt;&lt;a href=&quot;#6-Model-æœ€ä½³å®è·µ&quot; class=&quot;headerlink&quot; title=&quot;6. Model æœ€ä½³å®è·µ&quot;&gt;&lt;/a&gt;6. Model æœ€ä½³å®è·µ&lt;/h2&gt;&lt;p&gt;Modelsæ˜¯å¤§å¤šæ•°djangoé¡¹ç›®çš„åŸºç¡€ï¼Œåœ¨åˆ›å»ºModelçš„æ—¶å€™è¯·ä¸‰æ€è€Œåè¡Œï¼Œå……åˆ†è€ƒè™‘ä¹‹åå†åˆ›å»ºå¤§è€Œå…¨çš„Modelã€‚&lt;/p&gt;
&lt;h3 id=&quot;6-1-åŸºç¡€&quot;&gt;&lt;a href=&quot;#6-1-åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;6.1 åŸºç¡€&quot;&gt;&lt;/a&gt;6.1 åŸºç¡€&lt;/h3&gt;&lt;h4 id=&quot;6-1-1-æ‹†åˆ†æ‹¥æœ‰è¿‡å¤šmodelsçš„app&quot;&gt;&lt;a href=&quot;#6-1-1-æ‹†åˆ†æ‹¥æœ‰è¿‡å¤šmodelsçš„app&quot; class=&quot;headerlink&quot; title=&quot;6.1.1 æ‹†åˆ†æ‹¥æœ‰è¿‡å¤šmodelsçš„app&quot;&gt;&lt;/a&gt;6.1.1 æ‹†åˆ†æ‹¥æœ‰è¿‡å¤šmodelsçš„app&lt;/h4&gt;&lt;p&gt;å¦‚æœä¸€ä¸ªappæœ‰20+ models,è€ƒè™‘ä¸‹èƒ½ä¸èƒ½æŠŠè¿™äº›modelsæ‹†åˆ†åˆ°æ›´å°çš„appé‡Œé¢ï¼Œå› ä¸ºè¿™å¯èƒ½æ„å‘³ç€ä½ çš„appåšäº†å¤ªå¤šçš„äº‹æƒ…ã€‚&lt;br&gt;åœ¨å®é™…ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå°†è¿™ä¸ªæ•°å€¼å‡å°è‡³æ¯ä¸ªappä¸è¶…è¿‡5ä¸ªmodels&lt;/p&gt;
&lt;h4 id=&quot;6-1-2-è°¨æ…ä½¿ç”¨modelç»§æ‰¿&quot;&gt;&lt;a href=&quot;#6-1-2-è°¨æ…ä½¿ç”¨modelç»§æ‰¿&quot; class=&quot;headerlink&quot; title=&quot;6.1.2 è°¨æ…ä½¿ç”¨modelç»§æ‰¿&quot;&gt;&lt;/a&gt;6.1.2 è°¨æ…ä½¿ç”¨modelç»§æ‰¿&lt;/h4&gt;&lt;p&gt;Djangoä¸­çš„modelç»§æ‰¿æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼ŒDjangoæä¾›äº†ä¸‰ç§ç»§æ‰¿æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Abstract base classes&lt;/li&gt;
&lt;li&gt;Multi-table inheritance&lt;/li&gt;
&lt;li&gt;Proxy models&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»–ä»¬ä¹‹é—´çš„å…·ä½“ä¼˜ç¼ºç‚¹æ¯”è¾ƒå¦‚ä¸‹ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Backend" scheme="https://morningchen.com/categories/Backend/"/>
    
      <category term="Django" scheme="https://morningchen.com/categories/Backend/Django/"/>
    
    
      <category term="Django" scheme="https://morningchen.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>Two Scoops of Django 1.8 å­¦ä¹ ç¬”è®°ä¸€</title>
    <link href="https://morningchen.com/2015/09/02/Two-Scoops-of-Django-1-8-notes-1/"/>
    <id>https://morningchen.com/2015/09/02/Two-Scoops-of-Django-1-8-notes-1/</id>
    <published>2015-09-02T01:27:06.000Z</published>
    <updated>2018-09-27T03:56:26.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åˆšæŠŠDjangoçš„å®˜æ–¹æ–‡æ¡£çš„é‡è¦éƒ¨åˆ†çœ‹å®Œï¼Œå‡†å¤‡å¼€å§‹åˆ·ã€ŠTwo Scoops of Django 1.8ã€‹è¿™æœ¬ä¹¦è¿›è¡Œè¿›é˜¶ï¼Œå†™çš„çœŸçš„å¥½å¥½å•Šï½</p><h2 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a>æ ¸å¿ƒæ€æƒ³</h2><ul><li>Keep It Simple, Stupid</li><li>Fat Models, Utility Modules, Thin Views, Stupid Templates</li><li>Start With Django by Default</li><li>Be Familiar with Djangoâ€™s Design Philosophies</li><li>The Twelve-Factor App</li></ul><h2 id="1-ç¼–ç é£æ ¼"><a href="#1-ç¼–ç é£æ ¼" class="headerlink" title="1. ç¼–ç é£æ ¼"></a>1. ç¼–ç é£æ ¼</h2><h3 id="1-1-æ˜“è¯»æ€§"><a href="#1-1-æ˜“è¯»æ€§" class="headerlink" title="1.1 æ˜“è¯»æ€§"></a>1.1 æ˜“è¯»æ€§</h3><ul><li>é¿å…ç®€å†™çš„å˜é‡å</li><li>å†™å‡ºä½ çš„å‡½æ•°å˜é‡å</li><li>è®°å½•ä½ çš„classes å’Œ methods</li><li>ç»™ä»£ç æ³¨é‡Š</li><li>å°†é‡å¤çš„ä»£ç é‡æ„åˆ°å‡½æ•°æˆ–è€…æ–¹æ³•é‡Œ</li><li>ä¿æŒå‡½æ•°å’Œæ–¹æ³•çš„ç®€çŸ­ï¼Œä¸€ä¸ªå¥½çš„æ£€éªŒæ–¹æ³•æ˜¯ï¼Œä¸ç”¨æ»šåŠ¨å°±å¯ä»¥çœ‹åˆ°æ•´ä¸ªå‡½æ•°æˆ–æ–¹æ³•</li></ul><a id="more"></a><h3 id="1-2-å‚è€ƒPEP8-ç¼–ç è§„èŒƒ"><a href="#1-2-å‚è€ƒPEP8-ç¼–ç è§„èŒƒ" class="headerlink" title="1.2 å‚è€ƒPEP8 ç¼–ç è§„èŒƒ"></a>1.2 å‚è€ƒPEP8 ç¼–ç è§„èŒƒ</h3><ul><li>æ¯å±‚4ä¸ªç©ºæ ¼ç¼©è¿›</li><li>æ¯ä¸ªclass é—´éš”2è¡Œ</li><li>classé‡Œçš„methodé—´éš”1è¡Œ</li><li>æ¯è¡Œé™åˆ¶åœ¨79ä¸ªå­—ç¬¦ä»¥å†…</li></ul><h3 id="1-3-importé¡ºåº"><a href="#1-3-importé¡ºåº" class="headerlink" title="1.3 importé¡ºåº"></a>1.3 importé¡ºåº</h3><ol><li>standard library</li><li>core Django</li><li>third-party App</li><li>your apps</li></ol><h3 id="1-4-ä½¿ç”¨æ˜ç¡®çš„ç›¸å¯¹çš„import"><a href="#1-4-ä½¿ç”¨æ˜ç¡®çš„ç›¸å¯¹çš„import" class="headerlink" title="1.4 ä½¿ç”¨æ˜ç¡®çš„ç›¸å¯¹çš„import"></a>1.4 ä½¿ç”¨æ˜ç¡®çš„ç›¸å¯¹çš„import</h3><p>ä¸è¦ç¡¬ç¼–ç </p><pre><code>from cones.models import Wafflecone</code></pre><p>è¦ä»‹æ ·</p><pre><code>from .models import Wafflecone</code></pre><h3 id="1-5-é¿å…ä½¿ç”¨import"><a href="#1-5-é¿å…ä½¿ç”¨import" class="headerlink" title="1.5 é¿å…ä½¿ç”¨import *"></a>1.5 é¿å…ä½¿ç”¨import *</h3><p>ä¸è¦ä»‹æ ·</p><pre><code>from django.db.models import *</code></pre><p>è¦ä»‹æ ·</p><pre><code>from django.db import models</code></pre><h3 id="1-6-Django-Coding-Style"><a href="#1-6-Django-Coding-Style" class="headerlink" title="1.6 Django Coding Style"></a>1.6 Django Coding Style</h3><ul><li><a href="https://docs.djangoproject.com/en/1.8/internals/contributing/writing-code/coding-style/" target="_blank" rel="noopener">Djangoå®˜æ–¹ä»£ç é£æ ¼</a></li><li>URL Patternå ç”¨ä¸‹åˆ’çº¿( _ )ä¸è¦ç”¨ç ´æŠ˜å·( - )</li><li>æ¨¡æ¿å ç”¨ä¸‹åˆ’çº¿( _ )ä¸è¦ç”¨ç ´æŠ˜å·( - )</li></ul><h3 id="1-7-é€‰æ‹©ä¸€ä¸ª-JS-HTML-CSS-ä»£ç æ ·å¼æ‰‹å†Œ"><a href="#1-7-é€‰æ‹©ä¸€ä¸ª-JS-HTML-CSS-ä»£ç æ ·å¼æ‰‹å†Œ" class="headerlink" title="1.7 é€‰æ‹©ä¸€ä¸ª JS, HTML, CSS ä»£ç æ ·å¼æ‰‹å†Œ"></a>1.7 é€‰æ‹©ä¸€ä¸ª JS, HTML, CSS ä»£ç æ ·å¼æ‰‹å†Œ</h3><p>JS:</p><ul><li><a href="https://github.com/rwaldron/idiomatic.js/" target="_blank" rel="noopener">idiomatic.js</a></li><li><a href="https://github.com/madrobby/pragmatic.js" target="_blank" rel="noopener">pragmatic.js</a></li><li><a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener">airbnb</a></li><li><a href="https://github.com/felixge/node-style-guide" target="_blank" rel="noopener">node.js</a></li><li><a href="http://javascript.crockford.com/code.html" target="_blank" rel="noopener">Code Conventions for the JavaScript Programming Language</a></li></ul><p>HTML CSS:</p><ul><li><a href="http://codeguide.co/" target="_blank" rel="noopener">Code Guide by @mdo</a></li><li><a href="https://github.com/necolas/idiomatic-css" target="_blank" rel="noopener">idiomatic-css</a></li></ul><h2 id="2-æœ€ä½³çš„-Djangoç¯å¢ƒè®¾ç½®"><a href="#2-æœ€ä½³çš„-Djangoç¯å¢ƒè®¾ç½®" class="headerlink" title="2. æœ€ä½³çš„ Djangoç¯å¢ƒè®¾ç½®"></a>2. æœ€ä½³çš„ Djangoç¯å¢ƒè®¾ç½®</h2><ul><li><p>æ¯ä¸ªåœ°æ–¹éƒ½ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“å¼•æ“</p><p>  æ— è®ºæ˜¯æœ¬åœ°å¼€å‘ç¯å¢ƒè¿˜æ˜¯ç”Ÿäº§ç¯å¢ƒéƒ½è¦ä¿æŒä½¿ç”¨åŒä¸€ç§æ•°æ®åº“å¼•æ“ï¼Œ<br>  å¾ˆå¤šå¼€å‘è€…åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨SQLite3ï¼Œè€Œåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨PostgreSQLï¼Œè¿™æ˜¯éå¸¸ä¸å¥½çš„ã€‚</p></li><li><p>ç”¨Pip å’Œ Virtualenv è¿›è¡Œç¯å¢ƒéš”ç¦»</p></li><li>é€šè¿‡pip å®‰è£…djangoå’Œå…¶ä»–ä¾èµ–</li><li>ä½¿ç”¨gitå½“ä½œç‰ˆæœ¬æ§åˆ¶</li></ul><h2 id="3-Django-é¡¹ç›®å¸ƒå±€"><a href="#3-Django-é¡¹ç›®å¸ƒå±€" class="headerlink" title="3. Django é¡¹ç›®å¸ƒå±€"></a>3. Django é¡¹ç›®å¸ƒå±€</h2><p>djangoé»˜è®¤çš„å¸ƒå±€ä¸å’‹åœ°ï¼Œ<br>æˆ‘ä»¬æ›´å€¾å‘çš„é¡¹ç›®å¸ƒå±€æ˜¯ä¸‰å±‚ç»“æ„</p><ul><li>repository_root</li><li>django_project_root</li><li>configuration_root</li></ul><p>ç¬¬ä¸€å±‚repository_rootæ˜¯æˆ‘ä»¬é¡¹ç›®çš„ç»å¯¹æ ¹ç›®å½•ï¼Œé‡Œé¢é™¤äº†æœ‰django_project_rootä¹‹å¤–ï¼Œ<br>è¿˜æœ‰å…¶ä»–ä¸€äº›è‡³å…³é‡è¦çš„ç»„ä»¶ï¼Œæ¯”å¦‚README.rst, docs/, gitignore, requirements.txt,<br>å¸¸è§çš„é”™è¯¯æ˜¯æŠŠdjango_project_rootå½“ä½œrepository_root</p><p>ç¬¬äºŒå±‚django_project_rootæ‰æ˜¯æˆ‘ä»¬çš„djangoé¡¹ç›®ç›®å½•ï¼Œæ‰€æœ‰çš„pythonä»£ç éƒ½åº”è¯¥åœ¨é‡Œé¢</p><p>ç¬¬ä¸‰å±‚configuration_rootæ˜¯settingsæ¨¡å—å’Œ base URLConf(urls.py)æ”¾çš„åœ°æ–¹ï¼Œ<br>ä»–å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„pythonåŒ…(é‡Œé¢æœ‰<strong>init</strong>.py)</p><p>ä¸€ä¸ªä¾‹å­</p><pre><code>icecreamratings_project/    .gitignore    Makefile    docs/    README.rst    requirements.txt    icecreamratings/        manage.py        media/        products/        profiles/        ratings/        static/        templates/        config/            __init__.py            settings/            urls.py            wsgi.py</code></pre><p>å¯ä»¥é€šè¿‡Cookiecutterç”Ÿæˆé¡¹ç›®æ ·æ¿</p><pre><code>âœ  ~  pip install cookiecutterCollecting cookiecutter  Downloading cookiecutter-1.0.0-py2.py3-none-any.whlCollecting PyYAML&gt;=3.10 (from cookiecutter)  Downloading PyYAML-3.11.tar.gz (248kB)    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 249kB 550kB/sCollecting mock (from cookiecutter)  Downloading mock-1.3.0-py2.py3-none-any.whl (56kB)    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 57kB 1.6MB/sCollecting click&lt;4.0 (from cookiecutter)  Downloading click-3.3-py2.py3-none-any.whl (58kB)    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 61kB 3.3MB/sCollecting binaryornot&gt;=0.2.0 (from cookiecutter)  Downloading binaryornot-0.4.0-py2.py3-none-any.whlRequirement already satisfied (use --upgrade to upgrade): jinja2&gt;=2.7 in /usr/local/lib/python2.7/site-packages (from cookiecutter)Collecting funcsigs (from mock-&gt;cookiecutter)  Downloading funcsigs-0.4-py2.py3-none-any.whlRequirement already satisfied (use --upgrade to upgrade): pbr&gt;=0.11 in /usr/local/lib/python2.7/site-packages (from mock-&gt;cookiecutter)Requirement already satisfied (use --upgrade to upgrade): six&gt;=1.7 in /usr/local/lib/python2.7/site-packages (from mock-&gt;cookiecutter)Requirement already satisfied (use --upgrade to upgrade): chardet&gt;=2.0.0 in /usr/local/lib/python2.7/site-packages (from binaryornot&gt;=0.2.0-&gt;cookiecutter)Requirement already satisfied (use --upgrade to upgrade): markupsafe in /usr/local/lib/python2.7/site-packages (from jinja2&gt;=2.7-&gt;cookiecutter)Requirement already satisfied (use --upgrade to upgrade): pip in /usr/local/lib/python2.7/site-packages (from pbr&gt;=0.11-&gt;mock-&gt;cookiecutter)Installing collected packages: PyYAML, funcsigs, mock, click, binaryornot, cookiecutter  Running setup.py install for PyYAMLSuccessfully installed PyYAML-3.11 binaryornot-0.4.0 click-3.3 cookiecutter-1.0.0 funcsigs-0.4 mock-1.3.0âœ  ~  cookiecutter https://github.com/pydanny/cookiecutter-django.gitCloning into &apos;cookiecutter-django&apos;...remote: Counting objects: 3385, done.remote: Compressing objects: 100% (138/138), done.remote: Total 3385 (delta 81), reused 0 (delta 0), pack-reused 3244Receiving objects: 100% (3385/3385), 643.77 KiB | 247.00 KiB/s, done.Resolving deltas: 100% (2042/2042), done.Checking connectivity... done.project_name (default is &quot;project_name&quot;)? balalarepo_name (default is &quot;balala&quot;)? snirauthor_name (default is &quot;Your Name&quot;)? chenchengemail (default is &quot;Your email&quot;)? chan4aaron@163.comdescription (default is &quot;A short description of the project.&quot;)? just for fundomain_name (default is &quot;example.com&quot;)? morningchen.comversion (default is &quot;0.1.0&quot;)?timezone (default is &quot;UTC&quot;)? Asia/Shanghainow (default is &quot;2015/01/13&quot;)? 2015/09/06year (default is &quot;2015&quot;)?use_whitenoise (default is &quot;y&quot;)? nuse_celery (default is &quot;n&quot;)? yuse_maildump (default is &quot;n&quot;)? yuse_sentry (default is &quot;n&quot;)? ywindows (default is &quot;n&quot;)?âœ  ~  cd snir</code></pre><p>ç°åœ¨ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®æ¨¡æ¿å°±ç”Ÿæˆäº†ã€‚</p><h2 id="4-Django-APPè®¾è®¡åŸºç¡€"><a href="#4-Django-APPè®¾è®¡åŸºç¡€" class="headerlink" title="4. Django APPè®¾è®¡åŸºç¡€"></a>4. Django APPè®¾è®¡åŸºç¡€</h2><p>å¯¹ä¸€ä¸ªæ–°æ‰‹å¼€å‘è€…æ¥è¯´ï¼Œå¸¸å¸¸ä¼šå¯¹djangoçš„â€™appâ€™è¿™ä¸ªå•è¯äº§ç”Ÿç–‘æƒ‘ï¼Œ<br>åœ¨æˆ‘ä»¬æ·±å…¥appè®¾è®¡ä¹‹å‰ï¼Œæ˜ç¡®ä¸€äº›å®šä¹‰éå¸¸é‡è¦ã€‚</p><ul><li>A Django project: ç”±djangoæ¡†æ¶é©±åŠ¨çš„ä¸€ä¸ªç½‘é¡µåº”ç”¨ç¨‹åº</li><li>Django apps: ä»£è¡¨é¡¹ç›®ä¸€ä¸ªæ–¹é¢çš„å°å‹åº“</li><li>INSTALLED_APPS: settingä¸­çš„app list</li><li>Third-party Django packages: å·²ç»è¢«pythonæ‰“åŒ…å·¥å…·æ‰“åŒ…å¥½çš„ç®€æ´,å¯æ’æ‹”,å¯å¤ç”¨çš„django apps</li></ul><h3 id="Django-Appè®¾è®¡çš„é»„é‡‘å®šå¾‹"><a href="#Django-Appè®¾è®¡çš„é»„é‡‘å®šå¾‹" class="headerlink" title="Django Appè®¾è®¡çš„é»„é‡‘å®šå¾‹"></a>Django Appè®¾è®¡çš„é»„é‡‘å®šå¾‹</h3><blockquote><p>Write program do one thing and do it well.</p></blockquote><p>å…¶æœ¬è´¨å°±æ˜¯æ¯ä¸ªappåªä¸“æ³¨å®ƒè‡ªå·±çš„ä»»åŠ¡ï¼Œå¦‚æœä¸€ä¸ªappä½ ä¸èƒ½ç”¨ä¸€å¥ç®€å•çš„è¯æ¦‚æ‹¬ï¼Œ<br>é‚£å¯èƒ½æ„å‘³ç€è¿™ä¸ªappå¤ªå¤§äº†ï¼Œä½ éœ€è¦æ‰“æ•£å®ƒã€‚</p><h3 id="å¦‚ä½•å‘½åä½ çš„Django-app"><a href="#å¦‚ä½•å‘½åä½ çš„Django-app" class="headerlink" title="å¦‚ä½•å‘½åä½ çš„Django app"></a>å¦‚ä½•å‘½åä½ çš„Django app</h3><p>æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„ç¼–ç é£æ ¼ï¼Œæœ‰çš„äººå–œæ¬¢ç”¨ç‚«é…·çš„å‘½åï¼Œæˆ‘ä»¬æ›´å€¾å‘äºå¹³æ·¡ï¼Œæ˜¾è€Œæ˜“è§çš„å‘½åã€‚<br>æ¯”å¦‚è¯´flavors, animals, blog, polls, dreams, estimates, financesã€‚</p><p>ä¸€ä¸ªæ£’æ£’çš„ï¼Œæ˜¾è€Œæ˜“è§çš„appå‘½åè®©è¿™ä¸ªé¡¹ç›®æ›´æ˜“äºç»´æŠ¤.ä½¿ç”¨æœ‰æ•ˆçš„ã€éµå¾ªPEP8è§„èŒƒçš„å‘½åï¼šç®€çŸ­ã€å°å†™ï¼Œä¸è¦æœ‰æ•°å­—ã€ç ´æŠ˜å·ã€å¥å·ã€ç©ºæ ¼å’Œå…¶ä»–ç‰¹æ®Šå­—ç¬¦ã€‚<br>å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿è®©å•è¯çš„æ˜“è¯»æ€§æ›´å¼º</p><h2 id="5-é…ç½®æ–‡ä»¶å’Œä¾èµ–æ–‡ä»¶"><a href="#5-é…ç½®æ–‡ä»¶å’Œä¾èµ–æ–‡ä»¶" class="headerlink" title="5. é…ç½®æ–‡ä»¶å’Œä¾èµ–æ–‡ä»¶"></a>5. é…ç½®æ–‡ä»¶å’Œä¾èµ–æ–‡ä»¶</h2><p>æˆ‘ä»¬åº”è¯¥éµå¾ªä»¥ä¸‹æœ€ä½³å®ç°ï¼š</p><ul><li>æ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½è¦æœ‰ç‰ˆæœ¬æ§åˆ¶</li><li>Donâ€™t repeat yourself (DRYåŸåˆ™)</li><li>ä¿è¯secret key å®‰å…¨(ä¸€å®šä¸€å®šä¸€å®šè¦æŠŠä»–éš”ç¦»åœ¨ç‰ˆæœ¬æ§åˆ¶å™¨çš„å¤–é¢!!!!!!)</li></ul><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>ä¸ºäº†éš”ç¦»å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œç”¨settings/æ–‡ä»¶å¤¹å–ä»£settings.py</p><pre><code>settings/    __init__.py    base.py    local.py    staging.py    test.py    production.py</code></pre><ul><li>base.py å…±ç”¨çš„é…ç½®æ–‡ä»¶</li><li>local.py æœ¬åœ°å¼€å‘ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œä¸åŒäºproduction.pyçš„æ˜¯é‡Œé¢æœ‰DEBUGæ¨¡å—ï¼Œåƒdjango-debug-toolbarè¿™æ ·çš„æ—¥å¿—çº§åˆ«çš„å¼€å‘è€…å·¥å…·</li><li>staging.py åœ¨ç½‘ç«™ç”Ÿäº§æœåŠ¡å™¨ä¸Šè·‘çš„åŠç§äººåŒ–çš„ç‰ˆæœ¬</li><li>test.py è·‘æµ‹è¯•ç”¨çš„</li><li>production.py ç”Ÿäº§ç¯å¢ƒä¸‹çš„é…ç½®æ–‡ä»¶</li></ul><p>è¿è¡Œæœ¬åœ°è„šæœ¬å’ŒæœåŠ¡å™¨</p><pre><code>python manage.py shell --settings=twoscoops.settings.localpython manage.py runserver --settings=twoscoops.settings.local</code></pre><p>æœ‰æ—¶å€™ä¸€ä¸ªå¤§é¡¹ç›®ï¼Œä¸åŒçš„å¼€å‘è€…æœ‰ä¸åŒçš„é…ç½®ï¼Œä½†æ˜¯ä»–ä»¬å…±ç”¨ä¸€ä¸ªdev.pyæ–‡ä»¶ã€‚<br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™ä¸åŒçš„å¼€å‘è€…è®¾ç½®ä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚</p><pre><code>settings/    __init__.py    base.py    local.py    staging.py    test.py    production.py    dev_cc.py    dev_audreyr.py</code></pre><p>dev_cc.py å’Œ dev_audreyr åˆ†åˆ«æ˜¯ccå’Œaudreyrè¿™ä¸¤ä½å¼€å‘è€…çš„é…ç½®æ–‡ä»¶ï¼Œ<br>è¿™æ ·å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”é¡¹ç›®ç»„æˆå‘˜è¿˜å¯ä»¥äº’ç›¸æ£€æŸ¥çœ‹çœ‹è°ç¼ºå°‘äº†ä»€ä¹ˆè‡³å…³é‡è¦çš„ç»„ä»¶</p><p>ä»ä»£ç ä¸­éš”ç¦»å‡ºä¸‹é¢çš„é…ç½®ï¼Œæ¯”å¦‚è¯´ï¼š</p><ul><li>æ•°æ®åº“ï¼ŒMemcachedï¼Œä»¥åŠå…¶ä»– åç«¯æœåŠ¡ çš„é…ç½®</li><li>ç¬¬ä¸‰æ–¹æœåŠ¡çš„è¯ä¹¦ï¼Œå¦‚ Amazon S3ã€Twitter ç­‰</li><li>æ¯ä»½éƒ¨ç½²ç‰¹æœ‰çš„é…ç½®ï¼Œå¦‚åŸŸåç­‰</li></ul><p>é…ç½®æ–‡ä»¶éµå¾ªä»¥ä¸‹åŸåˆ™</p><ul><li><a href="http://12factor.net/zh_cn/config" target="_blank" rel="noopener">12factor-config</a></li></ul><h3 id="ä¾èµ–æ–‡ä»¶"><a href="#ä¾èµ–æ–‡ä»¶" class="headerlink" title="ä¾èµ–æ–‡ä»¶"></a>ä¾èµ–æ–‡ä»¶</h3><p>ä¾èµ–æ–‡ä»¶requirements.txtå¯ä»¥ç”¨æ–‡ä»¶requirements/ä»£æ›¿ï¼Œ<br>ä»¥åŒºåˆ†æœ¬åœ°å’Œç”Ÿäº§ç¯å¢ƒï¼Œç»“æ„å¦‚ä¸‹</p><pre><code>requirements/    base.txt    local.txt    staging.txt    production.txt</code></pre><p>ä¸‹é¢æ˜¯local.txtçš„å†…å®¹</p><pre><code>-r base.txtdjango-debug-toolbar==1.3.0</code></pre><p>å®‰è£…æœ¬åœ°ç¯å¢ƒä¾èµ–ï¼š</p><pre><code>$ pip install -r requirements/local.txt</code></pre><h3 id="settingé‡Œçš„æ–‡ä»¶è·¯å¾„"><a href="#settingé‡Œçš„æ–‡ä»¶è·¯å¾„" class="headerlink" title="settingé‡Œçš„æ–‡ä»¶è·¯å¾„"></a>settingé‡Œçš„æ–‡ä»¶è·¯å¾„</h3><p>MEDIA_ROOT, STATIC_ROOT, TEMPLATESç­‰ç­‰ä¸è¦ç¡¬ç¼–ç </p><p>ç”¨djangoçš„ç¬¬ä¸‰æ–¹app <a href="https://github.com/joke2k/django-environ" target="_blank" rel="noopener">django-environ</a>å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<br>å…·ä½“ç”¨æ³•çœ‹å®˜æ–¹è¯´æ˜</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åˆšæŠŠDjangoçš„å®˜æ–¹æ–‡æ¡£çš„é‡è¦éƒ¨åˆ†çœ‹å®Œï¼Œå‡†å¤‡å¼€å§‹åˆ·ã€ŠTwo Scoops of Django 1.8ã€‹è¿™æœ¬ä¹¦è¿›è¡Œè¿›é˜¶ï¼Œå†™çš„çœŸçš„å¥½å¥½å•Šï½&lt;/p&gt;
&lt;h2 id=&quot;æ ¸å¿ƒæ€æƒ³&quot;&gt;&lt;a href=&quot;#æ ¸å¿ƒæ€æƒ³&quot; class=&quot;headerlink&quot; title=&quot;æ ¸å¿ƒæ€æƒ³&quot;&gt;&lt;/a&gt;æ ¸å¿ƒæ€æƒ³&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Keep It Simple, Stupid&lt;/li&gt;
&lt;li&gt;Fat Models, Utility Modules, Thin Views, Stupid Templates&lt;/li&gt;
&lt;li&gt;Start With Django by Default&lt;/li&gt;
&lt;li&gt;Be Familiar with Djangoâ€™s Design Philosophies&lt;/li&gt;
&lt;li&gt;The Twelve-Factor App&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;1-ç¼–ç é£æ ¼&quot;&gt;&lt;a href=&quot;#1-ç¼–ç é£æ ¼&quot; class=&quot;headerlink&quot; title=&quot;1. ç¼–ç é£æ ¼&quot;&gt;&lt;/a&gt;1. ç¼–ç é£æ ¼&lt;/h2&gt;&lt;h3 id=&quot;1-1-æ˜“è¯»æ€§&quot;&gt;&lt;a href=&quot;#1-1-æ˜“è¯»æ€§&quot; class=&quot;headerlink&quot; title=&quot;1.1 æ˜“è¯»æ€§&quot;&gt;&lt;/a&gt;1.1 æ˜“è¯»æ€§&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;é¿å…ç®€å†™çš„å˜é‡å&lt;/li&gt;
&lt;li&gt;å†™å‡ºä½ çš„å‡½æ•°å˜é‡å&lt;/li&gt;
&lt;li&gt;è®°å½•ä½ çš„classes å’Œ methods&lt;/li&gt;
&lt;li&gt;ç»™ä»£ç æ³¨é‡Š&lt;/li&gt;
&lt;li&gt;å°†é‡å¤çš„ä»£ç é‡æ„åˆ°å‡½æ•°æˆ–è€…æ–¹æ³•é‡Œ&lt;/li&gt;
&lt;li&gt;ä¿æŒå‡½æ•°å’Œæ–¹æ³•çš„ç®€çŸ­ï¼Œä¸€ä¸ªå¥½çš„æ£€éªŒæ–¹æ³•æ˜¯ï¼Œä¸ç”¨æ»šåŠ¨å°±å¯ä»¥çœ‹åˆ°æ•´ä¸ªå‡½æ•°æˆ–æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Backend" scheme="https://morningchen.com/categories/Backend/"/>
    
      <category term="Django" scheme="https://morningchen.com/categories/Backend/Django/"/>
    
    
      <category term="Django" scheme="https://morningchen.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>Django - QuerySetså­¦ä¹ ç¬”è®°</title>
    <link href="https://morningchen.com/2015/08/06/Django-QuerySets-notes/"/>
    <id>https://morningchen.com/2015/08/06/Django-QuerySets-notes/</id>
    <published>2015-08-06T01:30:20.000Z</published>
    <updated>2018-09-27T03:50:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è¿›è¡ŒæŸ¥è¯¢"><a href="#è¿›è¡ŒæŸ¥è¯¢" class="headerlink" title="è¿›è¡ŒæŸ¥è¯¢"></a>è¿›è¡ŒæŸ¥è¯¢</h2><p>é€šè¿‡è¿™ä¸ªä¾‹å­æ¥è¯´æ˜å¦‚ä½•è¿›è¡ŒæŸ¥è¯¢çš„ï¼š</p><pre><code>from django.db import modelsclass Blog(models.Model):    name = models.CharField(max_length=100)    tagline = models.TextField()    def __str__(self):              # __unicode__ on Python 2        return self.nameclass Author(models.Model):    name = models.CharField(max_length=50)    email = models.EmailField()    def __str__(self):              # __unicode__ on Python 2        return self.nameclass Entry(models.Model):    blog = models.ForeignKey(Blog)    headline = models.CharField(max_length=255)    body_text = models.TextField()    pub_date = models.DateField()    mod_date = models.DateField()    authors = models.ManyToManyField(Author)    n_comments = models.IntegerField()    n_pingbacks = models.IntegerField()    rating = models.IntegerField()    def __str__(self):              # __unicode__ on Python 2        return self.headline</code></pre><a id="more"></a><h3 id="åˆ›å»ºå¯¹è±¡"><a href="#åˆ›å»ºå¯¹è±¡" class="headerlink" title="åˆ›å»ºå¯¹è±¡"></a>åˆ›å»ºå¯¹è±¡</h3><p>ä¸ºäº†æŠŠæ•°æ®åº“è¡¨ä¸­çš„æ•°æ®è¡¨ç¤ºæˆpythonå¯¹è±¡ï¼ŒDjangoä½¿ç”¨äº†ä¸€ä¸ªç›´è§‚çš„ç³»ç»Ÿï¼šä¸€ä¸ªmodel classä»£è¡¨ä¸€ä¸ªæ•°æ®åº“è¡¨<br>è€Œç”¨è¿™ä¸ªç±»çš„å®ä¾‹è¡¨ç¤ºæ•°æ®åº“è¡¨ä¸­ä¸€æ¡ç‰¹å®šçš„è®°å½•</p><p>è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå®ä¾‹åŒ–æ¨¡å‹ç±»çš„å…³é”®å­—å‚æ•°ï¼Œç„¶åè°ƒç”¨saveï¼ˆï¼‰å°†å…¶ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>å‡å®šmodelæ–‡ä»¶åœ¨ mysite/blog/models.pyä¸­</p><pre><code>&gt;&gt;&gt; from blog.models import Blog&gt;&gt;&gt; b = Blog(name=&apos;Beatles Blog&apos;, tagline=&apos;All the latest Beatles news.&apos;)&gt;&gt;&gt; b.save()</code></pre><p>ä»–èƒŒåæ‰§è¡Œçš„å°±æ˜¯sqlçš„insertè¯­å¥ï¼Œåœ¨ä½ æ˜ç¡®çš„è°ƒç”¨save()ä¹‹å‰ï¼Œ<br>Djangoä¸ä¼šè®¿é—®æ•°æ®åº“ï¼Œéœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯save()æ–¹æ³•æ²¡æœ‰è¿”å›å€¼</p><h3 id="ä¿å­˜å¯¹è±¡çš„æ”¹åŠ¨"><a href="#ä¿å­˜å¯¹è±¡çš„æ”¹åŠ¨" class="headerlink" title="ä¿å­˜å¯¹è±¡çš„æ”¹åŠ¨"></a>ä¿å­˜å¯¹è±¡çš„æ”¹åŠ¨</h3><p>ç”¨save()æ–¹æ³•æ¥ä¿å­˜å·²å­˜åœ¨äºæ•°æ®åº“ä¸­çš„å¯¹è±¡çš„æ”¹åŠ¨<br>å‡è®¾ä¸€ä¸ªBlogçš„å®ä¾‹b5å·²ç»è¢«ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œè¿™ä¸ªä¾‹å­æ›´æ”¹äº†å®ƒçš„åå­—ï¼Œå¹¶ä¸”åœ¨æ•°æ®åº“ä¸­æ›´æ–°å®ƒçš„è®°å½•</p><pre><code>&gt;&gt;&gt; b5.name = &apos;New name&apos;&gt;&gt;&gt; b5.save()</code></pre><p>ä»–èƒŒåæ‰§è¡Œçš„å°±æ˜¯sqlè¯­å¥çš„updateè¯­æ³•</p><h3 id="ä¿å­˜ForeignKeyå’ŒManyToManyFieldå­—æ®µ"><a href="#ä¿å­˜ForeignKeyå’ŒManyToManyFieldå­—æ®µ" class="headerlink" title="ä¿å­˜ForeignKeyå’ŒManyToManyFieldå­—æ®µ"></a>ä¿å­˜ForeignKeyå’ŒManyToManyFieldå­—æ®µ</h3><pre><code>&gt;&gt;&gt; from blog.models import Entry&gt;&gt;&gt; entry = Entry.objects.get(pk=1)&gt;&gt;&gt; cheese_blog = Blog.objects.get(name=&quot;Cheddar Talk&quot;)&gt;&gt;&gt; entry.blog = cheese_blog&gt;&gt;&gt; entry.save()&gt;&gt;&gt; from blog.models import Author&gt;&gt;&gt; joe = Author.objects.create(name=&quot;Joe&quot;)&gt;&gt;&gt; entry.authors.add(joe)&gt;&gt;&gt; john = Author.objects.create(name=&quot;John&quot;)&gt;&gt;&gt; paul = Author.objects.create(name=&quot;Paul&quot;)&gt;&gt;&gt; george = Author.objects.create(name=&quot;George&quot;)&gt;&gt;&gt; ringo = Author.objects.create(name=&quot;Ringo&quot;)&gt;&gt;&gt; entry.authors.add(john, paul, george, ringo)</code></pre><h3 id="æ£€ç´¢å¯¹è±¡"><a href="#æ£€ç´¢å¯¹è±¡" class="headerlink" title="æ£€ç´¢å¯¹è±¡"></a>æ£€ç´¢å¯¹è±¡</h3><p>æ£€ç´¢æ‰€æœ‰Entryå¯¹è±¡</p><pre><code>all_entries = Entry.objects.all()</code></pre><p>æ£€ç´¢å‘å¸ƒæ—¥æœŸæ˜¯2006å¹´çš„å¯¹è±¡ æ³¨æ„ç”¨åŒä¸‹åˆ’çº¿ç­›é€‰å¹´ä»½</p><pre><code>Entry.objects.filter(pub_date__year=2006)</code></pre><p>æ£€ç´¢å‘å¸ƒæ—¥æœŸä¸æ˜¯2006å¹´çš„å¯¹è±¡ æ³¨æ„ç”¨åŒä¸‹åˆ’çº¿ç­›é€‰å¹´ä»½</p><pre><code>Entry.objects.exclude(pub_date__year=2006)</code></pre><p>æ£€ç´¢æ ‡é¢˜ä»¥What å¼€å¤´ï¼Œå‘å¸ƒæ—¥æœŸåœ¨2005-1-30ä¸ä»Šå¤©ä¹‹é—´çš„Entry</p><ul><li>__startwith å¾ˆå¥½ç†è§£ ä»¥ä»€ä¹ˆå¼€å¤´</li><li>__gte  å°±æ˜¯great than and equal å¤§äºç­‰äºçš„ç¼©å†™</li><li>ç±»ä¼¼çš„è¿˜æœ‰__lte å°±æ˜¯less than and equal å°äºç­‰äºçš„ç¼©å†™</li></ul><pre><code>&gt;&gt;&gt; Entry.objects.filter(...     headline__startswith=&apos;What&apos;... ).exclude(...     pub_date__gte=datetime.date.today()... ).filter(...     pub_date__gte=datetime(2005, 1, 30)... )</code></pre><p>æ¯æ¬¡ç­›é€‰çš„ç»“æœéƒ½æ˜¯ç‹¬ç«‹çš„</p><pre><code>&gt;&gt;&gt; q1 = Entry.objects.filter(headline__startswith=&quot;What&quot;)&gt;&gt;&gt; q2 = q1.exclude(pub_date__gte=datetime.date.today())&gt;&gt;&gt; q3 = q1.filter(pub_date__gte=datetime.date.today())</code></pre><ul><li>q1æŸ¥è¯¢é›†æ˜¯ç­›é€‰headlineä»¥What å¼€å¤´çš„æ‰€æœ‰Entry</li><li>q2æŸ¥è¯¢é›†æ˜¯q1çš„å­é›†ï¼Œæ»¡è¶³q1çš„åŒæ—¶ï¼Œç­›é€‰å‡ºé™¤äº†å‘å¸ƒæ—¥æœŸå¤§äºä»Šå¤©çš„æ‰€æœ‰Entryï¼Œ<br>ä¹Ÿå°±æ˜¯ä»Šå¤©ä¹‹å‰æ‰€æœ‰çš„Entry</li><li>q3æŸ¥è¯¢é›†ä¹Ÿæ˜¯q1çš„å­é›†ï¼Œæ»¡è¶³q1çš„åŒæ—¶ï¼Œç­›é€‰ä»Šå¤©ä¹‹åçš„æ‰€æœ‰Entry</li></ul><p>ä»–ä»¬å½¼æ­¤ä¹‹é—´éƒ½æ˜¯ç‹¬ç«‹çš„äº’ä¸å½±å“</p><p>è¿˜æœ‰ä¸€ç‚¹æŸ¥è¯¢é›†çš„ç‰¹æ€§éœ€è¦è¯´æ˜ï¼Œå°±æ˜¯å®ƒå¾ˆâ€˜æ‡’â€™ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­</p><pre><code>&gt;&gt;&gt; q = Entry.objects.filter(headline__startswith=&quot;What&quot;)&gt;&gt;&gt; q = q.filter(pub_date__lte=datetime.date.today())&gt;&gt;&gt; q = q.exclude(body_text__icontains=&quot;food&quot;)&gt;&gt;&gt; print(q)</code></pre><p>çœ‹ä¸Šå»æŸ¥è¯¢é›†è®¿é—®äº†3æ¬¡æ•°æ®åº“ï¼Œäº‹å®ä¸Šç›´åˆ°ä½ è¦ç”¨åˆ°ä»–çš„æ—¶å€™ä»–æ‰å¼€å§‹è®¿é—®æ•°æ®åº“ï¼Œå¹¶ä¸”åªè®¿é—®äº†ä¸€æ¬¡</p><p>ç”¨get()æ£€ç´¢ä¸€æ¡æ•°æ®<br>æƒ³è¦åªæŸ¥è¯¢ä¸€æ¡æ•°æ®çš„è¯ï¼Œget()ä¸filter()çš„åŒºåˆ«æ˜¯ï¼Œfilter()éœ€è¦åˆ‡ç‰‡ï¼Œåƒè¿™æ ·filter()[0]</p><pre><code>&gt;&gt;&gt; one_entry = Entry.objects.get(pk=1)</code></pre><p>ä½ å¿…é¡»ç¡®ä¿ä»–åªä¼šæŸ¥åˆ°ä¸€æ¡æ•°æ®ï¼Œå¦‚æœæ²¡æŸ¥åˆ°ï¼Œä»–ä¼šæŠ›å‡ºDoesNotExistå¼‚å¸¸ï¼Œ<br>å¦‚æœæŸ¥åˆ°äº†å¤šæ¡æ•°æ®ï¼Œä»–ä¼šæŠ›å‡ºMultipleObjectsReturnedå¼‚å¸¸ï¼Œ</p><p>field__lookuptype=value</p><pre><code>&gt;&gt;&gt; Entry.objects.filter(pub_date__lte=&apos;2006-01-01&apos;)</code></pre><p>ç¿»è¯‘æˆSQLè¯­å¥å°±æ˜¯ï¼š</p><p>SELECT * FROM blog_entry WHERE pub_date &lt;= â€˜2006-01-01â€™;</p><p>å¸¸ç”¨çš„lookuptype:</p><pre><code>exact ç²¾ç¡®æŸ¥è¯¢ å¤§å°å†™æ•æ„Ÿiexact å¤§å°å†™ä¸æ•æ„Ÿcontains ç›¸å½“äºLIKE &apos;%foo%&apos; å¤§å°å†™æ•æ„Ÿicontains  å¤§å°å†™ä¸æ•æ„Ÿstartswithendswithistartswithiendswith</code></pre><p>å¤šä¸ªå‚æ•°å’Œå¤šä¸ªç­›é€‰ä¹‹é—´çš„åŒºåˆ«ï¼š</p><pre><code>Blog.objects.filter(entry__headline__contains=&apos;Lennon&apos;,        entry__pub_date__year=2008)Blog.objects.filter(entry__headline__contains=&apos;Lennon&apos;).filter(        entry__pub_date__year=2008)</code></pre><p>å‡è®¾æœ‰ä¸ªblog,ä¸€ä¸ªEntryåŒ…å«Lennonï¼Œå¦ä¸€ä¸ªEntryçš„pub_dateåœ¨2008å¹´ï¼Œ<br>ä½†æ˜¯æ²¡æœ‰åŒæ—¶æ»¡è¶³åå­—å«â€™Lennonâ€™å¹¶ä¸”å‘å¸ƒåœ¨2008å¹´çš„Entry</p><p>é‚£ä¹ˆç¬¬ä¸€ä¸ªç­›é€‰ä¸ä¼šè¿”å›ä»»ä½•blogï¼Œç¬¬äºŒä¸ªå¯ä»¥ç­›é€‰åˆ°è¿™ä¸ªblog</p><p>count()<br>aggregate(Avg())<br>aggregate(Max())<br>Sum(F(â€˜priceâ€™)/F(â€˜pagesâ€™), output_field=FloatField()))</p><p>annotate()</p><p>annotate() åº”è¯¥åœ¨filter()å‰é¢  å¦‚æœåœ¨åé¢åˆ™ä¼šå¿½ç•¥annotate()</p><h3 id="Evaluate-QuerySet"><a href="#Evaluate-QuerySet" class="headerlink" title="Evaluate QuerySet"></a>Evaluate QuerySet</h3><ul><li>Iteration</li><li>Slicing</li><li>Pickling/Caching</li><li>repr()</li><li>len()</li><li>count()</li><li>list()</li><li>bool()</li></ul><h3 id="QuerySet-API"><a href="#QuerySet-API" class="headerlink" title="QuerySet API"></a>QuerySet API</h3><h4 id="Methods-that-return-new-QuerySets"><a href="#Methods-that-return-new-QuerySets" class="headerlink" title="Methods that return new QuerySets"></a>Methods that return new QuerySets</h4><ul><li>filter</li><li>exclude</li><li>annotate</li><li>order_by   + -å‰ç¼€ ?éšæœºæ’åº å¦‚æœæœ‰2ä¸ªorder_byä¼šå¿½ç•¥å‰é¢çš„</li><li>reverse</li><li>distinct  å»é‡</li><li>values</li><li>values_list(*fields, flat=False)</li><li>dates(field, kind, order=â€™ASCâ€™)  kind= â€œyearâ€, â€œmonthâ€ or â€œdayâ€</li><li>datetimes(field_name, kind, order=â€™ASCâ€™, tzinfo=None)  â€œyearâ€, â€œmonthâ€, â€œdayâ€, â€œhourâ€, â€œminuteâ€ or â€œsecondâ€</li><li>none()</li><li>all()</li><li>select_related  ForeignKey/OneToOneField æ—¶ä½¿ç”¨å’Œfilterä¸€èµ·ä½¿ç”¨æ—¶é¡ºåºæ— è¦æ±‚  select_related(None)æ¸…é™¤å…³ç³»</li><li>prefetch_related(*lookups)</li><li>extra(select=None, where=None, params=None, tables=None, order_by=None, select_params=None)</li><li>defer</li><li>only</li><li>using(alias)</li><li>select_for_update(nowait=False)</li><li>raw</li></ul><h4 id="Methods-that-do-not-return-QuerySets"><a href="#Methods-that-do-not-return-QuerySets" class="headerlink" title="Methods that do not return QuerySets"></a>Methods that do not return QuerySets</h4><ul><li>get(**kwargs)</li><li>create(**kwargs)</li><li>get_or_create(defaults=None, **kwargs)</li><li>update_or_create(defaults=None, **kwargs)</li><li>bulk_create(objs, batch_size=None)    æ‰¹é‡åˆ›å»º</li><li>count()</li><li>in_bulk(id_list)    å–ä¸€ä¸ªåˆ—è¡¨pkçš„å€¼  è¿”å›ä¸€ä¸ªdict æ¯ä¸ªpkå€¼å¯¹åº”ä¸€ä¸ªå¯¹è±¡å®ä¾‹</li><li>iterator()</li><li>latest(field_name=None)</li><li>earliest(field_name=None)</li><li>first()</li><li>last()</li><li>aggregate(*args, **kwargs)</li><li>exists()</li><li>update(**kwargs)</li><li>exists()       ç”¨å®ƒæ¥åˆ¤æ–­å­˜åœ¨ä¸å¦ æ¯”å¾ªç¯è¦å¿«</li><li>update(**kwargs)</li><li>delete()</li></ul><h4 id="Field-lookups"><a href="#Field-lookups" class="headerlink" title="Field lookups"></a>Field lookups</h4><ul><li>exact</li><li>iexact</li><li>contains</li><li>icontains</li><li>in</li><li>gt</li><li>gte</li><li>lt</li><li>lte</li><li>startswith</li><li>istartswith</li><li>endswith</li><li>iendswith</li><li>range</li><li>year</li><li>month</li><li>day</li><li>week_day</li><li>hour</li><li>minute</li><li>second</li><li>isnull</li><li>search(SQL)</li><li>regex</li><li>iregex</li></ul><h4 id="Aggregation-functions"><a href="#Aggregation-functions" class="headerlink" title="Aggregation functions"></a>Aggregation functions</h4><ul><li>Avg(expression, output_field=None, **extra)</li><li>Count(expression, distinct=False, **extra)</li><li>Max(expression, output_field=None, **extra)</li><li>Min(expression, output_field=None, **extra)</li><li>StdDev(expression, sample=False, **extra)  æ ‡å‡†å·®</li><li>Sum(expression, output_field=None, **extra)</li><li>Variance(expression, sample=False, **extra)  æ–¹å·®</li></ul><h4 id="Query-related-classes"><a href="#Query-related-classes" class="headerlink" title="Query-related classes"></a>Query-related classes</h4><p>Q()<br>Prefetch(lookup, queryset=None, to_attr=None)</p><p>lookupè¡¨è¾¾å¼åŒ…å«äº†3ä¸ªéƒ¨åˆ†</p><ul><li>Fields part</li><li>Transforms part</li><li>A lookup</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;è¿›è¡ŒæŸ¥è¯¢&quot;&gt;&lt;a href=&quot;#è¿›è¡ŒæŸ¥è¯¢&quot; class=&quot;headerlink&quot; title=&quot;è¿›è¡ŒæŸ¥è¯¢&quot;&gt;&lt;/a&gt;è¿›è¡ŒæŸ¥è¯¢&lt;/h2&gt;&lt;p&gt;é€šè¿‡è¿™ä¸ªä¾‹å­æ¥è¯´æ˜å¦‚ä½•è¿›è¡ŒæŸ¥è¯¢çš„ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from django.db import models

class Blog(models.Model):
    name = models.CharField(max_length=100)
    tagline = models.TextField()

    def __str__(self):              # __unicode__ on Python 2
        return self.name

class Author(models.Model):
    name = models.CharField(max_length=50)
    email = models.EmailField()

    def __str__(self):              # __unicode__ on Python 2
        return self.name

class Entry(models.Model):
    blog = models.ForeignKey(Blog)
    headline = models.CharField(max_length=255)
    body_text = models.TextField()
    pub_date = models.DateField()
    mod_date = models.DateField()
    authors = models.ManyToManyField(Author)
    n_comments = models.IntegerField()
    n_pingbacks = models.IntegerField()
    rating = models.IntegerField()

    def __str__(self):              # __unicode__ on Python 2
        return self.headline
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="Backend" scheme="https://morningchen.com/categories/Backend/"/>
    
      <category term="Django" scheme="https://morningchen.com/categories/Backend/Django/"/>
    
    
      <category term="Django" scheme="https://morningchen.com/tags/Django/"/>
    
  </entry>
  
</feed>
